#use wml::debian::cdimage title="Een spiegelserver voor Debian-CD-beelden" BARETITLE=true
#use wml::debian::toc
#use wml::debian::translation-check translation="1.8"

# Last Translation Update by $Author$
# Last Translation Update at $Date$

<p>Om een spiegelserver voor Debian-CD-Beelden te hebben, moet u een Linux- of
Unix-machine hebben met een permanente, betrouwbare verbinding met het Internet.</p>

<p>De spiegelservers voor CD-beelden hebben gewoonlijk de jigdo-templates en
sommige hebben ook de volledige beelden. De templates worden bijgewerkt via 
rsync van <a href="../jigdo-cd/#which">één van de officiële locaties</a>, en de
volledige beelden worden bijgewerkt met 
<kbd>jigdo-mirror</kbd>.</p>

<toc-display/>

<hr>

<toc-add-entry name="httpftp">Waarom zijn FTP en HTTP <strong>niet</strong> bruikbaar</toc-add-entry>

<p>U zou FTP en HTTP <em>niet</em> moeten gebruiken om deze beelden te verkrijgen.
Deze transfermethodes hebben namelijk een grote kans op faling door de enorme
grootte van de bestanden.</p>

<p>Bovendien als de beelden een beetje wijzigen (zoals bij subreleases), dan
moet alle data opnieuw worden afgehaald. Dit geeft een hoge belasting op onze
computers en netwerkverbindingen.</p>

<toc-add-entry name="download">Afhalen via rsync</toc-add-entry>

<p>Omwille van bovenstaande redenen, gebruiken we het <a href="http://rsync.samba.org/">\
<tt>rsync</tt></a>-programma dat essentieel binaire bestanden patcht vanop 
afstand. Met <tt>rsync</tt>, worden subrelease-beelden zeer efficiënt bijgewerkt
omdat enkel de gewijzigde delen getransfereerd worden over het netwerk; de 
ongewijzigde delen worden gekopieerd van het oude beeld.</p>

<p>Voor sites die enkel Debian-CD-beelden willen aanbieden (en geen andere 
Debian-spiegelservers) en die geen snelle Debian (<kbd>debian/</kbd>) 
spiegelserver in de buurt hebben, raden we aan om dagelijks <kbd>rsync</kbd> 
te gebruiken via een cronjob.</p>

<p>U kunt een spiegelserver opzetten van elk van de sites in 
<a href="rsync-mirrors">deze spiegelserverlijst</a>.</p>

<p>Gebruik ten minste de opties <strong><kbd>--times --links --hard-links
--block-size=8192</kbd></strong>. Dit zal de datum van wijziging, symbolische
en harde koppelingen ongemoeid laten en een blokgrootte van 8192 bytes gebruiken
(efficiëntst voor CD-beelden). Wanneer de datum van wijziging en de grootte
hetzelfde zijn, zal <kbd>rsync</kbd> de bestanden ongemoeid laten, dus 
<tt>--times</tt> is echt nodig.</p>

<toc-add-entry name="jigdomirror">Beelden genereren met jigdo-mirror</toc-add-entry>

<p>Veel mensen beheren "gewone" Debian-spiegelservers (<kbd>debian/</kbd>),
of hebben zo'n spiegelserver in de buurt. Dit betekent dat ze de .debs die zich
in de CD-beelden bevinden, al hebben. De voor de hand liggende vraag is --
waarom kunnen we deze bestanden niet gebruiken voor de CD-beelden?</p>

<p><kbd>jigdo-mirror</kbd> is een programma dat toelaat om een Debian-CD-beeld
te genereren gebruikmakend van de bestanden van een "normale" spiegelserver,
plus een aantal extra jigdo-templatebestanden.</p>

<p>Merk op dat <kbd>jigdo-mirror</kbd> zich in jigdo 0.6.8 bevindt, maar deze
versie wordt niet verspreid in Debian 3.0 ("woody"). Dit betekent dat u het
afzonderlijk zult moeten verkrijgen, er is geen actueel probleem met het 
gebruik van de nieuwe versie op "woody".</p>

<p>Eerst hebt u de jigdo-templatebestanden nodig. Deze kunnen verkregen worden
op de meeste officiële sites, maar de twee primaire locaties zijn:</p>

<ul compact>
  <li><kbd>rsync us.cdimage.debian.org::jigdo-area/</kbd> (VS-spiegelserver)
  <li><kbd>rsync non-us.cdimage.debian.org::debian-jigdo/</kbd> (Europese spiegelserver)
</ul>

<p>Haal de bestanden af van de 
&lt;<var>versie</var>&gt;/jigdo/&lt;<var>architectuur</var>&gt;-submap,
voor elke architectuur waar u beelden wilt voor maken.</p>

<p>Maak het <kbd>~/.jigdo-mirror</kbd>-bestand aan om het programma in te stellen.
Dit is een voorbeeld:</p>

<pre>
jigdoDir="/waar/vind/ik/mirrors/debian-cd/current/jigdo"
imageDir="/waar/vind/ik/mirrors/debian-cd/current/images"
tmpDir="/waar/vind/ik/mirrors/debian-cd/current/images"
debianMirror="file:/waar/vind/ik/mirrors/debian"
nonusMirror="file:/waar/vind/ik/mirrors/debian-non-US"
include='i386/|sparc/|powerpc/|source/'; exclude='-1\.'
</pre>

<p>De <i>include</i>- en <i>exclude</i>-variabelen bevatten de lijst van 
architecturen waar u beelden wilt voor maken (reguliere expressies, eigenlijk). 
Voor meer informatie, zie de <kbd>jigdo-mirror</kbd>-manpagina of de broncode
(het is een shell-script met veel commentaar).</p>

<p>Nadat u het heeft ingesteld, voert u <kbd>jigdo-mirror</kbd> uit en het zal
alles automatisch doen. Het zal veel uitvoer genereren en waarschijnlijk een
tijdje in beslag nemen, dus we suggereren dat u dit voorziet (voer het uit in
screen, redirect de uitvoer naar een bestand enz.).</p>

<toc-add-entry name="pik">Beelden genereren met de pseudo-image kit en debcdmirror</toc-add-entry>

<p><tt>rsync</tt> doet nog altijd nog altijd volledige downloads voor alle 
"nieuwe" releases, omdat deze beelden bijna geen ongewijzigde delen hebben.
Echter, met de pseudo-image kit kunnen we "pseudo"-CD-beelden maken van data 
die al beschikbaar is op de dichtsbijzijnde Debian-FTP-spiegelserver - misschien
op uw lokale harde schijf. Dan kan <tt>rsync</tt> deze "pseudo-beelden" binair
patchen tegen de officiële. Ook voor de meeste subreleases is dit efficiënter 
dan het oude beeld te patchen.</p>

<p><strong>De informatie in deze sectie is misschien verouderd! Het is 
aangeraden om ofwel gewoon rsync te gebruiken ofwel jigdo-mirror te proberen.</strong></p>

<p>De pseudo image kit is vooral ontworpen om slechts enkele beelden af te 
halen, zoals de meeste mensen doen. Er is ook het <tt>debcdmirror</tt>-script
die spiegelservers <em>echt</em> gemakkelijkt maakt omdat het automatisch de
pseudo image kit en <tt>rsync</tt> gebruikt om uw spiegelserver up-to-date te
houden -- zelfs tot op het punt van automatisch van elk afgehalen beeld de
MD5-som te controleren. Met <tt>debcdmirror</tt>, kunt u ook exact specifiëren
waar u een spiegelserver wilt voor opzetten.</p>

<p>Handmatig gebruik van de pseudo image kit (misschien met <tt>rsync</tt> om
subreleases bij te werken) betekent veel werk en veel zorgen, dus we raden het
niet aan.

<p>Gebruik liever het <tt>debcdmirror</tt>-script (die "intern" gebruik maakt
van de Pseudo-Image Kit en <tt>rsync</tt>) (dagelijkse cronjob).</p>

<p>De laatsteversie van de 
<a href="http://cdimage.debian.org/~costar/pseudo-image-kit/">pseudo
image kit</a> en het 
<a href="http://cdimage.debian.org/~costar/debcdmirror/"><tt>debcdmirror</tt></a>-script 
zijn beschikbaar op de thuispagina van hun auteur. Lees de README's in beide
pakketten voor uitgebreide informatie over de procedures.</p>

<p><strong>Opmerkingen:</strong>

<p>Voor het <tt>debcdmirror</tt>-script, moet u een <tt>rsync</tt>-spiegelserver
kiezen die een "<tt>ls-lR</tt>"-bestand aanbiedt. Adressen vindt u op de 
<a href="rsync-mirrors">rsync-spiegelserverlijst</a>.</p>

<p>Als u geen lokale <a href="$(HOME)/mirror/">"gewone" Debian-FTP-spiegelserver</a>
heeft, bekijk dan de <a href="$(HOME)/mirror/list">lijst van spiegelservers</a>.</p>

<p><tt>debcdmirror</tt> vereist <tt>bash</tt> versie 2 of hoger. Dit is geen
probleem op een modern Debian-systeem. Indien nodig, kunt u dit in een 
niet-standaard lokatie installeren, maar wijzig dan het pad naar <tt>bash</tt> 
op de eerste regel van het script.</p>

<toc-add-entry name="test">Test-beelden</toc-add-entry>

<p>De "<tt><i>codenaam</i>_test</tt>"-mappen bevatten beelden die hard zijn
gekoppeld aan die in de versie- (v.b. <tt>2.2_r4</tt>) mappen. De 
versie-mapnaam zal wijzigen tussen (sub)releases, maar de namen in de 
"<tt>test</tt>"-mappen zullen hetzelfde blijven.</p>

<p>Dus in de <tt>rsync</tt>-situatie is een spiegelserver opzetten van beide,
de versie- en de juiste "<tt>test</tt>"-mappen, <em>en</em> gebruik maken van
de <tt>--hard-links</tt>-option de enige manier voor rsync om subreleases
juist bij te werken. [U mag <em>geen</em> "<tt>test</tt>"-mappen hebben met 
<tt>debcdmirror</tt>, omdat <tt>debcdmirror</tt> de dingen anders en efficiënter
aanpakt.]</p>

<toc-add-entry name="ls-lR">ls-lR bestanden</toc-add-entry>

<p>Het <tt>ls-lR</tt>-bestand beschrijft de mapstructuur van de spiegelserver.
Neem het <tt>ls-lR</tt>-bestand niet op in uw spiegelserver; maak ofwel
zelf één (elk uur via <tt>cron</tt> met de aangeboden "<tt>Makels-lR</tt>")
of gebruik gewoon helemaal geen <tt>ls-lR</tt>-bestand.
[<tt>debcdmirror</tt> zal automatisch een lokaal <tt>ls-lR</tt> maken.]</p>

<toc-add-entry name="serve">De bestanden aanbieden</toc-add-entry>

<p>Eens u de CD-beelden heeft verkregen wilt u starten met een spiegelserver
(i386- en broncode-CD's zijn het populairst), dit doet u door het 
<tt>rsync</tt>-serverprogram te draaien. Dit zal geen hoge belasting 
veroorzaken op uw machine en het zal veel minder netwerktraffiek met zich
meebrengen dan een FTP/HTTP-dienst.</p>

<p>Instructies om dit op te zetten vindt u in de README van de pseudo-image
kit. In het kort, voeg <kbd>rsync --daemon</kbd> toe aan uw 
<i>inetd</i>-configuratie, en stel <kbd>rsyncd.conf</kbd> in zoals u wenst.
We raden aan om de toegang te beperken tot een handvol verbindingen per 
IP-adres, en maximaal een dubbel aantal in het totaal.</p>

# TODO: include more stuff here rather than depending on pik, with examples

<toc-add-entry name="register">De spiegelserver registreren in onze lijsten</toc-add-entry>

<p>Om uw CD-beeldspiegelserver nuttig te maken voor een breder publiek, kunt u
het registreren in onze spiegelserverlijst zoals
<a href="../http-ftp/">deze</a> of <a href="rsync-mirrors">deze</a>.
Echter, omdat volledige beelden grote bestanden zijn, kan dit vele gigabytes 
netwerktraffief veroorzaken per dag.</p>

<p>U kunt uw spiegelserver registreren door ofwel 
<a href="$(HOME)/mirror/submit">het spiegelserveraanvraagformulier</a> in te
vullen (merk op dat de CDImage-* velden de belangrijke zijn), ofwel door een 
e-mail te sturen naar
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;debian-cd&#64;lists.debian.org">\
debian-cd&#64;lists.debian.org</a>.</p>

<p>We appreciëren alle nieuwe CD-beeldspiegelservers. Dank bij voorbaat!</p>
