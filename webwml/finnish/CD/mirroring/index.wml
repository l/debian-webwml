#use wml::debian::cdimage title="Debian CD-peilipalvelimen perustaminen" BARETITLE=true
#use wml::debian::toc
#use wml::debian::translation-check translation="1.8"

<p>Perustaaksesi Debian CD-vedoksia peilaavan palvelimen, tarvitset 
Linux- tai UNIX-tyyppisen koneen, jossa on pysyvä, luotettava 
Internet-yhteys.</p>

<p>Vedosten peileissä on yleensä jigdo-mallit sekä joissakin lisäksi
valmiit täydelliset vedokset.  Mallit yleensä päivitetään rsync:llä
jostain <a href="../jigdo-cd/#which">virallisista paikoista</a> ja
täydelliset vedokset päivitetään käyttämällä
<kbd>jigdo-mirror</kbd>:ia.</p>

<toc-display/>

<hr>

<toc-add-entry name="httpftp">Miksi FTP ja HTTP <strong>eivät</strong>
käy</toc-add-entry>

<p><em>Älä</em> käytä FTP/HTTP:tä vedosten hakuun. Näillä siirtomenetelmillä 
epäonnistuneen siirron todennäköisyys on suuri tiedostojen valtavan koon 
vuoksi.</p>

<p>Lisäksi, jos vedos muuttuu hiukankin (kuten on alijulkaisujen
kyseessäollessa), koko tiedosto on imuroitava uudelleen.  Tämä
kuormittaa kovasti koneitamme ja verkkoyhteyksiämme.</p>

<toc-add-entry name="download">Imurointi rsync:llä</toc-add-entry>

<p>Tämän vuoksi käytämme <a href="http://rsync.samba.org/">\
<tt>rsync</tt></a>-ohjelmaa joka varsinaisesti suorittaa etäkoneella 
binäärimuodossa tapahtuvan korjauksen.  <tt>rsync:in</tt>avulla, 
alijulkaisujen vedokset päivitetään tehokkaasti, sillä vain muuttuneet 
osat siirretään verkon kautta; muuttumattomat osat kopioidaan vanhasta 
vedoksesta.</p>

<p>Sellaisia tahoja, jotka haluavat pitää vain Debianin CD-vedoksia
(eikä mitään muita Debian-peilejä) ja joilla ei ole lähistöllä nopeaa
Debian-peiliä (<kbd>debian/</kbd>), suosittelemme käyttämään
<kbd>rsync</kbd>:iä päivittäisessä cron-työssä.</p>

<p>Voit peilata mitä tahansa <a href="rsync-mirrors">tältä listalta</a>
löytyvää palvelinta.</p>

<p>Käytä vähintään valitsimia <b><tt>--times --links --hard-links
--block-size=8192</tt></b>.  Tämä säilyttää muutosajan, symboliset ja
kovat linkit ja käyttää 8192 bitin lohkokokoa (tehokkain
CD-vedoksille).  Kun muutosajassa ja koossa ei ole eroja,
<tt>rsync</tt> ei koske tiedostoon, joten <tt>--times</tt> on
todellakin pakollinen.</p>

<toc-add-entry name="jigdomirror">Vedoksien luonti
jigdo-mirror:lla</toc-add-entry>

<p>Monet ihmiset ylläpitävät "tavallisia" Debian-peilejä
(<kbd>debian/</kbd>) tai heillä on sellainen lähistöllä.  Tämä
tarkoittaa, että heillä on jo .debit, jotka sisältyvät CD-vedoksiin.
Miksipä emme käyttäisi siis noita samoja tiedostoja CD-vedoksissa?</p>

<p><kbd>jigdo-mirror</kbd> on ohjelma, jolla jokainen voi luoda
Debian-CD-vedokset käyttäen tiedostoja "tavalliselta" peililtä sekä
muutamaa ylimääräistä jigdo-mallitiedostoa.</p>

<p>Huomaa että <kbd>jigdo-mirror</kbd> sisältyy jigdon versioon 0.6.8,
mutta tämä versio ei tule Debian 3.0 ("woody") kanssa.  Tämä
tarkoittaa, että sinun täytyy hankkia se erikseen, mitään varsinaista
ongelmaa sen käyttämisessä "woody"ssä ei ole.</p>

<p>Ensiksi tarvitset jigdo-mallitiedostot.  Nämä löydät useimmista
virallisista paikoista, mutta kaksi ensisijaista paikkaa ovat:</p>

<ul compact>
  <li><kbd>rsync us.cdimage.debian.org::jigdo-area/</kbd> (Yhdysvaltain peili)
  <li><kbd>rsync non-us.cdimage.debian.org::debian-jigdo/</kbd> (Euroopan peili)
</ul>

<p>Hae tiedostot
&lt;<var>versio</var>&gt;/jigdo/&lt;<var>arkkitehtuuri</var>&gt;\
-alihakemistosta jokaiselle arkkitehtuurille, joille haluat vedokset
luoda.</p>

<p>Luo <kbd>~/.jigdo-mirror</kbd>-tiedosto säätääksesi ohjelman.  Tämä
on esimerkki:</p>

<pre>
jigdoDir="/missä/pidät/peilejäsi/debian-cd/current/jigdo"
imageDir="/missä/pidät/peilejäsi/debian-cd/current/images"
tmpDir="/missä/pidät/peilejäsi/debian-cd/current/images"
debianMirror="file:/missä/pidät/peilejäsi/debian"
nonusMirror="file:/missä/pidät/peilejäsi/debian-non-US"
include='i386/|sparc/|powerpc/|source/'; exclude='-1\.'
</pre>

<p><i>include</i>- ja <i>exclude</i>-muuttujat sisältävät listan
arkkitehtuureista, joille haluat luoda vedokset (tai siis säännölliset
lausekkeet).  Lisätietoja löydät <kbd>jigdo-mirror</kbd>:n
manuaalisivulta tai itse lähdekoodista.  (Se on komentotulkin skripti,
jossa on paljon kommentteja).</p>

<p>Kun olet säätänyt sen, yksinkertaisesti aja <kbd>jigdo-mirror</kbd>
ja se tekee kaiken itse.  Se tulostaa paljon asioita ja kestää
hetkisen, joten suosittelemme ottamaan sen huomioon (aja esimerkiksi
screenissä, ohjaa tuloste tiedostoon, jne).</p>

<toc-add-entry name="pik">Vedoksien luonti PIK:llä ja
debcd-mirror:lla</toc-add-entry>

<p><tt>rsync</tt> yksin pystyy toki "täysin uusien" julkaisujen 
imurointiin, vaikka nuo vedokset eivät sisällä lainkaan muuttuneita 
osia.  Kuitenkin, "pseudo-image kit":in avulla voimme luoda 
"näennäisvedoksia" tiedosta joka on jo saatavilla lähimmältä Debian 
FTP-peililtä - mahdollisesti omalta kiintolevyltäsi.  Sen jälkeen 
<tt>rsync</tt> voi korjata nämä näennäisvedokset virallisia 
vastaaviksi.  Ja useimpien alijulkaisujen kohdallakin tämä on havaittu 
tehokkaammaksi kuin vanhan vedoksen korjaaminen.</p>


<p><strong>Tämän sivun tiedot ovat vanhentuneita! Käytä joko rsync:iä tai
kokeile jigdo-mirror:ia.</strong></p>

<p>"pseudo image kit" on suunniteltu pääasiassa yhden tai muutaman 
vedoksen imurointiin, kuten useimmat tekevätkin.  On olemassa myös 
<tt>debcdmirror</tt>-skripti joka tekee peilauksesta <em>todella</em> 
helppoa, koska se päivittää peilisi automaattisesti "pseudo image 
kit":iä ja <tt>rsync</tt>:iä käyttäen -- ja jopa tarkistaa 
automaattisesti imuroitujen vedoksien MD5-tarkistussummat.  
<tt>debcdmirror:in</tt> avulla voit myös määritellä tarkoin mitä 
haluat peilata.</p>

<p>Käyttämällä käsin pseudo-image kit:iä (ehkäpä <tt>rsync</tt>:n
kanssa päivitettäessä alijulkaisuja) tarkoittaa paljon työtä ja paljon
vaivoja, joten emme suosittele sitä.</p>

<p>Sen sijaan voit käyttää <tt>debcdmirror</tt>-skriptiä (joka
"sisäisesti" käytää Pseudo-Image Kit:iä ja <tt>rsync</tt>:iä)
(päivittäinen cron-työ).</p>

<p>Viimeisin versio 
<a href="http://cdimage.debian.org/~costar/pseudo-image-kit/">"pseudo
image kit":istä</a> ja 
<a href="http://cdimage.debian.org/~costar/debcdmirror/"><tt>debcdmirror</tt></a>-skriptistä 
löytyy tekijöidensä kotisivuilta.  Pakettien README-tiedostoissa on 
laajemmat ohjeet siitä kuinka homma hoidetaan.</p>

<p><strong>Huomautuksia:</strong>

<p><tt>debcdmirror</tt>-skriptille täytyy valita <tt>rsync</tt>-peili 
jolta löytyy "<tt>ls-lR</tt>"-tiedosto.  Osoitteet löytyvät 
<a href="rsync-mirrors">rsync-peilien listalta</a>.</p>

<p>Jos käytettävissäsi ei ole paikallista 
<a href="$(HOME)/mirror/">"tavallista" Debian FTP-peiliä</a>, valitse 
jokin <a href="$(HOME)/mirror/list">peilipalvelimien listalta</a>.</p>

<p><tt>debcdmirror</tt> vaatii <tt>bash</tt>-version 2, tai uudemman,
mikä ei ole ongelma missään modernissa Debian-järjestelmässä.
Tarvittaessa voit asentaa sen jonnekin muualle kuin oletushakemistoon, 
mutta muista myös muuttaa skriptin ensimmäisellä rivillä oleva 
<tt>bash</tt>-polku uutta vastaavaksi.</p>

<toc-add-entry name="test">Koevedokset</toc-add-entry>

<p>Hakemistot "<tt><i>koodinimi</i>_test</tt>" sisältävät vedokset, jotka ovat 
kovia linkkejä versioituihin (esim. <tt>2.2_r4</tt>) hakemistoihin.  
Versioidun hakemiston nimi muuttuu (ali)julkaisujen mukaisesti.</p>

<p>Siispä "<tt>test</tt>"-hakemiston nimet pysyvät samana.  Jotenka vain 
<tt>rsync:iä</tt> käytettäessä, sekä versioitujen että tarkoituksenmukaisten 
"<tt>test</tt>"-hakemistojen peilaus, <em>ja</em> 
<tt>--hard-links</tt>-valitsimen käyttäminen on ainoa keino alijulkaisujen 
kunnolliseen päivitykseen rsync:illä. ["<tt>test</tt>"-hakemistoja 
<em>ei</em> tule huomioida <tt>debcdmirror</tt>:ia käytettäessä, koska 
<tt>debcdmirror</tt> käsittelee asiat eri tavalla ja tehokkaammin.]</p>

<p><tt>ls-lR</tt>-tiedosto kertoo peilipalvelimen tiedostorakenteen.  
<strong>Älä</strong> peilaa <tt>ls-lR</tt>-tiedostoa; tee se itse 
(käyttämällä "<tt>Makels-lR</tt>"-skriptiä, tunnin välein <tt>cron</tt>:in 
avulla) tai älä tee <tt>ls-lR</tt>-tiedostoa lainkaan. [<tt>debcdmirror</tt> 
luo paikallisen <tt>ls-lR</tt>-tiedoston automaattisesti peilauksen 
jälkeen.]</p>

<toc-add-entry name="serve">Tiedostojen tarjoaminen</toc-add-entry>

<p>Kun olet hankkinut CD-vedokset jotka haluat peilata (i386- ja 
source-CD:t ovat yleisimpiä), käynnistä 
<tt>rsync</tt>-palvelinohjelma.  Tämä ei kuormita konettasi paljoa, ja 
aiheuttaa huomattavasti vähemmän verkkoliikennettä kuin 
FTP/HTTP-palvelu.</p>

<p>Ohjeita löydät pseudo-image kit:in README-tiedostosta.  Lyhyesti,
lisää <kbd>rsync --daemon</kbd> <i>inetd</i>-asetuksiisi ja säädä
<kbd>rsyncd.conf</kbd> sellaiseksi kuin haluat.  Suosittelemme
rajoittamaan pääsyn ainoastaan muutamaan yhteyteen per IP-osoite ja
vähintään tuplaamaan kaikkien yhteensä.</p>

# Kai tuo nyt tarkoittaa (siis sekä suomi että enkku), että tuplataan
# kaikkien yhteensä sallittujen yhteyksien määrä ja vähennetään per-IP
# yhteyksiä?

# TODO: include more stuff here rather than depending on pik, with examples

<toc-add-entry name="register">Rekisteröityminen meidän
peililistoillemme</toc-add-entry>

<p>Tehdäksesi CD-vedospeilisi hyödylliseksi laajalla yleisölle, voit
rekisteröidä sen meidän peililistallemme kuten <a
href="../http-ftp/">tämä</a> tai <a href="rsync-mirrors">tämä</a>.
Koska kuitenkin täydet vedokset ovat suuria tiedostoja, voi tämä
aiheuttaa usean gigatavun liiketeen päivässä.</p>

<p>Voit rekisteröidä peilisi joko täyttämällä <a
href="$(HOME)/mirror/submit">peili-ilmoituslomakkeen</a> (huomaa, että
CDImage-*-kentät ovat tärkeimmät) tai lähettämällä sähköpostia
(englanniksi) osoitteeseen <a
href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;debian-cd&#64;lists.debian.org">\
debian-cd&#64;lists.debian.org</a>.</p>

<p>Arvostamme kaikkia uusia CD-vedospeilejä.  Kiitos etukäteen!</p>
