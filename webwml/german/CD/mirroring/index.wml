#use wml::debian::cdimage title="Wie man einen Spiegel für Debian-CD-Images einrichtet" BARETITLE=true
#use wml::debian::toc
#use wml::debian::translation-check translation="1.8"
# $Id$
# Translator: Gerfried Fuchs <alfie@debian.org> 2002-01-20

<p>Um eine Spiegelsite für Debian-CD-Image zu werden, benötigen Sie einen Linux
oder Unix-ähnlichen Rechner mit einer permanenten, verlässlichen Anbindung ans
Internet.</p>

<p>Die CD-Image-Spiegel beherbergen üblicherweise die jigdo-Templates, und
einige beherbergen auch vorerstellte komplette Images. Die templates werden
gewöhnlich mit rsync von <a href="../jigdo-cd/#which">einem der offiziellen
Orten</a> aktualisiert, und die kompletten Images werden mittels
<kbd>jigdo-mirror</kbd> aktualisiert.</p>

<toc-display/>

<hr>

<toc-add-entry name="httpftp">Warum FTP und HTTP <strong>nicht</strong> passend sind</toc-add-entry>

<p>Sie sollten <em>nicht</em> FTP oder HTTP verwenden, um die Images zu
bekommen. Diese Transfer-Methoden haben eine hohe Fehlerquote wegen der
enormen Größe der Dateien.</p>

<p>Außerdem, falls sich das Image nur leicht ändert
(wie im Fall eines Sub-Releases), werden die gesamten Daten erneut
heruntergeladen. Das belegt unsere Computer und Netzwerk-Verbindungen mit
hoher Last.</p>


<toc-add-entry name="download">Über rsync herunterladen</toc-add-entry>

<p>Aus oben genannten Gründen verwenden wir das <a href="http://rsync.samba.org/">\
<tt>rsync</tt></a>-Programm, das im wesentlichen ein entferntes Binär-Patchen
durchführt. Mit <tt>rsync</tt> werden Sub-Release-Images sehr effizient
aktualisiert, da nur die geänderten Teile über das Netzwerk transferiert
werden müssen, die unveränderten Teile werden vom alten Image kopiert.</p>

<p>Für Sites, die nur Debian-CD-Images beherbergen wollen (und nicht
irgendwelche anderen Debian-Spiegel), und die keinen nahen/schnellen Debian
(<kbd>debian/</kbd>) Spiegel haben, empfehlen wir die Verwendung von
<kbd>rsync</kbd> in einem täglichen cron-Job.</p>

<p>Sie können von jeder der Sites in <a href="rsync-mirrors">dieser
Spiegel-Liste</a> spiegeln.</p>

<p>Verwenden Sie zumindest die Optionen <strong><kbd>--times --links
--hard-links --block-size=8192</kbd></strong>. Das wird die Änderungszeit,
symbolische und harte Links erhalten, und eine Block-Größe von 8192 Bytes
verwenden (am effizientesten für CD-Images). Wenn die Änderungszeit und die
Größe die gleichen sind, lässt <kbd>rsync</kbd> die Datei in Ruhe, daher ist
<tt>--times</tt> wirklich verpflichtend.</p>


<toc-add-entry name="jigdomirror">Images mit jigdo-mirror generieren</toc-add-entry>

<p>Viele Leute betreuen auch "reguläre" Debian-Spiegel (<kbd>debian/</kbd>),
oder haben einen solchen Spiegel in der Nähe. Dies bedeutet, dass sie bereits
die .debs haben, die in den CD-Images enthalten sind. Die offensichtliche
Frage ist -- wieso können wir diese gleichen Dateien in den CD-Images nicht
verwenden?</p>

<p><kbd>jigdo-mirror</kbd> ist ein Programm, das es einem erlaubt, ein
Debian-CD-Image unter Verwendung der Dateien eines "normalen" Spiegels
zuzüglich ein paar zusätzlichen jigdo-template-Dateien zu erstellen.</p>

<p>Beachten Sie, dass <kbd>jigdo-mirror</kbd> in jigdo 0.6.8 enthalten ist,
aber diese Version nicht mit Debian 3.0 ("woody") vertrieben wird. Dies
bedeutet lediglich, dass Sie sie sich seperat besorgen müssen, es gibt zur
Zeit keine Probleme damit, die neue Version auf "woody" zu verwenden.</p>

<p>Zu allererst benötigen Sie die jigdo-template-Dateien. Diese können von den
meisten offiziellen Sites bezogen werden, aber die zwei primären Orte
sind:</p>

<ul compact>
  <li><kbd>rsync us.cdimage.debian.org::jigdo-area/</kbd> (USA-Spiegel)
  <li><kbd>rsync non-us.cdimage.debian.org::debian-jigdo/</kbd> (Europäischer Spiegel)
</ul>

<p>Holen Sie sich die Dateien für jede Architektur aus dem
&lt;<var>version</var>&gt;/jigdo/&lt;<var>architektur</var>&gt;
Unterverzeichnis, für die Sie die Images bauen wollen.</p>

<p>Erstellen Sie eine <kbd>~/.jigdo-mirror</kbd> Datei, um das Programm zu
konfigurieren. Dies ist ein Beispiel:</p>

<pre>
jigdoDir="/wo/Sie/die/Spiegel/haben/debian-cd/current/jigdo"
imageDir="/wo/Sie/die/Spiegel/haben/debian-cd/current/images"
tmpDir="/wo/Sie/die/Spiegel/haben/debian-cd/current/images"
debianMirror="file:/wo/Sie/die/Spiegel/haben/debian"
nonusMirror="file:/wo/Sie/die/Spiegel/haben/debian-non-US"
include='i386/|sparc/|powerpc/|source/'; exclude='-1\.'
</pre>

<p>Die <i>include</i> und <i>exclude</i> Variablen enthalten die Liste von
Architekturen, für die Sie Images erstellen wollen (vielmehr reguläre
Ausdrücke). Für weitere Informationen lesen Sie die Handbuchseite von
<kbd>jigdo-mirror</kbd> oder den Quellcode selbst (es ist ein Shell-Skript mit
vielen Kommentaren).</p>

<p>Nachdem Sie es konfiguriert haben, rufen Sie einfach
<kbd>jigdo-mirror</kbd> auf, und es wird alles alleine tun. Es wird viele
Ausgaben produzieren und wahrscheinlich einige Zeit brauchen, daher schlagen
wir vor, dass Sie Schritte durchführen, damit umzugehen (es in screen
aufrufen, die Ausgabe in eine Datei umleiten, usw.).</p>


<toc-add-entry name="pik">Images mit dem Pseudo-Image Kit und debcdmirror erstellen</toc-add-entry>

<p><tt>rsync</tt> alleine lädt immer noch alles herunter für "alle neuen"
Releases, da diese Images praktisch keine unveränderten Teile enthalten.
Jedoch können wir mit dem Pseudo-Image-Kit ein "Pseudo"-CD-Image aus den Daten
erstellen, die bereits auf dem nächsten Debian-FTP-Spiegel verfügbar sind -
eventuell auf Ihrer lokalen Festplatte. Dann kann <tt>rsync</tt> diese
"Pseudo-Images" binär zu den offiziellen patchen. Und selbst für die meisten
Sub-Release-Images ist das effizienter als das alte Image zu patchen.</p>

<p><strong>Die Informationen in diesem Abschnitt könnten veraltet sein! Es
wird empfohlen, dass Sie entweder reines rsync verwenden, oder jigdo-mirror
ausprobieren.</strong></p>

<p>Das Pseudo-Image-Kit ist hauptsächlich dafür entworfen, nur eines oder
wenige Images herunterzuladen, wie es die meisten Leute tun. Es gibt auch das
<tt>debcdmirror</tt>-Skript, das das Spiegeln <em>wirklich</em> einfach macht,
da es das Pseudo-Image-Kit und <tt>rsync</tt> verwendet, um Ihren Spiegel
aktuell zu halten -- einschließlich des automatischen Prüfens der
MD5-Prüfsumme für jedes heruntergeladene Image. Mit <tt>debcdmirror</tt> können
Sie auch exakt spezifizieren, was Sie spiegeln wollen.</p>

<p>Die händische Verwendung des Pseudo-Image-Kits (vielleicht mit
<tt>rsync</tt>, um Unterreleases zu aktualisieren) bedeutet viel Arbeit und
viele Probleme, daher empfehlen wir es nicht.</p>

<p>Stattdessen sollten Sie das <tt>debcdmirror</tt>-Skript verwenden (das
"intern" das Pseudo-Image-Kit und <tt>rsync</tt> verwendet) (täglicher
Cron-Job).</p>

<p>Die neueste Version des
<a href="http://cdimage.debian.org/~costar/pseudo-image-kit/">\
Pseudo-Image-Kits</a> und des
<a href="http://cdimage.debian.org/~costar/debcdmirror/">\
<tt>debcdmirror</tt></a>-Skripts sind auf der Homepage ihres Autors
erhältlich. Lesen Sie die READMEs in beiden Paketen für umfassende
Informationen über die Prozeduren.</p>

<p><strong>Beachten Sie:</strong></p>

<p>Für das <tt>debcdmirror</tt>-Skript müssen Sie einen <tt>rsync</tt>-Spiegel
verwenden, der eine "<tt>ls-lR</tt>"-Datei bietet. Adressen gibt es auf der
<a href="rsync-mirrors">rsync-Spiegel-Liste</a>.</p>

<p>Falls Sie nicht einen lokalen <a href="$(HOME)/mirror/">"regulären"
Debian-FTP-Spiegel</a> haben, prüfen Sie die
<a href="$(HOME)/mirror/list">Liste der Spiegel-Sites</a>.</p>

<p><tt>debcdmirror</tt> benötigt <tt>bash</tt> Version 2 oder höher. Dies ist
auf einem modernem Debian-System kein Problem. Falls
nötig können Sie diese an einem Platz installieren, der nicht dem Standard
entspricht, aber vergessen Sie dann nicht, den Pfad zur <tt>bash</tt> in der
ersten Zeile des Skripts anzupassen.</p>


<toc-add-entry name="test">Test-Images</toc-add-entry>

<p>Die "<tt><i>codename</i>_test</tt>"-Verzeichnisse enthalten Images, die hart
verlinkt mit denen in den versionisierten (z.B. <tt>2.2_r4</tt>)
Verzeichnissen sind. Der Name des versionisierten Verzeichnisses wird sich
zwischen den (Sub-)Releases ändern, aber die Namen in den "<tt>test</tt>"-Verzeichnissen
werden die gleichen bleiben.</p>

<p>Daher, falls Sie nur
<tt>rsync</tt> verwenden, ist die einzige Möglichkeit für rsync die
Sub-Releases ordentlich zu aktualisieren, sowohl die versionisierten als auch
die entsprechenden "<tt>test</tt>"-Verzeichnisse zu spiegeln <em>und</em> die
<tt>--hard-links</tt>-Option zu verwenden. [Sie sollten <em>nicht</em> die
"<tt>test</tt>"-Verzeichnisse bei <tt>debcdmirror</tt> einbeziehen, da
<tt>debcdmirror</tt> diese Dinge anders und effizienter handhabt.]</p>


<toc-add-entry name="ls-lR">ls-lR-Dateien</toc-add-entry>

<p>Die <tt>ls-lR</tt>-Datei beschreibt die Verzeichnis-Struktur des Spiegel,
auf dem sie liegt. Spiegeln Sie <strong>nicht</strong> die <tt>ls-lR</tt>-Datei;
entweder erstellen Sie sie selbst (mit dem verfügbaren
"<tt>Makels-lR</tt>" jede Stunde über <tt>cron</tt>) oder haben Sie einfach
keine <tt>ls-lR</tt>-Datei. [<tt>debcdmirror</tt> wird automatisch ein lokales
<tt>ls-lR</tt> erstellen, nach dem Spiegeln.]</p>


<toc-add-entry name="serve">Die Dateien anbieten</toc-add-entry>

<p>Wenn Sie das CD-Image, das Sie spiegeln wollen (i386 und Source-CDs sind
die beliebtesten), erworben haben, sollten Sie das <tt>rsync</tt>-Server-Programm
laufen lassen. Das wird Ihren Rechner nicht mit einer hohen
Last überfordern, und wird viel weniger Netzwerk-Verkehr als ein
FTP/HTTP-Dienst benötigen.</p>

<p>Anleitungen, wie man dieses aufsetzt, finden sich im README des
Pseudo-Image-Kit. Kurz gesagt, fügen Sie <kbd>rsync --daemon</kbd> zu ihrer
<i>inetd</i>-Konfiguration hinzu, und stellen Sie die
<kbd>rsyncd.conf</kbd>-Datei ein, wie Sie es wünschen. Wir empfehlen, den
Zugriff auf eine Handvoll Verbindungen pro IP-Adresse zu beschränken, und
höchstens eine zweistellige Anzahl insgesamt.</p>

# TODO: include more stuff here rather than depending on pik, with examples

<toc-add-entry name="register">Den Spiegel für unsere Listen registrieren</toc-add-entry>

<p>Um ihren CD-Image-Spiegel für eine größere Anzahl von Personen nützlich zu
machen, können Sie ihn für unsere Spiegel-Liste wie
<a href="../http-ftp/">diese</a> oder <a href="rsync-mirrors">diese</a>
registrieren. Jedoch sind komplette Images große Dateien, das könnte Ihnen
also täglich viele Gigabyte an Netzwerkverkehr verursachen.</p>

<p>Sie können ihren Spiegel entweder durch das Ausfüllen des
<a href="$(HOME)/mirror/submit">Spiegel-Einreich-Formulars</a> registrieren
(beachten Sie, dass die CDImage-* Felder die wichtigen sind), oder indem Sie
eine E-Mail an
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;debian-cd&#64;lists.debian.org">\
debian-cd&#64;lists.debian.org</a> schicken.</p>

<p>Wir freuen uns auf jeden neuen CD-Image-Spiegel. Vielen Dank im
Vorhinein!</p>
