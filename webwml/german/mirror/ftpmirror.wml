#use wml::debian::template title="Einen Debian-Archiv-Spiegel erstellen"
#use wml::debian::toc
#include "$(ENGLISHDIR)/releases/woody/release.data"
#use wml::debian::translation-check translation="1.33"
# $Id$
# Translator: Thimo Neubauer <thimo@debian.org>

<toc-display/>

<p>Wenn ein Spiegelserver installiert ist, sollte er <a
href="submit">bei Debian registriert</a> werden, damit er in die
<a href="list">Liste der Spiegel</a> aufgenommen
werden kann. Anmelden kann man sich &uuml;ber ein
<a href="submit">einfaches Web-Formular</a>.</p>

<p>Probleme und Anfragen k&ouml;nnen Sie an
<email mirrors@debian.org> schicken.</p>


<toc-add-entry name="wherefrom">Von wo Spiegeln</toc-add-entry>

<p>Viele Leute denken, dass <code>ftp.debian.org</code> die vorschriftsmäßige
Adresse von Debian-Paketen ist und da es für Sie am Besten ist, von dort zu
spiegeln. Das ist <strong>nicht wahr</strong>. <code>ftp.debian.org</code> ist
lediglich einer von mehreren Servern, die von einem internen Debian-Server
aktualisiert werden.</p>

<p>Jeder der Server in der <a href="list-full">vollständigen Liste aller
Spiegel</a>, der das '<kbd>Type: Push-Primary</kbd>'-Tag besitzt, sollte fürs
Spiegeln gut geeignet sein.</p>

<p>Es gibt keinen wirklichen Unterschied zwischen den verschiedenen 
<em>Push-Primary</em> Spiegeln, soweit es das Spiegeln betrifft. Auf der
anderen Seite, wenn viele Leute ftp.debian.org verwenden (und
unglücklicherweise tun Sie das), verschwendet das unnötigerweise die
gespendete Bandbreite.</p>


<toc-add-entry name="how">Wie man spiegelt</toc-add-entry>

<p>Die bevorzugte Methode zum Spiegeln ist mit
<a href="http://packages.debian.org/stable/net/rsync.html">rsync</a>.</p>

<p>Beachten Sie: Während <kbd>wget</kbd> für kleine Sites ganz gut
arbeitet, ist es nicht so gut konfigurierbar wie rsync, deshalb wird es
nicht für diese Aufgabe empfohlen.</p>

<p>Hier einige Ratschläge für jene, die andere Methoden bevorzugen:</p>

<ul>
  <li>Führen Sie rsync mit zumindest diesen Optionen aus: <kbd>--recursive
      --times --links --hard-links --delete</kbd>.</li>

  <li>Falls Sie zusätzlichen Plattenplatz haben, verwenden Sie auch die
      <kbd>--delete-after</kbd> Option, um einige der temporären
      Aktualisierungsprobleme zu vermeiden.</li>

  <li>Falls Sie nicht genügend Plattenplatz haben, um alles zu spiegeln,
      verwenden Sie die <kbd>--exclude</kbd> Option, um Teile des Archivs vom
      Spiegeln auszunehmen. Üblicherweise beinhaltet dies verschiedene
      Architekturen, die Sie nicht wollen; zum Beispiel würde dies
      <em>alle</em> Architekturen ausschließen:
<: 
print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br>\n"
  foreach (sort keys %arches);
:>
      Lesen Sie ebenfalls den <a href="#partial">Abschnitt über teilweises
      Spiegeln</a>.</li>

  <li>Nachdem rsync mit dem Spiegeln fertig ist, fügen Sie einen Zeitstempel
      im <code>project/trace/</code> Verzeichnis des Debian-Spiegels hinzu,
      der nach ihrem Server benannt ist. Das heisst, dass Sie
      <kbd>date -u &gt; .../debian/project/trace/<var>ihr.server</var></kbd>
      aufrufen sollen, nachdem ihr tägliches rsync beendet ist; und
      <kbd>date -u &gt; .../debian-non-US/project/trace/<var>ihr.server</var></kbd>
      nach dem das tägliche non-US beendet ist, falls Sie debian-non-US
      spiegeln.</li>
</ul>


<h3>Anonymes rsync</h3>

<p>Sie k&ouml;nnen <a href="anonftpsync">dieses Skript</a> benutzen,
um das Archiv zu spiegeln. Folgen Sie einfach den Anweisungen im
Skript, um den Spiegel zu erstellen.</p>


<h3>Rsync mit Authentifizierung, von einem Push-Spiegel</h3>

<p>Push-Spiegeln ist eine Art des Spiegelns mit rsync, die wir
entwickelt haben, um die Zeit zu minimieren, die es ben&ouml;tigt, bis
&Auml;nderungen im Archiv die Spiegel erreichen.   Der Server-Spiegel
benutzt einen SSH-Trigger, um dem nachgeschalteten Spiegel
mitzuteilen, daß er sein Archiv aktualisieren soll.</p>

<p>Push-Spiegeln wird benötigt, um mehrere Server Synchron zu halten (wie die
Server in DNS round-robin-Aliasen wie <tt>ftp.us.debian.org</tt>), und wir
verwenden es gewöhnlich für unsere ersten und zweiten tier-Spiegel. Für
"normale" Spiegel benötigt diese Methode viel Aufwand, um es aufzusetzen, was
nicht viel Sinn hat gegenüber einem gut angepasstem cron-job.</p>

<p>Die Methode ist ziemlich sicher, da SSH so konfiguriert ist,
da&szlig; nur ein einziger Befehl ausgef&uuml;hrt wird.
Au&szlig;erdem l&auml;uft das eigentliche Spiegeln immer noch
"ziehenderweise" ab, so da&szlig; es nicht m&ouml;glich ist, den
Spiegel durch gef&auml;lschte Push-Spiegel zu besch&auml;digen.</p>

<p>Einige Spiegel-Verwalter haben aus Angst, das System f&uuml;r
andere zu &ouml;ffnen, eine gewisse Abneigung gegen diese
Spiegel-Methode gezeigt.  Das ist einfach <strong>nicht</strong> wahr.</p>

<p>Eine detailierte Beschreibung, wie dieses funktioniert, warum es
sicher ist und wie man einen Push-Spiegel aufsetzt, finden Sie <a
href="push_mirroring">hier</a>.</p>


<h3>Anonymes FTP mit 'mirror'</h3>

<p>Anonymes FTP war lange Zeit die Standardmethode zum Spiegeln. Das
Programm 'mirror' funktioniert gut mit dem Debian-Archiv. Wie Sie
vielleicht erraten haben, ist 'mirror' als Debian-Paket
erh&auml;ltlich. Wenn Sie das Debian-Paket installiert haben werden
Sie ein Beispielskript zum Spiegeln des FTP-Archivs in
/etc/mirror/packages/ftp.debian.org finden.</p>


<toc-add-entry name="partial">Teilweises Spiegeln</toc-add-entry>

<p>Aufgrund des bereits <a href="size">großen Umfangs des Debian-Archivs</a>
bevorzugen einige Leute, nur die Teile zu spiegeln, die sie auch benötigen.
Wenn Sie etwas ausschliessen wollen, sollten Sie Architekturen
ausschliessen.</p>

<p>Mit <a href="anonftpsync">anonftpsync</a> kann dies durch das Editieren der
EXCLUDE Variable geschehen. Sie können auch speziell geschriebene Skripte
verwenden, wie zum Beispiel
<a href="http://packages.debian.org/unstable/net/debmirror.html">debmirror</a>
(von Joey Hess und Joerg Wendland) oder
<a href="http://people.debian.org/~absurd/absurd_debmirror/">\
absurd_debmirror</a> (von Stephan Suerken). Wenn Sie der Meinung sind, daß zu
diesen etwas hinzugefügt werden sollte, kontaktieren Sie bitte die Autoren
(Kontaktinformationen sollten in den Skripten enthalten sein).</p>

<p>Wir empfehlen Ihnen dringenst, dass Sie die <tt>project/</tt>,
<tt>doc/</tt> und weiter Unterverzeichnisse inkludieren. Üblicherweise sind
diese nicht sehr gross und trotzdem für die Benutzer nützlich.</p>


<toc-add-entry name="when">Wann Spiegeln</toc-add-entry>

<p>Das Hauptarchiv wird alle 24 Stunden neu zusammengestellt.</p>

<p>Die Spiegel beginnen üblicherweise um 00:00 UTC herum zu aktualisieren,
aber das ist kein fixer Zeitpunkt.  Wir empfehlen es, täglich zu spiegeln,
einige Stunden danach; tatsächlich sollten Sie prüfen, ob die Site, von der
Sie spiegeln, eine Zeitstempel-Datei in ihrem <kbd>project/trace/</kbd>
Unterverzeichnis hinterlasst. Die Zeitstempel-Datei wird genauso wie die Site
benannt, und sie wird die Zeit der Beendigung der letzten
Spiegel-Aktualisierung enthalten. Fügen Sie ein paar Stunden zu dieser Zeit
hinzu (um sicher zu sein) und spiegeln Sie dann.</p>

<p>Die einfachste Art, um automatisch zu spiegeln, ist, den Prozess
t&auml;glich von cron aufrufen zu lassen. Weitere Informationen mit
<kbd>man crontab</kbd>.</p>

<p>Beachten Sie, falls ihre Site mit einem Push-Mechanismus angestoßen wird,
müssen Sie sich um all dies nicht kümmern.</p>


<toc-add-entry name="settings">Empfohlene zusätzliche
  Einstellungen</toc-add-entry>

<p>Wenn Sie planen, den Debian-Spiegel durch HTTP zur Verfügung zu
stellen, fügen Sie bitte die folgenden Einstellungen zur
Apache-Konfiguration (natürlich unter der Annahme, daß Sie Apache benutzen)
im <code>&lt;Directory <var>/pfad/zu/ihrem/debian/spiegel</var>&gt;</code>
Block hinzu, wobei <var>/pfad/zu/ihrem/debian/spiegel</var> der tatsächliche
Namen des Verzeichnisses sein sollte, indem sich ihr Spiegel befindet:</p>

<pre>
   Options +Indexes +FollowSymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
</pre>


<p>Dies erlaubt Verzeichnis-Indizes und stellt sicher, dass Symlink-Verfolgung
funktioniert. Die Datei-Namen in den Verzeichnis-Indizes werden nicht
abgeschnitten, und die (größtenteils nichtvorhandenen) Beschreibungen werden
nicht angezeigt.</p>
