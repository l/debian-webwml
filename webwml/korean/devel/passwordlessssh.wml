#use wml::debian::template title="rsync 사용 예제"
#use wml::debian::translation-check translation="1.1"

<P>다음은 웹과 ftp 사이트 모두를 미러하는 예제이다. 자신의 상황에 맞게
관련 있는 기계 이름과 디렉토리를 수정해야 한다.


<P>cron 작업을 이용하여 이것을 실행하고 있다면 lockfile이
유용하다. 어떤 이유 때문에 미러가 완전하지 않다면 다음 번에 미러가
실행되려고 할 때 전자우편을 받게 될 것이다. 문제가 어디에 있는지
추적해서 문제를 수정하고 lockfile을 지운다. 그리고 나면 다음 번에는
미러가 정상으로 동작할 것이다.

<blockquote>
<pre>
#!/bin/bash
set -e

lockfile -r 1 rsync.master.lock || exit 23

rsync -avz -e ssh --exclude .glbuild --delete &lt;machine&gt;:/web/debian.org/ debian.org
rsync -avz -e ssh --delete &lt;machine&gt;:/web/debian.org-local/ debian.org-local

echo FINISHED UPDATING WEB. WORKING ON FTP NOW.

rsync -avz --delete -e ssh &lt;machine&gt;:/debian debian

rm -f rsync.master.lock
</pre>
</blockquote>

<H3>암호를 물어보지 않게 ssh를 설정하는 방법:</H3>

앞에서 예로 든 스크립트는 ssh를 설정해 주지 않으면 암호를 물어볼
것이다. 먼저 ssh-keygen를 실행하고 암호[1]를 물어보면 그냥 return을
누른다. 다음으로 ~/.ssh/identity.pub의 내용을 미러 사이트의
~/.ssh/authorized_keys에 추가한다(이 파일은 반드시 모드가 600이어야
한다).  이제 ssh를 사용하여 미러사이트에 로그인하면 암호를 물어보지
않을 것이다.


<P>
[1] ssh를 빈 암호를 설정하면 자신이 미러링하고 있는 사이트에 침입자가
마음대로 접근하여 파괴할 것이다. 이와 같은 이유로 이것은 루트로
실행하면 결코 안 된다.


