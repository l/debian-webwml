<HTML>
<HEAD>
<!-- Created by texi2html 1.56k from hurd.texi on 29 June 1999 -->

<TITLE>Hurd Reference Manual - Bootstrap</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="hurd_1.html">first</A>, <A HREF="hurd_3.html">previous</A>, <A HREF="hurd_5.html">next</A>, <A HREF="hurd_17.html">last</A> section, <A HREF="hurd_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC14" HREF="hurd_toc.html#TOC14">Bootstrap</A></H1>

<P>
Bootstrapping<A NAME="DOCF3" HREF="hurd_foot.html#FOOT3">(3)</A> is the procedure by
which your machine loads the microkernel and transfers control to the
Hurd servers.




<H2><A NAME="SEC15" HREF="hurd_toc.html#TOC15">Bootloader</A></H2>

<P>
The <EM>bootloader</EM> is the first software that runs on your machine.
Many hardware architectures have a very simple startup routine which
reads a very simple bootloader from the beginning of the internal hard
disk, then transfers control to it.  Other architectures have startup
routines which are able to understand more of the contents of the hard
disk, and directly start a more advanced bootloader.


<P>
<A NAME="IDX1"></A>
<A NAME="IDX2"></A>
Currently, <EM>GRUB</EM><A NAME="DOCF4" HREF="hurd_foot.html#FOOT4">(4)</A> is the preferred GNU bootloader.
GRUB provides advanced functionality, and is capable of loading several
different kernels (such as Linux, DOS, and the *BSD family).


<P>
From the standpoint of the Hurd, the bootloader is just a mechanism to
get the microkernel running and transfer control to <CODE>serverboot</CODE>.
You will need to refer to your bootloader and microkernel documentation
for more information about the details of this process.




<H2><A NAME="SEC16" HREF="hurd_toc.html#TOC16">Server Bootstrap</A></H2>
<P>
<A NAME="IDX3"></A>


<P>
The <CODE>serverboot</CODE> program is responsible for loading and executing
the rest of the Hurd servers.  Rather than containing specific
instructions for starting the Hurd, it follows general steps given in a
user-supplied boot script.


<P>
To boot the Hurd, the microkernel must start <CODE>serverboot</CODE> as its
first task, and pass it appropriate arguments.  <CODE>serverboot</CODE> may
also be invoked while the Hurd is already running, which allows users to
start their own complete sub-Hurds (see section <A HREF="hurd_4.html#SEC19">Recursive Bootstrap</A>).




<H3><A NAME="SEC17" HREF="hurd_toc.html#TOC17">Invoking <CODE>serverboot</CODE></A></H3>

<P>
The <CODE>serverboot</CODE> program has the following synopsis:



<PRE>
serverboot -<VAR>switch</VAR>... [[<VAR>host-port</VAR> <VAR>device-port</VAR>] <VAR>root-name</VAR>]
</PRE>

<P>
Each <VAR>switch</VAR> is a single character, out of the following set:


<DL COMPACT>

<DT><SAMP>`a'</SAMP>
<DD>
Prompt the user for the <VAR>root-name</VAR>, even if it was already supplied
on the command line.

<DT><SAMP>`d'</SAMP>
<DD>
Prompt the user to strike a key after the boot script has been read.

<DT><SAMP>`q'</SAMP>
<DD>
Prompt the user for the name of the boot script.  By default, use
<TT>`<VAR>root-name</VAR>:/boot/servers.boot'</TT>.
</DL>

<P>
All the <VAR>switches</VAR> are put into the <CODE>${boot-args}</CODE> script
variable.


<P>
<VAR>host-port</VAR> and <VAR>device-port</VAR> are integers which represent the
microkernel host and device ports, respectively (and are used to
initialize the <CODE>${host-port}</CODE> and <CODE>${device-port}</CODE> boot
script variables).  If these ports are not specified, then
<CODE>serverboot</CODE> assumes that the Hurd is already running, and fetches
the current ports from the procserver (FIXME xref).


<P>
<VAR>root-name</VAR> is the name of the microkernel device that should be
used as the Hurd bootstrap filesystem.  <CODE>serverboot</CODE> uses this name
to locate the boot script (described above), and to initialize the
<CODE>${root-device}</CODE> script variable.




<H3><A NAME="SEC18" HREF="hurd_toc.html#TOC18">Boot Scripts</A></H3>
<P>
<A NAME="IDX4"></A>
<A NAME="IDX5"></A>


<P>
FIXME: finish




<H3><A NAME="SEC19" HREF="hurd_toc.html#TOC19">Recursive Bootstrap</A></H3>

<P>
The most appealing use of the <CODE>serverboot</CODE> program is to start a
set of core Hurd servers while another Hurd is already running.  You
will rarely need to do this, and it requires superuser privileges, but
it is interesting to note that it can be done.


<P>
Usually, you would make changes to only one server, and simply tell your
programs to use it in order to test out your changes.  This process can
be applied even to the core servers.  However, some changes have
far-reaching effects, and so it is nice to be able to test those effects
without having to reboot the machine.


<P>
Here are the steps you can follow to test out a new set of servers:



<OL>
<LI>

Create a new root partition.  Usually, you would do this under your old
Hurd, and initialize it with your favorite filesystem format.

<LI>

Copy the core servers, C library, and any of your modified programs onto
the new partition.

<LI>

Use some clever shadowfs hacks (FIXME xref) to mirror the rest of your
programs under the modified partition.  Copying them will work, too, if
you don't like shadowfs.

<LI>

Create a boot script on the new partition, in <TT>`/boot/servers.boot'</TT>.

<LI>

Run <KBD>serverboot -aqd <VAR>root-name</VAR></KBD>, where <VAR>root-name</VAR> is the
microkernel name for your new root device.
</OL>

<P>
Note that it is impossible to share microkernel devices between the two
running Hurds, so don't get any funny ideas.  When you're finished
testing your new Hurd, then you can run the <CODE>halt</CODE> or <CODE>reboot</CODE>
programs to return control to the parent Hurd.


<P>
If you're satisfied with your new Hurd, you can arrange for your
bootloader to start it, and reboot your machine.  Then, you'll be in a
safe place to overwrite your old Hurd with the new one, and reboot back
to your old configuration (with the new Hurd servers).




<H2><A NAME="SEC20" HREF="hurd_toc.html#TOC20">Shutdown</A></H2>
<P>
<A NAME="IDX6"></A>
<A NAME="IDX7"></A>


<P>
FIXME: finish


<P><HR><P>
Go to the <A HREF="hurd_1.html">first</A>, <A HREF="hurd_3.html">previous</A>, <A HREF="hurd_5.html">next</A>, <A HREF="hurd_17.html">last</A> section, <A HREF="hurd_toc.html">table of contents</A>.
</BODY>
</HTML>
