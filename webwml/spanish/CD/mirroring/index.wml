#use wml::debian::cdimage title="Convertirse en una réplica de imágenes de CDs de Debian" BARETITLE=true
#use wml::debian::toc
#use wml::debian::translation-check translation="1.7"

<p>Para llegar a ser una réplica de imágenes de CDs de Debian,
necesita una máquina Linux o de tipo UNIX con una conexión permanente y
fiable a Internetl.</p>

<p>Los sitios réplica de imágenes de CD normalmente contienen plantillas de
jigdo, y algunos imágenes completas pre-construidas. Las plantillas se
actualizan normalmente mediante rsync desde <a
href="../jigdo-cd/#which">uno de los sitios oficiales</a>, y las imágenes
completas se actualizan usando <kbd>jigdo-mirror</kbd>.</p>

<toc-display/>

<hr>

<toc-add-entry name="httpftp">Por qué <strong>no</strong> son adecuados FTP y HTTP</toc-add-entry>

<p><em>No</em> debería usar FTP ni HTTP para obtener las imágenes. Estos
métodos de transferencia tienen una alta probabilidad de fallo debido al
enorme tamaño de los archivos.</p>

<p>Más aún, si las imágenes cambian sólo ligeramente (como en el caso de
las subversiones), se han de bajar todos los datos de nuevo. Esto pone una
gran carga en nuestras computadoras y conexiones de red.</p>

<toc-add-entry name="download">Descarga mediante rsync</toc-add-entry>

<p>Por las razones argumentadas anteriormente, usamos el programa
<a href="http://rsync.samba.org/"><tt>rsync</tt></a> que esencialmente
realiza el parcheo remoto de binarios. Con <tt>rsync</tt>, las imágenes
de las subversiones se actualizan muy eficientemente, tan sólo se
transfieren las partes cambiadas por la red; las partes no cambiadas se
copian de la imagen antigua.</p>

<p>Para los sitios que sólo deseen incluir imágenes de CD de Debian (y no
otras réplicas de Debian), y que no tengan una réplica de Debian
(<kbd>debian/</kbd>) cercana/rápida, sugerimos el uso de <kbd>rsync</kbd>
en una tarea cron diaria.</p>

<p>Puede replicar de cualquiera de los sitios en <a
href="rsync-mirrors">esta lista de réplicas</a>.</p>

<p>Use al menos las opciones <strong><kbd>--times --links --hard-links
--block-size=8192</kbd></strong>. Esto mantendrá fechas de modificación,
enlaces simbólicos y reales, y usará un tamaño de bloque de 8192 bytes
(el más eficiente para imágenes de CD). Cuando la fecha de modificación y
el tamaño son iguales, <kbd>rsync</kbd> no descargará el fichero, de
manera que <tt>--times</tt> es realmente obligatorio.</p>

<toc-add-entry name="jigdomirror">Generar imágenes con jigdo-mirror</toc-add-entry>

<p>Mucha gente mantiene réplicas "regulares" de Debian
(<kbd>debian/</kbd>), o tienen una de esas réplicas cerca. Esto significa
que ya tienen los .deb que están incluidos en las imágenes de CD. La
pregunta obvia es ¿por qué no podemos usar esos mismos ficheros en las
imágenes de CD?</p>
<p><kbd>jigdo-mirror</kbd> es un programa que le permite a uno generar
imágenes de CD de Debian usando los ficheros de una réplica "normal", más
unos pocos ficheros de plantilla de jigdo.</p>

<p>Tenga en cuenta que <kbd>jigdo-mirror</kbd> se incluye en jigdo 0.6.8,
pero esta versión no está incluida en Debian 3.0 ("woody"). Esto significa
que tendrá que obtenerla por separado, no hay problema con usar la nueva
versión en "woody".</p>

<p>Lo primero de todo, necesita las plantillas de jigdo. Las puede
adquirir en la mayoría de los sitios oficiales, pero los dos lugares
principales son:</p>

<ul compact>
  <li><kbd>rsync us.cdimage.debian.org::jigdo-area/</kbd> (réplica de USA)
  <li><kbd>rsync non-us.cdimage.debian.org::jigdo-area/</kbd> (réplica europea)
</ul>

<p>Descargue los ficheros del subdirectorio
&lt;<var>versión</var>&gt;/jigdo/&lt;<var>arquitectura</var>&gt;,
por cada arquitectura para la que desee hacer imágenes.</p>

<p>Cree el fichero <kbd>~/.jigdo-mirror</kbd> para configurar el programa.
Un ejemplo:</p>

<pre>
jigdoDir="/where/you/keep/mirrors/debian-cd/current/jigdo"
imageDir="/where/you/keep/mirrors/debian-cd/current/images"
tmpDir="/where/you/keep/mirrors/debian-cd/current/images"
debianMirror="file:/where/you/keep/mirrors/debian"
nonusMirror="file:/where/you/keep/mirrors/debian-non-US"
include='i386/|sparc/|powerpc/|source/'; exclude='-1\.'
</pre>

<p>Las variables <i>include</i> y <i>exclude</i> contienen la lista de
arquitecturas para las que usted desea crear imágenes (expresiones
regulares, en realidad). Para más información, lea la página de manual de
<kbd>jigdo-mirror</kbd> o el código fuente (es un script de línea de
órdenes con muchos comentarios).</p>

<p>Tras haberlo configurado, simplemente ejecute <kbd>jigdo-mirror</kbd> y
eso hará todo por su cuenta. Mostrará un montón de información y
probablemente tarde mucho, de manera que le sugerimos que tome medidas al
respecto (ejecutarlo en screen, redirigir la salida a un fichero,
etc).</p>

<toc-add-entry name="pik">Generar imágenes con el pseudo-image kit y debcdmirror</toc-add-entry>

<p><tt>rsync</tt> no descarga por sí solo las versiones "completamente
nuevas", ya que esas imágenes virtualmente no contienen partes sin cambios.
Sin embargo, con el kit de pseudo imagen podemos crear "pseudo" imágenes
de CDs de los datos que están disponibles ya en la réplica de
Debian FTP más cercana - puede que en su propio disco duro local. Luego
<tt>rsync</tt> puede parchear el binario de esas "pseudo-imágenes" para
convertirlas en las oficiales. E incluso para la mayoría de las imágenes
de las subversiones se comprueba que es más eficiente que parchear la
imagen antigua.</p>

<p><strong>¡La información de esta sección puede estar obsoleta! Se
recomienda que use rsync o que pruebe jigdo-mirror.</strong></p>

<p>El kit de pseudo imagen está diseñado principalmente para descargar sólo
una o unas pocas imágenes, como hace la mayoría de la gente. También hay
el script <tt>debcdmirror</tt> que hace la réplica <em>realmente</em> fácil
porque utiliza automáticamente el kit de pseudo imagen y <tt>rsync</tt>
para mantener su réplica actualizada -- hasta el punto de verificar la suma
MD5 de cada imagen descargada automáticamente. Con <tt>debcdmirror</tt>,
puede espeficar exactamente lo que desea replicar.</p>

<p>El uso manual del kit de pseudo imagen (quizá con <tt>rsync</tt> para
actualizar la subversión) implica mucho trabajo y problemas, de manera que
no lo recomendamos.

<p>En su lugar, debería usar el script <tt>debcdmirror</tt> (que
"internamente" usa el Pseudo-Image Kit y <tt>rsync</tt>) (tarea cron
diaria).</p>

<p>La última versión del
<a href="http://cdimage.debian.org/~costar/pseudo-image-kit/">kit de
pseudo imagen</a> y el script de
<a href="http://cdimage.debian.org/~costar/debcdmirror/"><tt>debcdmirror</tt></a>
están disponibles en las páginas de sus autores. Lea los READMEs (LÉEMEs) de
ambos paquetes para información extensa sobre los procedimientos.</p>

<p><strong>Notas:</strong>

<p>Para el script <tt>debcdmirror</tt>, debe seleccionar una réplica
<tt>rsync</tt> que ofrezca un archivo "<tt>ls-lR</tt>". Las
direcciones están en la <a href="rsync-mirrors">lista de réplicas
de rsync</a>.</p>

<p>Si no tiene una <a href="$(HOME)/mirror/">réplica "regular" de
Debian</a>, verifique la <a href="$(HOME)/mirror/ftplist" >lista de
réplicas</a>.

<p><tt>debcdmirror</tt> requiere la versión de <tt>bash</tt> 2 o superior.
Esto no es problema en ninguna versión moderna de Debian. Si fuera
necesario, puede instalarlo en un sitio no estándar, pero asegúrese
entonces de actualizar la ruta hasta <tt>bash</tt> en la primera línea del
script.</p>

<toc-add-entry name="test">Imágenes de prueba</toc-add-entry>

<p>Los directorios "<tt><i>codename</i>_test</tt>" contienen imágenes que son
enlaces duros a los directorios versionados (por ejemplo, <tt>2.2_r6)</tt>).
El nombre del directorio versionado cambiará entre las (sub)versiones, pero
los nombres de los directorios de "<tt>test</tt>" permanecerán iguales.</p>

<p>Así, en la situación de sólo <tt>rsync</tt>, los directorios "<tt>test</tt>"
y el versionado apropiado se replicarán, <em>y</em> usar la opción
<tt>--hard-links</tt> es la única manera para que rsync actualice las
subversiones adecuadamente. [<em>No</em> debería incluir los directorios
"<tt>test</tt>" con <tt>debcdmirror</tt>, porque <tt>debcdmirror</tt>
manejará las cosas de forma diferente y más eficientemente.]</p>

<toc-add-entry name="ls-lR">Ficheros ls-lR</toc-add-entry>

<p>El archivo <tt>ls-lR</tt> describe la estructura de directorio de la
réplica en sí misma. <strong>No debe</strong> replicar el archivo
<tt>ls-lR</tt>; bien haga uno por sí mismo (con el "<tt>Makels-lR</tt>",
cada hora vía <tt>cron</tt>) o simplemente no tenga ningún archivo
<tt>ls-lR</tt>, [<tt>debcdmirror</tt> creará un <tt>ls-lR</tt> local
automáticamente tras hacer la réplica.]</p>

<toc-add-entry name="serve">Servir los ficheros</toc-add-entry>

<p>Una vez que haya adquirido las imágenes del CD que quiera replicar (las
más populares son i386 y source), debería ejecutar el programa servidor de
<tt>rsync</tt>. Esto no supondrá una carga pesada en su máquina, y generará
mucho menos tráfico de red que un servicio FTP/HTTP.</p>

<p>Las instrucciones para configurarlo están en el README - LÉAME - del kit de
pseudo imagen. En resumen, añada <kbd>rsync --daemon</kbd> en la
configuración de <i>inetd</i>, y configure <kbd>rsyncd.conf</kbd> a su
gusto. Recomendamos que limite el acceso a un puñado de conexiones por
dirección IP y algo así como el doble para el total, como mucho.</p>

# TODO: incluir más cosas aquí en lugar de depender de pik, con ejemplos

<toc-add-entry name="register">Registrar la réplica en nuestras listas</toc-add-entry>

<p>Para hacer útil su réplica de imágenes de CD a una mayor audiencia,
puede registrarla en nuestra lista de réplicas como
<a href="../http-ftp/">ésta</a> o <a href="rsync-mirrors">esta otra</a>.
Sin embargo, como las imágenes completas son ficheros grandes, esto podría
suponerle muchos gigabytes de tráfico de red diarios.</p>

<p>Puede registrar su réplica bien rellenando
<a href="$(HOME)/mirror/submit">el formulario de inclusión de réplicas</a>
(los campos CDImage-* son los importantes), o enviando un mensaje de
correo a
<a
href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;debian-cd&#64;lists.debian.org">\
debian-cd&#64;lists.debian.org</a>.</p>

<p>Agradecemos todas las nuevas réplicas de imágenes de CD. ¡Gracias!</p>
