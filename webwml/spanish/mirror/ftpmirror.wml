#use wml::debian::template title="Configuración de una réplica del archivo de Debian"
#use wml::debian::toc
#include "$(ENGLISHDIR)/releases/woody/release.data"
#use wml::debian::translation-check translation="1.39"

<toc-display/>

<p>Una vez ponga en marcha una réplica, debería <a
href="submit">registrarla en Debian</a> de manera que sea incluida en la
<a href="list">lista de réplicas</a>. Puede hacerlo
mediante nuestro <A href="submit">sencillo formulario web</A>.


<p>Cualquier problema o consulta puede enviarlo a
<email mirrors@debian.org>.</p>

<toc-add-entry name="what">Qué replicar</toc-add-entry>

<p>La <a href="./">página principal de réplicas</a> lista los archivos
disponibles de los cuales replicar.
<br>
Los usuarios buscarán el archivo debian/ para instalar Debian mediante
red, hacer CDs (con jigdo), y para actualizar sistemas ya instalados.
Aquellos interesados en los pocos paquetes con problemas no disponibles
para replicar desde los Estados Unidos, deberían buscar debian-non-US/.
<br>
El archivo debian/ es muy grande, mientras que el debian-non-US/ es
comparativamente pequeño. Por favor, lea la página de
<a href="size">tamaño de la réplica</a> si desea información más
precisa.</p>

<p>Nota: el archivo debian-non-US/ <strong>no</strong> es un superconjunto
del archivo debian/, sino un añadido opcional.</p>

<p>debian-cd es un archivo que no es idéntico en todos los servidores
réplica. En algunos sitios contiene plantillas jigdo para crear imágenes
de CD (usados en combinación con ficheros de debian/), algunos contienen
imágenes de CD preparadas, y otros sitios contienen ambos.
<br>
Por favor, lea la página sobre <a href="$(HOME)/CD/mirroring/">convertirse
en una réplica de imágenes</a> si quieres más información al respecto.</p>

<p>debian-archive/ contiene el verdadero <em>archivo</em>, las versiones
antiguas y obsoletas de Debian. Generalmente será interesante sólo para un
pequeño segmento de usuarios.</p>

<p>Los archivos debian-security contienen actualizaciones de seguridad
publicadas por el equipo de seguridad de Debian. Suena interesante para
todo el mundo, pero como las actualizaciones de seguridad son esporádicas,
habría que replicarlos a menudo para estar al día (o usar
<a href="push_mirroring">una réplica push</a>) de manera que no lo
recomiendo. Debian hace un gran esfuerzo para mantener la alta
disponibilidad de security.debian.org</p>

<toc-add-entry name="wherefrom">De dónde replicar</toc-add-entry>

<p>Mucha gente parece pensar que <code>ftp.debian.org</code> es el
sitio canónico o principal donde encontrar los paquetes de Debian,
y que lo mejor es replicar ese sitio. Eso <strong>no es
cierto</strong>. <code>ftp.debian.org</code> es simplemente uno de
entre varios servidores que se actualizan a partir de un servidor
interno de Debian.</p>

<p>Cualquiera de los servidores de la <a href="list-full">lista
completa de réplicas</a> que tengan la etiqueta '<kbd>Type:
Push-Primary</kbd>' deberían ser buenos sitios de los que replicar.

<p>No hay apenas diferencia entre differente <em>Push-Primary</em>
servidores en lo concerniente a la réplica. Por otra parte, si mucha
gente usa ftp.debian.org (y por desgracia, así es), se desperdicia el
ancho de banda que nos donan innecesariamente.</p>

<toc-add-entry name="methods">Cómo replicar</toc-add-entry>

<p>El método recomendado para hacer réplicas es usando 
<a href="http://packages.debian.org/stable/net/rsync">rsync</a>.</p>

<p>Nota: mientras que <kbd>wget</kbd> funciona bien cuando se replican
sitios pequeños, no es tan configurable como rsync, de manera
que no lo recomendamos para estas tareas.

<h3>Rsync anónimo</h3>

<p>Puede usar <a href="anonftpsync">este guión</a> para replicar el
archivo. Siga las instrucciones que contiene el guión para configurar
la réplica.

<p>Algunos consejos para aquellos que prefieran otros métodos:

<ul>
  <li>Use rsync al menos con estas opciones: <kbd>--recursive --times
     --links --hard-links --delete</kbd>.

  <li>Si tiene espacio en disco extra, use también la opción 
  <kbd>--delete-after</kbd> para evitar algunos problemas temporales 
  al realizar la actualización.

  <li>Si no tiene espacio suficiente para replicar todo, use la opción 
  <kbd>--exclude</kbd> para excluir partes del archivo. Usualmente esto incluye 
  varias arquitecturas que no desea; por ejemplo, esto excluiría <em>todas</em>
  las arquitecturas:
  <br>
<: 
print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br>\n"
  foreach (sort keys %arches);
:>
  Lea también la <a href="#partial">sección sobre las réplicas parciales</a>.

  <li>Después de que rsync termine de realizar la réplica, añada un fichero 
  con la hora al subdirectorio <code>project/trace/</code> del 
  que se llame como el nombre de su servidor de la réplica. Esto significa 
  ejecutar <kbd>date -u &gt; .../debian/project/trace/<var>nombre.servidor</var></kbd>
  después de que su rsync diario termine; y
  <kbd>date -u &gt; .../debian-non-US/project/trace/<var>nombre.servidor</var></kbd>
  después de que el rsync diario del archivo non-US termine, si hace réplica también
  del archuvo debian-non-US.
  
</ul>

<h3>Rsync con autenticación, de un sitio `push'</h3>

<p>El replicado `push' es una forma de réplica que usa rsync que hemos
desarrollado para minimizar el tiempo que tardan en llegar los cambios en
el archivo hasta las réplicas. El servidor replicado utiliza un disparador
mediante ssh para indicarle al cliente replicador que debe actualizarse.

<p>El replicado `push' es necesario para mantener la sincronización de
múltiples servidores (como servidores de alias de DNS en round-robin como
<tt>ftp.us.debian.org</tt>), y lo usamos comúnmente para los primeros y
segundos niveles de nuestros sitios de réplica. Para los sitios de réplica
"normales", este método precisa mucho esfuerzo en la configuración, lo que
no compensa con respecto a una tarea del cron bien ajustada.</p>

<p>El método es bastante seguro ya que ssh se configura para ejecutar
sólo una orden. Además, el replicado sigue siendo `pull', de manera que
<strong>no</strong> es posible corromper el contenido del archivo mediante
un servidor `push' falso. Algunos administradores de réplicas han mostrado
cierta reluctancia a la hora de usar este método de replicado debido a que
temen que el método pueda abrir sus máquinas ante una invasión. Esto,
sencillamente, <strong>no</strong> es cierto.

<p>Si desea una descripción más detallada de cómo funciona esto, por qué
es seguro, y cómo configurar un servidor `push', por favor lea <a
href="push_mirroring">la explicación completa</a>.

<h3>FTP anónimo</h3>

<p>El FTP anónimo fue el método estándar de réplica durante mucho tiempo,
pero ha quedado obsoleto en favor de rsync.</p>

<p>Si no puede usar rsync por alguna razón perentoria, puede serle útil el
programa "<a href="http://packages.debian.org/mirror">mirror</a>". Tenga
en mente que depende los ficheros ls-lR que le evitan mantener una réplica
adecuada de la traza que hay en el subdirectorio <kbd>project/trace/</kbd>
en las réplicas de Debian.</p>

<toc-add-entry name="partial">Réplicas parciales</toc-add-entry>

<p>Considerando el <a href="size">gran tamaño actual del archivo de
Debian</a>, hay gente que prefiere replicar sólo las partes que necesita.
Si quiere excluir algo, debería excuir arquitecturas.</p>

<p>Con <a href="anonftpsync">anonftpsync</a>, puede hacer esto editando la
variable EXCLUDE. También puede usar scripts escritos específicamente, como
<a href="http://packages.debian.org/unstable/net/debmirror">debmirror</a>
(de Joey Hess and Joerg Wendland). Si cree que debería añadírseles algo,
contacte por favor con los autores (la información de contacto debería venir
en los propios scripts).

<p>Le aconsejamos encarecidamente que no excluya <tt>project</tt>,
<tt>doc</tt> ni otros subdirectorios. Normalmente, su tamaño es pequeño
y aún son útiles para los usuarios.</p>

<toc-add-entry name="when">Cuándo replicar</toc-add-entry>

<p>El archivo principal se actualiza cada 24 horas.

<p>Las réplicas normalmente comienzan a actualizarse a las 00:00 UTC, pero 
ésta no es una hora fija. Recomendamos que actualice su réplica cada día, 
varias horas después de esto. De hecho, debería comprobar si el servidor 
desde el que usted realiza la réplica deja un fichero con la hora en que 
completó su réplica en su subdirectorio <kbd>project/trace/</kbd>. Este 
fichero se llamará como el servidor, y contendrá la hora a la que terminó
la actualización de dicha réplica. Añada un par de horas a ésa (para mayor
seguridad), y haga su réplica entonces.</p>

<p>La manera más sencilla de hacer que la réplica se ejecute diariamente
de forma automática es usar cron. Lea <kbd>man crontab</kbd> si desea más
detalles.

<p>Dése cuenta que si su mecanismo de réplica se lanza con un sistema de 
«push», entonces no debe preocuparse por nada de ésto.</p>
<toc-add-entry name="settings">Configuraciones adicionales recomendadas</toc-add-entry>

<p>Si va a dejar disponible mediante HTTP su réplica de Debian, añada por
favor estas opciones a la configuración de su Apache (presumiendo, por
supuesto, que use Apache), dentro del bloque
<code>&lt;Directory <var>/path/to/your/debian/mirror</var>&gt;</code>,
donde <var>/path/to/your/debian/mirror</var> debería ser el nombre real 
del directorio donde usted almacena la réplica:</p>


<pre>
&lt;directory /org/ftp.debian.org/ftp&gt;
   Options +Indexes +SymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
&lt;/directory&gt;
</pre>

<p>Esto activa los índices de directorio y asegura que se podrán seguir
los enlaces simbólicos. No se truncarán los nombres de ficheros en los
índices de los directorios, y no se mostrarán las descripciones
(prácticamente inexistentes).</p>
