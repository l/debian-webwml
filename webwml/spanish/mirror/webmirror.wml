#use wml::debian::template title="Réplicas del servidor web de Debian"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.47" maintainer="Jose G. López"
#include "$(ENGLISHDIR)/mirror/webmirrors.data"

<toc-display />

<toc-add-entry name="whynot">Por qué no necesitamos más sitios de réplica
de nuestra web</toc-add-entry>

<p>Las réplicas de nuestro sitio web precisan mantenimiento (un poco más
que el de las réplicas del FTP, quizá, ya que hay que modificar la
configuración de Apache de vez en cuándo) y supone un coste en recursos
para el patrocinador. Sin embargo, debido a la naturaleza de las páginas
web, que no hay que descargar con regularidad y que no importa si
llegan a 2 kbps o 30 kbps debido a su reducido tamaño, surge la
cuestión de la utilidad de tener réplicas del sitio web.</p>

<p>Hubo un tiempo en que las conexiones mundiales de Internet no eran
rápidas, y llegar a www.debian.org desde otro continente era complicado y
mucho más lento que una conexión de módem normal. De manera que
organizamos réplicas y aparecieron varios sitios web. Diez (u once, si
contamos Turquía) de ellos están en Europa.</p>

<p>Sin embargo, hoy en día tenemos rapidísimos enlaces de red,
especialmente en Europa, de manera que ya casi no hace falta tener tantas
réplicas. De hecho, debido al incremento en la velocidad de los enlaces de
red entre Europa y América, ni siquiera es lento acceder a www.debian.org
desde Europa.</p>

<p>Esta es básicamente la razón por la que ya no necesitamos más réplicas
del sitio web, especialmente en continentes en los que ya las hay. Por
favor, respete nuestra decisión. Gracias por su cooperación.</p>

<p>Si tiene alguna pregunta, envíe un mensaje a <a
href="mailto:mirrors@debian.org">mirrors@debian.org</a>.</p>

<hrline />

<toc-add-entry name="ref">Referencia de las réplicas actuales</toc-add-entry>

<p><strong>La información presentada de aquí en adelante se proporciona
sólo como referencia para los mantenedores de réplicas ya
existentes.</strong></p>


<h3>Proceso de replicación</h3>

<p>El método recomendado para hacer réplicas es usar rsync. No hay
acceso anónimo a los ficheros del sitio web. Puede configurar un acceso
autenticado con el responsable del sitio que desea replicar enviando un
mensaje a <a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.
</p>

<p>La replicación es un proceso de obtención (<q>pull</q>). Esto es,
el cliente pide los datos del
servidor a su conveniencia. Para configurarlo, puede usar el <a
href="websync">script websync</a> y <a href="websync.conf">su fichero de
configuración</a>, que puede ejecutar mediante crontab, lo que ejecuta el proceso
automáticamente. Siga las instrucciones del script para comprobar que
todo funciona correctamente.</p>


<h4>Hacer réplicas de un servidor <q>push</q></h4>

<p>La réplica <q>push</q> es una forma de replicar usando rsync que hemos
desarrollado para minimizar el tiempo que tarda en propagarse un cambio
en los ficheros hasta las réplicas. El servidor replicado usa un
disparador mediante ssh para indicarle al cliente replicador que ha de
actualizarse.
</p>

<p>Este método es bastante seguro ya que ssh se configura para ejecutar
sólo una orden. Además, la replicación sigue siendo <q>pull</q>, de manera que
<strong>no</strong> es posible corromper el contenido del fichero mediante
un servidor <q>push</q> falso. Algunos administradores de réplicas han mostrado
cierta reticencia a la hora de usar este método de replicación debido a que
temen que el método pueda abrir sus máquinas a un ataque. Esto,
sencillamente, <strong>no</strong> es cierto.</p>

<p>Si desea una descripción más detallada de cómo funciona esto, por qué
es seguro, y cómo configurar un servidor <q>push</q>, por favor lea <a
href="push_mirroring">la explicación completa</a>.
</p>


<h3>Cuándo replicar</h3>

<p>El sitio principal se actualiza aproximadamente cada cuatro horas.</p>

<p>Si su sitio replica mediante el método <q>push</q>, no necesita preocuparse
al respecto. En caso contrario, debería calcular el tiempo entre réplicas
para su sitio de acuerdo con la fecha en el registro horario de los
ficheros en el directorio <code>/mirror/timestamps/</code> del sitio web.
Añada un poco de tiempo, digamos media hora, a esa fecha, y replique
entonces.
</p>

<p>La manera más sencilla de hacer que la réplica se ejecute todos los
días es usar cron. Vea <kbd>man crontab</kbd> si desea más detalles.
</p>


<h3>Anunciando al patrocinador de la réplica</h3>

<p>Si lo desea, puede reemplazar la imagen <code>sponsor_img.jpg</code> por un 
logo (discreto) de su propia empresa u organización, y hacer que 
<code>sponsor.html</code> redirija a su propia página web. Por omisión, estos 
dos archivos no se replican. Los predeterminados se llaman 
<code>sponsor.deb.html</code> y <code>sponsor.deb.jpg</code>; aunque puede usar
estos nombres, le animamos a que proporcione su propia imagen. El tamaño máximo
sugerido para su logo es 120x60px.</p>

<p>Debido a que se usa <a href="#cn">negociación de contenido</a> en las
páginas web para seleccionar el lenguaje preferido, debería
proporcionar un <code>sponsor.html</code> en diferentes idiomas. Para
hacerlo, cree sponsor.&lt;idioma&gt;.html para cada &lt;idioma&gt; que
desee.
</p>

<p>Asegúrese de que añade a la lista de exclusión los ficheros que no
desea que sean sobreescritos durante la réplica.
</p>


<h3>Configurando el servidor web</h3>


<h4>Algunos cambios en el servidor web</h4>

<p>Si su máquina está ejecutando Debian, debe saber que se decidió ir contra la
norma de Debian y usar <code>/doc</code> en las páginas web. Esto
significa que debería comentar la línea
<q><code>Alias /doc/ /usr/share/doc/</code></q> que encontrará en su
<code>/etc/apache/srm.conf</code>.
</p>

<P>Nota: todos nuestros scripts CGI se ejecutan de forma centralizada en
cgi.debian.org, de manera que no tiene que preocuparse por ellos.</p>


<h4><a name="cn">Negociación de contenido</a></h4>

<p>La negociación de contenido es un método que permite a un navegador
negociar con un servidor el tipo de documento que debería serle suministrado.
Habiendo varios usos para esto, el más común es negociar el idioma en que
será presentado un documento. Usar esto permitirá a Debian servir sus
páginas en varios idiomas de una manera (técnicamente) muy elegante.
</p>

<p>Para aquellos que usen Apache, el cambio es casi trivial. Limítese a
añadir esta opción:</p>

<pre>
Options +Multiviews   
</pre>

<p>a la sección <code>&lt;Directory&gt;</code> para las páginas web de
Debian en su <kbd>/etc/apache/access.conf</kbd>, y reinicie el servidor.</p>

<p>Además, necesitará asegurarse de que el servidor puede controlar todos
los idiomas que hay en el sitio web. Esto se hace usando la etiqueta
<kbd>AddLanguage</kbd>. Lo que sigue es una lista de los idiomas que ya
se usan (más adelante añadiremos más):</p>

<pre>
  AddLanguage en .en
<:
foreach $l (keys %langs) { push @codes, $langs{$l}; }
foreach $c (sort @codes) { print "  AddLanguage $c .$c\n" if (($c ne "en") && ($c ne "zh")); }
:>  \
  AddLanguage pt-br .pt
  AddLanguage nb .nb
  AddLanguage zh-CN .zh-cn
  AddLanguage zh-HK .zh-hk
  AddLanguage zh-TW .zh-tw
</pre>

<p>Debido a un fallo en apache, bajo algunas circunstancias puede llegar a
servirse un idioma erróneo, de manera que es buena idea añadir cada
lenguaje servido a la opción LanguagePriority, de esta manera:</p>

<pre>
<:
print "LanguagePriority en fr es ";
foreach $c (sort @codes) { print "$c " if (($c ne "en") && ($c ne "fr") && ($c ne "es") && ($c ne "zh")); }
print "pt-br nb zh-CN zh-HK zh-TW\n";
:>\
</pre>

<p>Para evitar servir ficheros de contenido negociado con un conjunto de
caracteres erróneo, asegúrese de que la opción
<code>AddDefaultCharSet</code> está comentada o su valor es
<q><code>Off</code></q>.</p>

<p>Si usa Apache 1, para servir correctamente los índices de los 
directorios probablemente necesite modificar la sección 
<code>DirectoryIndex</code> en <code>/etc/apache/srm.conf</code>.
Esto no funcionará con Apache 2. Lo siguiente debería 
bastar para Apache 1:
</p>

<pre>
DirectoryIndex index index.html
</pre>

<p>Para enviar la cabecera «Content-Type» correcta para «favicon.icon»,
debería configurar Apache para que utilice el tipo «image/x-icon» de la siguiente
manera:</p>

<pre>
AddType image/x-icon .ico
</pre>

<p>Para enviar la cabecera «Context-Type» correcta para las entradas RSS,
se le tiene que indicar a Apache que use el tipo «application/rss+xml»,
así:</p>

<pre>
AddType application/rss+xml .rdf
</pre>

<p>Para enviar la cabecera «Content-Type» correcta para las traducciones en
Español de ficheros HTML, PDF y texto plano, se le tiene que indicar a Apache
que utilice los tipos correctos de esta manera:</p>

<pre>
&lt;Files *.html.es>
  ForceType text/html
&lt;/Files>

&lt;Files *.pdf.es>
  ForceType application/pdf
&lt;/Files>

&lt;Files *.txt.es>
  ForceType text/plain
&lt;/Files>
</pre>

<p>Para evitar problemas de negociación de contenido con el contenido de
<a href="../events/">/events</a>, a los ficheros de calendario hay que 
asignarles una prioridad menor que al contenido text/html:</p>

<pre>
AddType text/calendar;qs=0.9 .ics
</pre>


<h4>Redirecciones</h4>

<p>Como varias partes del sitio web están empezando a ser demasiado
grandes para ser replicadas en varios sitios, las hemos separado del sitio
principal. Aunque la mayoría de los enlaces deberían convertirse de
manera que usen las nuevas localizaciones, le invitamos a que añada
redirecciones a otros sitios de manera que no haya enlaces rotos. Esto lo
puede hacer en <kbd>/etc/apache/srm.conf</kbd>. Por ejemplo:</p>

<pre>
Redirect /Lists-Archives http://lists.debian.org/
Redirect /search http://search.debian.org
Redirect /Packages http://packages.debian.org
Redirect /lintian http://lintian.debian.org
</pre>

<h4>Hosts virtuales</h4>

<p>El sitio web de Debian, accedido a través de <a
href="$(HOME)">www.debian.org</a> y mediante una gran variedad de nombres, usa
una configuración GeoDNS para poder repartir la carga y seleccionar una réplica
cercana a la localización del usuario.</p>

<p>Por ese motivo, Apache debería proporcionar el sitio web de Debian por
medio de varios servidores de alojamiento virtuales, de esta manera:</p>

<pre>ServerAlias www.debian.org www.debian.com debian.org www.*.debian.org</pre>
