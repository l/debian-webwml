#use wml::debian::template title="Ejemplo de uso de rsync"
<!--translation 1.1.1.1-->

<P>Lo siguiente es un ejemplo que crear&aacute; una r&eacute;plica (mirror) tanto del sitio web como del sitio ftp.
Tedr&aacute; que modificar el nombre de la m&aacute;quina y de los directorios involucrados
para ajustarse a su situaci&oacute;n.

<P>El archivo cerradura (lockfile) es &uacute;til si ejecuta esto usando un trabajo cron. Si, por cualquier raz&oacute;n,
la copia no se completa, la pr&oacute;xima vez que intente ejecutar la copia obtendr&aacute; un
mensaje de correo. Entonces podr&aacute; investigar donde reside el problema, fijarlo, borrar el
archivo de cierre y la copia funcionar&aacute; adecuadamente la pr&oacute;xima vez que la ejecutemos.
<blockquote>
<pre>
#!/bin/bash
set -e

lockfile -r 1 rsync.master.lock || exit 23

rsync -avz -e ssh --exclude .glbuild --delete &lt;machine&gt;:/web/debian.org/ debian.org
rsync -avz -e ssh --delete &lt;machine&gt;:/web/debian.org-local/ debian.org-local

echo ACTUALIZACI&Oacute;N WEB TERMINADA. TRABAJANDO EN FTP AHORA.

rsync -avz --delete -e ssh &lt;machine&gt;:/debian debian

rm -f rsync.master.lock
</pre>
</blockquote>

<H3>Como establecer ssh de forma que no se nos pida la contrase&ntilde;a:</H3>

El script dado arriba le preguntar&aacute; por una contrase&ntilde;a a menos que establezca
ssh de cierta forma. Primero, cuando use ssh-keygen, simplemente presione retorno cuando
le pregunten una contrase&ntilde;a [1]. Luego, agrege el contenido
de ~/.ssh/identity.pub a ~/.ssh/authorized_keys en el sitio espejo (el
archivo deber&iacute;a tener modo 600).
Entonces, deber&iacute;a poder usar ssh para entrar en el sitio espejo sin
ser preguntado por una contrase&ntilde;a.

<P>
[1] Dese cuenta que establecer ssh con una contrase&ntilde;a vac&iacute;a da a cualquier intrusoNote that setting up ssh with a blank password gives an intruder free access
libre acceso al sitio que est&aacute; duplicando (mirroring) una vez que hayan forzado la entrada a su sitio.
Por esta raz&oacute;n, esto no deber&iacute;a hacerse nunca como root.

