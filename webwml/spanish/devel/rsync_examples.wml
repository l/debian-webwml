#use wml::debian::template title="Ejemplo de uso de rsync, y cómo configurarlo con ssh para que no pida contraseña"
#use wml::debian::translation-check translation="1.5"

<H3>Ejemplo de uso de rsync</H3>

<P>Lo siguiente es un ejemplo que creará una réplica tanto del sitio
web como del FTP. Tendrá que modificar el nombre de la máquina y de
los directorios involucrados para ajustarse a su situación.

<P>El archivo de bloqueo (lockfile) es útil si ejecuta esto usando un
trabajo cron. Si, por cualquier razón, la copia no se completa, la
próxima vez que intente ejecutar la copia obtendrá un mensaje de
correo. Entonces podrá investigar dónde reside el problema,
arreglarlo, borrar el archivo de bloqueo, y la copia funcionará
adecuadamente la próxima vez que la ejecute.
<blockquote>
<pre>
\#!/bin/sh -e

lockfile -r 1 rsync.master.lock || exit 23

rsync -avz -e ssh --exclude sponsor.* --delete &lt;máquina&gt;:/web/debian.org/ debian.org

echo Actualización de la réplica del web terminada. Trabajando en la réplica del FTP ahora...

rsync -avz --delete -e ssh &lt;máquina&gt;:/debian debian

rm -f rsync.master.lock
</pre>
</blockquote>

<p>El guión dado arriba le pedirá una contraseña a menos que configure
ssh como se describe más abajo.

<H3><a name="paswordlessssh">Cómo configurar ssh de forma que no nos
pida una contraseña</a>:</H3>

<p>Puede crear una clave de autenticación RSA para ser capaz de entrar
en un sitio remoto desde su cuenta, sin tener que escribir su
contraseña.

<p>Dése cuenta que una vez que lo configure así, si un intruso entra
en su cuenta/máquina, ¡tendrán también libre acceso al sitio del que
está replicando! Por esta razón, <strong>nunca</strong> debería
hacer esto como root.

<ul>
 <li>Ejecute ssh-keygen, y simplemente presione Enter cuando le
 pregunte una contraseña.
 <li>Luego, agrege el contenido de ~/.ssh/identity.pub a
 ~/.ssh/authorized_keys en la réplica (el fichero debería tener modo
 600).
</ul>

<p>Ahora debería poder usar ssh para entrar en la réplica remota sin
que se le pida una contraseña.
