#use wml::debian::cdimage title="Om at blive et filspejl af Debian-cd-aftryk" BARETITLE=true
#use wml::debian::translation-check translation="1.8"
#use wml::debian::toc

<p>For at oprette et filspejl med Debian-cd-aftryk, skal du bruge en Linux-
eller Unix-lignende maskine med en permanent, pålidelig forbindelse til 
Internet.</p>

<p>Filspejle med cd-aftryk fører normalt jigdo-skabeloner og nogle fører også
præ-opbyggede komplette aftryk.  Skabelonerne opdateres normalt ved hjælp af 
rsync fra <a href="../jigdo-cd/#which">et af de officielle steder</a>, og de
komplette aftryk opdateres ved hjælp af <kbd>jigdo-mirror</kbd>.</p>

<toc-display/>

<hr>

<toc-add-entry name="httpftp">Hvorfor FTP og HTTP <strong>ikke</strong> er velegnede</toc-add-entry>

<p>Du skal <em>ikke</em> bruge FTP eller HTTP for at hente aftrykkene. Disse
overførselsmetoder har en høj risiko for fejl på grund af filernes enorme 
størrelser.</p>

<p>Desuden, hvis aftrykkene kun ændrer sig ganske lidt (som det er tilfældet 
med mellemudgivelser), blive alle data hentet igen. Dette belaster vore 
computere og netværksforbindelser meget.</p>

<toc-add-entry name="download">Hent via rsync</toc-add-entry>

<p>Af de ovennævnte grunde bruger vi programmet 
<a href="http://rsync.samba.org/"><tt>rsync</tt></a>, som grundlæggende udfører 
binære fjern-ændringer (patching).  Med <tt>rsync</tt> bliver aftryk af 
mellemudgivelser opdateret meget effektivt, da kun de ændrede dele overføres 
over netværket; de uændrede dele kopieres fra det gamle aftryk.</p>

<p>For steder som kun ønsker at føre Debians cd-aftryk (og ikke andre 
Debian-filspejle), og som ikke har et nærtliggende eller hurtigt Debian-filspejl
(<kbd>debian/</kbd>), anbefaler vi at bruge <kbd>rsync</kbd> i et dagligt 
cronjob.</p>

<p>Du kan spejle fra hvilket som helst af stederne i <a href="rsync-mirrors">\
denne liste over spejle</a>.</p>

<p>Brug i hvert fald følgende parametre <strong><kbd>--times --links 
--hard-links --block-size=8192</kbd></strong>.  Dette vil bevare 
ændringstidspunktet, symlinks og hardlinks, og anvende en blokstørrelse på 8192 
bytes (det mest effektive for cd-aftryk).  Når ændringstidspunktet og 
størrelsen er uændrede, vil <kbd>rsync</kbd> blot lade filen være, så 
<tt>--times</tt> er egentlig obligatorisk.</p>

<toc-add-entry name="jigdomirror">Fremstilling af aftryk med jigdo-mirror</toc-add-entry>

<p>Mange vedligeholder "regulære" Debian-filspejle (<kbd>debian/</kbd>) eller
har et sådan filspejl i nærheden.  Dette betyder at de allerede har de 
.deb-filer, som er indeholdt i cd-aftrykkene.  Det indlysende spørgsmål er -
hvorfor kan vi ikke bruge de samme filer i cd-aftrykkene?</p>

<p><kbd>jigdo-mirror</kbd> er et program gør det muligt, at fremstille 
Debian-cd-aftryk med filer fra et "normalt" filspejl, plus nogle få ekstra
jigdo-skabelonfiler.</p>

<p>Bemærk at <kbd>jigdo-mirror</kbd> følger med jigdo 0.6.8, men denne version
distribueres ikke med Debian 3.0 ("woody").  Dette betyder blot, at du skal 
hente den separat, der er ikke noget problem ved at anvende den nye version på
"woody".</p>

<p>Først og fremmest skal du bruge jigdo-skabelonfilerne.  Disse kan hentes fra
de fleste officielle steder, men de to primære steder er:</p>

<ul compact>
  <li><kbd>rsync us.cdimage.debian.org::jigdo-area/</kbd> (filspejl i USA)</li>
  <li><kbd>rsync non-us.cdimage.debian.org::debian-jigdo/</kbd> (filspejl i Europa)</li>
</ul>

<p>Hent filerne fra undermappen 
&lt;<var>version</var>&gt;/jigdo/&lt;<var>architecture</var>&gt;, til hver 
arkitektur, som du ønsker at fremstille aftryk til.</p>

<p>Opret filen <kbd>~/.jigdo-mirror</kbd> til opsætning af programmet.  Her er
et eksempel:</p>

<pre>
jigdoDir="/hvor/du/har/filspejle/debian-cd/current/jigdo"
imageDir="/hvor/du/har/filspejle/debian-cd/current/images"
tmpDir="/hvor/du/har/filspejle/debian-cd/current/images"
debianMirror="file:/hvor/du/har/filspejle/debian"
nonusMirror="file:/hvor/du/har/filspejle/debian-non-US"
include='i386/|sparc/|powerpc/|source/'; exclude='-1\.'
</pre>

<p>Variablerne <i>include</i> og <i>exclude</i> indeholder lister over 
arkitekturer som du ønsker at fremstille aftryk til (eller rettere regulære
udtryk).  For flere oplysninger, se manualsiden <kbd>jigdo-mirror</kbd> eller
kildekoden selv (det er et shellscript med massevis af kommentarer).</p>

<p>Når du har opsat det, så udføres <kbd>jigdo-mirror</kbd> og det vil selv 
klare alt.  Det vil lave en masse uddata og måske tage nogen tid, så vi 
foreslår at du forbereder dig på at håndtere det (kører det i en konsol, 
omdirigerer uddataene til en fil, osv.).</p>

<toc-add-entry name="pik">Fremstilling af aftryk med pseudo-image kit og debcdmirror</toc-add-entry>

<p><tt>rsync</tt> alene henter stadig udgivelser som er "helt nye", da sådanne
aftryk stort set ikke indeholder uændrede dele. Men med pseudoaftryksværktøjet
("pseudo image kit") kan vi oprette "pesudo"-cd-aftryk ud fra data som allerede
er tilgængelige på det nærmeste af Debians ftp-filspejle - måske på din egen
lokale harddisk. <tt>rsync</tt> kan så binært ændre disse "pseudo-aftryk" til
de officielle aftryk. Selv for de fleste aftryk af mellemudgivelser har dette
vist sig at være mere effektivt end at ændre the gamle aftryk.</p>

<p><strong>Oplysningerne i dette afsnit kan være forældede!  Det anbefales at
du enten bruger almindelig rsync eller prøver jigdo-mirror.</strong></p>

<p>pseudoaftryksværktøjet er primært lavet med henblik på at hente kun et eller
nogle få aftryk, som de fleste gør det. Der er også scriptet 
<tt>debcdmirror</tt> som gør filspejl <em>særdeles</em> nemt fordi det 
automatisk bruger pseudoaftryksværktøjet og <tt>rsync</tt> til at holde dit 
filspejl ajour - sågar automatisk MD5-kontrol af alle hentede aftryk.  Med 
<tt>debcdmirror</tt> kan du også angive præcis hvad du ønske at filspejle.</p>

<p>Bruge af pseudoaftryksværktøjet manuelt (måske sammen med <tt>rsync</tt> til 
at opdatere mellemudgivelser), giver en masse arbejde og mange problemer, så vi
anbefaler det ikke.</p>

<p>I stedet bør du anvende scriptet <tt>debcdmirror</tt> (som "internt" bruger 
pseudoaftryksværktøjet, Pseudo Image Kit, og <tt>rsync</tt>) (dagligt 
cron-job).</p>

<p>Den seneste version af 
<a href="http://cdimage.debian.org/~costar/pseudo-image-kit/">\
pseudoaftryksværktøjet</a> og scriptet
<a href="http://cdimage.debian.org/~costar/debcdmirror/"><tt>debcdmirror</tt></a>
er tilgængelige fra forfatterens hjemmeside. Læs README-filer i begge pakker
for udførlige oplysninger om hvordan man gør.</p>

<p><strong>Bemærkninger:</strong>

<p>I forbindelse med scriptet <tt>debcdmirror</tt> skal du vælge et 
<tt>rsync</tt>-filspejl som har en "<tt>ls-lR</tt>"-fil. Du kan finde adresser
på <a href="rsync-mirrors">listen over rsync-filspejle</a>.</p>

<p>Hvis du ikke har et lokalt <a href="$(HOME)/mirror/">"regulært" 
Debian-filspejl</a>, kig i <a href="$(HOME)/mirror/list">listen over 
filspejle</a>.</p>

<p><tt>debcdmirror</tt> kræver <tt>bash</tt> version 2 eller højere.  Dette er
ikke et problem på moderne Debian-systemer.  Om nødvendigt kan du installere 
programmet i et ikke-standardsted, men så skal du huske at opdatere stien til 
<tt>bash</tt> i scriptets første linie.</p>

<toc-add-entry name="test">Testaftryk</toc-add-entry>

<p>Mappen "<tt><i>kodenavn</i>_test</tt>" indeholder aftryk som er 
'hard-linked' til versionerede mappenavne (for eksempel <tt>2.2_r4</tt>). 
Versionerede mappenavne ændrer sig fra (mellem)udgivelse til 
(mellem)udgivelse, men navnene i "<tt>test</tt>"-mapperne forbliver de 
samme.</p>

<p>I situationen kun-<tt>rsync</tt>, med spejling af både de versionerede
mapper og den passende "<tt>test</tt>"-mappe, <em>og</em> anvendelse af
parameteret <tt>--hard-links</tt> er den eneste korrekte måde at opdatere 
mellemudgivelser på. [Du bør <em>ikke</em> inkludere mappen "<tt>test</tt>"
med <tt>debcdmirror</tt>, fordi <tt>debcdmirror</tt> håndterer det på en anden
og mere effektiv måde.]</p>

<toc-add-entry name="ls-lR">ls-lR-filer</toc-add-entry>
 
<p>Filen <tt>ls-lR</tt> beskriver mappestrukturen på det filspejl den 
befinder sig på. Spejl <strong>ikke</strong> <tt>ls-lR</tt>-filen; enten skal
du lave en selv (ved hjælp af den medfølgende "<tt>Makels-lR</tt>", hver time
via <tt>cron</tt>) eller ved slet ikke at have en <tt>ls-lR</tt>-fil.
[<tt>debcdmirror</tt> opretter automatisk en lokal <tt>ls-lR</tt> efter at have 
fortaget en filspejling.]</p>

<toc-add-entry name="serve">Levering af filerne</toc-add-entry>

<p>Når du har anskaffet dig de cd-aftryk, som du ønsker at spejle (i386- og 
kildekode-cd'er er de mest populære), bør du køre serverprogrammet 
<tt>rsync</tt>. Dette vil ikke belaste din maskine ret meget, og vil resultere
langt mindre netværkstrafik end FTP-/HTTP-tjenesterne.</p>

<p>Vejledning i at opsætte dette befinder sig i pseudoaftryksværktøjets 
README-fil.  Kort og godt, tilføj <kbd>rsync --daemon</kbd> til din 
<i>inetd</i>-opsætning, og opsæt <kbd>rsyncd.conf</kbd> som det passer dig.
Vi anbefaler en adgangsbegrænsning til en håndfuld forbindelser pr. IP-adresse,
og højst et tocifret tal alt i alt.</p>

# TODO: include more stuff here rather than depending on pik, with examples

<toc-add-entry name="register">Registrering af filspejlet i vore lister</toc-add-entry>

<p>For at gøre de filspejl med cd-aftryk anvendeligt for et bredere publikum,
kan du registrere det i vore filspejlslister såsom 
<a href="../http-ftp/">denne</a> or <a href="rsync-mirrors">this one</a>.
Dette kan dog generere mange gigabytes daglig netværkstrafik, da de komplette
aftryk er store filer.</p>

<p>Du kan registrere dit filspejl enten ved at udfylde 
<a href="$(HOME)/mirror/submit">filspejlsformularen</a> (bemærk at felterne
CDImage-* er de vigtige), eller ved at sende en e-mail på engelsk til 
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;debian-cd&#64;lists.debian.org">\
debian-cd&#64;lists.debian.org</a>.</p>

<p>Vi er taknemmelige for alle nye filspejle med cd-aftryk. På forhånd tak!</p>
