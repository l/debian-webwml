#use wml::debian::template title="Opsætning af et Debian-arkivspejl"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.53"
#include "$(ENGLISHDIR)/releases/woody/release.data"

<toc-display/>

<toc-add-entry name="what">Hvad man spejler</toc-add-entry>

<p>Den <a href="./">primære side om spejling</a> oplyser de arkiver, som kan
spejles.

<ul>
    <li>Brugere kigger efter arkivet debian/ for at installere Debian over 
    netværket, til at opbygge cd'er fra (med jigdo) og til at opgradere 
    allerede installerede systemer.</li>

    <li>Arkivet debian-cd/ er ikke identisk på tværs af alle de forskellige 
    spejlingservere.  Nogle steder indeholder det jigdo-skabeloner til 
    opbygning af cd-aftryk (anvendes sammen med filer fra debian/), nogle 
    indeholder færdige cd-aftryk, mens nogle steder har begge dele.
    <br>
    Se siden om <a href="$(HOME)/CD/mirroring/">spejling af cd-aftrykkene</a> 
    for flere oplysninger om dette.</li>

    <li>debian-archive/ indeholder det egentlige <em>arkiv</em>, dvs. gamle og
    udgåede versioner af Debian.  Generelt er det kun interessant for et fåtal 
    af brugerne.</li>
</ul>

<p>Se siden om <a href="size">størrelser på filspejle</a> for mere præcise 
oplysninger om størrelser på filspejle.</p>

<p>Arkivet debian-security/ indeholder sikkerhedsopdateringer udsendt af
Debians sikkerhedsteam.  Der lyder interessant for alle, men da 
sikkerhedsopdateringer er sporadiske, er man nødt til at spejle det meget ofte,
for at være ajour (eller bruge <a href="push_mirroring">push-spejling</a>),
hvorfor vi ikke anbefaler det.  Debian gør i stedet meget ud af, at sørge for 
en højtilgængelighed af security.debian.org.</p>

<p>Bemærk: Arkivet debian-non-US/ har ikke været anvendt siden udgivelsen af
version 3.1 (<em>sarge</em>) i juni 2005.</p>


<toc-add-entry name="wherefrom">Hvor der kan filspejles fra</toc-add-entry>

<p>Mange lader til at tro, at <code>ftp.debian.org</code> er det kanoniske sted
for Debian-pakker og at det vil være bedst for dem at filspejle det ftp-sted.
Det er <strong>ikke rigtigt</strong>.</p>

<p><code>ftp.debian.org</code> er blot en af flere servere som opdateres fra en 
intern Debian-server.  Adressen befinder sig pt. på en enkelt server i USA, og
findes primært af hensyn til bagudkompatibilitet.</p>

<p>Hensigten med de <a href="official">officielle filspejle</a> er at de skal
være gode steder at spejle fra.  En hvilken som helst server på den 
<a href="list-full">fuldstændige liste over filspejle</a>, som har flagene 
'<kbd>Type: Push-Primary</kbd>' eller '<kbd>Type: Push-Secondary</kbd>' skulle 
være god at basere sit filspejl på.  Anvend venligst et filspejl, der både 
netværksgeografisk og fysisk er tæt på dig.</p>

<p>Der er i praksis ikke nogen forskel på de forskellige 
<em>Push-Primary</em>-filspejle, hvad angår spejlingen. På den anden siden, 
hvis mange bruger ftp.debian.org (og det gør de desværre) sker der et 
unødvendigt spild af den donerede båndbredde.</p>

<p>Filspejlsadministratorer i USA bør spejle fra ftp.us.debian.org (den
officielle filspejlsadresse i USA, som er et Push-Primary-filspejl).  Men da
denne adresse også er et <q>round-robin</q>-alias for flere maskiner, giver
det normalt mening at beslutte sig for, hvilken af dem det vil være bedst at
spejle fra.
<br>
<small>Fordelen derved, er at man undgår risiko for fejl ved udførelse af en
to-trins rsync (forskellige trin kan blive udført mod forskellige maskiner,
der på det givne tidspunkt kan have forskellige data, medførende en såkaldt
<q>race condition</q>).  Ulempen er at man anvender ét bestemt sted, hvis
tilgængelighed kan skifte, men det gælder pt. generelt hele vores netværk af
filspejle.</small></p>


<toc-add-entry name="how">Hvordan man spejler</toc-add-entry>

<p>Den anbefalede filspejlingsmetode er med det såkaldte skript 
<a href="anonftpsync">anonftpsync</a> via anonym
<a href="http://packages.debian.org/stable/net/rsync">rsync</a>.</p>

<p>Bemærk: mens <kbd>wget</kbd> og andre ftp-værktøjer lader til at fungere 
fint, er der nogle problemer.  Vi anbefaler kraftigt at bruge rsync.</p>


<h3>Anonym rsync</h3>

<p>Vi anbefaler at bruge <a href="anonftpsync">dette skript</a> til at lave et 
filspejl af arkivet. Følg instruktionerne i skriptet for at sætte 
filspejlingen op.</p>

<p>Her er nogle råd til dem der foretrækker andre metoder:</p>

<ul>
  <li>Kør rsync med i hvert fald disse parametre: <kbd>--recursive --times
      --links --hard-links --delete</kbd>.</li>

  <li>Hvis du har ekstra diskplads, så brug også parametret 
      <kbd>--delete-after</kbd> for at undgå nogle af de midlertidige 
      opdateringsproblemer.</li>

  <li>Hvis du ikke har diskplads nok til at spejle alt, så brug parametret 
      <kbd>--exclude</kbd> til at udelukke dele af arkivet fra spejlingen.
      Almindeligvis er dette forskellige arkitekturer som du måske ikke ønsker;
      for eksempel vil dette udlukke <em>alle</em> arkitekturer:
      <br>
<: 
print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br>\n"
  foreach (sort keys %arches);
:>
      Se også <a href="#partial">afsnittet om delvis spejling</a>.</li>

  <li>Når rsync er færdig med at spejle, tilføjes et tidsstemplingsfil til 
      undermappen <code>project/trace/</code> på Debian-spejlet, opkaldt
      efter din server.  Dette betyder at 
      <kbd>date -u &gt; .../debian/project/trace/<var>din.server</var></kbd>
      skal køres efter din daglige rsync er afsluttet; og 
      <kbd>date -u &gt; .../debian-non-US/project/trace/<var>din.server</var></kbd>
      efter den daglige non-US-rsync er afsluttet, hvis du spejler 
      debian-non-US.</li>
      
  <li>Vi fraråder kraftigt at fravælge <tt>project/</tt>, <tt>doc/</tt> og 
      andre undermapper.  Normalt er disse mindre i størrelse og alligevel
      nyttige for brugerne.  Særligt <tt>project/trace</tt> er meget nyttig
      hvis der er problemer med et filspejl.</li>
</ul>


<h3>Rsync med autentifikation, fra et 'push'-filspejl</h3>

<p>'Push'-filspejling er en form for spejling ved hjælp af rsync vi har 
udviklet for at minimere den tid det tager ændringer i arkivet at nå ud til 
filspejlene. Server-filspejlet anvender en ssh-udløser til at fortælle 
klient-filspejlet at det sker opdatere sig selv.</p>

<p>Push-filspejling er nødvendig hvis mange servere skal være synkrone (såsom
servere i DNS der på skrift svarer på et alias som <tt>ftp.us.debian.org</tt>),
og vi bruger det almindeligvis i forbindelse med vores primære og sekundære 
filspejle. I forbindelse med "normale" filspejle er det et stort arbejde at 
sætte op, som ikke er umagen værd i forhold til et veltilpasset cron-job.</p>

<p>Denne metode er ganske sikker da ssh er sat op til kun at køre en enkelt 
kommando. Desuden er spejlingen stadig 'pull' så det er <strong>ikke</strong>
muligt at ødelægge indholdet af arkivet ved hjælp af et forfalsket 
'push'-filspejl. Nogle administratorer af filspejle har vist sig utilbøjelige 
til at anvende denne form for filspejl af frygt for at deres maskiner vil være
åbne for angreb. Det er simpelthen <strong>ikke</strong> korrekt.</p>

<p>For en mere detaljeret beskrivelse af hvordan dette fungerer, hvorfor det er
sikkert, og hvordan man opsætter et 'push'-filspejl, se 
<a href="push_mirroring">den komplette beskrivelse</a>.</p>


<toc-add-entry name="partial">Delvis filspejling</toc-add-entry>

<p>Det allerede <a href="size">store Debian-arkiv</a> taget i betragtning, 
foretrækker nogle kun at spejle de dele som de har brug for. Hvis du ønsker at
fravælge noget, bør du fravælge arkitekturer.</p>

<p>Med <a href="anonftpsync">anonftpsync</a> kan dette gøres ved at ændre 
ARCH EXCLUDE-variablen.  Der er også andre særligt fremstillede skripter.  De 
er dog ikke velegnede til officielle filspejle.</p>

<p>Vi advarer kraftigt imod at fravælge mapperne <tt>project/</tt>, 
<tt>doc/</tt> og andre undermapper. Normalt er de ikke særligt store og 
alligevel nyttige for brugerne.  Særligt <tt>project/trace</tt> kan være meget
nyttigt hvis der er problemer med et filspejl.</p>


<toc-add-entry name="when">Hvornår man skal filspejle</toc-add-entry>

<p>Hovedarkivet opdateres to gange dagligt.  Filspejlene begynder normalt 
opdateringen omkring klokken 09.00 og 21.00 (begge UTC), men disse er ikke 
uforanderlige, og du skal ikke indstille din daglige spejling efter disse 
tider.</p>

<p>Vi anbefaler daglig spejling.  Opdatering af spejlet mere end to gange 
dagligt er nytteløst og vil formentlig føre til, at dit spejl bliver 
bandlyst &mdash; gør det ikke.</p>

<p>Dit spejl bør opdateres nogle få timer efter et af hovedfilspejlene er blevet
opdateret.  Du bør undersøge om det sted du spejler fra efterlader en 
tidsstemplingsfil i sin undermappe <kbd>project/trace/</kbd>.  
Tidsstemplingsfilen har samme navn som netstedet, og indeholder tidspunktet for
den seneste opdatering af filspejlet.  Læg et par timer til den tid (for at 
være på den sikre side) og start din filspejl på det tidspunkt.</p>

<p>Den nemmeste måde, automatisk at få filspejlet opdateret hver dag er at 
anvende cron. Se <kbd>man crontab</kbd> for flere oplysninger.</p>

<p>Bemærk, at den nemmeste måde at få spejlingen til at køre automatisk hver 
dag, er at bruge cron.  Se <kbd>man crontab</kbd> for flere oplysninger.</p>


<toc-add-entry name="settings">Yderligere anbefalet opsætning</toc-add-entry>

<p>Hvis du ønsker at gøre et Debian-filspejl tilgængeligt via HTTP, tilføj da
følgende indstillinger til din opsætning af Apache (naturligvis forudsat at du
bruger Apache) i blokken <code>&lt;Directory 
<var>/sti/til/dit/debian/spejl</var>&gt;</code>, hvor 
<var>/sti/til/dit/debian/spejl</var> ændres til navnet på den mappe, hvor
dit filspejl ligger:</p>

<pre>
   Options +Indexes +SymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
</pre>

<p>Dette slår mappeindeksering til og sikrer at man kan følge symbolske 
links.  Filnavnene i mappererne bliver ikke forkortet, og beskrivelserne 
(overvejende ikke-eksisterende) vises ikke.</p>

<p>I Apache 1.3.x kan følgende også tilføjes:</p>
     
<pre>
    DirectoryIndex .
</pre>
		     
<p>Brug ikke denne indstilling i Apache 2.x.</p>


<toc-add-entry name="submit">Hvordan et spejl føjes til spejllisten</toc-add-entry>

<p>Når et filspejl er blevet sat up, bør det <a href="submit">registereres hos 
Debian</a> for at blive optaget på <a href="list">listen over filspejle</a>.
Det gøres ved at benytte vores <a href="submit">simple webformular</a>.</p>

<p>Problemer eller forespørgsler stilles til <email mirrors@debian.org>.</p>
