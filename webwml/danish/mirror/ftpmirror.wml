#use wml::debian::template title="Opsætning af et Debian-arkivspejl"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.34"
#include "$(ENGLISHDIR)/releases/woody/release.data"

<toc-display/>

<p>Når et filspejl er blevet sat up, bør det 
<a href="submit">registereres hos Debian</a> for at blive optaget på
<a href="list">listen over filspejle</a>.
Det gøres ved at benytte vores <a href="submit">simple webformular</a>.</p>

<p>Problemer eller forespørgsler stilles til <email mirrors@debian.org>.</p>

<toc-add-entry name="wherefrom">Hvor der kan filspejles fra</toc-add-entry>

<p>Mange lader til at tro, at <code>ftp.debian.org</code> er det kanoniske sted
for Debian-pakker og at det vil være bedst for dem at filspejle det ftp-sted.
Det er <strong>ikke rigtigt</strong>. <code>ftp.debian.org</code> er blot en af
flere servere som opdateres fra en intern Debian-server.</p>

<p>En hvilken som helst server på den <a href="list-full">fuldstændige liste 
over filspejle</a> som har flaget '<kbd>Type: Push-Primary</kbd>' skulle være 
god at basere sit filspejl på.</p>

<p>Der er i praksis ikke nogen forskel på de forskellige 
<em>Push-Primary</em>-filspejle, hvad angår spejlingen. På den anden siden, 
hvis mange bruger ftp.debian.org (og det gør de desværre) sker der et 
unødvendigt spild af den donerede båndbredde.</p>

<toc-add-entry name="how">Hvordan man spejler</toc-add-entry>

<p>Den anbefalede filspejlingsmetode er med
<a href="http://packages.debian.org/stable/net/rsync.html">rsync</a>.</p>

<p>Bemærk: mens <kbd>wget</kbd> fungerer fint ved filspejling af små steder, er
det ikke så konfigurérbart som rsync og anbefales ikke til dette arbejde.</p>

<h3>Anonym rsync</h3>

<p>Du kan bruge <a href="anonftpsync">dette script</a> til at lave et filspejl
af arkivet. Følg instruktionerne i script'et for at sætte filspejlingen op.</p>

<p>Her er nogle råd til dem der foretrækker andre metoder:</p>

<ul>
  <li>Kør rsync med i hvert fald disse parametre: <kbd>--recursive --times
      --links --hard-links --delete</kbd>.</li>

  <li>Hvis du har ekstra diskplads, så brug også parametret 
      <kbd>--delete-after</kbd> for at undgå nogle af de midlertidige 
      opdateringsproblemer.</li>

  <li>Hvis du ikke har diskplads nok til at spejle alt, så brug parametret 
      <kbd>--exclude</kbd> til at udelukke dele af arkivet fra spejlingen.
      Almindeligvis er dette forskellige arkitekturer som du måske ikke ønsker;
      for eksempel vil dette udlukke <em>alle</em> arkitekturer:
      <br>
<: 
print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br>\n"
  foreach (sort keys %arches);
:>
      Se også <a href="#partial">afsnittet om delvis spejling</a>.</li>

  <li>Når rsync er færdig med at spejle, tilføjes et tidsstemplingsfil til 
      underkataloget <code>project/trace/</code> på Debian-spejlet, opkaldt
      efter din server.  Dette betyder at 
      <kbd>date -u &gt; .../debian/project/trace/<var>din.server</var></kbd>
      skal køres efter din daglige rsync er afsluttet; og 
      <kbd>date -u &gt; .../debian-non-US/project/trace/<var>din.server</var></kbd>
      efter den daglige non-US-rsync er afsluttet, hvis du spejler 
      debian-non-US.</li>      
</ul>


<h3>Rsync med autentifikation, fra et 'push'-filspejl</h3>

<p>'Push'-filspejling er en form for spejling ved hjælp af rsync vi har 
udviklet for at minimere den tid det tager ændringer i arkivet at nå ud til 
filspejlene. Server-filspejlet anvender en ssh-udløser til at fortælle 
klient-filspejlet at det sker opdatere sig selv.</p>

<p>Push-filspejling er nødvendig hvis mange servere skal være synkrone (så som
servere i DNS der på skrift svarer på et alias som <tt>ftp.us.debian.org</tt>),
og vi bruger det almindeligvis i forbindelse med vores primære og sekundære 
filspejle. I forbindelse med "normale" filspejle er det et stort arbejde at 
sætte op, som ikke er umagen værd i forhold til et veltilpasset cron-job.</p>

<p>Denne metode er ganske sikker da ssh er sat op til kun at køre en enkelt 
kommando. Desuden er spejlingen stadig 'pull' så det er <strong>ikke</strong>
muligt at ødelægge indholdet af arkivet ved hjælp af et forfalsket 
'push'-filspejl. Nogle administratorer af filspejle har vist sig utilbøjelige 
til at anvende denne form for filspejl af frygt for at deres maskiner vil være
åbne for angreb. Det er simpelthen <strong>ikke</strong> korrekt.</p>

<p>For en mere detaljeret beskrivelse af hvordan dette fungerer, hvorfor det er
sikkert, og hvordan man opsætter et 'push'-filspejl, se 
<a href="push_mirroring">den komplette beskrivelse</a>.</p>

<h3>Anonym ftp ved hjælp af 'mirror'</h3>

<p>Anonym ftp var i lang tid den gængse filspejlningsmetode. Til dette formål
fungerer programmet 'mirror' fint i forbindelse med Debians arkiv. Som du nok
har gættet er 'mirror' tilgængelig som en Debian-pakke. Hvis du har installeret
Debian-pakken, er der et eksempel på et script til filspejl af ftp-arkivet i
/etc/mirror/packages/ftp.debian.org .</p>

<toc-add-entry name="partial">Delvis filspejling</toc-add-entry>

<p>Det allerede <a href="size">store Debian-arkiv</a> taget i betragtning, 
foretrækker nogle kun at spejle de dele som de har brug for. Hvis du ønsker at
fravælge noget, bør du fravælge arkitekturer.</p>

<p>Med <a href="anonftpsync">anonftpsync</a> kan dette gøres ved at ændre 
EXCLUDE-variablen. Du kan også bruge specielt fremstillede scripts som 
<a href="http://packages.debian.org/unstable/net/debmirror.html">debmirror</a>
(af Joey Hess og Joerg Wendland).  Hvis du mener at noget bør føjes til disse 
scripts, så kontakt forfatterne (kontaktoplysninger skulle være at finde i 
scriptene selv).</p>

<p>Vi advarer kraftigt imod at fravælge katalogerne <tt>project/</tt>, 
<tt>doc/</tt> og andre underkataloger. Normalt er de ikke særligt store og 
alligevel nyttige for brugerne.</p>

<toc-add-entry name="when">Hvornår man skal filspejle</toc-add-entry>

<p>Hovedarkivet opdateres en gang i døgnet.</p>

<p>Filspejlene begynder normalt opdateringen ved 00:00-tiden UTC, men det er 
ikke et krav.  Vi anbefaler daglig spejling, flere timer efter dette tidspunkt,
faktisk bør du undersøge om det sted du spejler fra efterlader en
tidsstemplingsfil i sit underkatalog <kbd>project/trace/</kbd>.  
Tidsstemplingsfilen har samme navn som netstedet, og indeholder tidspunktet for
den seneste opdatering af filspejlet.  Læg et par timer til den tid (for at 
være på den sikre side) og start din filspejl på det tidspunkt.</p>

<p>Den nemmeste måde, automatisk at få filspejlet opdateret hver dag er at 
anvende cron. Se <kbd>man crontab</kbd> for flere oplysninger.</p>

<p>Bemærk, at den nemmeste måde at få spejlingen til at køre automatisk hver 
dag, er at bruge cron.  Se <kbd>man crontab</kbd> for flere oplysninger.</p>

<toc-add-entry name="settings">Yderligere anbefalet opsætning</toc-add-entry>

<p>Hvis du ønsker at gøre et Debian-filspejl tilgængeligt via HTTP, tilføj da
følgende indstillinger til din opsætning af Apache (naturligvis forudsat at du
bruger Apache) i blokken <code>&lt;Directory 
<var>/sti/til/dit/debian/spejl</var>&gt;</code>, hvor 
<var>/sti/til/dit/debian/spejl</var> ændres til navnet på det katalog, hvor
dit filspejl ligger:</p>

<pre>
   Options +Indexes +FollowSymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
</pre>

<p>Dette slår katalogindeksering til og sikrer at man kan følge symbolske 
links.  Filnavnene i katalogerne bliver ikke forkortet, og beskrivelserne 
(overvejende ikke-eksisterende) vises ikke.</p>
