#use wml::debian::template title="Configurare un mirror dell'archivio Debian"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.36" maintainer="Giuseppe Sacco"
#include "$(ENGLISHDIR)/releases/woody/release.data"

<toc-display/>

<p>Una volta che il mirror è configurato dovrebbe essere <a href="submit">\
registrato con Debian</a> in modo da essere incluso nella <a href="list">lista
dei mirror</a>. Le sottomissioni possono essere fatte usando il nostro 
<A href="submit">semplice modulo web</a>.

<p>Ogni problema o domanda può essere inviata a 
<email mirrors@debian.org>.</p>

<toc-add-entry name="wherefrom">Da dove copiare i dati</toc-add-entry>

<p>Molte persone credono che <code>ftp.debian.org</code> sia il posto migliore
dal quale scaricare tutti i pacchetti per creare un mirror.
Questo <strong>non è vero</strong>.
<code>ftp.debian.org</code> è semplicemente uno dei vari server internazionali
che vengono aggiornati da un altro server Debian.</p>

<p>Uno qualsiasi dei server nell'<a href="list-full">elenco completo dei
mirror</a> che è segnato come '<kbd>Type: Push-Primary</kbd>' è buono da
utilizzare come fonte.</p>

<p>Non c'è alcuna differenza reale tra i server <em>Push-Primary</em> per
quanto riguarda il mirroring. D'altro canto, se molte persone
utilizzano ftp.debian.org (e, sfortunatamente, lo fanno), questo spreca
inutilmente la banda donataci.</p>

<toc-add-entry name="how">Come copiare</toc-add-entry>

<p>Il metodo raccomandato di mirroring è usare 
<a href="http://packages.debian.org/stable/net/rsync.html">rsync</a>.</p>

<p>Nota: mentre <kbd>wget</kbd> lavora bene per copiare piccoli siti,
non è flessibile come rsync, per cui non è raccomandato
per questo compito.</p>

<h3>Rsync anonimo</h3>

<p>Puoi usare <a href="anonftpsync">questo script</a> per copiare
l'archivio. Segui le direttive dello script per configurare il mirroring.

<p>Ecco alcuni consigli per coloro che preferiscono metodi diversi:

<ul>
  <li>Eseguire rsync con almeno queste opzioni: <kbd>--recursive --times
      --links --hard-links --delete</kbd>.

  <li>Se si ha altro spazio disco, si utilizzi anche l'opzione
      <kbd>--delete-after</kbd> per evitare alcuni dei problemi temporanei
      durante l'aggiornamento.

  <li>Se non si ha sufficiente spazio disco per fare il mirror completo, si usi
      l'opzione <kbd>--exclude</kbd> per escludere porzioni dell'archivio dalla
      copia. Normalmente questo include alcune architetture che non si vogliono;
      per esempio questo escluderebbe l'architettura <em>all</em>:
     <br>
<: 
 print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br>\n"
  foreach (sort keys %arches);
:>
      Si veda inoltre la <a href="#partial">sezione sul mirror parziale</a>.

  <li>Dopo che rsync ha fatto la copia, si aggiunga un file che faccia da
      marca temporale nella sottodirectory <code>project/trace/</code> del
      mirro che si chiami come il proprio server. Vale a dire eseguire
      <kbd>date -u &gt; .../debian/project/trace/<var>your.server</var></kbd>
      dopo la copia quotidiana, e
      <kbd>date -u &gt; .../debian-non-US/project/trace/<var>your.server</var></kbd>
      dopo la copia di non-US, se si copia anche debian-non-US.
</ul>

<h3>Rsync con autenticazione, da un push mirror</h3>

<p>Il push mirroring è un tipo di
mirroring con rsync che abbiamo sviluppato per minimizzare il tempo
richiesto perché le modifiche all'archivio raggiungano i mirror.
Il server mirror usa una procedura ssh per dire al client mirror di
aggiornarsi.

<p>Il mirror di tipo push è necessario per mantenere vari server in sincrono
(come per i server in round robin sul DNS, come <tt>ftp.us.debian.org</tt>),
a normalmente li usiamo come mirror di primo e secondo livello.
Per mirror "normali" questo metodo è sconsigliato poiché lo sforzo necessario
per attivarlo e configurarlo è decisamente superiore di quello necessario per
avere un job cron ben fatto.</p>

<p>Questo metodo è abbastanza sicuro in quanto ssh è configurato
per lanciare un unico comando. Inoltre il mirroring è ancora di
tipo `pull', cosìcché <strong>non</strong> è possibile
corrompere il contenuto dell'archivio usando un falso
push mirror.
Alcuni amministratori di mirror hanno qualche riluttanza a usare
questo metodo di mirroring per paura di aprire le propria macchina
a intrusioni. Questo è semplicemente <strong>falso</strong>.

<p>Per una spiegazione più dettagliata di come il metodo lavora, perché 
è sicuro, e come configurare un push mirror, leggi 
<a href="push_mirroring">la spiegazione completa</a>.

<h3>FTP anonimo</h3>

<p>L'FTP anonimo è stato per molto tempo il metodo standard per copiare
verso i mirror, ma è stato ormai superato da rsync.</p>

<p>Se per una particolare ragione non è possibile utilizzare rsync, il
programma "<a href="http://packages.debian.org/mirror">mirror</a>" può
essere una valida alternativa. Si tenga presente che richiede i file ls-lR
per avere una traccia esatta del mirror nella sottodirectory
<kbd>project/trace/</kbd> di tutti i mirror Debian.</p>

<toc-add-entry name="partial">Mirroring parziale</toc-add-entry>

<p>Utilizzando <a href="anonftpsync">anonftpsync</a> si può modificare
la variabile EXCLUDE. Si possono anche utilizzare degli script appositi quali
<a href="http://packages.debian.org/unstable/net/debmirror.html">debmirror</a>
(di Joey Hess e Joerg Wendland).
Se pensi di aggiungere qualcosa ad essi, contatta gli autori (le
informazioni di contatto dovrebbero essere incluse negli script
stessi).</p>

<p>Scoraggiamo fortemente di escludere le directory <tt>project/</tt>,
<tt>doc/</tt> e altre sottodirectory. Normalmente esse sono di dimensioni
modeste e molto utili agli utenti.<p>

<toc-add-entry name="when">Quando copiare</toc-add-entry>

<p>L'archivio principale vien aggiornato ogni 24 ore.

<p>I mirror normalmente cominciano ad aggiornarsi attorno alle 00:00 UTC, ma
questo non è un orario fisso. Noi raccomandiamo di effettuare la copia ogni
giorno, alcune ore dopo. Infatti, si dovrebbe verificare se il sito dal quale
si copia abbia una marca temporale in <kbd>project/trace/</kbd>. Il file di
marca temporale avrà lo stesso nome del server e conterrà l'orario esatto
della fine dell'ultima copia. Si aggiungano un paio d'ore (per essere sicuri)
e si faccia partire la copia.</p>

<p>La maniera più semplice di avere la copia automatica ogni giorno 
è usare cron. Vedi <kbd>man crontab</kbd> per dettagli.

<p>Nota che se il proprio sito effettua la copia tramite il meccanismo di tipo
push allora non ci si deve preoccupare di ciò.</p>

<toc-add-entry name="settings">Configurazioni aggiuntive raccomandate</toc-add-entry>

<p>Se vuoi rendere il mirror Debian disponibile via HTTP, aggiungi
le istruzioni seguenti alla tua configurazione di Apache (presumendo
ovviamente, che usi Apache) nel blocco
<code>&lt;Directory <var>/percorso/per/il/mirror/debian</var>&gt;</code>
dove <var>/percorso/per/il/mirror/debian</var> deve essere il nome della
directory nella quale si mantiene il mirror:</p>

<pre>
   Options +Indexes +SymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
</pre>

<p>Questo abilita gil indici delle directory e si assicura di permettere
la leggibilità dei link simbolici. I nomi dei file negli indici delle
directory non saranno troncati e le (quasi inesistenti) descrizioni non
saranno mostrate.</p>
