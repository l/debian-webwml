#use wml::debian::template title="Creare un mirror dell'archivio Debian"
#use wml::debian::toc
#include "$(ENGLISHDIR)/releases/woody/release.data"
#use wml::debian::translation-check translation="1.39" maintainer="Daniele Cortesi"

<toc-display/>

<p>Una volta creato un mirror bisognerebbe <a href="submit">registrarlo su
Debian</a> per far s&igrave; che sia incluso nella nostra <a href="list">lista
di mirror</a>.
Le registrazioni possono essere effettutate usando il nostro 
<a href="submit">semplice web form</a>.

<p>Per ogni problema o domanda ci si pu&ograve; rivolgere a <email mirrors@debian.org>.</p>

<toc-add-entry name="what">Cosa mettere nel mirror</toc-add-entry>

<p>La <a href="./">pagina principale dei mirror</a> elenca gli archivi
disponibili.
<br>
Gli utenti cercheranno la directory debian/ per installare Debian via rete,
per scaricare i CD (usando jigdo), e per aggiornare sistemi gi&agrave;
installati. Gli interessati ai pochi pacchetti non disponibili per i mirror
negli Stati Uniti cercheranno debian-non-US/.
<br>
La directory debian/ &egrave; molto grande confrontata con debian-non-US/ che
&egrave; molto piccola. Controllate la pagina con <a href="size">la dimensione
dei mirror</a> per informazioni pi&ugrave; precise.</p>

<p>NB: la directory debian-non-US/ <strong>non</strong> comprende
debian/, al contrario &egrave; un'aggiunta opzionale.</p>

<p>debian-cd/ &egrave; una directory che non &egrave; identica su tutti i
mirror. Da qualche parte conterr&agrave; i template di jigdo per produrre le
immagini dei CD (insieme ai file contenuti in debian/), da altre
conterr&agrave; delle immagini gi&agrave; complete, in altri siti entrambi.
<br>
Controllate la pagina <a href="$(HOME)/CD/mirroring/">mirror delle immagini
dei CD</a> per ulteriori informazioni a riguardo.</p>

<p>debian-archive/ contiene il vero <em>archivio</em>: le vecchie e obsolete
versioni di Debian. Di solito &egrave; interesante solo per un piccolo numero
di utenti.</p>

<p>La directory debian-security/ contiene solamente gli aggiornamenti di
sicurezza rilasciati dal Debian Security team. Sembra interessante per tutti,
ma siccome gli aggiornamenti sono sporadici, bisognerebbe sincronizzare il
mirror molto spesso per essere aggiornati (o usare il
<a href="push_mirroring">push mirroring</a>) ed è per questo che non &egrave;
raccomandato. Debian si sforza al massimo per mantenere disponibile
security.debian.org.</p>

<toc-add-entry name="wherefrom">Da dove sincronizzarsi</toc-add-entry>

<p>Molte persone sembrano pensare che <code>ftp.debian.org</code> sia la
locazione canonica dei pacchetti Debian e che sarebbe meglio per loro
sincronizzarsi da quel sito. Questo <strong>non &egrave; vero</strong>.
<code>ftp.debian.org</code> &egrave; solamente uno dei tanti server che sono
aggiornati da un server interno di Debian.</p>

<p>Uno qualsiasi dei server nella <a href="list-full">lista completa dei
mirror</a> che ha il tag '<kbd>Type: Push-Primary</kbd>' dovrebbe essere una
buona fonte per sincronizzarsi.</p>

<p>Non c'&egrave; nessuna differenza tra i vari mirror <em>Push-Primary</em>
fintanto che il mirroring viene effettuato. D'altra parte, se molte persone
usassero ftp.debian.org (e purtroppo lo fanno), questo necessariamente
comporta uno spreco della banda che ci viene donata.</p>

<toc-add-entry name="how">Come sincronizzarsi</toc-add-entry>

<p>Il metodo raccomandato per sincronizzarsi &egrave;
<a href="http://packages.debian.org/stable/net/rsync">rsync</a>.</p>

<p>Nota: mentre <kbd>wget</kbd> funziona bene per il mirroring di piccoli
siti, non &egrave; configurabile come rsync, quindi non &egrave; raccomandato
per questo lavoro.</p>

<h3>rsync anonimo</h3>

<p>Si pu&ograve; utilizzare <a href="anonftpsync">questo script</a> per
sincronizzarsi con l'archivio. Si seguano le indicazioni nello script per
impostare il mirroring.

<p>Ecco qualche consiglio per coloro i quali preferiscono differenti metodi:

<ul>
  <li>Eseguite rsync con almeno queste opzioni: <kbd>--recursive --times
      --links --hard-links --delete</kbd>.

  <li>Se avete dello spazio su disco extra, usate anche l'opzione <kbd>--delete-after</kbd>
	  per prevenire qualche problema temporaneo di aggiornamento.

  <li>Se non avete spazio sufficiente per copiare ogni cosa, usate l'opzione
      <kbd>--exclude</kbd> per escludere porzioni di archivio dalla
	  sincronizzazione. Comunemente questo include le vare architetture che
	  non vi interessano; per esempio, questo escluderebbe <em>tutte</em> le
	  architetture:
      <br>
<: 
print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br>\n"
  foreach (sort keys %arches);
:>
      Consultate inoltre la <a href="#partial">sezione sul mirroring parziale</a>.

  <li>Dopo che rsync ha finito di sincronizzarsi, si aggiunga un file
      timestamp nella sottodirectory <code>project/trace/</code> del mirror
	  chiamata come il vostro server. Questo significa eseguire
      <kbd>date -u &gt; .../debian/project/trace/<var>vostro.server</var></kbd>
	  dopo che la sincronizzazione giornaliera &egrave; finita; e
      <kbd>date -u &gt; .../debian-non-US/project/trace/<var>vostro.server</var></kbd>
	  dopo che la sincronizzazione giornaliera di non-US &egrave; terminata,
	  se effettuate il mirror anche di debian-non-US.
</ul>

<h3>Rsync con autorizzazione, da un push mirror</h3>

<p>Il "push mirroring" &egrave; una forma di mirroring basata su rsync che
&egrave; stata sviluppata per minimizzare i tempi che impiegano i cambiamenti
dell'archivio a raggiungere i vari mirror. Il server di mirror usa un avviso
ssh per indicare al client di mirror di aggiornarsi.

<p>Il push mirroring &egrave; necessario per mantenere sincronizzati server
multipli (come i nostri server in DNS round-robin come
<tt>ftp.us.debian.org</tt>) ed &egrave; comunemente utilizzato da noi per i
nostri server di primo e secondo livello. Per i mirror "normali", questo
metodo richiede uno sforzo notevole di impostazione che non &egrave;
necessario, se confrontato con un cron job ben ottimizzato.</p>

<p>Il metodo &egrave; piuttosto sicuro dato che ssh &egrave; configurato per
eseguire solamente un semplice comando. Inoltre il mirroring &egrave; ancora
`pull' (via download) cos&igrave; che <strong>non</strong> &egrave; possibile
corrompere i contenuti dell'archivio attraverso un upload.
Qualche amministratore si &egrave; dimostrato riluttante ad adottare questo
metodo di mirroring per fantomatiche paure di una intrusione sulla macchina.
Semplicemente ci&ograve; <strong>non</strong> &egrave; vero.

<p>Per una descrizione pi&ugrave; del funzionamento, di perch&eacute; &egrave;
sicuro e per come creare un push mirror, consultate
<a href="push_mirroring">la spiegazione completa</a>.

<h3>Anonymous FTP</h3>

<p>Anonymous FTP &egrave; stato il metodo standard di sincronizzazione per
molto tempo, ma adesso &egrave; deprecato, in favore di rsync.</p>

<p>Se per qualche ragione non si pu&ograve; usare rsync, il programma
"<a href="http://packages.debian.org/mirror">mirror</a>" potrebbe essere
utile. Si tenga in mente che fa affidamento a dei file ls-lR che gli
permettono di mantenere il mirror correttamente aggiornato nella sottodirectory
<kbd>project/trace/</kbd> dei mirror Debian.</p>

<toc-add-entry name="partial">Mirroring parziale</toc-add-entry>

<p>Considerando le gi&agrave;  <a href="size">grandi dimensioni dell'archivio
Debian</a>, alcune persone preferisono fare il mirroring solo delle parti di
cui hanno bisogno. Se si vuole escludere qualcosa si dovrebbero escludere le
architetture.</p>

<p>Con <a href="anonftpsync">anonftpsync</a>, questo si pu&ograve; fare
utilizzando la variabile EXCLUDE. Si possono anche usare script scritti
appositamente, come <a href="http://packages.debian.org/unstable/net/debmirror">\
debmirror</a> (di Joey Hess e Joerg Wendland).  Se vi sembra che qualcosa
debba essere aggiunto a questi script, contattate gli autori (le informazioni
per contattarli dovrebbero essere incluse negli script stessi).</p>

<p>Vi scoraggiamo fortemente ad escludere le directory <tt>project/</tt>, <tt>doc/</tt>
e le altre sottodirectory. Di solito hanno una dimensione minore e sono ancora
utili agli utenti.</p>

<toc-add-entry name="when">Quando sincronizzarsi</toc-add-entry>

<p>L'archivio principale viene aggiornato ogni 24 ore.

<p>I mirror iniziano l'aggiornamento approssimativamente alle 00:00 UTC ma non
&egrave; un tempo fissato. &Egrave; consigliabile sincronizzarsi ogni giorno, molte ore
dopo; andrebbe controllato se il mirror utilizzato per sincronizzarsi crea un
file timestamp nella sua directory <kbd>project/trace/</kbd>. Il file di
timestamp sar&agrave; chiamato come il sito, e conterr&agrave; l'orario di
completamento dell'ultimo aggiornamento. Aggiungete un paio di ore da
quell'orario (per essere sicuri) e sincronizzatevi a quell'ora.</p>

<p>La maniera pi&ugrave; semplice sincronizzarsi ogni giorno &egrave; usare
cron. Consultate <kbd>man crontab</kbd> per dettagli.

<p>Notate che se il vostro sito &egrave; avvisato tramite un meccanismo di
push, allora non vi dovete preoccupare di questo.</p>

<toc-add-entry name="settings">Ulteriori impostazioni raccomandate</toc-add-entry>

<p>Se state creando un mirror Debian disponibile via HTTP per favore
aggiungete le seguenti impostazioni alla vostra configurazione di Apache
(supponendo naturalmente che stiate usando Apache) nel blocco
<code>&lt;Directory <var>/percorso/al/vostro/mirror/debian</var>&gt;</code>
dove <var>/percorso/al/vostro/mirror/debian</var> dovrebbe essere il percorso
alla directory che contiene la copia dell'archivio Debian:</p>

<pre>
   Options +Indexes +SymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
</pre>

<p>Questo abilita l'indice delle directory e si assicura che funzionino i
link simbolici. I nomi dei file nell'indice delle directory non saranno troncati e le
descrizioni (pressoch&eacute; inesistenti) non saranno mostrate.</p>
