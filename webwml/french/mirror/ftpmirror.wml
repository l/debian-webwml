#use wml::debian::template title="Mettre en place un miroir FTP"

#use wml::debian::translation-check translation="1.16" translation_maintainer="Christian Couder"


<p>Faire tourner un miroir revient au même que le site soit officiel ou non
(<a href="official">plus d'information sur les types de miroir</a>).

<p>Une fois qu'un miroir est mis en place il doit être 
<a href="submit">enregistré par Debian</a>
de façon à être inclus dans la 
<a href="../misc/README.mirrors">liste des miroirs</a>.
Les soumissions peuvent être faites en utilisant notre 
<A href="submit">simple formulaire web</a>.

<p>Les problèmes ou questions peuvent être envoyés à 
<A href="mailto:mirrors@debian.org">mirrors@debian.org</A>.


<H2>Méthodes pour faire un miroir</H2>

<p>La méthode recommandée pour faire tourner un miroir est d'utiliser rsync.

<p>Note : bien que <kbd>wget</kbd> fonctionne correctement pour faire
des miroirs de petits sites, il n'est pas aussi configurable que rsync
ou mirror donc il n'est pas recommandé pour ce travail.

<h3>rsync anonyme</h3>

<p>Vous pouvez utiliser <a href="anonftpsync">ce script</a> pour faire un 
miroir de l'archive. Suivez les indications du script pour mettre en place 
le miroir.
Les sites dans la <a href="mirrors_full">liste complète des miroirs</a> qui 
ont la marque « <kbd>Type: Push-Primary</kbd> »
devraient être de bons sites comme base de miroir.

<h3>rsync avec authentification, à partir d'un miroir « Push »</h3>

<p>Les miroirs « Push » sont une forme de miroir, utilisant rsync, que nous 
avons développée afin de minimiser le temps que mettent les changements de 
l'archive pour atteindre les miroirs. Les miroirs « Push » utilisent un 
script déclencheur ssh pour indiquer au miroir client qu'il doit se mettre 
à jour. 

<p>Cette méthode est assez sûre car ssh est configuré pour lancer une unique 
commande. Ainsi le miroir se fait toujours par « Pull », il n'est donc 
<strong>pas</strong> possible de corrompre le contenu de l'archive 
<i>via</i> un miroir push infiltré.
Quelques administrateurs de miroirs ont montré une certaine hésitation à 
utiliser cette méthode de miroirs par crainte qu'elle n'ouvre leur machine à 
une invasion. Ce n'est absolument <strong>pas</strong> le cas.

<p>Pour une description plus détaillée de la manière dont cette méthode 
fonctionne, des raisons pour lesquelles elle est sûre et de la façon de
la mettre en place, voyez <a href="push_mirroring">les explications
complètes</a>.

<h3>FTP anonyme en utilisant « mirror »</h3>

<p>FTP anonyme a été la méthode standard de création de miroir depuis
longtemps. Pour cela, le programme « mirror » fonctionne correctement sur 
l'archive Debian.
Comme vous vous en doutez probablement, « mirror » est disponible en
paquet Debian.
Si vous avez installé le paquet Debian, il y a un script d'exemple pour
faire un miroir de l'archive ftp dans /etc/mirror/packages/ftp.debian.org.

<h2>Miroir partiel</h2>

<p>Considérant la taille déjà importante de l'archive Debian, certaines
personnes préfèrent ne faire un miroir que des quelques parties 
de celle-ci dont ils ont besoin. Pour cela, des scripts, comme ceux de 
<a href="http://cvs.kitenet.net/~checkout~/joey-cvs/bin/debmirror?tag=HEAD&content-type=text/plain">Joey Hess</a> et
<a href="http://people.debian.org/~absurd/">Stephan Suerken</a> sont 
nécessaires. 
Si vous sentez que quelque chose devrait être ajouté à ceux-ci, merci de 
contacter les auteurs (les informations permettant de les contacter devraient
être incluses dans les scripts eux-mêmes).


<h2>Quand rafraîchir les miroirs ?</h2>

<p>L'archive principale est mise à jour toutes les 24 heures.

<p>Si votre site est un miroir « Push », alors vous n'avez pas à vous
soucier de ce problème. Sinon, et si le site dont vous faites un miroir
utilise rsync, alors vous devriez aller voir dans <kbd>project/trace/</kbd>
dans l'archive Debian du site pour y trouver un fichier ayant le nom du site.
Ce fichier devrait contenir la date à laquelle le processus de miroir s'est
terminé la dernière fois.
Ajoutez-y un moment, par exemple une heure, et vous obtiendrez le moment 
auquel lancer votre processus.

<p>La meilleure façon de faire tourner le miroir automatiquement tous les 
jours est d'utiliser cron. Voyez <kbd>man crontab</kbd> pour plus de détails.
 
<h2>Configuration supplémentaire recommandée</h2>

<p>Si vous voulez rendre le miroir Debian disponible par HTTP, merci de
rajouter les options suivantes à votre configuration d'Apache (en
supposant bien sûr que vous utilisez Apache) concernant l'indexation
des répertoires :

<pre>
&lt;directory /org/ftp.debian.org/ftp&gt;
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
&lt;/directory&gt;
</pre>

<p>(remplacez <code>/org/ftp.debian.org/ftp</code> par le nom du répertoire
dans lequel vous gardez le miroir.)

