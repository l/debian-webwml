#use wml::debian::template title="Miroirs du site web Debian"
#use wml::debian::toc
#include "$(ENGLISHDIR)/mirror/webmirrors.data"
#use wml::debian::translation-check translation="1.47" maintainer="Simon Paillard"

<toc-display/>

<toc-add-entry name="whynot">Pourquoi n'avons-nous plus besoin de
miroirs web supplémentaires&nbsp;?</toc-add-entry>

<p>Nos miroirs web demandent de la maintenance (un peu plus que nos
miroirs FTP, même, du fait qu'il est nécessaire de modifier de temps
en temps les fichiers de configuration d'Apache) et accaparent des
ressources chez ceux qui nous aident. Cependant, à cause de la nature
des pages web, que l'on n'a pas besoin de télécharger régulièrement et
pour lesquelles il importe peu qu'elles soient transmises à 2 kbps ou
à 30 kbps car elles sont assez légères, la question se pose de savoir
s'il est utile de disposer de beaucoup de miroirs web.</p>

<p>Il y eut une époque où les connexions Internet autour du globe
n'étaient pas rapides, où par exemple accéder à www.debian.org depuis
un autre continent était difficile et beaucoup plus lent que la
vitesse habituelle d'une connexion par modem.
Nous avons mis en place des solutions pour créer des miroirs et
plusieurs sites ont vu le jour. Dix (ou onze, si vous comptez la
Turquie) d'entre eux sont en Europe.</p>

<p>Aujourd'hui nous avons des liens réseaux ultra rapides, en
particulier en Europe, et il n'y a guère besoin d'autant de 
miroirs. En fait, grâce à l'augmentation de la vitesse des liens réseaux
entre l'Europe et l'Amérique, ce n'est même plus lent d'accéder à
www.debian.org depuis l'Europe.</p>

<p>C'est en gros pour cela que nous n'avons plus besoin de miroirs
web, en particulier sur les continents où il y a déjà des miroirs
en place. Merci de respecter nos désirs. Merci de votre coopération.</p>

<p>Si vous avez des questions à poser, envoyez un message à
<a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.</p>

<hr />

<toc-add-entry name="ref">Réference pour les miroirs existants</toc-add-entry>

<p><strong>Les informations ci-dessous sont fournies uniquement en 
tant que référence pour les responsables des miroirs existants.</strong></p>

<h3>Fonctionnement d'un miroir</h3>
 
<p>La méthode recommandée pour faire un miroir est d'utiliser rsync.
Il n'y a pas d'accès anonyme aux fichiers du site web. Vous pouvez
configurer un accès authentifié avec l'aide du responsable du site
à partir duquel vous voulez faire fonctionner votre miroir, merci
d'envoyer un message à 
<a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.</p>

<p>Le processus de fonctionnement d'un miroir est un processus <q>Pull</q>
c'est-à-dire que le client demande des données à un serveur quand il le souhaite.
Pour configurer cela, vous pouvez utiliser le
<a href="websync">script websync</a> et <a href="websync.conf">son
fichier de configuration</a>, qui peuvent être lancés avec crontab, 
et qui feront tout automatiquement. Suivez les indications se trouvant 
dans le script pour être sûr que tout fonctionne bien.</p>

<h4>Miroir <q>Push</q></h4>

<p>Les miroirs <q>Push</q> sont une forme de miroir, utilisant rsync, que nous 
avons développé pour minimiser le temps qu'il faut aux changements de 
l'archive pour atteindre les miroirs. Le miroir serveur utilise un script 
déclencheur ssh pour indiquer au miroir client qu'il doit se mettre à jour.</p>

<p>Cette méthode est assez sûre car ssh est configuré pour lancer une
unique commande. Ainsi le miroir se fait toujours par <q>Pull</q>, il
n'est donc <strong>pas</strong> possible de corrompre le contenu de
l'archive <i>via</i> un miroir <q>Push</q> infiltré. Quelques
administrateurs de miroirs ont montré une certaine hésitation à
utiliser cette solution, par crainte qu'elle n'ouvre leur machine à
une invasion.
Ce n'est absolument <strong>pas</strong> le cas.</p>

<p>Pour une description plus détaillée de la manière dont cette méthode 
fonctionne, des raisons pour lesquelles elle est sûre et de la façon de
la mettre en place, voyez <a href="push_mirroring">les explications
complètes</a>.</p>

<h3>Quand rafraîchir les miroirs&nbsp;?</h3>

<p>Le site principal est mis à jour toutes les quatre heures environ.</p>

<p>Si votre site est un miroir «&nbsp;Push&nbsp;», alors vous n'avez pas à vous
soucier de ce problème. Sinon vous calculerez le moment où vous 
rafraîchirez votre miroir en fonction de la date des fichiers «&nbsp;timestamp&nbsp;» 
se trouvant dans le répertoire <code>/mirror/timestamps/</code> du site 
web que vous utilisez comme source. Ajoutez-y par exemple une 
demi-heure, et vous obtiendrez le moment pour lancer votre processus.</p>

<p>La meilleure façon de faire tourner le miroir automatiquement tous les 
jours est d'utiliser cron. Voyez <kbd>man crontab</kbd> pour plus de détails.</p>
 
<h3>La publicité du sponsor sur le miroir</h3>

<p>Les fichiers <code>sponsor.html</code> et <code>sponsor_img.jpg</code> 
peuvent et devraient être remplacés par vos soins. 
Ils sont destinés à faire de la publicité pour votre site de façon à 
ce que les gens sachent qui est le sponsor.
Les originaux sont sous <code>sponsor.deb.html</code> et 
<code>sponsor.deb.jpg</code> du fait que le site dont vous faites un miroir 
peut avoir remplacé ceux que Debian fournis en exemple.
La taille maximum suggérée pour votre logo est 120x60.</p>

<p>Comme <a href="#cn">la négociation de contenu</a> est utilisée sur les 
pages web pour choisir la langue préférée, vous pouvez même fournir 
<code>sponsor.html</code> dans différentes langues. Pour cela vous devez 
simplement créer un sponsor.&lt;lang&gt;.html pour chaque &lt;lang&gt; que 
vous souhaitez.</p>

<p>Soyez sûr d'ajouter tous les fichiers que vous ne voulez pas voir 
écrasés dans la liste des exclusions du miroir.</p>

<h3>Configuration du serveur web</h3>

<h4>Modifications diverses sur le serveur web</h4>

<p>Si votre machine tourne sous Debian, il a été décidé
de ne pas respecter la politique Debian et d'utiliser <code>/doc</code> 
pour les pages web. Cela signifie que vous devriez commenter les lignes
<q><code>Alias /doc/ /usr/share/doc/</code></q> de votre fichier
<code>/etc/apache/srm.conf</code>.</p>

<p>Note&nbsp;: tous nos scripts CGI tournent de façon centralisée sur 
cgi.debian.org, donc vous n'avez pas à vous en soucier.</p>

<h4><a name="cn">Négociation de contenu</a></h4>

<p>La négociation de contenu est un moyen qui laisse le navigateur
négocier avec le serveur le type de document qui doit être servi. Cela
peut avoir beaucoup d'utilisations, mais la plus courante est de
négocier la langue du document. Debian peut ainsi servir ses pages en
de multiples langues d'une façon (techniquement) très élégante.</p>

<p>Pour ceux qui utilisent Apache, la modification est presque triviale. 
Ajoutez simplement cette option&nbsp;:</p>

<pre>
Options +Multiviews   
</pre>

<p>à la section <code>&lt;Directory&gt;</code> concernant les pages
web Debian de votre fichier
<kbd>/etc/apache/access.conf</kbd>, et relancez le serveur.

<p>De plus, vous devez vérifier que le serveur peut gérer toutes les
langues qui seront sur le site web. Ceci peut être fait en utilisant
la commande <kbd>AddLanguage</kbd>. Ce qui suit est une liste des 
langues déjà utilisées - prévoyez d'en ajouter d'autres plus tard&nbsp;:</p>

<pre>
  AddLanguage en .en
<:
foreach $l (keys %langs) { push @codes, $langs{$l}; }
foreach $c (sort @codes) { print "  AddLanguage $c .$c\n" if (($c ne "en")
&& ($c ne "zh")); }
:>  \
  AddLanguage pt-br .pt
  AddLanguage nb .nb
  AddLanguage zh-CN .zh-cn
  AddLanguage zh-HK .zh-hk
  AddLanguage zh-TW .zh-tw
</pre>

<p>À cause d'un bogue dans Apache une mauvaise langue peut être
servie dans certaines circonstances, c'est pourquoi c'est une bonne idée 
d'ajouter chaque langue servie dans l'option LanguagePriority 
comme ceci&nbsp;:</p>

<pre>
<:
print "LanguagePriority en fr es ";
foreach $c (sort @codes) { print "$c " if (($c ne "en") && ($c ne "fr") && ($c ne "es") && ($c ne "zh")); }
print "pt-br nb zh-CN zh-HK zh-TW\n";
:>\
</pre>

<p>De façon à éviter de servir des fichiers issus de la négociation de
contenu avec un mauvais jeu de caractères, assurez-vous que la
commande <code>AddDefaultCharSet</code> est soit commentée soit mise à
<q><code>Off</code></q>.

<p>Si vous utilisez apache&nbsp;1, vous devrez probablement modifier
l'entrée <code>DirectoryIndex</code> dans
<code>/etc/apache/srm.conf</code>, afin de servir correctement les
fichiers index de répertoire. Cela ne marche cependant pas avec
apache&nbsp;2. La ligne suivante devrait suffire pour
apache&nbsp;1&nbsp;:</p>

<pre>
DirectoryIndex index index.html
</pre>

<p>Afin d'envoyer le bon en-tête «&nbsp;Content-Type&nbsp;» pour
favicon.ico, il faut spécifier à Apache d'utiliser le type
image/x-icon, de la façon suivante&nbsp;:</p>

<pre>
AddType image/x-icon .ico
</pre>

<p>Pour envoyer l'en-tête «&nbsp;Context-Type&nbsp;» correct pour les
«&nbsp;feeds&nbsp;» RSS, il faut spécifier à Apache qu'il doit
utiliser le type application/rss+xml, comme
ceci&nbsp;:</p>

<pre>
AddType application/rss+xml .rdf
</pre>

<p>Pour envoyer le bon en-tête «&nbsp;Content-Type&nbsp;» pour
les traductions espagnoles html, pdf et autres fichiers plats, Apache doit 
être configuré pour utiliser des types corrects comme ceci&nbsp;:</p>

<pre>
&lt;Files *.html.es>
 ForceType text/html
&lt;/Files>

&lt;Files *.pdf.es>
 ForceType application/pdf
&lt;/Files>

&lt;Files *.txt.es>
 ForceType text/plain
&lt;/Files>
</pre>

<p>Pour éviter les problèmes de négociation du contenu pour le contenu
qui se trouve dans <a href="../events/">/events</a>, les fichiers de
calendrier doivent avoir une priorité plus faible que ceux ayant du
contenu text/html&nbsp;:</p>

<pre>
AddType text/calendar;qs=0.9 .ics
</pre>

<h4>Redirections</h4>

<p>Comme certaines parties du site web devenaient trop volumineuses
pour la plupart des sites miroirs, nous les avons séparées du site
principal. Bien que la plupart des liens devraient avoir été
transformés pour utiliser les nouveaux emplacements, vous êtes invités
à ajouter une redirection de façon à ce qu'aucun lien ne soit
cassé. Cela peut être fait dans <kbd>/etc/apache/srm.conf</kbd>. Par
exemple&nbsp;:</p>

<pre>
Redirect /Lists-Archives http://lists.debian.org/
Redirect /search http://search.debian.org
Redirect /Packages http://packages.debian.org
Redirect /lintian http://lintian.debian.org
</pre>

<h4>Hôtes virtuels</h4>

<p>Le site web de Debian accessible via 
<a href="$(HOME)">www.debian.org</a> et beaucoup d'autres noms
utilise une configuration GeoDNS dans le but d'équilibrer la charge
et de sélectionner un miroir proche de l'endroit où se trouve 
l'utilisateur.</p>

<p>En conséquence, Apache doit servir le site web de Debian via différents
hôtes virtuels comme ceci&nbsp;:</p>

<pre>ServerAlias www.debian.org www.debian.com debian.org www.*.debian.org</pre>

