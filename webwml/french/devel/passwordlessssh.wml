#use wml::debian::template title="Exemple d'utilisation de rsync, de la façon de configurer ssh pour qu'il ne demande pas de mot de passe" NOHEADER=yes

#use wml::debian::translation-check translation="1.5" translation_maintainer="Christian Couder"


<H3>Exemple d'utilisation de rsync</H3>

<P>Ce qui suit est un exemple qui fera un miroir à la fois du site web et du 
site FTP.
Vous devrez modifier le nom de la machine et les répertoires impliqués pour 
qu'ils conviennent à votre situation.

<P>Le lockfile est utile si vous lancez ce miroir en utilisant cron. Si, pour 
une quelconque raison, le miroir n'est pas terminé, la prochaine fois que le 
miroir essayera de se lancer vous recevrez un courrier.
Vous pourrez alors remonter à la source du problème, le corriger, et effacer 
le lockfile et le miroir fonctionnera correctement lors de sa prochaine 
exécution.

<blockquote>
<pre>
#!/bin/sh -e

lockfile -r 1 rsync.master.lock || exit 23

rsync -avz -e ssh --exclude sponsor.* --delete &lt;machine&gt;:/web/debian.org/ debian.org

echo Mise a jour du miroir web terminée. Travail sur le miroir FTP maintenant...

rsync -avz --delete -e ssh &lt;machine&gt;:/debian debian

rm -f rsync.master.lock
</pre>
</blockquote>

<p>Le script donné ci dessus vous demandera un mot de passe sauf si vous 
installez ssh comme décrit ci-dessous.

<H3><a name="paswordlessssh">Comment configurer ssh de façon à ne pas avoir 
à entrer un mot de passe</a>:</H3>

<p>Vous pouvez créer une clé d'authentification RSA pour pouvoir vous 
connecter à un autre site à partir de votre compte, sans avoir à taper votre 
mot de passe.

<p>Notez qu'une fois que vous avez configuré cela, si un intrus s'introduit
dans votre compte/site, il aura aussi accès libre au site que vous mirorez!
Pour cette raison, cela ne devrait <strong>jamais</strong> être fait sous
le compte root.

<ul>
  <li>Lancez <code>ssh-keygen</code> sur votre machine, et tapez simplement
  sur la touche entrée quand on vous demande un mot de passe.
  <li>Ensuite, ajoutez le contenu de <code>~/.ssh/identity.pub</code> de 
  votre machine à <code>~/.ssh/authorized_keys</code> sur le site miroir (le
  mode su fichier devrait être 600).
</ul>
 
<p>Vous devriez ensuite pouvoir utiliser ssh pour vous connecter sur le site 
miroir sans qu'un mot de passe vous soit demandé.
