<html><head>
<title>Le manuel de programmation de dpkg - Déviation - écraser une version de paquet d'un fichier</title>
<link rev=made href="mailto:cure@cnam.fr">
</head><body>
<h1>
Le manuel de programmation de dpkg - chapitre 11<br>
Déviation - écraser une version de paquet d'un fichier
</h1>

Il est possible d'éviter à <kbd>dpkg</kbd> d'écraser un fichier quand il
réinstalle le paquet auquel il appartient, et de mettre le fichier du
paquet autre part.<P>

Cela peut être utilisé localement pour écraser une version de paquet
d'un fichier, ou par un paquet pour écraser une autre version (ou pour
fournir un lien pour elle).<P>

Avant de décider de l'utilisation d'une déviation, lire <A href="ch-alt.html">Les versions alternatives d'une interface - <code>update-
alternatives</code>, chapter 10</A>,
pour savoir si tu veux vraiment une déviation
plutôt que plusieurs versions alternatives d'un programme.<P>

Il y a une liste de déviation qui est lue par <kbd>dpkg</kbd> et mise à
jour par un programme spécial <kbd>dpkg-divert</kbd>. Voir 
<code>dpkg-divert(8)</code>
pour plus de renseignements sur ses arguments.<P>

Quand un paquet souhaite différencier un fichier d'un autre, il doit
appelé <kbd>dpkg-divert</kbd> dans sa pré-installation pour ajouter la
déviation et renommer le fichier existant. Par exemple, supposons qu'un
paquet <kbd>smailwrapper</kbd> souhaite installer un lien sur
<kbd>/usr/sbin/smail</kbd>:

<pre>   if [ install = &quot;$1&quot; ]; then
       dpkg-divert --package smailwrapper --add --rename \
                   --divert /usr/sbin/smail.real /usr/sbin/smail
   fi</pre>

Le test de <code>$1</code> est nécessaire afin que le script n'essaye pas
d'ajouter encore la déviation quand <kbd>smailwrapper</kbd> est mis à
jour. L'option <code>--package smailwrapper</code> assure que la copie de
<code>smailwrapper</code> du répertoire <kbd>/usr/sbin/smail</kbd> peut
contourner la déviation et s'installer comme la vraie version.<P>

Le <code>postrm</code> fait l'inverse:
<pre>   if [ remove = &quot;$1&quot; ]; then
       dpkg-divert --package smailwrapper --remove --rename \
                   --divert /usr/sbin/smail.real /usr/sbin/smail
   fi</pre>
N'essaie pas dévier un fichier qui est vital pour le système
d'exploitation. Quand on utilise <code>dpkg</code>, il y a un moment, après
que le fichier ait été dévié, mais avant que <code>dpkg</code> ait installé
la nouvelle version, où le fichier n'existe pas.<P>



<hr>
Le manuel de programmation de dpkg
- <A href="index.html#copyright">Copyright ©1996 Ian Jackson
Copyright ©1997 David Curé et Christian Jacolot pour
           la version française.</A>
<br>
<A href="index.html#toc">Table des matières</A>; <A href="index.html#abstract">résumé</A>; <A href="ch-partages.html">suivant</A>; <A href="ch-alt.html">précédent</A>.
<br>
<address>20 décembre 1997<br>
D. Cure <A href="mailto:cure@cnam.fr">cure@cnam.fr</A><br>
C. Jacolot <A href="mailto:jacolot@ubolib.univ-brest.fr">jacolot@ubolib.univ-brest.fr</A></address>
</body></html>