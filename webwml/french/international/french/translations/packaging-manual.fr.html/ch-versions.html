<html><head>
<title>Le manuel de programmation de dpkg - Numérotation des versions</title>
<link rev=made href="mailto:cure@cnam.fr">
</head><body>
<h1>
Le manuel de programmation de dpkg - chapitre 5<br>
Numérotation des versions
</h1>

Chaque paquet a un numéro de version, dans son champ <code>Version</code> du
fichier de contrôle.<P>

<code>dpkg</code> impose un ordre sur les numéros de version, afin de savoir
si les paquets sont nouveaux ou anciens et afin que <kbd>dselect</kbd>
puisse dire si un des paquets qu'il a trouvé est plus récent que celui
installé sur le système. La partie la plus significative dans le format
de numéro de version se trouve au début.<P>

Le format de numéro de version est:

<pre>   [epoch:]version-originale[-révision-debian]</pre>

Les trois composants sont:

<dl>
<dt> epoch<dd>Un entier non signé simple, qui doit toujours être petit. Il peut être
omis, dans ce cas, il est considéré à 0. S'il est omis, le champ
<em>version-originale</em> ne peut pas contenir la ponctuation :.<P>

Il est fourni pour autoriser des erreurs dans les numéros de version des
vieilles versions de paquet, et aussi pour abandonner une structure
précédente de numérotation de version de paquet.<P>

<code>dpkg</code> n'affiche pas habituellement le champ <em>epoch</em>, à
moins qu'il ne soit essentiel (différent de 0, ou si le champ
<em>version-originale</em> contient la ponctuation :), <kbd>dselect</kbd>
n'affiche pas le champ <em>epoch</em> du tout dans la partie principale
d'un affichage de sélection de paquet.<P>

<p><dt> version-originale<dd>C'est la partie principale de la version. C'est d'habitude le numéro de
la version originale du paquet à partir duquel le fichier <code>.deb</code>
a été crée, si c'est possible. Généralement, ce champ est dans le même
format que celui spécifié par l'auteur original, cependant, il peut être si
nécessaire, reformaté pour rentrer dans le format <code>dpkg</code> et la
structure de comparaison.<P>

Le comportement de la comparaison de <code>dpkg</code> en respect avec le
champ <em>version-originale</em> est décrit ci-dessous. La portion du
champ <em>version-originale</em> du numéro de version est
obligatoire.<P>

Le champ <em>version-originale</em> ne peut contenir seulement des
caractères alphanumériques et les caractères <code>+ . - :</code> et doit
commencer par un chiffre. S'il n'y a pas de champ <em>révision-debian</em>
alors le tiret (-) n'est pas autorisé. S'il n'y a pas le
champ <em>epoch</em> alors les : ne sont pas autorisés.<P>

<p><dt> révision-debian<dd>Cette partie de la version représente la version des modifications qui
ont été faites au paquet pour en faire un paquet Debian. Elle est dans le
même format que le champ <em>version-originale</em> et <code>dpkg</code> la
compare de la même façon.<P>

Ce champ est optionnel. S'il n'est pas présent alors le champ
<em>version-originale</em> ne peut contenir de tirer (-). Ce format
représente le cas où un morceau de code a été écrit spécialement pour
obtenir le paquet binaire Debian. S'il n'y a qu'une seule et plus
débianisation du paquet, aucune indication de révision n'est
nécessaire.<P>

Par convention, le champ <em>révision-debian</em> est remis à 1 à chaque
fois que le champ <em>version-originale</em> est incrémenté.<P>

<code>dpkg</code> coupera en deux, les champs <em>version-originale</em> et
<em>révision-debian</em> au dernier tiret dans le numéro de version.
L'absence du champ <em>révision-debian</em> est comparée plus tôt que la
présence de ce champ (mais le champ <em>révision-debian</em> est la partie la
moins significative du numéro de version).<P>

Le champ <em>révision-debian</em> peut contenir seulement des caractères
alphanumériques et les caractères (<code>+ .</code>). <P>
<p></dl>



Les champs <em>version-originale</em> et <em>révision-debian</em> sont
comparés par <code>dpkg</code> en utilisant le même algorithme.<P>

Les chaînes sont comparées de gauche à droite.<P>

D'abord la partie initiale de chaque chaîne, qui consiste entièrement de
caractères sans chiffre, est déterminée. Ces deux parties sont comparées
lexicalement. Si une différence est trouvée, elle est retournée. La
comparaison lexicale est une comparaison de valeurs ASCII modifiées afin
que toutes les lettres soient triées plus tôt que les chiffres et
caractères de ponctuation.<P>

Ensuite, la partie initiale du reste de chaque chaîne qui consiste
entièrement de chiffre est déterminée. La valeur numérique de ces deux
parties est comparée, la différence est retournée comme résultat de la
comparaison. C'est dans ce but, qu'une chaîne vide (qui apparaît
seulement à la fin de l'une ou des deux chaînes comparées de version)
compte pour un zéro.<P>

Ces deux phases sont répétées (en enlevant du début de la chaîne les
caractères et les chiffres) jusqu'à ce qu'une différence soit trouvée ou
que les deux chaînes soient terminées.<P>

Le but du champ <em>epoch</em> est d'inhiber les erreurs de
numérotation de version, et de s'arranger avec les situations où la
numérotation de version change. Il ne sert pas à corriger les
numéros de version contenant des chaînes de caractères que <code>dpkg</code>
ne peut pas interpréter (tel que <code>ALPHA</code> ou <code>pre-</code>) ou une
numérotation bâtarde (l'auteur du manuel original a entendu qu'un paquet
avait une version <code>1.1.1.2</code>, <code>1.3</code>, <code>1</code>,
<code>2.1</code>, <code>2.2</code>, <code>2</code> et ainsi de suite).<P>

Si un paquet original a un problème de numérotation de version, il doit
être converti dans un format sain pour être utilisé dans le champ
<code>Version</code>.<P>

Si tu as besoin de comparer les numéros de version dans un script, tu
peux utiliser <kbd>dpkg --compare-versions ...</kbd>.
Voir <kbd>dpkg --help</kbd> pour avoir plus de détails sur les arguments.<P>



<hr>
Le manuel de programmation de dpkg
- <A href="index.html#copyright">Copyright ©1996 Ian Jackson
Copyright ©1997 David Curé et Christian Jacolot pour
           la version française.</A>
<br>
<A href="index.html#toc">Table des matières</A>; <A href="index.html#abstract">résumé</A>; <A href="ch-maintenance.html">suivant</A>; <A href="ch-controles.html">précédent</A>.
<br>
<address>20 décembre 1997<br>
D. Cure <A href="mailto:cure@cnam.fr">cure@cnam.fr</A><br>
C. Jacolot <A href="mailto:jacolot@ubolib.univ-brest.fr">jacolot@ubolib.univ-brest.fr</A></address>
</body></html>