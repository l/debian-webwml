<html><head>
<title>Le manuel de programmation de dpkg - Interface dselect pour ses méthodes d'installation</title>
<link rev=made href="mailto:cure@cnam.fr">
</head><body>
<h1>
Le manuel de programmation de dpkg - chapitre 14<br>
Interface dselect pour ses méthodes d'installation
</h1>

<code>dselect</code> appelle les scripts à partir des ses méthodes
d'installation quand il a vraiment besoin d'accéder aux données de la
distribution. Le programme noyau <code>dselect</code> lui-même appelle juste
ces scripts et fournit le paquet et les interfaces de sélection des
méthodes d'accès. Les méthodes d'installation sont responsables de
l'appel approprié de <code>dpkg</code>.<P>

Chaque méthode d'installation a trois scripts:
<ul>
<li>Positionner les paramètres d'installation (Setup)<p><li>Mettre à jour la liste des paquets disponibles (Upgrade)<p><li>installer (Install)<p></ul>

<P>
<code>dselect</code> cherche les méthodes dans les répertoires
<code>/usr/lib/dpkg/methods</code> et <code>/usr/local/lib/dpkg/methods</code>.<P>
<hr>
<h2><A name="s-intdselect-1">
14.1 Les fonctions des scripts de méthode
</A></h2>
Le script setup est exécuté juste après que l'utilisateur a choisi une
méthode d'installation. Il doit demander à l'utilisateur les paramètres
comme le site NFS à monter ou FTP, le répertoire à utiliser, ou le
répertoire ou le système de fichiers où les fichiers <code>.deb</code> peuvent
être trouvés, ou le lecteur de bande, le lecteur de disquette d'install.
Il devrait stocker la réponse sous <code>/var/lib/dpkg/methods</code> - voir
ci-dessous. Si aucune liste de paquets n'est disponible, il devrait
proposer peut-être la scrutation des paquets disponibles.<P>

Le script upgrade devrait obtenir une liste des paquets disponibles si
possible, et démarrer <code>dpkg --update-avail, dpkg --merge-avail</code>
et/ou <code>dpkg --forget-old-unavail</code> pour la charger dans la base de
données des paquets disponibles de <code>dpkg</code> et de <code>dselect</code>.
Si aucune liste de paquets n'est disponible et si on a proposé à
l'utilisateur et qu'il a accepté l'option de scruter les fichiers
réels disponibles, alors la scrutation doit être faite ici, en utilisant
<code>dpkg --record-avail</code>.<P>

Le script install doit donner tous les fichiers <code>.deb</code> disponibles
à <code>dpkg -iGOEB</code> (ce qui est équivalent à <code>dpkg --install --
refuse-downgrade --selected-only --skip-same-version --auto-
deconfigure</code>). L'option <code>-R</code> (<code>--recursive</code>) pour traverser
tous les sous-répertoires peut être utile ici.<P>

Si un de ces scripts a besoin d'afficher un message à l'utilisateur, il
doit attendre que l'utilisateur tape 'return' avant de sortir afin que
<code>dselect</code> ne rafraîchisse pas immédiatement l'écran.<P>

Si un script de méthode réussi (retourne un statut de sortie à zéro)
<code>dselect</code> retournera immédiatement au menu principal, avec l'option
suivante soulignée prêt pour être sélectionnée par l'utilisateur. S'il
échoue, <code>dselect</code> affichera un message et attendra que
l'utilisateur tape 'return'.<P>
<hr>
<h2><A name="s-intdselect-2">
14.2 Emplacement et arguments des scripts de méthode
</A></h2>

Un ensemble de scripts (aussi connu comme un groupe) peut fournir
plusieurs méthodes dans le menu principal avec différent comportement.
Par exemple, il peut y avoir un groupe pour récupérer les paquets par
FTP qui peut fournir les méthodes dans le menu principal pour
l'installation directe à partir d'un des sites miroirs Debian aussi
bien que l'installation à partir d'un site spécifique à l'utilisateur.<P>

Chaque groupe de méthodes implantées par le même ensemble de scripts
doit avoir un sous-répertoire <code>/usr/lib/dpkg/methods</code>/<em>groupe</em>
ou <code>/usr/local/lib/dpkg/methods</code>/<em>groupe</em>, contenant:

<dl>
<dt>names<dd>une liste des méthodes visibles par l'utilisateur fournies par ces
scripts.
<p><dt>setup<dt>update<dt>install<dd>les programmes exécutables, les scripts eux-mêmes.
<p><dt>des.<em>option</em><dd>fichier de description
<p></dl>
<P>

<code>names</code> sera formaté comme une liste de ligne, chacune contenant:
<pre>sequence méthode résumé</pre>

<em>sequence</em> est un nombre sur 2 chiffres qui sera utilisé comme pour
les préfixes de <code>rc.d</code> pour contrôler l'ordre dans le menu
principal. Dans le doute, utilise 50.<P>

<em>méthode</em> est un nom qui est affiché par <code>dselect</code> comme nom
de la méthode et qui sera passé à <code>setup, update</code> et <code>unpack</code>
comme premier argument.<P>

<em>résumé</em> est la brève chaîne de caractères de description pour le
menu de <code>dselect</code>.<P>

Chacun de ces trois scripts prend les mêmes trois arguments:
<em>vardir, group</em> et <em>method</em>. <em>vardir</em> est le répertoire
de base pour stocker l'état de <code>dpkg</code> et de <code>dselect</code>,
généralement <code>/var/lib/dpkg</code>; ceci est passé afin que l'option
<code>--admindir</code> de <code>dselect</code> soit honorée.<P>

Chaque option peut avoir une description étendue dans
<code>desc.</code><em>option</em>. Celui-ci doit être formaté comme la
partie description étendue comme une entrée du champ <code>Description</code>
<em>décalée d'un caractère vers la gauche</em>.<P>

<em>vardir</em>/<code>methods</code> existera, et un groupe de méthodes peut
utiliser un répertoire <em>vardir</em>/<code>methods</code>/<em>group</em> pour
stocker ses états.<P>

Le nom du groupe et le nom des méthodes doivent suivre les règles des
identificateurs C.<P>

<hr>
Le manuel de programmation de dpkg
- <A href="index.html#copyright">Copyright ©1996 Ian Jackson
Copyright ©1997 David Curé et Christian Jacolot pour
           la version française.</A>
<br>
<A href="index.html#toc">Table des matières</A>; <A href="index.html#abstract">résumé</A>; <A href="ch-confinit.html">précédent</A>.
<br>
<address>20 décembre 1997<br>
D. Cure <A href="mailto:cure@cnam.fr">cure@cnam.fr</A><br>
C. Jacolot <A href="mailto:jacolot@ubolib.univ-brest.fr">jacolot@ubolib.univ-brest.fr</A></address>
</body></html>