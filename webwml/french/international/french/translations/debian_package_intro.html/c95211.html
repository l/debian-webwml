<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>rules</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet version 1.13"><LINK
REL="HOME"
TITLE="      Créer un paquet Debian
    "
HREF="book1.html"><LINK
REL="UP"
TITLE="      Création du paquet
    "
HREF="c95.html"><LINK
REL="PREVIOUS"
TITLE="Makefile"
HREF="c95190.html"><LINK
REL="NEXT"
TITLE="	dirs
      "
HREF="c95223.html"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Créer un paquet Debian</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c95190.html"
>Précédent</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapitre 2. Création du paquet</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c95223.html"
>Suivant</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="AEN211"
>rules</A
></H1
><P
>	Maintenant, nous revenons dans le répertoire debian et jetons
	un oeil aux règles que dpkg-dev utilise pour créer vraiment le
	paquet. Voici ce que debmake nous donne comme fichier de
	règles par défaut :
	<PRE
CLASS="PROGRAMLISTING"
>	  1  #!/usr/bin/make -f
	  2  # Made with the aid of debmake, by Christoph Lameter,
	  3  # based on the sample debian/rules file for GNU hello by Ian Jackson.
	  4 
	  5  package=empire
	  6
	  7  build:
	  8     $(checkdir)
	  9     
	  10    make CFLAGS="-O2 -g -Wall"
	  11 
	  12    touch build
	  13
	  14 clean:
	  15    $(checkdir)
	  16    -rm -f build
	  17    -make clean
	  18    -rm -f `find . -name "*~"`
	  19    -rm -rf debian/tmp debian/files* core debian/substvars
	  20
	  21 binary-indep:    checkroot build
	  22    $(checkdir)
	  23 # There are no architecture-independent files to be uploaded
	  24 # generated by this package. If there were any they would be
	  25 # made here.
	  26 
	  27 binary-arch:    checkroot build
	  28    $(checkdir)
	  29    -rm -rf debian/tmp
	  30    install -d debian/tmp
	  31    cd debian/tmp &#38;&#38; install -d `cat ../dirs`
	  32    make install DESTDIR=`pwd`/debian/tmp
	  33 # Must have debmake installed for this to work. Otherwise please copy
	  34 # /usr/bin/debstd into the debian directory and change debstd to debian/debstd
	  35    debstd BUGS 
	  36    dpkg-gencontrol
	  37    chown -R root.root debian/tmp
	  38    chmod -R go=rX debian/tmp
	  39    dpkg --build debian/tmp ..
	  40 
	  41 define checkdir
	  42    test -f debian/rules
	  43 endef
	  44 
	  45 # Below here is fairly generic really
	  46 
	  47 binary:        binary-indep binary-arch
	  48 
	  49 checkroot:
	  50    $(checkdir)
	  51    test root = "`whoami`"
	  52
	  53 .PHONY: binary binary-arch binary-indep clean checkroot
	</PRE
>
      </P
><P
>	Vous vous êtes probablement familiarisé avec des lignes comme
	la ligne une, de part les scripts shell ou perl. Cela signifie
	que le fichier sera exécuté par make. La ligne 10 déclenche le
	fichier makefile de l'application. La partie CFLAGS de cette
	ligne indique des options de compilation par défaut, au cas ou
	le makefile de l'application n'en aurait pas. Nous n'avons pas
	de soucis à nous faire pour cela (voir la ligne 31 du makefile
	d'Empire), aussi nous pouvons l'effacer :
	<PRE
CLASS="PROGRAMLISTING"
>	  10    make
	</PRE
>
      </P
><P
>	On y arrive rarement du premier coup, aussi les lignes 14-20
	nettoient les crasses inutiles laissées par les essais ratés.
      </P
><P
>	Les lignes 27-40 sont le coeur du fichier rules. Un répertoire
	nommé tmp est créé dans le répertoire debian (si il existe
	déjà, il sera effacé pour reprendre dans un état initial). Le
	paquet sera assemblé ici. C'est pour cela que dans le makefile
	d'Empire, nous avons spécifié debian/tmp comme répertoire
	racine. Dans la ligne 31 sont créés les répertoires dans
	lesquels nous allons effectuer l'installation. Ils sont pris
	dans le fichier dirs dont nous parlerons plus bas. La ligne 32
	lance le but install du fichier makefile d'Empire. La ligne 35
	lance <B
CLASS="COMMAND"
>debstd(1)</B
> qui vient avec
	debmake. debstd est une boÃ®te noire qui va modifier votre
	paquet pour qui soit conforme aux normes Debian. Si vous
	voulez des détails, lisez la page de manuel, ou regardez les
	sources (c'est juste un script shell), et je vous encourage à
	le faire. Mais l'avantage de la boÃ®te noire, c'est que vous
	n'avez pas à savoir ce qu'elle fait, vous pouvez supposer
	qu'elle le fait correctement. Quand les normes Debian
	changeront, ce sera transparent pour vous. Installez juste une
	version mise à jour de debmake qui supportent les nouvelles
	normes, recompilez et vous serez conforme (pour la plupart des
	normes. Toutes les modifications des normes ne peuvent pas
	être aisément gérées automatiquement, aussi est-il payant de
	comprendre le problème en profondeur avant de se fier à un
	bout de code.) La ligne 36 lance dpkg-gencontrol qui va créer
	le fichier de contrôle du paquet. Voyez
	<B
CLASS="COMMAND"
>deb(5)</B
> pour des détails sur le format de
	paquet Debian. Enfin, la ligne 39 crée le paquet proprement
	dit.
      </P
><P
>	Les lignes 41 et suivantes sont juste des macros utilisées par
	le fichier rules et vous n'avez pas à vous en soucier.
      </P
><P
>	Ce qu'il faut savoir du fichier rules créé par debmake est
	qu'il est juste une suggestion. Il fonctionne pour des paquets
	simples, mais pour des paquets plus compliqués, n'hésitez à y
	faire des ajouts ou des retraits pour vos besoin.
      </P
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c95190.html"
>Précédent</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
>Sommaire</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c95223.html"
>Suivant</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Makefile</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c95.html"
>Supérieur</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>dirs</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>