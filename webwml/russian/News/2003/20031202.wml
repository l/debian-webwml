#use wml::debian::translation-check translation="1.10"
<define-tag pagetitle>Отчёт о расследовании Debian взлома серверов</define-tag>
<define-tag release_date>2003-12-02</define-tag>
#use wml::debian::news

<p>Команда администрирования Debian и эксперты в области безопасности,
наконец, смогли точно определить метод, использованный для взлома
четырёх серверов проекта. Тем не менее, кто это сделал, остаётся
невыясненным.</p>

<h3>Архив пакетов взломщиком не изменён.</h3>

<p>Команда администрирования Debian и команды безопасности проверили
архивы (security, us, non-us) почти сразу после обнаружения взлома
и переустановки. Именно поэтому проект смог снова открыть доступ к
архиву исправлений, связанных с безопасностью, и подтвердить, что
обновление стабильного выпуска (3.0r2) не затронуты вторжением.</p>

<p>Если бы проект мог ожидать взлома в то же время, когда выпускается
новое обновление, выпуск можно было бы отсрочить. Однако, к моменту
обнаружения взлома обновлённые пакеты уже были помещены в архив
стабильного выпуска и на зеркальные серверы, и повернуть время вспять
было невозможно.</p>

<p>Чтобы проверить пакеты и убедиться в том, что архив не изменён
взломщиком, были использованы несколько различных методов:</p>

<ul>
<li> списки MD5-сумм, сформированные в течение последних недель и
   хранящиеся на машинах, не подвергшихся взлому
<li> файлы .changes с цифровыми подписями из внешних архивов
   списка debian-devel-changes на машинах, не подвергшихся взлому
<li> файлы .changes с цифровыми подписями на пользующихся доверием
   серверах, содержащих архив пакетов
<li> файлы журналов зеркал, хранящиеся "вовне"
</ul>

<h3>Хронология событий</h3>

<p>Ниже приведена хронология обнаружения взлома и восстановления
подвергшихся атаке машин. Все моменты времени указаны по Гринвичу.
Некоторые моменты ориентировочны, поскольку имеющиеся у нас данные
не содержат точной информации.</p>

<ul class="discless">
   <li>Sep 28  01:33  Линус Торвальдс (Linus Torvalds) выпускает ядро 2.6.0-test6 с исправлением в функции do_brk()
   <li>Oct 02  05:18  Марчело Тозатти (Marcelo Tosatti) применяет проверку границ в do_brk()
   <li>Nov 19  17:00  Нападающий входит в систему на klecker с подобранным паролем
   <li>Nov 19  17:08  На klecker установлен root-kit
   <li>Nov 19  17:20  Нападающий входит в систему на master с тем же паролем
   <li>Nov 19  17:47  На master установлен root-kit
   <li>Nov 19  18:30  Нападающий входит в систему на murphy с использованием учётной записи с master
   <li>Nov 19  18:35  На murphy установлен root-kit
   <li>Nov 19  19:25  На murphy начинаются сбои (Oops...)
   <li>Nov 20  05:38  На master начинаются сбои (Oops...)
   <li>Nov 20  20:00  Регистрация проблем на master и murphy
   <li>Nov 20  20:54  На gluck установлен root-kit
   <li>Nov 20  22:00  Подтверждение того, что debian.org взломан
   <li>Nov 21  00:00  Отключение всех учётных записей
   <li>Nov 21  00:34  Выключение security.debian.org
   <li>Nov 21  04:00  Выключение gluck (www, cvs, people, ddtp)
   <li>Nov 21  08:30  Перенаправление www.debian.org на www.de.debian.org
   <li>Nov 21  10:45  Общее оповещение
   <li>Nov 21  16:47  Обновление информации о разработчиках
   <li>Nov 21  17:10  Выключение murphy (lists) и master
   <li>Nov 22  02:41  security.debian.org восстановлен
   <li>Nov 25  07:40  lists.debian.org восстановлен
   <li>Nov 28  22:39  Выпуск Linux 2.4.23
</ul>

<h3>Обнаружение</h3>

<p>Вечером (по Гринвичу) четверга, 20 ноября команда администрирования
заметила несколько записей о сбоях ядра (oops) на master. Поскольку
система работала без ошибок достаточно долгое время, нужно было изучить
проблему и проверить, нет ли неполадок в аппаратном обеспечении. Однако
в то же время в точности те же проблемы были отмечены на другой машине,
murphy. Администраторы заподозрили что-то неладное.</p>

<p>На klecker, murphy и gluck установлена "Усовершенствованная система
обнаружения взлома ("Advanced Intrusion Detection Environment", пакет <a
href="http://packages.debian.org/aide">aide</a>), регистрирующий изменения
в файловой системе. В то же время он выдал предупреждение о том, что
<code>/sbin/init</code> заменён другим файлом и изменены значения mtime
и ctime в <code>/usr/lib/locale/en_US</code>.</p>

<p>Дальнейший анализ показал, что причиной обеих проблем была программа
SucKIT root-kit (1.3b). В её возможности входит подбор паролей и
защита от обнаружения (т.е. инструменты для сокрытия процессов и файлов),
которые устанавливаются непосредственно в ядро, что в свою очередь,
приводит к появлению замеченных сбоев ядра.</p>


<h3>Подробный анализ атаки</h3>

<p>В среду, 19 ноября, приблизительно в 17 часов по Гринвичу
подобранный пароль был использован для входа в систему на klecker
(.debian.org) с непривилегированной учётной записью разработчика.
Затем нападающий по протоколу HTTP получил исходный код, необходимый
для применения неизвестного (на данный момент) способа использования
уязвимости ядра, и посредством этого использования присвоил
привилегии пользователя root. Затем был установлен SucKIT root-kit.</p>

<p>Те же учётная запись и пароль были использованы для входа на
машину master, присвоения тем же образом привилегий root и установки
SucKIT root-kit.</p>

<p>Затем нападающий попытался получить доступ к серверу murphy,
используя ту же учётную запись. Это не удалось, поскольку murphy&nbsp;&mdash;
машина с ограниченным доступом, она работает только в роли сервера списков
рассылки, и входить в систему могут лишь немногие разработчики. Поскольку
первая попытка входа не удалась, нападающий использовал доступ с правами
пользователя root на master для доступа к административной учётной записи,
используемой для целей резервного копирования. Используя эту запись, он
получил доступ также и к murphy. На этой машине также был установлен
SucKIT root-kit.</p>

<p>На следующий день нападающий использовал пароль, подобранный на master
для входа на gluck, присвоения привилегий пользователя root на этой системе
и, как и прежде, установки SucKIT root-kit.</p>

<p>Тщательный анализ позволил установить точные моменты времени
перезаписи <code>/sbin/init</code> и установки root-kit. Аналитики
также обнаружили исполняемый файл, использованный для присвоения прав
пользователя root на этих машинах, защищённый и "затемнённый" Burneye.
После разворачивания и дизассемблирования этого кода эксперты по
безопасности выяснили, какая ошибка в ядре была использована.</p>

<p>Использовался выход за границы допустимых целочисленных значений
в системном вызове brk для перезаписи памяти ядра (изменения битов
защиты страниц). Таким образом нападающий получил полный контроль над
пространством памяти ядра и возможность изменить любое значение в
памяти.</p>

<p>Несмотря на то, что этот участок кода ядра был отредактирован
ещё в сентябре Эндрю Мортоном (Andrew Morton), и это исправление
попало в последние предварительные версии ядра (начиная с октября),
аспект безопасности этой проблемы не рассматривался. Поэтому ни один
из поставщиков дистрибутивов не выпустил предложений по безопасности.
Тем не менее, после обнаружения способа локального использования
уязвимости, проект Common Vulnerabilities and Exposures присвоил
проблеме идентификатор CAN-2003-0961. Она исправлена в ядре Linux 2.4.23,
выпущенном на этих выходных, и описана в предложении Debian по безопасности
<a href="$(HOME)/security/2003/dsa-403">DSA 403</a>.</p>

<p>Linix 2.2.x не содержит этой уязвимости, поскольку раньше выполнялась
проверка границ. Предполагается также, что этой уязвимости нет в ядрах
для архитектур Sparc и PA-RISC, поскольку пользовательские адреса и
адреса ядра на этих архитектурах хранятся в различных адресных
пространствах.</p>

<p>Просим понять, что мы не можем предоставить данный код незнакомым
нам людям. Пожалуйста, не просите нас об этом.</p>


<h3>Восстановление</h3>

<p>После выключения взломанных машин были созданы и сохранены
на отдельных машинах образы жёстких дисков. Они были предоставлены
людям, расследовавшим проблему. Три машины в США (master, murphy и
gluck) впоследствии были восстановлены, и их функционирование в точности
возобновлено после изучения вопроса администраторами соответствующих
служб.</p>

<p>Однако полное исследование klecker было отложен до планового анализа,
чтобы функционирование архива обновлений, связанных с безопасностью, было
восстановлено раньше, чем другие службы. Также в это время у нас не было
консольного доступа к klecker, поэтому восстановление приходилось выполнять
удалённым образом. После создания образа диска путём входа на локальную
машину с последовательной консоли через сетевое соединение, защищённое
брандмауэром, был удалён root-kit, заменено и укреплено ядро, тщательно
проверена целостность двоичных файлов. Архив обновлений был сверен
с нескольким внешними источниками. Машина будет восстановлена в течение
нескольких недель.</p>

<p>В качестве меры предосторожности были отключены учётные записи всех
разработчиков в LDAP, а ключи SSH удалены. Это сделано, чтобы не пострадали
другие машины. Однако, это делает невозможным почти любое участие в
деятельности проекта, связанное с загрузкой файлов на сервер или доступом
к репозиториям CVS.</p>

<p>Все пароли на quantz (т.е. все пароли Alioth, arch и subversion)
также отключены. Все авторизованные ключи SSH удалены. Для создания
нового пароля используйте, пожалуйста, <a
href="https://alioth.debian.org/account/lostpw.php">систему</a>
восстановления потерянных паролей.</p>
   
<p>После того, как будут снова запущены все службы и будут приняты меры
по безопасности машин, LDAP будет восстановлен и разработчики смогут <a
href="http://db.debian.org/password.html">создать</a> новые пароли.
Однако, предсказать, когда это произойдёт, нельзя.</p>

<p>После восстановления на взломанных машинах был переустановлен SSH.
Поэтому на этих серверах используются новые ключи RSA и отпечатки
ключей. Ключи будут включены в LDAP, как только они будут сгенерированы.
Их можно взять <a href="http://db.debian.org/machines.cgi">здесь</a>.</p>


<h3>Выводы</h3>

<p><strong>Обновите ваш пароль!</strong></p>

<p>Поскольку со взломанных системах были взяты хранившиеся там пароли,
любое внешнее соединение, где используется такой пароль, должно
рассматриваться как взломанное, т.е. пароль нужно считать известным
нападающему. Поэтому его следует немедленно сменить.</p>

<p>Кроме того, если кто-то из имевших доступ к одной из машин Debian
использует тот же пароль или парольную фразу на других машинах или
для других ключей, мы настоятельно рекомендуем сменить этот пароль
как можно быстрее.</p>

<p>Если ключ SSH был сгенерирован или хранился на одной из наших машин
и использовался для входа на другие машины (т.е. помещён в
<code>.ssh/authorized_keys</code>), его также следует удалить.</p>

<p>Секретные ключи GnuPG/PGP, обнаруженные на машинах debian.org,
также удалены из сети ключей Debian и, таким образом, больше не могут
использоваться.</p>

<p>Разработчики, беспокоящиеся о собственных машинах, должны, по
крайней мере, запустить chkrootkit и проанализировать его вывод.
Мэтт Таггарт (Matt Taggart) сопровождает обратный перенос на woody,
который можно найти по следующему адресу:</p>

<ul class="discless">
   <li>deb http://lackof.org/taggart/debian woody/chkrootkit main
   <li>deb-src http://lackof.org/taggart/debian woody/chkrootkit main
</ul>

<p>Кроме того, Вичерт Аккерман (Wichert Akkerman) и Мэтт Таггарт (Matt Taggart)
составили подробный список <a
href="http://www.wiggy.net/debian/developer-securing/">мер предосторожности</a>.


<h3>SucKIT Root-Kit</h3>

<p>SucKIT&nbsp;&mdash; это инструмент, представленный в 58-м выпуске Phrack,
статья 0x07 ("Изменение на лету ядра Linux без LKM" авторства sd &amp; devik).
Это полностью рабочий инструмент, загружаемый через /dev/kmem, т.е. для
его работы не требуется ядро с поддержкой загружаемых модулей ядра.
Он предоставляет оболочку защищённого паролем удалённого доступа с
обратным соединением, инициируемым поддельным пакетом (минующим большинство
брандмауэров). Может скрывать процессы, файлы и соединения.</p>

<p>Обычно SucKIT запускается как /sbin/init при загрузке системы,
разветвляется для установки самого себя в ядра, запускает фоновый
процесс и передаёт управление от родительского процесса (pid 1) исходному
двоичному файлу init. Любое последующее выполнение <code>/sbin/init</code>
будет перенаправлено на исходный init.</p>


<h3>Защита TESO's Burneye</h3>

<p>Burneye&nbsp; это средство "затемнения" двоичных файлов формата ELF
на платформах UNIX, представленное в 58-м выпуске Phrack, статья 0x05
("`Бронирование' ELF: двоичное шифрование на всех платформах UNIX"
авторства grugq &amp; scut). Используя средства типа TESO's Burneye,
нападающий может изменить выполняемую программу так, чтобы скрыть
её истинное назначение, скрыв её от фильтров брандмауэров, систем
обнаружения вторжения, антивирусного ПО и зоркого взгляда исследователей.</p>


<h3>Благодарности</h3>

<ul>
  <li> Джеймсу Трупу (James Troup) и Райану Мюррею (Ryan Murray) за общую
       работу со всеми системами
  <li> Адаму Хету (Adam Heath) и Брайану Вольфу (Brian Wolfe) за работу
       с master и murphy
  <li> Вичерту Аккерману (Wichert Akkerman) за работу с klecker
  <li> Данну Фразье (Dann Frazier) и Мэтту Таггарту (Matt Taggart) за работу
       с gluck
  <li> Майклу Стоуну (Michael Stone) и Роберту ван дер Меулену (Robert
       van der Meulen) за следственный анализ
  <li> Маркусу Мейсснеру (Marcus Meissner) за дизассемблирование кода,
       использующего уязвимость
  <li> Джакко Ниэми (Jaakko Niemi) за работу по проверке и восстановлению
       lists.debian.org
  <li> Колину Уотсону (Colin Watson) за работу по проверке и восстановлению
       bugs.debian.org
  <li> Джосипу Родину (Josip Rodin) за работу по проверке и восстановлению
       web-архивов списков рассылки
</ul>

<h3>Отклики прессы</h3>

<ul>
<li><a href="http://slashdot.org/articles/03/11/21/1314238.shtml">Slashdot</a>, Nov 21, 2003
<li><a href="http://www.eweek.com/print_article/0,3048,a=113091,00.asp">eWeek</a>, Nov 21, 2003
<li><a href="http://www.internetnews.com/dev-news/article.php/3112551">InternetNews</a>, Nov 21, 2003
<li><a href="http://www.heise.de/newsticker/data/odi-21.11.03-001/">Heise Newsticker</a>, Nov 21, 2003 (German)
<li><a href="http://www.pro-linux.de/news/2003/6205.html">Pro-Linux</a>, Nov 21, 2003 (German)
<li><a href="http://www.linux-community.de/Neues/story?storyid=10821">Linux-Community</a>, Nov 21, 2003 (German)
<li><a href="http://barrapunto.com/articles/03/11/21/1527220.shtml">BarraPunti</a>, Nov 21, 2003 (Spanish)
<li><a href="http://www.newsforge.com/article.pl?sid=03/11/21/1319258">Newsforge</a>, Nov 21, 2003
<li><a href="http://searchenterpriselinux.techtarget.com/originalContent/0,289142,sid39_gci938279,00.html">SearchEnterpriseLinux.com</a>, Nov 22, 2003
<li><a href="../oldurl?http://www.debianplanet.org/node.php?id=1011">Debian Planet</a>, Nov 22, 2003
<li><a href="http://www.pcworld.com/news/article/0,aid,113636,00.asp">PC World</a>, Nov 24, 2003
<li><a href="http://news.zdnet.co.uk/internet/security/0,39020375,39118062,00.htm">ZDNet UK</a>, Nov 24, 2003
<li><a href="http://www.enterprise-linux-it.com/perl/story/22748.html">Enterprise Linux IT</a>, Nov 24, 2003
<li><a href="http://www.theage.com.au/articles/2003/11/24/1069522516071.html">The Age</a>, Nov 24, 2003
<li><a href="http://www.smh.com.au/articles/2003/11/24/1069522516071.html">Sydney Morning Herald</a>, Nov 24, 2003
<li><a href="http://www.windowsitpro.com/windowspaulthurrott/Article/ArticleID/40957/windowspaulthurrott_40957.html">Windows &amp; .NET Magazine</a>, Nov 24, 2003
<li><a href="http://www.infoworld.com/article/03/11/24/HNdebianhacked_1.html">Infoworld</a>, Nov 24, 2003
<li><a href="http://www.linuxinsider.com/perl/story/32240.html">Linux Insider</a>, Nov 24, 2003
<li><a href="http://www.ecommercetimes.com/perl/story/32240.html">eCommerce Times</a>, Nov 24, 2003
<li><a href="http://www.technewsworld.com/perl/story/32240.html">TechNewsWorld</a>, Nov 24, 2003
<li><a href="http://www.theregister.co.uk/2003/11/24/check_your_sums_debian_advises/">The Register</a>, Nov 28, 2003
<li><a href="http://newsvac.newsforge.com/article.pl?sid=03/11/28/1545237">Newsforge</a>, Nov 28, 2003
<li><a href="http://slashdot.org/articles/03/11/28/050232.shtml">Slashdot</a>, Nov 28, 2003
<li><a href="http://developers.slashdot.org/developers/03/12/01/2133249.shtml">Slashdot</a>, Dec 1, 2003
<li><a href="http://www.theage.com.au/articles/2003/11/24/1069522516071.html">The Age</a>, Dec 1, 2003
<li><a href="http://www.smh.com.au/articles/2003/12/01/1070127318372.html">Sydney Morning Herald</a>, Dec 1, 2003
<li><a href="http://www.pro-linux.de/news/2003/6240.html">Pro-Linux</a>, Dec 2, 2003 (German)
<li><a href="http://www.heise.de/newsticker/data/jk-02.12.03-000/">Heise Newsticker</a>, Dec 2, 2003 (German)
<li><a href="http://www.golem.de/0312/28747.html">Golem</a>, Dec 2, 2003 (German)
<li><a href="http://lwn.net/Articles/60948/">LWN</a>, Dec 2, 2003
<li><a href="http://www.theregister.co.uk/2003/12/02/hackers_used_unpatched_server/">The Register</a>, Dec 2, 2003
<li><a href="http://www.zdnet.de/news/security/0,39023046,39117906,00.htm">ZDnet DE</a>, Dec 2, 2003 (German)
<li><a href="http://www.linux-community.de/Neues/story?storyid=11004">Linux-Community</a>, Dec 2, 2003 (German)
<li><a href="http://www.heise.de/security/artikel/42546">Heise</a>, Dec 2, 2003 (German)
<li><a href="http://www.heise.de/newsticker/data/anw-02.12.03-005/">Heise Newsticker</a>, Dec 2, 2003 (German)
<li><a href="http://www.symlink.ch/articles/03/12/02/1820248.shtml">Symlink</a>, Dec 2, 2003
<li><a href="http://www.pro-linux.de/news/2003/6245.html">Pro-Linux</a>, Dec 3, 2003 (German)
<li><a href="http://www.heise.de/newsticker/data/ju-04.12.03-000/">Heise Newsticker</a>, Dec 4, 2003 (German)
<li><a href="http://www.symlink.ch/articles/03/12/04/0123247.shtml">Symlink</a>, Dec 4, 2003 (German)
<li><a href="http://www.internetnews.com/dev-news/article.php/3116231">Symlink</a>, Dec 4, 2003
<li><a href="http://newsvac.newsforge.com/article.pl?sid=03/12/04/1448206">Newsforge</a>, Dec 4, 2003
<li><a href="http://newsvac.newsforge.com/article.pl?sid=03/12/05/1635231">Newsforge</a>, Dec 5, 2003
<li><a href="http://www.osnews.com/comment.php?news_id=5362">OSnews</a>, Dec 10, 2003
<li><a href="http://news.com.com/2100-7344-5117271.html">Cnet</a>, Dec 10, 2003
<li><a href="http://newsvac.newsforge.com/article.pl?sid=03/12/30/1435210">Newsforge</a>, Dec 30, 2003

</ul>

<h3>Для связи</h3>

<p>Чтобы получить более подробную информацию, посетите <a
href="$(HOME)/">web-страницы</a> Debian или отправьте ваш вопрос по адресу
<email press@debian.org />.</p>
