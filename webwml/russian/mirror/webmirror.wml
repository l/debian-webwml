#use wml::debian::template title="Зеркала веб-сайта Debian"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.42"
#include "$(ENGLISHDIR)/mirror/webmirrors.data"

<toc-display/>

<toc-add-entry name="whynot">Почему нам не нужно больше веб-зеркал</toc-add-entry>

<p>Наши зеркала веб-сайтов требуют сопровождения (чуть больше, чем зеркала
FTP-сайта, но подобно, так как вам каждый раз необходимо изменять конфигурационные
файлы Apache, сейчас и потом) и стоит спонсорских ресурсов. Однако, в связи с
природой веб-страниц, которые вам нет необходимости загружать регулярно, и для
которых вам не надо беспокоиться, приходят они на 2кбит или на 30кбит, потому что
они достаточно малы, поэтому возникает вопрос о полезности множества зеркал
веб-сайтов.
</p>

<p>Были времена, когда соединения Internet в мире не были быстрыми, и доступ к
www.debian.org с другого континента был тягостным и намного медленнее, чем
типичное модемное соединение. Так что мы организовали зеркалирование и было
создано несколько зеркал веб-сайтов. Десять (или одиннадцать, если считать
Турцию) из них в Европе.
</p>

<p>Однако сегодня мы имеем явно быстрые сетевые связи, особенно в Европе,
так что трудно найти необходимость для этих многих зеркал. Фактически, в связи
с увеличившейся скоростью сетевых связей между Европой и Америкой, больше нет
медленного доступа к www.debian.org из Европы.
</p>

<p>Это в основном, почему мы больше не нуждаемся в зеркалах веб-сайтов, особенно
на континентах, где уже есть зеркала. Пожалуйста, уважайте наши желания.
Спасибо за ваше сотрудничество.
</p>

<p>Если у вас есть вопросы, посылайте их на
<a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.
</p>

<hrline />

<toc-add-entry name="ref">Справка по существующим зеркалам</toc-add-entry>

<p><strong>Информация ниже предоставлена только для сопровождающих существующих
зеркал.</strong>
</p>

<h3>Процесс зеркалирования</h3>

<p>Рекомендуемый метод зеркалирования это rsync. Анонимного доступа к файлам
веб-сайта не существует. Вы можете настроить авторизованный доступ с
сопровождающим сайта, с которого вы хотите зеркалировать, пожалуйста, пошлите
email на <a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.
</p>

<p>Зеркалирование это <q>вытягивающий</q> процесс, так как клиент запрашивает
данные с сервера как ему самому удобно. Чтобы это настроить, вы можете
использовать <a href="websync">скрипт websync</a> и <a href="websync.conf">его
конфигурационный файл</a>, который может быть запущен из crontab и всё сделает
автоматически. Следуйте инструкциям в скрипте для уверенности, что всё
отлично работает.</p>

<h4>Зеркалирование из проталкивающего зеркала</h4>

<p>Проталкивающее зеркалирование это форма зеркалирования, использующая rsync, который
минимизирует время, занимаемое на то, чтобы изменения в главном архиве достигли зеркал.
Сервер зеркала использует механизм защёлки для информирования клиентского зеркала, что
ему необходимо обновиться.
</p>

<p>Метод полностью безопасен, как ssh, настроенный для запуска только одной команды.
Также, зеркалирование лишь <q>вытягивает</q>, так что оно <strong>не может</strong>
испортить содержимое архива через поддельное проталкивающее зеркало.
Некоторые администраторы зеркал выказывали некоторое нежелание к использованию этого
метода зеркалирования, основываясь на страхах, что этот метод может открыть их
машину к вторжениям. Это просто <strong>неправда</strong>.
</p>

<p>Более подробное описание о том, как это работает, почему это безопасно, и как
настроить проталкивающее зеркало, смотрите <a href="push_mirroring">полное
разъяснение</a>.
</p>

<h3>Когда зеркалировать</h3>

<p>Главный сайт получает обновления примерно каждые четыре часа.</p>

<p>Если ваш сайт будет проталкивающе зеркалирован, тогда вам нет необходимости
беспокоиться об этом. Если нет, вы должны вычислить время зеркалирования для вашего
сайта согласно временам в файлах временных меток в директории
<code>/mirror/timestamps/</code> зеркала веб-сайта. Добавьте некоторое время, скажем
полчаса, к этому времени, и тогда зеркалируйте.
</p>

<p>Самый лёгкий путь ежедневно автоматически запускать зеркалирование, это использовать
cron. Детали смотрите в <kbd>man crontab</kbd>.
</p>

<h3>Рекламирование спонсора зеркала</h3>

<p>Если вы хотите, вы можете заменить изображение <code>sponsor_img.jpg</code>
(ненавязчивым) логотипом вашей компании или организации, и можете сделать
пересылку со страницы <code>sponsor.html</code> на вашу домашнюю страницу.
По умолчанию оба эти файла не зеркалируются. Оригиналы находятся в
<code>sponsor.deb.html</code> и <code>sponsor.deb.jpg</code>. Не смотря на то,
что вы можете использовать эти оригинальные файлы, мы поощряем создание вашего
собственного изображения. Советуемый максимальный размер для вашего
логотипа&nbsp;&mdash; 120x60 пикселов.</p>

<p>В связи с тем, что на веб-страницах используется <a href="#cn">согласование
содержимого</a> для выбора предпочитаемого языка, вы можете даже предоставлять
<code>sponsor.html</code> на различных языках. Для того чтобы сделать это, вы
просто создаёте файлы sponsor.&lt;lang&gt;.html для каждого &lt;lang&gt;,
который вы хотите.
</p>

<p>Убедитесь, что те файлы, которые нежелательно перезаписывать, добавлены в
список исключённых для зеркалирования файлов.
</p>

<h3>Конфигурирование веб-сервера</h3>

<h4>Различные изменения в веб-сервере</h4>

<p>Если на вашей машине запущен Debian, то было принято решение о нарушении
политики Debian и использован <code>/doc</code> в веб-страницах. Это значит, что
вы должны закомментировать строку <q><code>Alias /doc/ /usr/share/doc/</code></q> в
вашем файле <code>/etc/apache/srm.conf</code>.
</p>

<p>Замечание: все ваши скрипты CGI запускаются централизованно с cgi.debian.org,
так что вам нет необходимости беспокоиться о них.
</p>

<h4><a name="cn">Согласование содержимого</a></h4>

<p>Согласование содержимого&nbsp;&mdash; это метод, который позволяет обозревателю
согласовать с сервером тип документа, который должен быть предоставлен. Хотя есть
несколько вариантов использовать его, наиболее общим является согласование, какой
язык документа должен быть предоставлен. Использование этого позволяет Debian
предоставлять свои страницы на многих языках в (технически) очень элегантной манере.
</p>

<p>Для тех, кто использует Apache, изменения почти банальны.
Просто добавьте опцию:
</p>

<pre>
Options +Multiviews
</pre>

<p>в секцию <code>&lt;Directory&gt;</code> для веб-страниц Debian в вашем файле
<kbd>/etc/apache/access.conf</kbd>, и перезапустите сервер.

<p>Дополнительно вам нужно убедиться, что сервер может обрабатывать все языки,
которые будут на веб-сайте. Это делается добавлением метки <kbd>AddLanguage</kbd>.
Следующее является списком тех языков, которые уже используются - позже ожидается
добавление других:

<pre>
  AddLanguage en .en
<:
foreach $l (keys %langs) { push @codes, $langs{$l}; }
foreach $c (sort @codes) { print "  AddLanguage $c .$c\n" if (($c ne "en") && ($c ne "zh")); }
:>  \
  AddLanguage pt-br .pt
  AddLanguage nb .nb
  AddLanguage zh-CN .zh-cn
  AddLanguage zh-HK .zh-hk
  AddLanguage zh-TW .zh-tw
</pre>

<p>В связи с ошибкой в apache, ошибочный язык может быть предоставлен в некоторых
случаях, так что хорошей идеей является добавление каждого предоставляемого языка
в опцию LanguagePriority, подобно следующему:
</p>

<pre>
<:
print "LanguagePriority en fr es ";
foreach $c (sort @codes) { print "$c " if (($c ne "en") && ($c ne "fr") && ($c ne "es") && ($c ne "zh")); }
print "pt-br nb zh-CN zh-HK zh-TW\n";
:>\
</pre>

<p>В порядке избежания предоставления согласованных по содержимому файлов с
неправильным набором символов, убедитесь, что настройка <code>AddDefaultCharSet</code>
или закомментирована, или установлена в <q><code>Off</code></q>.

<p>Если используется apache 1, то для корректного обслуживания файлов
индекса директории, возможно, вам необходимо изменить запись
<code>DirectoryIndex</code> в <code>/etc/apache/srm.conf</code>. Но это не
будет работать с apache 2. Следующего должно быть достаточно для apache 1:
</p>

<pre>
DirectoryIndex index index.html
</pre>

<p>Чтобы для favicon.ico посылался правильный заголовок Content-Type, Apache
должен быть проинструктирован использовать тип image/x-icon, подобно этому:</p>

<pre>
AddType image/x-icon .ico
</pre>

<p>Чтобы для файлов RSS посылался правильный заголовок Context-Type, Apache
должен быть проинструктирован использовать тип application/rss+xml, подобно
этому:</p>

<pre>
AddType application/rss+xml .rdf
</pre>

<p>Для избежания проблем с согласованием содержимого с содержимым из
<a href="../events/">/events</a>, файлам calendar необходимо назначить
более низкий приоритет, чем содержимому text/html:</p>

<pre>
AddType text/calendar;qs=0.9 .ics
</pre>

<h4>Перенаправления</h4>

<p>Так как некоторые части веб-сайта создавались быть слишком большими, чтобы
зеркалироваться многими сайтами, мы отделили их от главного сайта. Также
большинство ссылок должны быть сконвертированы для использования новых мест,
вы вполне можете добавлять перенаправления на другой сайт, так что ссылки не будут
испорчены. Это может быть сделано в <kbd>/etc/apache/srm.conf</kbd>. Например:
</p>

<pre>
Redirect /Lists-Archives http://lists.debian.org/
Redirect /search http://search.debian.org
Redirect /Packages http://packages.debian.org
Redirect /lintian http://lintian.debian.org
</pre>
