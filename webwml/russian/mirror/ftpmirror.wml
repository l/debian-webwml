#use wml::debian::template title="Настройка зеркала архивов Debian"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.44"
#include "$(ENGLISHDIR)/releases/woody/release.data"

<toc-display/>

<p>Как только зеркало настроено, оно должно быть <a href="submit">зарегистрировано в Debian</a>
для добавления его в <a href="list">список зеркал</a>.
Для подача заявки используется наша <A href="submit">простая веб-форма</a>.

<p>Проблемы и вопросы можно присылать на <email mirrors@debian.org>.</p>

<toc-add-entry name="what">Что необходимо для зеркалирования</toc-add-entry>

<p><a href="./">Главная страница зеркала</a> перечисляет архивы, доступные для
зеркалирования.
<br>
Пользователи будут искать архив debian/ для установки Debian через сеть,
для создания дисков (с помощью jigdo), и для обновления уже установленных систем.

<p>Замечание: с выпуском sarge архив debian-non-US/ больше не используется.</p>

<p>debian-cd/&nbsp;&mdash; это архив, который не одинаков для разных серверов зеркал.
На некоторых сайтах он содержит шаблоны jigdo для создания образов дисков (используется
совместно с файлами из debian/), на некоторых он содержит уже созданные образы дисков,
а на некоторых сайтах содержится оба варианта.
<br>
Подробную информацию о зеркалировании смотрите на странице <a href="$(HOME)/CD/mirroring/">\
зеркалирование образов дисков</a>.</p>

<p>debian-archive/ содержит настоящий <em>архив</em> старых и вышедших из употребления
версий Debian. Главным образом он будет интересен лишь малому числу пользователей.</p>

<p>Архив debian-security/ содержит обновления безопасности, выпущенные командой
безопасности Debian. Он выглядит интересным для каждого, но, в связи с тем, что обновления
безопасности случайны, для того, чтобы оно оставалось современным, достаточно лишь иногда
обновлять его зеркало (или использовать <a href="push_mirroring">проталкивающее
зеркалирование</a>), так что мы не рекомендуем его. Вместо этого Debian делает всё
возможное для поддержки высокой доступности security.debian.org.</p>

<p>Более точную информацию о размерах зеркала смотрите на странице <a href="size">размер
зеркала</a>.</p>

<toc-add-entry name="wherefrom">Откуда зеркалировать</toc-add-entry>

<p>Многие люди думают, что каноническое расположение пакетов Debian это
<code>ftp.debian.org</code>, и что будет лучше для них зеркалировать именно с этого
сайта. Это <strong>неверно</strong>. <code>ftp.debian.org</code> это лишь один
из нескольких серверов, которые обновляются с внутреннего сервера Debian.</p>

<p>Любой из серверов в <a href="list-full">полном списке зеркал</a>, имеющий метку
'<kbd>Type: Push-Primary</kbd>', будет правильным для зеркалирования с него.
Используйте тот из них, который, по сетевым меркам, географически ближе к вам.</p>

<p>Нет никакой разницы между разными <em>Push-Primary</em> серверами зеркал,
так как в зеркалировании участвуют все они. С другой стороны, если множество людей
использует ftp.debian.org (а, к несчастью, так оно и есть), это излишне тратит
пожертвованную полосу пропускания.</p>

<toc-add-entry name="how">Как зеркалировать</toc-add-entry>

<p>Рекомендуемый метод зеркалирования это так называемый
<a href="anonftpsync">anonftpsync</a> скрипт через анонимный
<a href="http://packages.debian.org/stable/net/rsync">rsync</a>.</p>

<p>Замечание: тогда как <kbd>wget</kbd> и другие инструменты ftp выглядят
хорошо работающими, существуют некоторые спорные моменты. Мы строго рекомендуем
использовать rsync.</p>

<h3>Анонимный rsync</h3>

<p>Мы рекомендуем использовать <a href="anonftpsync">этот скрипт</a> для
зеркалирования архива. Следуйте направлениям в скрипте для настройки зеркалирования.

<p>Есть несколько советов для тех, кто предпочитает другие методы:

<ul>
  <li>Запускайте rsync с, как минимум, следующими опциями: <kbd>--recursive --times
      --links --hard-links --delete</kbd>.

  <li>Если у вас достаточно дискового пространства, используйте также опцию
      <kbd>--delete-after</kbd>, для избежания некоторых временных проблем обновления.

  <li>Если у вас недостаточно дискового пространства для зеркалирования всего, используйте
      опцию <kbd>--exclude</kbd> для исключения от зеркалирования частей архива.
      Обычно туда можно включить различные архитектуры, которые вам не желательны. Например,
      следующее исключит <em>все</em> архитектуры:
      <br>
<: 
print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br>\n"
  foreach (sort keys %arches);
:>
      Хорошо просмотрите <a href="#partial">секцию о частичном зеркалировании</a>.

  <li>После того, как rsync завершит зеркалирование, добавте файл с именем вашего сервера
      с отметкой времени в поддиректорию <code>project/trace/</code> зеркала Debian.
      Это предполагает запуск
      <kbd>date -u &gt; .../debian/project/trace/<var>ваш.сервер</var></kbd>
      после того, как ежедневный rsync завершён; и
      <kbd>date -u &gt; .../debian-non-US/project/trace/<var>ваш.сервер</var></kbd>
      после того как ежедневный non-US rsync завершён, если вы зеркалируете debian-non-US.

  <li>Мы строго советуем не исключать <tt>project/</tt>, <tt>doc/</tt>
      и другие поддиректории. Обычно они невелики в размерах, но всё же полезны пользователям.
      Особенно очень помогает <tt>project/trace</tt>, если имеются какие-либо проблемы с
      зеркалом.
</ul>

<h3>Rsync с идентификацией с проталкивающего зеркала</h3>

<p>Проталкивающее зеркалирование это форма зеркалирования, использующая rsync, который
мы разработали для уменьшения времени, занимаемого чтобы изменения в архиве достигли зеркал.
Сервер зеркала использует защёлку ssh, чтобы сказать клиентскому зеркалу обновить себя.

<p>Проталкивающее зеркалирование необходимо для сохранения множества серверов в синхронизации
(таких как серверов с DNS системой имён, подобных <tt>ftp.us.debian.org</tt>),
и мы обычно используем его для наших первых и вторых скрепляющих зеркал. Для "нормальных"
зеркал, этот метод требует множество усилий для настройки, которые на самом деле не
оправдываются по сравнению с хорошо отлаженной работой cron.</p>

<p>Метод полностью безопасен, как ssh, настроенный для запуска только одной команды.
Также, зеркалирование лишь `вытягивает', так что оно <strong>неможет</strong>
испортить содержимое архива через поддельное проталкивающее зеркало.
Некоторые администраторы зеркал выказывали некоторое нежелание к использованию этого
метода зеркалирования, основываясь на страхах, что этот метод может открыть их
машину к вторжениям.
Это просто <strong>неправда</strong>.

<p>Более подробное описание, как это работает, почему оно безопасно, и как настроить
проталкивающее зеркалирование, смотрите в <a href="push_mirroring">полном
разъяснении</a>.

<toc-add-entry name="partial">Частичное зеркалирование</toc-add-entry>

<p>Посмотрев на уже <a href="size">большой размер архива Debian</a>, некоторые
люди предпочитают зеркалировать только те его части, которые им нужны. Если вы хотите
исключить что-то, вы должны исключать архитектуры.</p>

<p>С <a href="anonftpsync">anonftpsync</a>, это может быть сделано редактированием
переменной ARCH_EXCLUDE.
Существует также другие, специально написанные скрипты.
Однако, они не предназначены для официальных зеркал.</p>

<p>Мы строго советуем не исключать <tt>project/</tt>, <tt>doc/</tt>
и другие поддиректории. Обычно они невелики в размерах, но всё же полезны пользователям.
Особенно очень помогает <tt>project/trace</tt>, если имеются какие-либо проблемы с
зеркалом.
</p>

<toc-add-entry name="when">Когда зеркалировать</toc-add-entry>

<p>Главный архив обновляется каждые 24 часа.

<p>Зеркала обычно начинают обновляться около 00:00 UTC, но это не фиксированное время.
Мы рекомендуем зеркалировать ежедневно, через несколько часов после этого времени.
Фактически вы должны проверить, оставил ли сайт, с которого вы зеркалируете, файл с
отметкой времени в его поддиректории <kbd>project/trace/</kbd>. Файл с отметкой
времени будет назван как сайт, и он будет содержать полное время последнего обновления
его зеркала. Добавте пару часов к этому времени (для уверенности) и затем зеркалируйте.</p>

<p>Самый лёгкий путь автоматически ежедневно запускать зеркалирование, это использовать cron.
Детали смотрите в <kbd>man crontab</kbd>.

<p>Учтите, что если ваш сайт настроен на работу с проталкивающим механизмом, вам нет
необходимости беспокоиться обо всём этом.</p>

<toc-add-entry name="settings">Рекомендуемые добавочные установки</toc-add-entry>

<p>Если вы собираетесь сделать зеркало Debian доступным через HTTP, добавте следующие
настройки в вашу конфигурацию Apache (конечно, подразумевается, что вы будете использовать
Apache), в пределах блока
<code>&lt;Directory <var>/path/to/your/debian/mirror</var>&gt;</code>,
Где <var>/path/to/your/debian/mirror</var> должно быть актуальным именем
директории, где вы храните зеркало:</p>

<pre>
   Options +Indexes +SymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
</pre>

<p>Это включает индексирование директорий и даёт уверенность, что следование символьным
ссылкам будет работать. Имена файлов в директории индексов не будут обрезаться, и
(обычно несуществующие) описания не будут показываться.</p>
