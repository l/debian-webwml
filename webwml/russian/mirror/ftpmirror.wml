#use wml::debian::template title="Настройка зеркала архивов Debian"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.85" maintainer="Lev Lamberov"
#include "$(ENGLISHDIR)/releases/sid/archive.data"
#include "$(ENGLISHDIR)/releases/arches.data"

<toc-display />

<toc-add-entry name="whether">Зеркалировать или нет?</toc-add-entry>

<p>Хотя мы высоко ценим все новые зеркала, каждый будущий держатель зеркала
должен быть уверен, что он может ответить на следующие вопросы, перед тем как
начнёт создавать собственное зеркало:</p>

<ul>
  <li>Нужно ли зеркало в моей местности? Возможно, недалеко уже есть
      зеркало.</li>
  <li>Есть ли у меня ресурсы для содержания зеркала? Зеркала занимают
      значительное <a href="size">дисковое пространство</a> и полосу пропускания,
      зеркало должно оправдывать свою цену.</li>
  <li>Является ли зеркало правильным выбором? Если вы хотите поддерживать в первую очередь
      пользователей, использующих с вами одного и того же провайдера, либо одну и ту же сеть,
      то вероятно лучше выбрать кэширующий прокси, такой как apt-cacher-ng, squid или varnish.</li>
</ul>

<toc-add-entry name="what">Что зеркалировать</toc-add-entry>

<p><a href="./">Главная страница зеркала</a> перечисляет архивы, доступные для
зеркалирования.</p>

<ul>
<li>
Пользователи будут искать архив debian/ для установки Debian через сеть, для создания
дисков (с помощью jigdo), и для обновления уже установленных систем. <em>Рекомендуется сделать зеркало этого репозитория.</em></li>

<li>
debian-cd/&nbsp;&mdash; это архив, который не одинаков для разных серверов зеркал.
На некоторых сайтах он содержит шаблоны jigdo для создания образов дисков (используется
совместно с файлами из debian/), на некоторых он содержит уже созданные образы дисков,
а на некоторых сайтах содержится оба варианта.
<br />
Подробную информацию о зеркалировании смотрите на странице <a href="$(HOME)/CD/mirroring/">\
зеркалирование образов дисков</a>.</li>

<li>
debian-archive/ содержит настоящий <em>архив</em> старых и вышедших из употребления версий Debian.
Главным образом он будет интересен лишь малому числу пользователей. (Если вы не уверены, что хотите зеркалировать этот архив, то скорее всего вам это и не нужно.)</li>

</ul>

<p>Более точную информацию о размерах зеркала смотрите на странице <a href="size">размер
зеркала</a>.</p>

<p>Архив debian-security/ содержит обновления безопасности, выпущенные командой
безопасности Debian. Хотя это кажется интересным для каждого, мы не рекомендуем нашим
пользователям использовать зеркала для получения обновлений безопасности, а даже наоборот
просим их загружать обновления напрямую с нашей распределённой службы security.debian.org.
<em><strong>НЕ</strong> рекомендуется зеркалировать
debian-security.</em></p>

<toc-add-entry name="wherefrom">Откуда зеркалировать</toc-add-entry>

<p>Заметьте, что <code>ftp.debian.org</code> не является каноническим местом размещения
пакетов Debian, это лишь один из нескольких серверов, которые обновляются с
внутреннего сервера Debian.

Существует множество <a href="list-full">открытых зеркал</a>, поддерживающих rsync,
которые вполне подходят в качестве источника для зеркалирования. Используйте близкий
к вам (в смысле его сетевого размещения) сервер.</p>

<p>Вам не следует использовать в качестве источника зеркалирования имя сервиса, которые
разрешается в несколько адресов (например, <code>ftp.us.debian.org</code>), поскольку
нарушение синхронизации между такими зеркалами может привести к синхронизации между
разными состояниями вашего собственного процесса синхронизации зеркала.
#
Кроме того, заметьте, что мы гарантируем работу только HTTP на
<code>ftp.СТРАНА.debian.org</code>. Если вы хотите выполнять зеркалирование с использованием
rsync (рекомендуется использовать ftpsync), то выберите соответствующее имя сайта для
машины, предоставляющей в настоящее время <code>ftp.СТРАНА.debian.org</code>. (Для этого
следует обратиться к каталогу на этом сервере <code>/debian/project/trace</code>).

<toc-add-entry name="how">Как зеркалировать</toc-add-entry>

<p>Рекомендуемым методом зеркалирования является набор сценариев ftpsync,
который доступен в двух видах:</p>
<ul>
  <li>tar-архив <url "https://ftp-master.debian.org/ftpsync.tar.gz"></li>
  <li>из git-репозитория: <kbd>git clone https://anonscm.debian.org/git/mirror/archvsync.git</kbd> (see <url "https://anonscm.debian.org/cgit/mirror/archvsync.git/">)</li>
</ul>

<p>В качестве протокола зеркалирования мы настоятельно рекомендуем использовать
<a href="https://packages.debian.org/stable/net/rsync">rsync</a>.</p>

<p>Не используйте собственные сценарии и не используйте rsync в режиме одного прохода.
Использование ftpsync гарантирует, что обновления осуществляются так, что apt работает нормально.
В частности, ftpsync обрабатывает переводы, содержимое и другие файлы метаданных,
чтобы при работе apt не возникли ошибки при выполнении проверок в случае, когда
пользователь обновляет список пакетов во время обновления зеркала. Более того,
этот инструмент также создаёт trace-файлы, содержащие дополнительную информацию, которая полезна
для определения того, работает зеркало или нет, какие архитектуры на нём доступны, а также
откуда оно обновляется.</p>

<toc-add-entry name="partial">Частичное зеркалирование</toc-add-entry>

<p>Принимая во внимание <a href="size">большой размер архива Debian</a>,
можно посоветовать зеркалировать лишь часть архива. Открытые зеркала
должны содержать все выпуски (тестируемый, нестабильный и т. д.), но можно ограничить
набор архитектур. В файле настройки ftpsync имеются опции
ARCH_EXCLUDE и ARCH_INCLUDE для этой цели.</p>

<toc-add-entry name="when">Когда зеркалировать</toc-add-entry>

<p>Главный архив обновляется четыре раза в день.
Зеркала обычно начинают обновляться около 3:00, 9:00, 15:00 и 21:00 (всё время по UTC),
но это не фиксированное время, и вы не должны опираться на эти времена при
зеркалировании.</p>

<p>Ваше зеркало должно обновляться спустя несколько часов после начала
обновления главного зеркала. Вы должны проверить, оставил ли сайт, с которого вы зеркалируете, файл с
отметкой времени в его поддиректории <kbd>project/trace/</kbd>. Файл с отметкой
времени будет назван как сайт, и он будет содержать полное время последнего обновления
его зеркала. Добавьте пару часов к этому времени (для уверенности) и затем зеркалируйте.</p>

<p><b>Важно, чтобы ваше зеркало было синхронизировано с основным архивом</b>. Как минимум
4 обновления в течение 24 часов требуются для того, чтобы гарантировать, что ваше зеркало
является действительным отражением архива. Помните, зеркала, которые не синхронизированы
с основным архивом, не будут указаны в списке официальных зеркал.</p>

<p>Самый лёгкий путь автоматически ежедневно запускать зеркалирование, это использовать cron.
Детали смотрите в <kbd>man crontab</kbd>.</p>

<p>Учтите, что если ваш сайт настроен на работу с проталкивающим механизмом, вам нет
необходимости беспокоиться обо всём этом.</p>

<h3>Проталкивающее зеркалирование</h3>

<p><q>Проталкивающее</q> зеркалирование&nbsp;&mdash; это форма зеркалирования, которую мы
разработали для уменьшения времени, требуемого для того, чтобы изменения в архиве достигли зеркал.
Сервер зеркала использует триггер SSH, чтобы сказать клиентскому зеркалу обновить себя.
Более подробное описание того, как это работает, почему оно безопасно, а также как
настроить проталкивающее зеркалирование, смотрите в <a href="push_mirroring">полном
разъяснении</a>.</p>

<toc-add-entry name="settings">Рекомендуемые добавочные установки</toc-add-entry>

<p>На открытых зеркалах архив Debian должен быть доступен по HTTP в каталоге <code>/debian</code>.</p>

<p>Более того, убедитесь, что включены перечени файлов каталога (с полными
именами файлов) и выполняется переход по символьным ссылкам.

Если вы используете Apache, то можно использовать следующие настройки:
<pre>
&lt;Directory <var>/путь/к/вашему/зеркалу/debian</var>&gt;
   Options +Indexes +SymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
&lt;/Directory&gt;
</pre>

<toc-add-entry name="submit">Как добавить зеркало в список зеркал</toc-add-entry>

<p>
Если вы хотите, чтобы ваше зеркало было представлено в официальном списке зеркал, то
</p>

<ul>
<li>убедитесь, что синхронизация вашего зеркала с архивом осуществляется 4 раза за 24 часа</li>
<li>убедитесь, что ваше зеркало содержит файлы с исходным кодом для всех архитектур, которые
представлены на вашем зеркале</li>
</ul>

<p>После настройки зеркала его следует <a href="submit">зарегистрировать в Debian</a>,
тогда оно будет включено в <a href="list">официальный список зеркал</a>.
Для подачи заявки используется <a
href="submit">простая веб-форма</a>.</p>

<p>Вопросы и о проблемах можно писать на <email mirrors@debian.org>.</p>

<toc-add-entry name="mailinglists">Списки рассылки</toc-add-entry>

<p>Существует два открытых <a href="../MailingLists/">списка рассылки</a> касательно
зеркал Debian,
<a href="https://lists.debian.org/debian-mirrors-announce/">debian-mirrors-announce</a>
и
<a href="https://lists.debian.org/debian-mirrors/">debian-mirrors</a>.
Всем сопровождающим зеркал настоятельно рекомендуется подписаться на список на новостной
список рассылки, поскольку он используется для распространения важных новостей. Этот список
модерируется, количество сообщений в нём крайне мало. Второй список рассылки предназначен в
первую очередь для общих обсуждений и открыт для всех.</p>

<p>Если у вас имеются какие-либо вопросы, ответы на которые вы не нашли на этих страницах,
то вы можете связаться с нами по адресу <email mirrors@debian.org> или задать ваши вопросы
через IRC, канал #debian-mirrors в сети <tt>irc.debian.org</tt>.</p>


<toc-add-entry name="private-mirror">Замечания для закрытых (частичных) зеркал</toc-add-entry>

<p>
Если вы хотите, чтобы ваше зеркало было доступно только в вашей сети, либо вам требуются только определённые
наборы пакетов (например, только стабильный выпуск), то утилита <a href="https://packages.debian.org/stable/debmirror">
debmirror</a> тоже вам подойдёт.
</p>
