#use wml::debian::template title="ц╝ц│ц⌠ц■ц▓ц▐ц┼ц▀ц│ push-ц⌠ц┘ц▓ц≈ц┘ц▓ц│"
#use wml::debian::translation-check translation="1.20"
#use wml::debian::toc

<p>ц╝ц│ц⌠ц■ц▓ц▐ц┼ц▀ц│ push-ц⌠ц┘ц▓ц≈ц┘ц▓ц│ ц⌠ц▐ц⌠ц■ц▐ц┴ц■ ц┴ц  ц└ц≈ц•ц┬ ц▐ц⌠ц▌ц▐ц≈ц▌ц≥ц┬ ц ц│ц└ц│ц·: ц▌ц│ц⌠ц■ц▓ц▐ц┼ц▀ц│ rsync
ц└ц▐ц⌠ц■ц•ц░ц│ (ц└ц▄ц▒ ц▌ц▐ц▓ц█ц│ц▄ц≤ц▌ц▐ц┤ц▐, <q>ц■ц▒ц▌ц•ц²ц┘ц┤ц▐</q> ц ц┘ц▓ц▀ц│ц▄ц┴ц▓ц▐ц≈ц│ц▌ц┴ц▒) ц┴ ц▌ц│ц⌠ц■ц▓ц▐ц┼ц▀ц│ ц■ц▓ц┴ц┤ц┤ц┘ц▓ц▌ц▐ц┤ц▐ ц█ц┘ц┬ц│ц▌ц┴ц ц█ц│ ssh
(ц└ц▄ц▒ <q>ц░ц▓ц▐ц■ц│ц▄ц▀ц┴ц≈ц│ц▌ц┴ц▒</q> ц■ц▒ц▌ц•ц²ц┘ц┤ц▐ ц ц┘ц▓ц▀ц│ц▄ц┴ц▓ц▐ц≈ц│ц▌ц┴ц▒).
</p>

<p><small>(ц╟ц▐ц└ц▓ц▐ц┌ц▌ц▐ц⌠ц■ц┴ ц▐ ц■ц▐ц█, ц·ц■ц▐ ц■ц│ц▀ц▐ц┘ push-ц⌠ц┘ц▓ц≈ц┘ц▓, ц·ц┴ц■ц│ц┼ц■ц┘ ц≈
<a href="push_mirroring">ц▓ц│ц ц÷ц▒ц⌠ц▌ц┘ц▌ц┴ц▒ц┬ push-ц ц┘ц▓ц▀ц│ц▄ц┴ц▓ц▐ц≈ц│ц▌ц┴ц▒</a>.)</small>
</p>

<toc-display />

<toc-add-entry name="rsync">ц╝ц│ц⌠ц■ц▓ц▐ц┼ц▀ц│ rsync</toc-add-entry>

<p>ц╣ц⌠ц■ц│ц▌ц▐ц≈ц┴ц■ц┘ <code>rsync</code> ц≈ц┘ц▓ц⌠ц┴ц┴ 2.1.1 ц┴ц▄ц┴ ц≈ц≥ц⌡ц┘. ц╔ц⌠ц▄ц┴ ц≈ц│ц⌡ ц⌠ц│ц┼ц■ ц▓ц│ц┌ц▐ц■ц│ц┘ц■ ц▌ц│
Debian, ц░ц▓ц▐ц⌠ц■ц▐ ц•ц⌠ц■ц│ц▌ц▐ц≈ц┴ц■ц┘ ц░ц▐ц⌠ц▄ц┘ц└ц▌ц┴ц┼ ц░ц│ц▀ц┘ц■
<a href="http://packages.debian.org/stable/net/rsync">rsync</a>.
</p>

<p>цЁц▐ц ц└ц│ц┼ц■ц┘ ц├ц│ц┼ц▄ <code>rsyncd.conf</code> ц┴ ц≈ц▌ц┘ц⌠ц┴ц■ц┘ ц≈ ц▌ц┘ц┤ц▐ ц·ц■ц▐-ц■ц▐ ц░ц▐ц└ц▐ц┌ц▌ц▐ц┘ ц°ц■ц▐ц█ц•:
</p>

<pre>
uid = nobody
gid = nogroup
max connections = 25
socket options = SO_KEEPALIVE

[debian]
  path = /srv/debian/mirror
  comment = The Debian Archive (~250 GB)
  auth users = authorized_account1,authorized_account2,authorized_accountN
  read only = true
  secrets file = /etc/rsyncd/debian.secrets
</pre>

<p>ц╓ц▐ц┌ц│ц≈ц≤ц■ц┘ ц ц│ц░ц┴ц⌠ц≤ ц└ц▄ц▒ ц▀ц│ц√ц└ц▐ц┤ц▐ ц⌠ц│ц┼ц■ц│, ц▀ц▐ц■ц▐ц▓ц≥ц┼ ц≈ц≥ ц░ц▓ц▐ц■ц│ц▄ц▀ц┴ц≈ц│ц┘ц■ц┘, ц≈ ц├ц│ц┼ц▄
<code>/etc/rsyncd/debian.secrets</code>:
</p>

<pre>
ц│ц≈ц■ц▐ц▓ц┴ц ц▐ц≈ц│ц▌ц▌ц│ц▒_ц•ц·бёц■ц▌ц│ц▒_ц ц│ц░ц┴ц⌠ц≤1:ц░ц│ц▓ц▐ц▄ц≤
ц│ц≈ц■ц▐ц▓ц┴ц ц▐ц≈ц│ц▌ц▌ц│ц▒_ц•ц·бёц■ц▌ц│ц▒_ц ц│ц░ц┴ц⌠ц≤2:ц└ц▓ц•ц┤ц▐ц┼_ц░ц│ц▓ц▐ц▄ц≤
ц│ц≈ц■ц▐ц▓ц┴ц ц▐ц≈ц│ц▌ц▌ц│ц▒_ц•ц·бёц■ц▌ц│ц▒_ц ц│ц░ц┴ц⌠ц≤N:Nц▌ц≥ц┼_ц░ц│ц▓ц▐ц▄ц≤
</pre>

<p>ц╢ц┘ц░ц┘ц▓ц≤ ц≈ц≥ ц└ц│бёц■ц┘ ц▌ц┴ц√ц┘ц▄ц┘ц√ц│ц²ц┴ц█ ц ц┘ц▓ц▀ц│ц▄ц│ц█ ц└ц▐ц⌠ц■ц•ц░ ц▀ ц│ц▓ц┬ц┴ц≈ц• ц▌ц│ ц≈ц│ц⌡ц┘ц┼ ц█ц│ц⌡ц┴ц▌ц┘.
</p>

<p>ц╥ц▐ц ц█ц▐ц√ц▌ц▐, ц≈ц≥ ц ц│ц┬ц▐ц■ц┴ц■ц┘, ц·ц■ц▐ц┌ц≥ ц└ц┘ц█ц▐ц▌ rsync ц ц│ц░ц•ц⌠ц▀ц│ц▄ц⌠ц▒ ц┴ц  inetd. ц╬ц■ц▐ц┌ц≥ ц⌠ц└ц┘ц▄ц│ц■ц≤ ц°ц■ц▐,
ц≈ц≥ ц└ц▐ц▄ц√ц▌ц≥ ц└ц▐ц┌ц│ц≈ц┴ц■ц≤ ц⌠ц┘ц▓ц≈ц┴ц⌠ rsync ц≈ ц├ц│ц┼ц▄ <code>/etc/services</code> (ц┘ц⌠ц▄ц┴ ц▐ц▌ ц┘ц²бё
ц▌ц┘ ц■ц│ц█), ц▀ц│ц▀ ц░ц▐ц▀ц│ц ц│ц▌ц▐ ц▌ц┴ц√ц┘:
</p>

<pre>
rsync           873/tcp
</pre>

<p>
ц╓ц▐ц┌ц│ц≈ц≤ц■ц┘ ц⌠ц▄ц┘ц└ц•ц─ц²ц•ц─ ц⌠ц■ц▓ц▐ц▀ц• ц≈ ц├ц│ц┼ц▄ <code>/etc/inetd.conf</code>, ц·ц■ц▐ц┌ц≥ ц▓ц│ц ц▓ц┘ц⌡ц┴ц■ц≤
ц└ц┘ц█ц▐ц▌ ц┴ц  inetd:
</p>

<pre>
rsync      stream      tcp         nowait      root /usr/bin/rsync rsyncd --daemon
</pre>

(ц╝ц┘ ц ц│ц┌ц•ц└ц≤ц■ц┘ ц░ц▐ц⌠ц▄ц│ц■ц≤ inetd ц⌠ц┴ц┤ц▌ц│ц▄ HUP, ц·ц■ц▐ц┌ц≥ ц⌠ц▀ц│ц ц│ц■ц≤ ц┘ц█ц• ц░ц┘ц▓ц┘ц·ц┴ц■ц│ц■ц≤ ц▀ц▐ц▌ц├ц┴ц┤ц•ц▓ц│ц┐ц┴ц▐ц▌ц▌ц≥ц┼ ц├ц│ц┼ц▄
ц░ц▐ц⌠ц▄ц┘ ц█ц▐ц└ц┴ц├ц┴ц▀ц│ц┐ц┴ц┴.)

<toc-add-entry name="sshtrigger">ц╝ц│ц⌠ц■ц▓ц▐ц┼ц▀ц│ ц█ц┘ц┬ц│ц▌ц┴ц ц█ц│ ц■ц▓ц┴ц┤ц┤ц┘ц▓ц│ ssh</toc-add-entry>

<p>цЁц▐ц ц└ц│ц┼ц■ц┘ ц▌ц▐ц≈ц≥ц┼ ц▀ц▄ц─ц· ssh ц└ц▄ц▒ ц•ц·бёц■ц▌ц▐ц┼ ц ц│ц░ц┴ц⌠ц┴, ц▀ц▐ц■ц▐ц▓ц•ц─ ц≈ц≥ ц┴ц⌠ц░ц▐ц▄ц≤ц ц•ц┘ц■ц┘ ц└ц▄ц▒ ц ц┘ц▓ц▀ц│ц▄ц┴ц▓ц▐ц≈ц│ц▌ц┴ц▒ Debian.
ц╒ц•ц└ц≤ц■ц┘ ц▐ц⌠ц■ц▐ц▓ц▐ц√ц▌ц≥ ц┴ ц▌ц┘ ц░ц┘ц▓ц┘ц ц│ц░ц┴ц⌡ц┴ц■ц┘ ц≈ц│ц⌡ ц▐ц▓ц┴ц┤ц┴ц▌ц│ц▄ц≤ц▌ц≥ц┼ ц▀ц▄ц─ц· ssh, ц└ц▄ц▒ ц·ц┘ц┤ц▐ ц≈ц▐ц⌠ц░ц▐ц▄ц≤ц ц•ц┼ц■ц┘ц⌠ц≤ ц▀ц▄ц─ц·ц▐ц█
ц▀ц▐ц█ц│ц▌ц└ц▌ц▐ц┼ ц⌠ц■ц▓ц▐ц▀ц┴ -f, ц▌ц│ц░ц▓ц┴ц█ц┘ц▓:
</p>

<pre>
ssh-keygen -f ~/.ssh/identity.mysite
</pre>

<p>ц╣ц┌ц┘ц└ц┴ц■ц┘ц⌠ц≤ ц·ц■ц▐ ц▌ц▐ц≈ц≥ц┼ ц░ц•ц┌ц▄ц┴ц·ц▌ц≥ц┼ ц▀ц▄ц─ц· (~/.ssh/identity.mysite.pub) ц⌠ц▐ц└ц┘ц▓ц√ц┴ц■
ц≈ ц▌ц│ц·ц│ц▄ц┘ IPADDRESS ц⌠ IP-ц│ц└ц▓ц┘ц⌠ц▐ц█ ц≈ц≥ц⌡ц┘ц⌠ц■ц▐ц▒ц²ц┘ц┤ц▐ ц ц┘ц▓ц▀ц│ц▄ц│:
</p>

<pre>
no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty,command="~/bin/ftpsync",from="IPADDRESS" &amp;"
</pre>

<p>ц╥ц│ц█ ц▌ц•ц√ц▌ц▐ ц▌ц│ц⌠ц■ц▓ц▐ц┴ц■ц≤ ц⌠ц┐ц┘ц▌ц│ц▓ц┴ц┼, ц▀ц▐ц■ц▐ц▓ц≥ц┼ ц┌ц•ц└ц┘ц■ ц⌠ц≈ц▒ц ц≥ц≈ц│ц■ц≤ц⌠ц▒ ц⌠ ц▌ц┴ц√ц┘ц▄ц┘ц√ц│ц²ц┴ц█ц┴ ц ц┘ц▓ц▀ц│ц▄ц│ц█ц┴.
цЁц▐ц ц└ц│ц┼ц■ц┘ ц├ц│ц┼ц▄ ц⌠ ц┴ц█ц┘ц▌ц┘ц█ <code>signal</code>, ц⌠ц▐ц└ц┘ц▓ц√ц│ц²ц┴ц┼ ц⌠ц▄ц┘ц└ц•ц─ц²ц┘ц┘:
</p>

<protect>
<pre>
#!/bin/sh

# This script is called to signal the remote host that it is time to
# mirror the archive.

echo Signalling $1
ssh -o"BatchMode yes" -o"user $2" "$1" -i $HOME/.ssh/identity.mysite sleep 1
</pre>
</protect>

<p>ц╪ц■ц▐ц■ ц⌠ц┐ц┘ц▌ц│ц▓ц┴ц┼ ц┌ц•ц└ц┘ц■ ц⌠ц▐ц┘ц└ц┴ц▌ц▒ц■ц≤ц⌠ц▒ ц⌠ ц•ц└ц│ц▄бёц▌ц▌ц≥ц█ ц┬ц▐ц⌠ц■ц▐ц█, ц┴ц⌠ц░ц▐ц▄ц≤ц ц•ц▒ ц⌠ц░ц┘ц┐ц┴ц│ц▄ц≤ц▌ц≥ц┼ ц▀ц▄ц─ц· ssh,
ц▀ц▐ц■ц▐ц▓ц≥ц┼ ц≈ц≥ ц⌠ц▐ц ц└ц│ц▄ц┴ ц≈ц≥ц⌡ц┘, ц░ц▓ц┘ц└ц▄ц│ц┤ц│ц▒ ц┘ц┤ц▐ ц└ц▐ц┌ц│ц≈ц┴ц■ц≤ ц≈ ~/.ssh/authorized_keys 
ц▀ц│ц√ц└ц▐ц█ц• ц▐ц░ц┘ц▓ц│ц■ц▐ц▓ц• ц▌ц┴ц√ц┘ц▄ц┘ц√ц│ц²ц┴ц┬ ц ц┘ц▓ц▀ц│ц▄ (ц ц│ц█ц┘ц▌ц▒ц┘ц■ <q>ftpsync</q> ц▌ц│ ц▄ц─ц┌ц•ц─ ц└ц▓ц•ц┤ц•ц─ ц▀ц▐ц█ц│ц▌ц└ц• 
ц└ц▄ц▒ ц▌ц│ц·ц│ц▄ц│ ц ц┘ц▓ц▀ц│ц▄ц┴ц▓ц▐ц≈ц│ц▌ц┴ц▒).
цЁц│ц█ ц░ц▐ ц⌠ц┘ц┌ц┘ ц⌠ц┐ц┘ц▌ц│ц▓ц┴ц┼ ц•ц└ц│ц▄бёц▌ц▌ц▐ ц▌ц┘ ц└ц┘ц▄ц│ц┘ц■ ц▌ц┴ц·ц┘ц┤ц▐ &mdash; ц┌ц•ц└ц┘ц■ ц ц│ц░ц•ц²ц┘ц▌ц│ 
ц┘ц└ц┴ц▌ц⌠ц■ц≈ц┘ц▌ц▌ц│ц▒ ц▀ц▐ц█ц│ц▌ц└ц│, ц ц│ц≈ц┴ц⌠ц▒ц²ц│ц▒ ц▐ц■ ц▌ц│ц⌠ц■ц▓ц▐ц┘ц▀ ц▀ц▄ц─ц·ц│.</p>

<p>ц╕ц│ц▀ц■ц┴ц·ц┘ц⌠ц▀ц┴, ц·ц■ц▐ц┌ц≥ ц⌠ц≈ц▒ц ц│ц■ц≤ ц ц┘ц▓ц▀ц│ц▄ц│, ц≈ц│ц█ ц▌ц•ц√ц▌ц▐ ц≈ц≥ц░ц▐ц▄ц▌ц┴ц■ц≤ <code>./signal
&lt;ц⌠ц│ц┼ц■&gt; &lt;ц┴ц█ц▒_ц░ц▐ц▄ц≤ц ц▐ц≈ц│ц■ц┘ц▄ц▒&gt;</code> ц░ц▐ц⌠ц▄ц┘ ц ц│ц≈ц┘ц▓ц⌡ц┘ц▌ц┴ц▒ ц⌠ц┴ц▌ц┬ц▓ц▐ц▌ц┴ц ц│ц┐ц┴ц┴ 
ц⌠ ц░ц▐ц█ц▐ц²ц≤ц─ rsync. цЁц▐ц▐ц■ц≈ц┘ц■ц⌠ц■ц≈ц┘ц▌ц▌ц▐, ц▀ц│ц▀ ц■ц▐ц▄ц≤ц▀ц▐ ц┌ц•ц└ц┘ц■ ц ц│ц▀ц▐ц▌ц·ц┘ц▌ц▐ ц ц┘ц▓ц▀ц│ц▄ц┴ц▓ц▐ц≈ц│ц▌ц┴ц┘
ц⌠ ц≈ц≥ц⌡ц┘ц▄ц┘ц√ц│ц²ц┴ц█ ц⌠ц│ц┼ц■ц▐ц█, ц≈ц≥ ц⌠ц■ц│ц▓ц■ц•ц┘ц■ц┘ ц░ц▓ц▐ц■ц│ц▄ц▀ц┴ц≈ц│ц▌ц┴ц┘ ц▌ц┴ц√ц┘ц▄ц┘ц√ц│ц²ц┴ц█ ц▐ц■ ц≈ц│ц⌠ ц⌠ц│ц┼ц■ц│ц█.
</p>

<p>ц╢ц│ц▀ц√ц┘ ц█ц▐ц√ц▌ц▐ ц▓ц│ц ц█ц┘ц⌠ц■ц┴ц■ц≤ ц°ц■ц┴ ц▀ц▐ц█ц│ц▌ц└ц≥ ц≈ ц▀ц▐ц▌ц┐ц┘ ц≈ц│ц⌡ц┘ц┤ц▐ <code>ftpsync.conf</code>
ц┴ц▄ц┴ ц⌠ц▐ц ц└ц│ц■ц≤ ц▌ц▐ц≈ц≥ц┼ ц⌠ц┐ц┘ц▌ц│ц▓ц┴ц┼ ц┴ ц ц│ц░ц•ц⌠ц▀ц│ц■ц≤ ц┘ц┤ц▐ ц┴ц  <code>anonftpsync</code>.
<br />ц╝ц│ц░ц▓ц┴ц█ц┘ц▓:
</p>

<protect>
<pre>
#!/bin/sh

# This script is called by websync to signal the downstream mirrors.

./signal some.other.site archvsync
./signal and.another.site othersiteaccount
</pre>
</protect>

<p>ц╔ц⌠ц▄ц┴ ц• ц≈ц│ц⌠ ц░ц▐ц▒ц≈ц┴ц▄ц┴ц⌠ц≤ ц⌠ ц°ц■ц┴ц█ ц▀ц│ц▀ц┴ц┘-ц■ц▐ ц░ц▓ц▐ц┌ц▄ц┘ц█ц≥, <a href="mailto:mirrors@debian.org">
ц⌠ц≈ц▒ц√ц┴ц■ц┘ц⌠ц≤ ц⌠ ц▌ц│ц█ц┴</a>.
</p>
