#use wml::debian::template title="Проталкивающее Зеркалирование"
#use wml::debian::translation-check translation="1.6"

<p>Проталкивающее зеркалирование это форма зеркалирования, использующая rsync, который
минимизирует время, занимаемое на то, чтобы изменения в главном архиве достигли зеркал.
Сервер зеркала использует механизм защёлки для информирования клиентского зеркала, что
ему необходимо обновиться.

<p>Проталкивающее зеркалирование требует немного больше усилий по настройке, поскольку
сопровождающие вышележащего и нижележащего серверов должны обмениваться информацией.
Выгодой является то, что вышележащий сервер инициализирует процесс зеркалирования
непосредственно после того как его архивы были обновлены. Это позволяет изменениям в архиве
распространяться чрезвычайно быстро.

<h2>Разъяснения метода</h2>

<p>Для начал некоторые объяснения о ssh. Ssh позволяет людям безопасно подключаться к
аккаунтам на различных машинах. Не только пароли никогда не передаются в открытом виде,
но и как только вы соединитесь к машине, вам по существу гарантируется, что будущие
соединения будут идти именно к этой машине. Это предупреждает многие так называемые
man-in-the-middle (человек в середине) атаки.
<p>Одной из возможностей, которую имеет ssh, это способность для пользователя дать публичный
ключ идентификации для пользователя на другой машине и добавить его в файл авторизованных ключей
на вашей машине. По умолчанию пользователь на другой машине (который имеет приватный ключ
идентификации, связанный с данным вам публичным ключом идентификации), затем имеет привилегии
входа в ваш аккаунт. При этом возможно добавить к авторизованному ключу текст, ограничивающий
тип доступа персоны, подключающейся к вашему аккаунту, используя этот ключ.

<p>Так что для защиты нижележащего сервера ключ, предоставленный вышележащим сервером зеркала,
имеет текст, добавленный к нему для ограничения, дающего подключающейся к вашему аккаунту персоне
право сделать лишь одну вещь - запустить программу на вашей машине, которая обновляет ваше зеркало.
Даже если кто-то (злоумышленник) взломает ключ, самое большое, что он сможет сделать, это
запустить на вашей машине программу зеркалирования.
Вам даже не надо беспокоиться о возможности запустить множество копий программы, так как
используется файл блокировки.

<p>На вышележащем конце, rsync может быть сконфигурирован для ограничения по имени
пользователя и паролю тех, кто может зеркалировать заданную область. Эти данные полностью
разделены от <kbd>/etc/passwd</kbd>, так что проталкивающие серверы не должны
беспокоиться о том, что кто-то получит доступ к их машинам.
После того, как всё настроено, имя пользователя и пароль устанавливаются пустыми. Это
также не должно быть проблемой, так как наихудшее, что может произойти, это что кто-то
получит возможность зеркалировать страницы Debian с этого сайта.

<h2>Настройка клиента проталкивающего зеркала</h2>

<p>Лучше всего настроить его, используя аккаунт обычного пользователя, не root.
Содержимое публичного ключа ssh, данное вам вышележащим зеркалом, должно быть помещено
в <kbd>~&lt;пользователь&gt;/.ssh/authorized_keys</kbd>.

<p>Чтобы стать клиентом проталкивающего зеркала для архива FTP, вам необходимы файлы
<a href="ftpsync">ftpsync</a> и <a href="ftpsync.conf">ftpsync.conf</a>.
Отредактируйте ftpsync.conf и следуйте руководствам, изложенным в нём, используя
информацию, предоставленную вам вышележащим сервером.

<p>Чтобы стать клиентом проталкивающего зеркала для архива non-US FTP, вам необходимы
файлы <a href="ftpsync-non-US">ftpsync-non-US</a> и
<a href="ftpsync-non-US.conf">ftpsync-non-US.conf</a>.
Эти файлы имеют отличающиеся имена, так что вы можете использовать один и тот же аккаунт для
зеркалирования обоих архивов.

<p>Чтобы стать клиентом проталкивающего зеркала для страниц WWW, вам необходимы файлы
<a href="websync">websync</a> и <a href="websync.conf">websync.conf</a>.
Отредактируйте websync.conf и следуйте руководствам, изложенным в нём, используя
информацию, предоставленную вам вышележащим сервером.

<h2>Сайты клиенты Push-Primary</h2>

<p>Зеркала клиенты Push-Primary, также отнесённые к зеркалам Tier-1, являются клиентами
проталкивающих зеркал, которым разрешено зеркалировать с наших мастер-архивов.

<p>Если ваш сайт <strong>очень</strong> хорошее подключение (имеет хорошую полосу
пропускания и хорошее подключение к главным магистралям) и вы вы хотите позволить другим
майтам зеркалировать с вашего сайта, вы можете дать нам знать, и мы можем рассмотреть
добавление вас к проталкивающему зеркалу. Однако, не ожидайте, что это произойдёт очень
быстро, потому что мы уже имеем значительное количество зеркал Tier-1.

<p>Если ваш сайт становится Push-Primary для архива FTP, вам необходим публичный
ключ ssh для archvsync@ftp-master.debian.org, или
<a href="identity.pub.master.ftp">SSH1</a> или
<a href="id_rsa.pub.ftp-master">SSH2</a> версии.</p>

<p>Если ваш сайт становится Push-Primary для архива non-US FTP, вам необходим
публичный ключ ssh для archvsync@non-us.debian.org, или
<a href="identity.pub.non-US.ftp">SSH1</a> или
<a href="id_rsa.pub.non-US">SSH2</a> версии.</p>

<p>Если ваш сайт становится Push-Primary для страниц WWW, вам необходим публичный
ключ ssh для archvsync@www-master.debian.org, или
<a href="identity.pub.master.web">SSH1</a> или
<a href="id_dsa.pub.www-master">SSH2</a> версии.</p>

<h2>Настройка сервера проталкивающего зеркала</h2>

<p>Обусловленное большим количеством зеркал и размером архива Debian, неосуществимо
всем зеркалам использовать сайт мастер-архива как вышележащий источник Debian
(т.е. его сервера проталкивающего зеркала). Более рационально, если загрузка распределяется
среди нескольких проталкивающих зеркал, распределённых по земному шару.

<p>Серверы проталкивающих зеркал должны быть клиентами проталкивающих зеркал мастер-архива
(или, возможно, другого проталкивающего сервера), и они должны содержать зеркало полного
архива Debian.

<p>Смотрите <a href="push_server">детали по установке проталкивающего сервера</a>.
