#use wml::debian::template title="rsync の使用例および ssh をパスワードなしで使う設定" NOHEADER=yes
#use wml::debian::translation-check translation="1.5"

<H3>rsync の利用例</H3>

<P>以下はウェブサイトと FTP サイトの両方をミラーするやり方の例です。
ご自分の状況に合わせてマシン名とディレクトリの箇所は修正してください。

<P>こちらを cron から実行する場合には lockfile を利用するとよいでしょう。
もし何らかの理由でミラーが完全に行なわれなかった場合、
次回ミラーが実行される際にその旨メールで通知されます。
この場合には、問題がどこにあるのかを調べて修正し、
lockfile を消去すれば、次回には適切にミラーが行なわれるでしょう。

<blockquote>
<pre>
\#!/bin/sh -e

lockfile -r 1 rsync.master.lock || exit 23

rsync -avz -e ssh --exclude sponsor.* --delete &lt;machine&gt;:/web/debian.org/ debian.org

echo Finished updating web mirror. Working on FTP mirror now...

rsync -avz --delete -e ssh &lt;machine&gt;:/debian debian

rm -f rsync.master.lock
</pre>
</blockquote>

<p>上記のスクリプトは、ssh を以下の記述のように設定しなければ
パスワードを尋ねるプロンプトを出します。

<H3><a name="paswordlessssh">パスワードを尋ねられないように ssh を設定するには</a>:</H3>

<p>あなたのアカウントからリモートサイトにログインできるよう、
RSA 認証キーを作ってください。パスワードはタイプしないでください。

<p>この設定をした場合にあなたのアカウント/サイトが侵入されると、
その侵入者はミラーするサイトへのアクセスもできてしまいます!
したがって、これは<strong>絶対に</strong>
root アカウントでは実行しないでください。

<ul>
  <li>あなたのマシンで <code>ssh-keygen</code> を実行し、
      パスワードを尋ねられたときは単にリターンを押します。
  <li>次に、あなたのマシンの <code>~/.ssh/identity.pub</code> の内容を
      ミラーサイトの <code>~/.ssh/authorized_keys</code> にコピーします
      (このファイルのモードは 600 にしましょう)。
</ul>

<p>これでリモートのミラーサイトに、パスワードを尋ねられることなく、
ssh でログインできるようになるはずです。

