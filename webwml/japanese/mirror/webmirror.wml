#use wml::debian::template title="Debian ウェブサイトのミラー"
#use wml::debian::toc
#include "$(ENGLISHDIR)/mirror/webmirrors.data"
#use wml::debian::translation-check translation="1.46"

<toc-display />

<hrline />

<toc-add-entry name="whynot">どうしてウェブミラーがこれ以上要らないのか</toc-add-entry>

<p>ウェブミラーは管理が必要で (Apache
の設定ファイルをたまに変更する必要があったりして、FTP
サイトのミラーより手間がかかります)、提供者のリソースに負担がかかります。
ただ、頻繁にダウンロードする必要もなく非常に小さいので 2kbps や 30kbps
増えても大して気にも留めることもないというウェブページの特徴から、
多くのウェブサイトミラーがあることが果たして有益なのかという疑問が出てきました。</p>

<p>世界のインターネット回線が速くなかった頃、例えば他の大陸から www.debian.org
を取得するのは苦痛で、標準的なモデムよりはるかに遅い状態でした。
そこでミラーを組織し、ウェブサイトミラーをいくつか作りました。
そのうちの 10 (トルコを入れるなら 11) はヨーロッパにあります。</p>

<p>しかし、現在は特にヨーロッパで高速なネットワークリンクを得て、
それほど多くのミラーはほとんど必要なくなりました。事実、
ヨーロッパ-アメリカ間のネットワークリンクの高速化により、ヨーロッパから
www.debian.org にアクセスしても遅くなくなりました。</p>

<p>これが基本的にウェブサイトミラーをこれ以上必要としない理由です。
特に、既にミラーがある大陸においては。私たちの意思を尊重してください。
ご協力に感謝します。</p>

<p>何か疑問があれば、<a
href="mailto:mirrors@debian.org">mirrors@debian.org</a>
にメールを送ってください。</p>

<hrline />

<toc-add-entry name="ref">既存のミラーのための参考</toc-add-entry>

<p><strong>ここから後の情報は、
既存のミラーの管理者に対する参考のためだけにあります。</strong></p>


<h3>ミラー作業</h3>

<p>推奨するミラー方法は rsync
です。ウェブサイトのファイルに対する匿名アクセスはありません。
ミラー元サイトの管理者に相談して、認証付きでアクセスさせることができます。<a
href="mailto:mirrors@debian.org">mirrors@debian.org</a>にメールを送ってください。</p>

<p>ミラー作業は<q>取得 (pull)</q>、つまりクライアント側が都合に合わせてサーバ側に要求します。
この構築には、<a href="websync">websync スクリプト</a>及び<a
href="websync.conf">その設定ファイル</a>を使用して、crontab
から実行させることができ、また、すべて自動的に行います。
スクリプト内の指示に従って、正常に動作するようにしてください。</p>


<h4>push ミラーからのミラー作業</h4>

<p>push ミラーによるミラー作業は私たちが開発した、rsync
を使ってアーカイブへの変更がミラーに行き渡るまでの時間を最小にとどめる方法です。
ミラーのサーバが ssh を使ってミラーのクライアントに更新を開始させます。</p>

<p>この方法では、ssh
はただ一つのコマンドだけを実行するように設定するのでまったく安全です。
さらに、ミラー作業はあくまで<q>取得 (pull)</q>するもので、偽の push
ミラーがアーカイブの内容を汚染することができるというものでは<strong>ありません</strong>。
この方法のミラー作業によって侵入されるかもしれないと心配して消極的になるミラー管理者もいますが、
これは単なる<strong>勘違い</strong>です。</p>

<p>この仕組みについて、さらに突っ込んだ説明や、どうして安全なのか、
push ミラーの構築方法については、<a
href="push_mirroring">完全な説明</a>を参照してください。</p>


<h3>ミラーする時間</h3>

<p>メインのサイトは大体 4 時間ごとに更新されます。</p>

<p>注: あなたのサイトが push
機構を採用する場合にはこの項目はまったく気にする必要がありません。
そうでない場合は、ウェブサイトミラーの <code>/mirror/timestamps/</code>
ディレクトリにあるタイムスタンプファイルの日付を見てミラー作業の時間を確認してください。
これにいくらか、例えば 30 分加えた時間からミラーしてください。</p>

<p>毎日のミラー作業を自動化するのに最も簡単なのは cron です。
詳細は <kbd>man crontab</kbd> してください。</p>


<h3>ミラー提供者の広告</h3>

<p>望むなら、あなたの会社または組織の (控え目な) ロゴで <code>sponsor_img.jpg</code> の画像を置き換えて、<code>sponsor.html</code> をあなたのホームページにリダイレクトするようにできます。
デフォルトでは、これらの両方のファイルはミラーされません。デフォルトファイルは <code>sponsor.deb.html</code> および <code>sponsor.deb.jpg</code> という名前です。
これらのデフォルトファイルを使うこともできますが、あなた自身の画像を用意することをお勧めします。
ロゴの最大サイズは 120x60 ピクセルにしておくことを推奨します。</p>

<p>ウェブページの適切な言語を選択するのに <a
href="#cn">content negotiation (内容交渉)</a>
を使用しているので、異なる言語の <code>sponsor.html</code>
を置くこともできます。これは単純に置きたい &lt;言語&gt; それぞれの
sponsor.&lt;言語&gt;.html を置くだけです。</p>

<p>上書きさせたくないファイルはミラー処理の除外リストに追加してください。</p>


<h3>ウェブサーバの設定</h3>


<h4>ウェブサーバへの変更</h4>

<p>もしあなたのミラーが Debian で運用される場合、Debian の方針を曲げて
<code>/doc</code> をウェブページに使用することになります。その場合はつまり、
<code>/etc/apache/srm.conf</code> ファイルの
<q><code>Alias /doc/ /usr/share/doc/</code></q>
という行をコメントアウトすべきだということになります。</p>

<p>注意: CGI スクリプトはすべて中心の cgi.debian.org
で動くのでこの点については気にする必要はありません。</p>


<h4><a name="cn">content negotiation (内容交渉)</a></h4>

<p>content negotiation (内容交渉)
はサーバが返す文書の種類をブラウザに選択させる方法です。
これの使い方にもいろいろありますが、
最も一般的なのはどの言語の文書を返すべきかを選択させることです。これを使うことで、
Debian は (技術的に) 非常に的確な方法で複数の言語のページを返すことができます。</p>

<p>Apache を使っている場合は概ね簡単な変更で済みます。
単純にこのオプション:</p>

<pre>
Options +Multiviews   
</pre>

<p>を <kbd>/etc/apache/access.conf</kbd> ファイルの Debian
ウェブページの <code>&lt;Directory&gt;</code>
セクションに追加してサーバを再起動するだけです。</p>

<p>さらに、ウェブサイト上にある言語をすべて適切に処理できるようにする必要があります。
これには <kbd>AddLanguage</kbd> タグを使ってください。
既に使用されている言語のリストを以下に挙げます - さらに増やせることを期待しつつ:</p>

<pre>
  AddLanguage en .en
<:
foreach $l (keys %langs) { push @codes, $langs{$l}; }
foreach $c (sort @codes) { print "  AddLanguage $c .$c\n" if (($c ne "en") && ($c ne "zh")); }
:>  \
  AddLanguage pt-br .pt
  AddLanguage nb .nb
  AddLanguage zh-CN .zh-cn
  AddLanguage zh-HK .zh-hk
  AddLanguage zh-TW .zh-tw
</pre>

<p>ある状況下で誤った言語を返してしまうという Apache
のバグがあるので、以下のように返される言語をすべて LanguagePriority
オプションに追加するのは良い案です:</p>

<pre>
<:
print "LanguagePriority en fr es ";
foreach $c (sort @codes) { print "$c " if (($c ne "en") && ($c ne "fr") && ($c ne "es") && ($c ne "zh")); }
print "pt-br nb zh-CN zh-HK zh-TW\n";
:>\
</pre>

<p>content negotiation (内容交渉) されたファイルが誤った文字セットで返されないようにするため、
<code>AddDefaultCharSet</code> の設定がコメントアウトされているか<q><code>Off</code></q>
になっていることを確認してください。</p>

<p>Apache 1 では、ディレクトリのインデクスを正しく返すため、
<code>/etc/apache/srm.conf</code> の <code>DirectoryIndex</code>
エントリを恐らく変更する必要があります。これは Apache 2 では動作しませんが。
Apache 1 では以下でいいでしょう:</p>

<pre>
DirectoryIndex index index.html
</pre>

<p>favicon.ico の正しい Content-Type ヘッダを返すため、Apache
が image/x-icon を使用するようにしてください:</p>

<pre>
AddType image/x-icon .ico
</pre>

<p>RSS フィードの正しい Context-Type ヘッダを返すため、Apache
が application/rss+xml を使用するようにしてください:</p>

<pre>
AddType application/rss+xml .rdf
</pre>

<p>スペイン語翻訳版の HTML, PDF,
及びプレーンテキストファイルの正しい Context-Type
ヘッダを返すため、Apache に正しい種類を次のように指示してください:</p>

<pre>
&lt;Files *.html.es>
  ForceType text/html
&lt;/Files>

&lt;Files *.pdf.es>
  ForceType application/pdf
&lt;/Files>

&lt;Files *.txt.es>
  ForceType text/plain
&lt;/Files>
</pre>

<p><a href="../events/">/events</a> 
以下での content negotiation (内容交渉) の問題回避のため、カレンダーファイルには
text/html の内容よりも低い優先度を割り当てる必要があります:</p>

<pre>
AddType text/calendar;qs=0.9 .ics
</pre>


<h4>リダイレクト</h4>

<p>ほとんどのサイトでミラーするには巨大になりすぎている部分があるので、
ウェブサイトの一部をメインのサイトから分離させました。
ほとんどのリンクは新しい場所を指すように変換すべきですが、
他サイトへのリダイレクトを追加してリンク切れを防ぐことを歓迎します。
これには、<kbd>/etc/apache/srm.conf</kbd> を編集してください。例:</p>

<pre>
Redirect /Lists-Archives http://lists.debian.org/
Redirect /search http://search.debian.org
Redirect /Packages http://packages.debian.org
Redirect /lintian http://lintian.debian.org
</pre>

<h4>バーチャルホスト</h4>

<p><a href="$(HOME)">www.debian.org</a>
及び管理下のいくつかの名前でアクセスされる Debian ウェブサイトでは、
負荷分散とユーザから近いミラーの選択のために GeoDNS を使っています。</p>

<p>結論から言うと、Apache はいくつかのバーチャルホストを通して
Debian ウェブサイトを使えるようにすべきです。
こんな感じになります:</p>

<pre>ServerAlias www.debian.org www.debian.com debian.org www.*.debian.org</pre>
