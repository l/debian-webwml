#use wml::debian::template title="Debian ウェブサイトのミラー"
#use wml::debian::toc
#include "$(ENGLISHDIR)/mirror/webmirrors.data"
#use wml::debian::translation-check translation="1.37"

<toc-display/>

<hrline>

<toc-add-entry name="list">ウェブミラーのリスト</toc-add-entry>

<p>以下の国に Debian WWW ページのミラーがあります:</p>

<webmirrors>

<p>このリストにあなたの国がなく、ミラーを提供したい場合は知らせてください。
あなたの国がリストにあれば、恐らく新しいミラーは<strong>必要ありません</strong>。
基本的に新しい Debian ウェブサイトのミラーは<strong>勧めていません</strong>。</p>

<toc-add-entry name="whynot">どうしてウェブミラーがこれ以上要らないのか</toc-add-entry>

<p>ウェブミラーは管理が必要で (Apache
の設定ファイルをたまに変更する必要があったりして、FTP
サイトのミラーより手間がかかります)、提供者のリソースに負担がかかります。
ただ、頻繁にダウンロードする必要もなく非常に小さいので 2kbps や 30kbps
増えても大して気にも留めることもないというウェブページの特徴から、
多くのウェブサイトミラーがあることが果たして有益なのかという疑問が出てきました。</p>

<p>世界のインターネット回線が速くなかった頃、例えば他の大陸から www.debian.org
を取得するのは苦痛で、標準的なモデムよりはるかに遅い状態でした。
そこでミラーを組織し、ウェブサイトミラーをいくつか作りました。
そのうちの 10 (トルコを入れるなら 11) はヨーロッパにあります。</p>

<p>しかし、現在は特にヨーロッパで高速なネットワークリンクを得て、
それほど多くのミラーはほとんど必要なくなりました。事実、
ヨーロッパ-アメリカ間のネットワークリンクの高速化により、ヨーロッパから
www.debian.org にアクセスしても遅くなくなりました。</p>

<p>これが基本的にウェブサイトミラーをこれ以上必要としない理由です。
特に、既にミラーがある大陸においては。私たちの意思を尊重してください。
ご協力に感謝します。</p>

<p>何か疑問があれば、<a
href="mailto:mirrors@debian.org">mirrors@debian.org</a>
にメールを送ってください。</p>

<hrline>

<p><strong>ここから後の情報は、
既存のミラーの管理者に対する参考のためだけにあります。</strong></p>

<toc-add-entry name="how">ミラー作業</toc-add-entry>

<p>推奨するミラー方法は rsync
です。ウェブサイトのファイルに対する匿名アクセスはありません。
ミラー元サイトの管理者に相談して、認証付きでアクセスさせることができます。<a
href="mailto:mirrors@debian.org">mirrors@debian.org</a>にメールを送ってください。</p>

<p>ミラー作業は「取得」、つまりクライアント側が都合に合わせてサーバ側に要求します。
この構築には、<a href="websync">websync スクリプト</a>及び<a
href="websync.conf">その設定ファイル</a>を使用して、crontab
から実行させることができ、また、すべて自動的に行います。
スクリプト内の指示に従って、正常に動作するようにしてください。</p>

<h3>push ミラーからのミラー作業</h3>

<p>push ミラーによるミラー作業は私たちが開発した、rsync
を使ってアーカイブへの変更がミラーに行き渡るまでの時間を最小にとどめる方法です。
ミラーのサーバが ssh を使ってミラーのクライアントに更新を開始させます。</p>

<p>この方法は ssh
はただ一つのコマンドだけを実行するように設定するのでまったく安全です。
さらに、ミラー作業はあくまで「取得」するもので、偽の push
ミラーがアーカイブの内容を汚染することができるというものでは<strong>ありません</strong>。
この方法のミラー作業によって侵入される可能性があるのではないかという恐れにより消極的になるミラー管理者もいますが、
これは単純に<strong>間違い</strong>です。</p>

<p>この仕組みについて、さらに突っ込んだ説明や、どうして安全なのか、
push ミラーの構築方法については、<a
href="push_mirroring">完全な説明</a>を参照してください。</p>

<toc-add-entry name="when">ミラーする時間</toc-add-entry>

<p>メインのサイトは大体 4 時間ごとに更新されます。</p>

<p>注: あなたのサイトが push
機構を採用する場合にはこの項目はまったく気にする必要がありません。
そうでない場合は、ウェブサイトミラーの <code>/mirror/timestamps/</code>
ディレクトリにあるタイムスタンプファイルの日付を見てミラー作業の時間を確認してください。
これにいくらか、例えば 30 分加えた時間からミラーしてください。</p>

<p>毎日のミラー作業を自動化するのに最も簡単なのは cron です。
詳細は <kbd>man crontab</kbd> してください。</p>

<toc-add-entry name="sponsor">ミラー提供者の広告</toc-add-entry>

<p><code>sponsor.html</code> と <code>sponsor_img.jpg</code>
のファイルは置き換えてもらって結構です、というか置き換えてください。
これにより訪問者は提供者が誰なのか知ることができます。Debian
が例として用意したものはミラー元のサーバで置き換えられている可能性があるので、
オリジナルは <code>sponsor.deb.html</code> と <code>sponsor.deb.jpg</code>
にあります。ロゴは 120x60 以下のサイズにしておくことを推奨します。</p>

<p>ウェブページの言語の指向を選択するのに<a
href="#cn">content negotiation (内容交渉)</a>
を使用しているので、異なる言語の <code>sponsor.html</code>
を置くこともできます。これは単純に置きたい &lt;言語&gt; それぞれの
sponsor.&lt;lang&gt;.html を置くだけです。</p>

<p>上書きさせたくないファイルはミラー処理の除外リストに追加してください。</p>

<toc-add-entry name="configure">ウェブサーバの設定</toc-add-entry>

<h3>ウェブサーバへの変更</h3>

<p>もしあなたのミラーが Debian で運用される場合、Debian の方針を曲げて
<code>/doc</code> をウェブページに使用することになります。その場合はつまり、
<code>/etc/apache/srm.conf</code> ファイルの
`<code>Alias /doc/ /usr/share/doc/</code>'
行をコメントアウトすべきだということになります。</p>

<p>注意: CGI スクリプトはすべて中心の cgi.debian.org
で動くのでこの点については気にする必要はありません。</p>

<h3><a name="cn">content negotiation (内容交渉)</a></h3>

<p>content negotiation (内容交渉)
はサーバが返す文書の種類をブラウザに選択させる方法です。
これの使い方にもいろいろありますが、
最も一般的なのはどの言語の文書を返すべきかを選択させることです。これを使うことで、
Debian は (技術的に) 非常に的確な方法で複数の言語のページを返すことができます。</p>

<p>Apache を使っている場合は概ね簡単な変更で済みます。
単純にこのオプション:</p>

<pre>
Options +Multiviews   
</pre>

<p>を <kbd>/etc/apache/access.conf</kbd> ファイルの Debian
ウェブページの <code>&lt;Directory&gt;</code>
セクションに追加してサーバを再起動するだけです。</p>

<p>さらに、ウェブサイト上にある言語をすべて適切に処理できるようにする必要があります。
これには <kbd>AddLanguage</kbd> タグを使ってください。
既に使用されている言語のリストを以下に挙げます - さらに増やせることを期待しつつ:</p>

<pre>
  AddLanguage en .en
<:
foreach $l (keys %langs) { push @codes, $langs{$l}; }
foreach $c (sort @codes) { print "  AddLanguage $c .$c\n" if (($c ne "en") && ($c ne "zh")); }
:>  \
  AddLanguage pt-br .pt
  AddLanguage nb .nb
  AddLanguage zh-CN .zh-cn
  AddLanguage zh-HK .zh-hk
  AddLanguage zh-TW .zh-tw
</pre>

<p>ある状況下で誤った言語を返してしまうという Apache
のバグがあるので、以下のように返される言語をすべて LanguagePriority
オプションに追加するのは良い案です:</p>

<pre>
<:
print "LanguagePriority en fr es ";
foreach $c (sort @codes) { print "$c " if (($c ne "en") && ($c ne "fr") && ($c ne "es") && ($c ne "zh")); }
print "pt-br nb zh-CN zh-HK zh-TW\n";
:>\
</pre>

<p>content negotiation (内容交渉) されたファイルが誤った文字セットで返されないようにするため、
<code>AddDefaultCharSet</code> の設定がコメントアウトされているか `<code>Off</code>'
になっていることを確認してください。</p>

<p>Apache 1 では、ディレクトリのインデクスを正しく返すため、
<code>/etc/apache/srm.conf</code> の <code>DirectoryIndex</code>
エントリを恐らく変更する必要があります。これは Apache 2 では動作しませんが。
Apache 1 では以下でいいでしょう:</p>

<pre>
DirectoryIndex index index.html
</pre>

<p>favicon.ico の正しい Content-Type ヘッダを返すため、Apache
が image/x-icon を使用するようにしてください:</p>

<pre>
AddType image/x-icon .ico
</pre>

<p>RSS フィードの正しい Context-Type ヘッダを返すため、Apache
が application/rss+xml を使用するようにしてください:</p>

<pre>
AddType application/rss+xml .rdf
</pre>

<p><a href="../events/">/events</a> 
以下でのcontent negotiation (内容交渉) の問題回避のため、カレンダーファイルには
text/html の内容よりも低い優先度を割り当てる必要があります:</p>

<pre>
AddType text/calendar;qs=0.9 .ics
</pre>

<h3>リダイレクト</h3>

<p>ほとんどのサイトでミラーするには巨大になりすぎている部分があるので、
ウェブサイトの一部をメインのサイトから分離させました。
ほとんどのリンクは新しい場所を指すように変換すべきですが、
他サイトへのリダイレクトを追加してリンク切れを防ぐことを歓迎します。
これには、<kbd>/etc/apache/srm.conf</kbd> を編集してください。例:</p>

<pre>
Redirect /Lists-Archives http://lists.debian.org/
Redirect /search http://search.debian.org
Redirect /Packages http://packages.debian.org
Redirect /lintian http://lintian.debian.org
</pre>
