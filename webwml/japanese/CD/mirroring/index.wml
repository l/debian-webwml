#use wml::debian::cdimage title="Debian CD イメージのミラーサイトになるには" BARETITLE=true
#use wml::debian::translation-check translation="1.4"

<p>Debian CD イメージのミラーサイトになるには、Linux か Unix
系のマシンが必要です。
イメージを取得してアクセス可能にするには、あなたの都合に合わせていくつかのやり方があります。</p>

<p>FTP や HTTP でイメージを入手するようにすべきでは <em>ありません</em>。
これらの転送方法は、巨大なイメージファイルサイズのため失敗しやすいからです。
さらに、イメージがわずかに変化した場合 (サブリリースなどの場合にこうなります)
にも、全体を再ダウンロードしなければなりません。
この結果、コンピュータにもネットワークにも大きな負荷がかかります。
</p>

<p>上記の理由から、私たちは <a href="http://rsync.samba.org/"> <tt>rsync</tt></a>
プログラムを使っています。これは本質的にはバイナリパッチを行うプログラムです。
<tt>rsync</tt> により、サブリリースのイメージを大変効率的に更新できます。
これは、変更部分だけをネットワークで転送すればよく、変更されなかった部分は以前のイメージからコピーすれば済むからです。
</p>

<p><tt>rsync</tt> 単体で使った場合、全く新しいリリースの際には全イメージのダウンロードが行われます。
これは、イメージ中に変更されない部分がほとんどないためです。
しかしながら、疑似イメージキットを用いれば、近くの Debian FTP ミラー
(場合によってはローカルのミラー) にすでにあるデータを用いて擬似的な CD
イメージを作成できますし、<tt>rsync</tt>
でその疑似イメージにバイナリパッチを当てて公式版に更新することが出来ます。
さらにサブリリースの際にはたいていの場合、旧イメージにパッチを当てた方が効率がよいことも分かっています。
</p>

<p>疑似イメージキットは、普通の人の要求に合わせて、主に一つないしは数個のイメージのみをダウンロードする目的で設計されています。
この発展形として、疑似イメージキットと <tt>rsync</tt>
を自動的に使ってミラーを更新し、更にはダウンロードした各イメージの MD5
チェックサムの計算までを自動的に行ってくれる、ミラー作成を
<em>実に</em> 簡単にする <tt>debcdmirror</tt> スクリプトがあります。
<tt>debcdmirror</tt> では、なにをミラーするのか正確に指定することも出来ます。
</p>

<p>というわけで、イメージを取得して最新に維持するには以下の選択肢があります。</p>

<ul>

  <li>FTP または HTTP: これは <em>避けるべき</em> です。</li>

  <li><tt>rsync</tt> だけを使う (一日一回 cron で): これは近くに高速な
  Debian FTP ミラーが無いサイトのみに勧められるやり方です。</li>

  <li>疑似イメージキットを手動で用いる (サブリリース時には <tt>rsync</tt> を
  用いる) 作業も多いですし、問題も多いでしょう。</li>

  <li><tt>debcdmirror</tt> スクリプトを用いる (内部では疑似イメージキットと
  <tt>rsync</tt> が使われています。一日一回 cron で起動) :
  <strong>これを</strong> 行うべきです :-) </li>

</ul>

<p>最新の疑似イメージキットは
<a href="http://cdimage.debian.org/~costar/pseudo-image-kit/">疑似イメージキット</a> で、最新の <tt>debmirror</tt> は
<a href="http://cdimage.debian.org/~costar/debcdmirror/"><tt>debcdmirror</tt></a>
の、各々作者のページに置かれています。両方のパッケージの README
に作業手順の詳細な情報が記載されています。</p>

<p><strong>注記:</strong><p>

<p><tt>debcdmirror</tt> スクリプトでは、"<tt>ls-lR</tt>" ファイルを提供する
<tt>rsync</tt> ミラーサイトを選択する必要があります。
このようなミラーサイトのアドレスは
<a href="rsync-mirrors">rsync ミラーリスト</a> にあります。
公式の公開ミラーはマスターサーバ  cdimage.debian.org への直接の rsync
接続が許されています。マスタサーバへの接続にはパスワードが必要になるので、
<a href="mailto:phil@hands.com">マスタサーバの管理者</a>
に問い合わせて取得してください。</p>

<p>もしローカルの <a href="$(HOME)/mirror/">"通常の" Debian FTP ミラー</a>
が無い場合、<a href="$(HOME)/mirror/list" >FTP サイトのリスト</a>
を見てください。</p>

<p><tt>debcdmirror</tt> では <tt>bash</tt> バージョン 2 以上が必要です。
必要な場合は <tt>bash</tt> を標準以外の場所にインストールすることも出来ますが、
その場合スクリプトの最初の行で <tt>bash</tt>
へのパスを指定するようにしてください。</p>

<p>もし、<tt>rsync</tt>
のみを使う場合には、少なくとも以下のオプションを使ってください。
"<b><tt>--times --links --hard-links --block-size=8192</tt></b>"
これは修正時間、シンボリックリンクとハードリンクをそのまま保持し、ブロックサイズ
8192 バイトを使います (CD イメージの場合、このブロックサイズが最適です)。
修正時間とサイズが同じ場合には、<tt>rsync</tt>
はファイルを変更しないので、<tt>--times</tt> は事実上必須です。</p>

<p>"<tt><i>codename</i>_test</tt>" ディレクトリには、バージョン付きのディレクトリ以下のイメージにハードリンクされたイメージが置かれています。
バージョン付きのディレクトリ名は (サブ) リリースごとに変わりますが、
"<tt>test</tt>" ディレクトリ以下の名前は変化しません。従って <tt>rsync</tt>
だけを使う環境では、バージョン付きのイメージと適切な "<tt>test</tt>"
ディレクトリの両方をミラーして、<em>同時に</em> <tt>--hard-links</tt>
オプションを指定するのがサブリリースを適切に更新するために必須です。
<tt>debcdmirror</tt> を使う場合には "<tt>test</tt>" ディレクトリは
<em>含めない</em> で下さい。これは <tt>debcdmirror</tt> は <tt>rsync</tt>
とは異なった、かつもっと効率のよいやり方を用いているからです。
</p>

<p><tt>ls-lR</tt> はミラーが置かれているサイトのディレクトリ構造を記載したものです。この <tt>ls-lR</tt> ファイルをミラー <strong>しないで下さい</strong>。
自分で作成するか (提供されている "<tt>Makels-lR</tt>" を使って <tt>cron</tt>
で毎時作成する)、<tt>ls-lR</tt> を全く置かないかのどちらかとしてください。
<tt>debcdmirror</tt> の場合は、ミラー作成後にローカルの <tt>ls-lR</tt>
が自動的に作成されます。
</p>

<p>ミラーしたい CD イメージ (i386 とソース CD が人気があります) を取得した後、
<tt>rsync</tt> サーバプログラムを走らせる必要があります。
これはマシンに大きな負荷はかけませんし、FTP/HTTP
サービスに比べてネットワーク負荷も比較的軽いものです。
サーバの設定方法は、疑似イメージキットの README に記載されています。
</p>

<p>もちろん、毎日数 GB のネットワーク負荷は問題がないということでしたら、
FTP/HTTP ミラーになっていただけるととてもありがたいです。
提供いただけるならばどのようなものでも結構ですので、<a
href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;debian-cd&#64;lists.debian.org"
>debian-cd&#64;lists.debian.org</a>
にミラーを運用している旨連絡くだされば、所定のページを更新いたします。</p>

