#use wml::debian::template title="Sätta upp en spegel av Debianarkivet"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.55"

<toc-display/>

<toc-add-entry name="what">Vad som bör speglas</toc-add-entry>

<p>
<a href="./">Ingångssidan för speglar</a> innehåller en förteckning över
vilka arkiv som är tillgängliga för spegling.
</p>

<ul>
<li>
Användarna kommer att leta efter debian/-arkivet för att installera Debian
över nätverket, att bygga cd:ar (med jigdo) och att uppgradera redan
installerade system.
</li>

<li>
debian-cd/ är ett arkiv som inte är identiskt hos alla spegelservrar.
På några platser innehåller det jigdo-mallar att bygga cd-avbildningar från
(används tillsammans med filer från debian/), på några innehåller det
färdigbyggda cd-avbildningar, och på vissa bådadera.
<br />
Se sidan om att <a href="$(HOME)/CD/mirroring/">spegla cd-avbildningar</a>
för vidare information om detta.
</li>

<li>
debian-archive/ innehåller det sanna <em>arkivet</em>, de gamla och
föråldrade versionerna av Debian.
Den är vanligtvis bara intressant för en liten del av användarna.
</li>
</ul>

<p>
Se vår sida om <a href="size">storlek på spegeln</a> för mer detaljerad
information om spegelstorlekar.
</p>

<p>
Arkiven i debian-security/ innehåller säkerhetsuppdateringar som släppts av
Debians säkerhetsgrupp.
Det låter intressant för alla, men eftersom säkerhetsuppdateringarna är
sporadiska måste man spegla den väldigt ofta för att hålla sig à jour (eller
använda <a href="push_mirroring"><q>push</q>-spegling</a>), så vi
rekommenderar det inte.
Debian gör allt som står i vår makt för att istället vidmakthålla
tillgängligheten hos security.debian.org.
</p>

<p>
Obs! Arkivet debian-non-US/ används inte längre i och med utgivningen av
Debian 3.1 (<em>Sarge</em>) i juni 2005.
</p>

<toc-add-entry name="wherefrom">Platser att spegla</toc-add-entry>

<p>Många tror att <code>ftp.debian.org</code> är <q>rätt</q> plats
för Debianpaket och att det är bäst att spegla därifrån.
Detta är <strong>inte korrekt</strong>.
</p>

<p>
<code>ftp.debian.org</code> är bara en av många servrar som uppdateras från
en intern Debianserver.
Adressen pekar för närvarande mot en enda adress i Förenta Staterna och är
mest där för bakåtkompatibilitet.
</p>

<p>
<a href="official">Officiella speglar</a> är tänkta att vara bra platser att
spegla från.
Alla servrar i den <a href="list-full">kompletta spegellistan</a> som
är märkta <q><kbd>Type: Push-Primary</kbd></q> eller
<q><kbd>Type: Push-Secondary</kbd></q>
bör vara lämpade att spegla från.
Välj en som är nära dig både nätverksmässigt och geografiskt.
</p>

<p>
Det är i praktiken ingen skillnad mellan olika <em>Push-Primary</em>-speglar
vad gäller själva speglingen.
Å andra sidan, om många använder ftp.debian.org (vilket tyvärr sker) slösar
detta i onödan med donerad bandbredd.
</p>

<p>
Spegeladministratörer i Förenta Staterna bör spegla från ftp.us.debian.org
(den officiella spegeladressen i USA, vilken är en Push-Primary-spegel).
Men eftersom den adressen även är ett slingalias för flera maskiner är det
oftast en bra idé att bestämma vilken av komponenterna som är bäst och
därefter spegla från just den.
<br />
<small>Fördelen med detta är att man undviker risken för misslyckanden när
man kör en tvåstegs-rsync (olika steg kan hamna hos olika maskiner under det
tidsfönster då de har olika data, vilket ger en kapplöpningseffekt).
Nackdelen är att den koncentrerar sig på en enda plats, vilket gör att
prestanda kan variera, men det är något som finns där i hela vårt
spegelnätverk för närvarande.</small>
</p>

<toc-add-entry name="how">Hur man speglar</toc-add-entry>

<p>
Den rekommenderade metoden för att spegla är med det så kallade
<a href="anonftpsync">anonftpsync</a>-skriptet via anonym
<a href="http://packages.debian.org/stable/net/rsync">rsync</a>.
</p>

<p>Observera:
Även om <kbd>wget</kbd> och andra ftp-verktyg verkar fungera bra finns det
vissa problem.
Vi rekommenderar å det bestämdaste att använda rsync.
</p>

<h3>Anonym rsync</h3>

<p>
Vi rekommenderar att du använder
<a href="anonftpsync">detta skript</a> för att spegla
arkivet.
Följ instruktionerna i skriptet för att sätta upp spegeln.
</p>

<p>
Här är några råd för de som föredrar andra arbetssätt:
</p>

<ul>
 <li>
  Kör rsync med åtminstone dessa flaggor:
  <kbd>--recursive --times --links --hard-links --delete</kbd>.
 </li>

 <li>
  Om du har tillräckligt med diskutrymme bör även flaggan
  <kbd>--delete-after</kbd> användas för att undvika vissa temporära
  uppdateringsproblem.
 </li>

 <li>
  Om du inte har tillräckligt med diskutrymme att spegla allting, använd
  flaggan <kbd>--exclude</kbd> för att utesluta delar av arkivet från
  spegeln.
  Det vanliga är att skriva in olika arkitekturer du inte önskar; till
  exempel kommer detta att utesluta <em>alla</em> arkitekturer:
  <br />
<: 
print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br />\n"
  foreach (sort keys %arches);
:>
  Se även <a href="#partial">stycket om att spegla delmängder</a>.
 </li>

 <li>
  När rsync är färdig med sin spegling, lägg till en tidsstämpelfil i
  underkatalogen <code>project/trace/</code> på Debianspegeln, med din
  server som namn.
  Det betyder att du bör köra
  <kbd>date -u &gt; .../debian/project/trace/<var>din.server</var></kbd>
  när din dagliga rsync är färdig.
 </li>

 <li>
  Vi avråder å det bestämdaste att exkludera <tt>project/</tt>,
  <tt>doc/</tt> och andra kataloger.
  Dessa är normalt mycket små, men väldigt användbara för användarna.
  Speciellt <tt>project/trace</tt> är väldigt bra att ha om det är några
  problem med speglingsprocessen.
 </li>
</ul>

<h3>Rsync med autentisering, från en <q>push</q>-spegel</h3>

<p>
<q>Push</q>-spegling är en form av spegling med rsync vi har utvecklat
som minimerar tiden det tar för ändringar i huvudarkivet att nå speglarna.
Den servande spegeln använder en utlösarmekanism för att informera
klientspegeln om att den måste uppdateras.

<p>
<q>Push</q>-spegling är nödvändig för att hålla flera servrar
synkroniserade (såsom servrarna för cirkulerande DNS-alias som
<tt>ftp.us.debian.org</tt>), och vi använder det vanligtvis för våra första-
och andranivåspeglar.
För <q>normala</q> speglar kräver detta en hel del arbete att ställa
in vilket egentligen inte är värt besväret jämfört med ett finjusterat
cron-jobb.</p>

<p>
Metoden är relativt säker eftersom ssh konfigureras för att köra ett
enda kommando.
Dessutom är spegeln fortfarande <q>pull</q>, så det är
<strong>inte</strong> möjligt att förstöra innehållet i arkivet via en
förfalskad <q>push</q>-spegel.
Vissa spegeladministratörer har uppvisat viss motvillighet mot att
använda denna typ av spegel på grund av oro för att metoden öppnar deras
maskin för intrång, något som <strong>inte</strong> är sant.

<p>
För en mer utförlig beskrivning av hur det fungerar, varför det är
säkert, och hur man sätter upp en <q>push</q>-spegel, se
<a href="push_mirroring">den kompletta förklaringen</a>.

<toc-add-entry name="partial">Spegla delmängder</toc-add-entry>

<p>Med tanke på <a href="size">hur stort</a> Debianarkivet
redan är föredrar vissa att bara spegla de delar de behöver.
Om du vill undvara något bör du undvara arkitekturer.</p>

<p>Med <a href="anonftpsync">anonftpsync</a> kan detta göras genom att
redigera ARCH_EXCLUDE-variabeln.
Det finns även andra specialskrivna skript, de är dock inte lämpliga för
officiella speglar.
</p>

<p>Vi rekommenderar å det bestämdaste mot att exkludera <tt>project/</tt>,
<tt>doc/</tt> och andra underkataloger.
Vanligtvis är dessa inte speciellt stora men ändå användbara för användare.
Speciellt <tt>project/trace</tt> är väldigt bra att ha om det är några
problem med speglingsprocessen.
</p>

<toc-add-entry name="when">När du bör spegla</toc-add-entry>

<p>
Huvudarkivet uppdateras var två gånger om dagen.
Speglarna börjar normalt uppdatera runt klockan 9:00 och 21:00 (båda tiderna
UTC), men detta är en fastslagen tid och du bör inte fixera dina speglar
runt dem.
</p>

<p>
Vi rekommenderar att du speglar en gång om dagen.
Det är meningslöst att spegla mer än två gånger om dagen och kommer troligen
bara ett leda till att du blir utestängd &ndash; gör inte det.
</p>

<p>
Din spegel bör uppdatera ett par timmar efter en av huvudarkivets
spegelpulser.
Du bör se om platsen du speglar från skapar en tidsstämpelfil i sin
<kbd>project/trace/</kbd>-katalog.
Tidsstämpelfilen kommer ha samma namn som den platsen, och ange den
tidpunkt när senaste speglingskörningen slutfördes.
Lägg till ett par timmar på det (för att vara på den säkra sidan) och spegla
då.
</p>

<p>Det enklaste sättet att automatiskt köra spegeln varje dag är att använda
cron.
Se <kbd>man crontab</kbd> för detaljer.
</p>

<p>
Om din plats blir <q>push</q>-speglad behöver du inte bry dig om något av detta.
</p>

<toc-add-entry name="settings">Rekommenderade ytterligare inställningar</toc-add-entry>

<p>Om du planerar att göra Debianspegeln tillgänglig över HTTP ber vi dig
lägga till följande inställningar till Apaches konfiguration (förutsatt,
naturligtvis, att du använder Apache), innanför blocket
<code>&lt;Directory <var>/sökväg/till/din/debianspegel</var>&gt;</code>,
där <code>/sökväg/till/din/debianspegel</code> är namnet på den
katalog du har spegeln i:
</p>

<pre>
   Options +Indexes +SymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
</pre>

<p>
Detta aktiverar katalogindex och försäkrar att symboliska länkar fungerar.
Filnamnen i katalogindexen kommer inte trunkeras och (de huvudsakligen
icke-existerande) beskrivningarna kommer inte att visas.
</p>

<p>
I Apache 1.3.x kan även följande alternativ läggas till:
</p>

<pre>
   DirectoryIndex .
</pre>

<p>
Lägg inte till detta alternativ för Apache 2.x.
</p>

<toc-add-entry name="submit">Lägga till en spegel i spegellistan</toc-add-entry>

<p>
När en spegel satts upp bör den <a href="submit">registreras hos Debian</a>
så att den kan läggas in i
<a href="list">spegellistan</a>.
Registrering kan göras via vårt <a href="submit">enkla webbformulär</a>.
</p>

<p>
Problem eller frågor kan ställas till
<email mirrors@debian.org>.
</p>
