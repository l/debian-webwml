#use wml::debian::template title="Sätta upp en spegel av Debianarkivet"
#use wml::debian::toc
#use wml::debian::translation-check translation="1.36"

<toc-display/>

<p>
När en spegel satts upp bör den <a href="submit">registreras hos Debian</a>
så att den kan läggas in i
<a href="list">spegellistan</a>.
Registrering kan göras via vårt <a href="submit">enkla webbformulär</a>.

<p>
Problem eller frågor kan ställas till
<email mirrors@debian.org>.
</p>

<toc-add-entry name="wherefrom">Platser att spegla</toc-add-entry>

<p>Många tror att <code>ftp.debian.org</code> är &rdquo;rätt&rdquo; plats
för Debianpaket och att det är bäst att spegla därifrån.
Detta är <strong>inte sant</strong>.
<code>ftp.debian.org</code> är bara en av många servrar som uppdateras från
en intern Debianserver.</p>

<p>Alla servrar i den <a href="list-full">kompletta spegellistan</a> som
är märkta &rdquo;<kbd>Type: Push-Primary</kbd>&rdquo; bör vara lämpade att
spegla från.</p>

<p>
Det är i praktiken ingen skillnad mellan olika <em>Push-Primary</em>-speglar
vad gäller själva speglingen.
Å andra sidan, om många använder ftp.debian.org (vilket tyvärr sker) slösar
detta i onödan med donerad bandbredd.
</p>

<toc-add-entry name="how">Hur man speglar</toc-add-entry>

<p>
Den rekommenderade metoden för att spegla är via
<a href="http://packages.debian.org/stable/net/rsync.html">rsync</a>.
</p>

<p>Observera:
Trots att <kbd>wget</kbd> fungerar bra för att spegla små arkiv är det inte
lika konfigurerbart som rsync, så det rekommenderas inte för
detta.
</p>

<h3>Anonym rsync</h3>

<p>Du kan använda <a href="anonftpsync">detta skript</a> för att spegla
arkivet.
Följ instruktionerna i skriptet för att sätta upp spegeln.
</p>

<p>
Här är några råd för de som föredrar andra arbetssätt:
</p>

<ul>
 <li>
  Kör rsync med åtminstone dessa flaggor:
  <kbd>--recursive --times --links --hard-links --delete</kbd>.
 </li>

 <li>
  Om du har tillräckligt med diskutrymme bör även flaggan
  <kbd>--delete-after</kbd> användas för att undvika vissa temporära
  uppdateringsproblem.
 </li>

 <li>
  Om du inte har tillräckligt mede diskutrymme att spegla allting, använd
  flaggan <kbd>--exclude</kbd> för att utesluta delar av arkivet från
  spegeln.
  Det vanliga är att skriva in olika arkitekturer du inte önskar; till
  exempel kommer detta att utesluta <em>alla</em> arkitekturer:
  <br>
<: 
print "<code>--exclude binary-$_/ --exclude *_$_.deb</code><br>\n"
  foreach (sort keys %arches);
:>
  Se även <a href="#partial">stycket om att spegla delmängder</a>.
 </li>

 <li>
  När rsync är färdig med sin spegling, lägg till en tidsstämpelfil i
  underkatalogen <code>project/trace/</code> på Debianspegeln, med din
  server som namn.
  Det betyder att du bör köra
  <kbd>date -u &gt; .../debian/project/trace/<var>din.servere</var></kbd>
  när din dagliga rsync är färdig; samt
  <kbd>date -u &gt; .../debian-non-US/project/trace/<var>din.server</var></kbd>
  när din dagliga rsync av non-US är färdig, om du speglar debian-non-US.
 </li>
</ul>

<h3>Rsync med autentisering, från en &rdquo;push&rdquo;-spegel</h3>

<p>
&rdquo;Push&rdquo;-spegling är en form av spegling med rsync vi har utvecklat
som minimerar tiden det tar för ändringar i huvudarkivet att nå speglarna.
Den servande spegeln använder en utlösarmekanism för att informera
klientspegeln om att den måste uppdateras.

<p>
&rdquo;Push&rdquo;-spegling är nödvändig för att hålla flera servrar
synkroniserade (såsom servrarna för cirkulerande DNS-alias som
<tt>ftp.us.debian.org</tt>), och vi använder det vanligtvis för våra första-
och andranivåspeglar.
För &rdquo;normala&rdquo; speglar kräver detta en hel del arbete att ställa
in vilket egentligen inte är värt besväret jämfört med ett finjusterat
cron-jobb.</p>

<p>
Metoden är relativt säker eftersom ssh konfigureras för att köra ett
enda kommando.
Dessutom är spegeln fortfarande &rdquo;pull&rdquo;, så det är
<strong>inte</strong> möjligt att förstöra innehållet i arkivet via en
förfalskad &rdquo;push&rdquo;-spegel.
Vissa spegeladministratörer har uppvisat viss motvillighet mot att
använda denna typ av spegel på grund av oro för att metoden öppnar deras
maskin för intrång, något som <strong>inte</strong> är sant.

<p>
För en mer utförlig beskrivning av hur det fungerar, varför det är
säkert, och hur man sätter upp en &rdquo;push&rdquo;-spegel, se
<a href="push_mirroring">den kompletta förklaringen</a>.

<h3>Anonym ftp</h3>

<p>
Anonym med ftp var länge det vanligaste sättet att spegla,
men rekommenderas inte längre till förmån för rsync.
</p>

<p>
Om du på övertygande grunder inte kan använda rsync kan programmet
&rdquo;<a href="http://packages.debian.org/mirror">mirror</a>&rdquo;
kanske vara användbart.
Tänk på att det är beroende av ls-lR-filer vilket förhindrar det från
att hålla en korrekt spegelspårning i underkatalogen
<kbd>project/trace/</kbd> på Debianspeglarna.
</p>

<toc-add-entry name="partial">Spegla delmängder</toc-add-entry>

<p>Med tanke på <a href="size">hur stort</a> Debianarkivet
redan är föredrar vissa att bara spegla de delar de behöver.
Om du vill undvara något bör du undvara arkitekturer.</p>

<p>Med <a href="anonftpsync">anonftpsync</a> kan detta göras genom att
redigera EXCLUDE-variabeln.
Du kan även använda specialskrivna skript, som
<a href="http://packages.debian.org/unstable/net/debmirror.html">debmirror</a>
(av Joey Hess och Jörg Wendland).
Om du anser att något bör läggas in i dessa ber vi dig kontakta respektive
författare (kontaktinformation bör finnas i skripten själva).

<p>Vi rekommenderar å det bestämdaste mot att exkludera <tt>project/</tt>,
<tt>doc/</tt> och andra underkataloger.
Vanligtvis är dessa inte speciellt stora men ändå användbara för användare.

<toc-add-entry name="when">När du bör spegla</toc-add-entry>

<p>Huvudarkivet uppdateras var 24:e timme.
</p>

<p>
Speglarna börjar vanligtvis att uppdateras runt 00:00 UTC, men det är inte
en fastslagen tid.
Vi rekommenderar att speglingen sker dagligen, flera timmar senare än så; du
bör se om platsen du speglar från skapar en tidsstämpelfil i sin
<kbd>project/trace/</kbd>-katalog.
Tidsstämpelfilen kommer ha samma namn som den platsen, och ange den
tidpunkt när senaste speglingskörningen slutfördes.
Lägg till ett par timmar på det (för att vara på den säkra sidan) och spegla
då.
</p>

<p>Det enklaste sättet att automatiskt köra spegeln varje dag är att använda
cron.
Se <kbd>man crontab</kbd> för detaljer.
</p>

<p>
Om din plats blir &rdquo;push&rdquo;-speglad behöver du inte bry dig om något av detta.
</p>

<toc-add-entry name="settings">Rekommenderade ytterligare inställningar</toc-add-entry>

<p>Om du planerar att göra Debianspegeln tillgänglig över HTTP ber vi dig
lägga till följande inställningar till Apaches konfiguration (förutsatt,
naturligtvis, att du använder Apache), innanför blocket
<code>&lt;Directory <var>/sökväg/till/din/debianspegel</var>&gt;</code>,
där <code>/sökväg/till/din/debianspegel</code> är namnet på den
katalog du har spegeln i:
</p>

<pre>
   Options +Indexes +SymlinksIfOwnerMatch
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
</pre>

<p>
Detta aktiverar katalogindex och försäkrar att symboliska länkar fungerar.
Filnamnen i katalogindexen kommer inte trunkeras och (de huvudsakligen
icke-existerande) beskrivningarna kommer inte att visas.
</p>
