#use wml::debian::template title="Sätta upp en spegling av Debians webbplats"
#use wml::debian::translation-check translation="1.13"

<p>Spegling görs på samma sätt på både officiella och inofficiella servrar.

<p>
När en spegel satts upp bör den <a href="submit">registreras hos Debian</a>
så att den kan läggas in i
<a href="../misc/README.mirrors">spegellistan</a>.
Registrering kan göras via vårt <A href="submit">enkla webbformulär</a>.
Problem eller frågor kan ställas till
<A href="mailto:mirrors@debian.org">mirrors@debian.org</A>.

<H2>Sätt att spegla</H2>

<h3>Anonym rsync</h3>

<p>
Den rekommenderade metoden för att spegla är via rsync.

<p>Du kan använda <a href="anonwebsync">detta skript</a> för att spegla
arkivet.
Följ instruktionerna i skriptet för att sätta upp speglingen.
Platser i den <a href="mirrors_full">kompletta spegellistan</a> som använder
'<kbd>Type: Push-*</kbd>' bör vara bra val att spegla från.

<p>Huvudwebbplatsen byggs om var åttonde timme (se datumstämpelfilerna i
<code>mirror/timestamps/</code>-katalogen på webbplatsen för exakta tider),
du bör kalkulera speglingstiden för din plats.

<h3>"Push"-spegling</h3>

<p>
"Push"-spegling är en variant på spegling med hjälp av rsync som vi har
utvecklat för att minimera den tid det tar för ändringar att nå
speglingarna.
"Push"-spegling använder en ssh-utlösare för att tala om för klientspegeln
när den ska uppdatera sig.
Denna metod är relativt säker eftersom ssh konfigureras för att köra ett
enda kommando.
Dessutom är speglingen fortfarande "pull", så det är inte möjligt att
förstöra innehållet i arkivet via en förfalskad "push"-spegel.

<p>Vissa spegeladministratörer har uppvisat viss motvillighet mot att
använda denna typ av spegling på grund av oro för att metoden öppnar deras
maskin för invasion, något som inte är sant.
För en mer utförlig beskrivning av hur det fungerar, och varför det är
säkert, se <a href="explain">den här sidan</a>.

<p>"Push"-spegling tar lite mer arbete i anspråk att sätta upp, eftersom de
som är ansvariga för upp- och nedströmsspeglingarna måste utbyta
information.
Fördelen är att uppströmsspegeln är den som påbörjar speglingsprocessen
direkt efter att dess eget arkiv har uppdateras, vilket gör att ändringar i
arkivet propageras extremt snabbt.

<p>Det är bäst att sätta upp detta med ett konto för en vanlig användare,
inte root.
Innehållet i den publika ssh-nyckeln som du får från spegeln uppströms ska
placeras i <kbd>~&lt;användare&gt;/.ssh/authorized_keys</kbd>.

<p>Filerna <a href="websync">websync</a> och
<a href="websync.conf">websync.conf</a> kommer att användas.
Redigera websync.conf och följ anvisningarna i den tillsammans med den
information som du får från spegeln uppströms.

<p>Om du vill bli en primär "push"-spegel behöver du
<a href="identity.pub.master.ftp">webbserverns publika ssh-nyckel</a>.

<h3>Anonym ftp med "mirror"</h3>

<p>Det är inte rekommenderat att använda "mirror" på Debians webbsidor.
För stora kataloger blir minneskraven löjligt stora.
En spegelansvarig har sagt att det fungerade för honom med 96 Mbyte RAM.
Andra, med mindre minne, har upptäckt att spegeln jobbar överdrivet mot
växlingsdisken.

<h3>wget</h3>

<p>
Trots att <kbd>wget</kbd> fungerar bra för att spegla små arkiv är det inte
lika konfigurerbart som mirror eller rsync, så det rekommenderas inte för
detta.

<H2>Annonsera spegelns sponsor</H2>

<p>Filerna <code>sponsor.html</code> och <code>sponsor_img.jpg</code>
kan, och bör, ersättas av dig.
De är till för att du ska kunna annonsera din webbplats så att folk vet vem
som är sponsorn.
Originalen finns i <code>sponsor.deb.html</code> och
<code>sponsor.deb.jpg</code>, eftersom platsen du
speglar kan ha ersatt exemplen som kom från Debian.
Föreslagen maxstorlek för din logotyp är 120x60.

<p>Eftersom "<a href="#cn">content negotiation</a>" används på webbsidorna
för att välja språk, kan du till och med göra <code>sponsor.html</code>
tillgänglig på
olika språk.
För att göra detta skapar du helt enkelt sponsor.&lt;språk&gt;.html för
varje &lt;språk&gt; du önskar.

<p>Se till att du lägger in alla filer du inte vill skall skrivas över
till speglingens exkluderingsfil.

<H2>Konfigurera webbservern</H2>

<h3>Andra webbserverinställningar</h3>

<p>Om din maskin kör Debian, så har vi valt att bryta mot Debianpolicyn och
använda <code>/doc</code> bland webbsidorna.
Detta betyder att du måste kommentera ut
raden "<code>Alias /doc/ /usr/doc/</code>" från din
<code>/etc/apache/srm.conf</code>-fil.

<h3><a name="cn">Content negotiation</a></h3>

<p>
"Content negotiation" är ett sätt att låta webbläsaren förhandla fram vilken
sorts dokument som skall hämtas från servern.
Det finns flera olika användningsområden för detta, men det mest använda är
att förhandla fram vilket språk ett dokument skall visas med.
Genom att använda detta kan Debian visa sina webbsidor på flera språk på ett
(tekniskt) väldigt elegant sätt.

<P>För de som använder Apache är inställningen nästan trivial.
Du lägger helt enkelt in en sektion liknande den nedan i
<kbd>/etc/apache/access.conf</kbd>
(ersätt <kbd>/debian/web</kbd> med den katalog som innehåller webbsidorna)
och starta om servern (detta exempel fungerar med betaversionen av Apache
1.3 och senare):

<pre>
&lt;Directory /debian/web&gt;
Options +Multiviews   
&lt;/Directory&gt;
</pre>

<p>
Dessutom måste du se till att servern kan hantera alla språk som används på
webbplatsen.
Detta görs genom att använda <kbd>AddLanguage</kbd>.
Här följer en lista över de språk som används nu - men var beredd på att
lägga in fler senare:

<pre>
AddLanguage en .en
AddLanguage fr .fr
AddLanguage de .de
AddLanguage da .da
AddLanguage it .it
AddLanguage es .es
AddLanguage ja .ja
AddLanguage pl .pl
AddLanguage ko .ko
AddLanguage hr .hr
AddLanguage pt .pt
AddLanguage fi .fi
AddLanguage zh-CN .zh-cn
AddLanguage zh-TW .zh-tw
AddLanguage cs .cs
AddLanguage sv .sv
AddLanguage no .no
AddLanguage ru .ru
AddLanguage tr .tr
AddLanguage eo .eo
AddLanguage ar .ar
AddLanguage nl .nl
AddLanguage hu .hu
AddLanguage ro .ro
</pre>

<p>På grund av ett fel i Apache kan fel språk sändas ut från servern under
vissa omständigheter, varför det är det en bra idé att lägga in alla språk i
LanguagePriority-inställningen, enligt vad som följer:

<pre>
LanguagePriority en fr de it es ja pl hr da pt fi zh-cn zh-tw cs sv ko no ru tr eo ar nl hu ro
</pre>

<p>För att undvika att filer som sänds via "content negotiation" sänds med
fel teckenuppsättning, se till att
<code>AddDefaultCharSet</code>-inställningen antingen är utkommenterad,
eller satt till "<code>Off</code>".

<p>För att hantera indexfiler i kataloger korrekt måste du antagligen
modifiera <code>DirectoryIndex</code>-posten i
<code>/etc/apache/srm.conf</code>.
Följande bör räcka:

<pre>
DirectoryIndex index index.html
</pre>

<h3>Omdirigeringar</h3>

<p>Eftersom vissa delar av webbplatsen börjar bli för stora för att speglas
av de flesta av platserna har vi delat av dem från huvudwebbplatsen.
Trots att de flesta länkar bör ha korrigerats så att de använder de nya
platserna ser vi gärna att du lägger till en omdirigering till de nya
adresserna, så att inga länkar slutar fungera.
Detta kan göras i <kbd>/etc/apache/srm.conf</kbd> så här:

<pre>
Redirect /Lists-Archives http://lists.debian.org/
Redirect /search http://search.debian.org
Redirect /Packages http://packages.debian.org
Redirect /lintian http://lintian.debian.org
</pre>

