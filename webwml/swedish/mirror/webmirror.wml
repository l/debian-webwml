#use wml::debian::template title="Speglar av Debians webbplats"
#use wml::debian::translation-check translation="1.46"
#use wml::debian::toc
#include "$(ENGLISHDIR)/mirror/webmirrors.data"

<toc-display />

<hrline />

<toc-add-entry name="whynot">Varför vi inte har behov av fler
webbspeglar</toc-add-entry>

<p>Våra webbplatsspeglar kräver underhåll (något mer än ftp-platsspeglarna,
faktiskt, eftersom du måste ändra Apaches konfigurationsfiler lite då och då)
och kostar sponsorn resurser.
Hur som helst, på grund av webbsidornas natur, vilka du inte behöver hämta
regelbundet, och för vilka det inte gör så mycket om de kommer fram med 2kbit/s
eller 30kbit/s eftersom de är relativt små, uppkommer frågan om det är
användbart att ha många webbplatsspeglar.
</p>

<p>Det fanns tider när Internetanslutningarna i olika delar av världen inte
var snabba, och det var smärtfullt och betydligt långsammare att hämta
www.debian.org från en annan kontinent på en normal modemanslutning.
Därför började vi spegla, varpå flera webbplatsspeglar startades.
Tio (eller elva, om du räknar Turkiet) av dem finns i Europa.
</p>

<p>Idag, däremot, har vi blixtsnabba nätverkskopplingar, speciellt i Europa,
så det finns knappast något behov för så här många speglar.
Faktum är att det inte ens är långsamt att ansluta till www.debian.org från
Europa längre, på grund av att hastigheten på nätverkslänkarna mellan
Europa och Amerika har ökats.
</p>

<p>Det är i stort sett därför vi inte behöver några ytterligare
webbplatsspeglar, speciellt inte på kontinenter där det redan finns speglar.
Vi ber dig respektera våra önskemål, och tackar dig för din samarbetsvilja.
</p>

<p>Om du har frågor, sänd ett brev till
<a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.
</p>

<hrline />

<toc-add-entry name="ref">Referens för existerande speglar</toc-add-entry>

<p><strong>Informationen nedan ges bara som referens till ansvariga för
existerande speglar.</strong>
</p>

<h3>Speglingsprocessen</h3>

<p>
Den rekommenderade metoden för att spegla är via rsync.
Det finns ingen anonym åtkomst till webbplatsfilerna.
Du kan sätta upp autentiserad åtkomst med ansvariga för den du önskar spegla
från, sänd e-post till
<a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.
</p>

<p>Speglingen är en <q>pull</q>-process, dvs. klienten ber om data från servern
när de önskar.
För att ställa in detta kan du använda
<a href="websync">websync-skriptet</a> och
<a href="websync.conf">dess konfigurationsfil</a>, vilken kan köras från
crontab, och som kommer att utföra allting automatiskt.
Följ beskrivningarna i skriptet för att se till att allting fungerar
korrekt.
</p>

<h4>Spegla från en <q>push</q>-spegel</h4>

<p>
<q>Push</q>-spegling är en form av spegling med rsync vi har utvecklat
som minimerar tiden det tar för ändringar i huvudarkivet att nå speglarna.
Den servande spegeln använder en utlösarmekanism för att informera
klientspegeln om att den måste uppdateras.
Vissa spegeladministratörer har uppvisat viss motvillighet mot att
använda denna typ av spegling på grund av oro för att metoden öppnar deras
maskin för intrång, något som <strong>inte</strong> är sant.
</p>

<p>
För en mer utförlig beskrivning av hur det fungerar, varför det är
säkert, och hur man sätter upp en <q>push</q>-spegling, se
<a href="push_mirroring">den kompletta förklaringen</a>.
</p>

<h3>När du bör spegla</h3>

<p>
Huvudwebbplatsen byggs om var fjärde timme.
</p>

<p>Om din plats blir <q>push</q>-speglad behöver du inte oroa dig om detta.
Om inte bör du beräkna speglingstiden för din plats från tidsstämplningarna
på filerna i katalogen <code>/mirror/timestamps/</code> på webbspegeln.
Lägg till en viss tid, säg en halvtimme, till den tiden och spegla då.
</p>

<p>Det enklaste sättet att automatiskt köra spegeln varje dag är att använda
cron.
Se <kbd>man crontab</kbd> för detaljer.
</p>

<h3>Annonsera spegelns sponsor</h3>

<p>Om du vill kan du ersätta bilden <code>sponsor_img.jpg</code> med en
(okontroversiell) logotyp för ditt eget företag eller organisation och låta
<code>sponsor.html</code> vidarebefordra till din egen hemsida. Som standard
speglas ingen av dessa båda filer. Standardfilerna heter
<code>sponsor.deb.html</code> och <code>sponsor.deb.jpg</code>; du kan
visserligen använda dessa men vi rekommenderar dig att tillhandahålla
din egen bild.
Föreslagen maxstorlek för din logotyp är 120×60px.
</p>

<p>Eftersom <a href="#cn">innehållsförhandling</a> används för att välja språk
på webbsidorna kan du till och med göra <code>sponsor.html</code>
tillgänglig på
olika språk.
För att göra detta skapar du helt enkelt sponsor.&lt;språk&gt;.html för
varje &lt;språk&gt; du önskar.
</p>

<p>Se till att du lägger in alla filer du inte vill skall skrivas över
till spegelns exkluderingsfil.
</p>

<h3>Konfigurera webbservern</h3>

<h4>Diverse webbserverinställningar</h4>

<p>Om din maskin kör Debian, så har vi valt att bryta mot Debianpolicyn och
använda <code>/doc</code> bland webbsidorna.
Detta betyder att du måste kommentera ut
raden <q><code>Alias /doc/ /usr/share/doc/</code></q> från din
<code>/etc/apache/srm.conf</code>-fil.
</p>

<p>Observera:
Alla våra CGI-skript körs centralt på cgi.debian.org, så du behöver inte
oroa dig för dem.
</p>

<h4><a name="cn">Innehållsförhandling</a></h4>

<p>
Innehållsförhandling (eng. <em lang="en">content negotiation</em>)
är ett sätt att låta webbläsaren förhandla fram vilken
sorts dokument som skall hämtas från servern.
Det finns flera olika användningsområden för detta, men det mest använda är
att förhandla fram vilket språk ett dokument skall visas med.
Genom att använda detta kan Debian visa sina webbsidor på flera språk på ett
(tekniskt) väldigt elegant sätt.
</p>

<p>För de som använder Apache är inställningen nästan trivial.
Lägg helt enkelt till denna inställning:
</p>

<pre>
Options +Multiviews   
</pre>

<p>i <code>&lt;Directory&gt;</code>-delen för Debians webbplats i din
<kbd>/etc/apache/access.conf</kbd>
och starta om servern.
</p>

<p>
Dessutom måste du se till att servern kan hantera alla språk som används på
webbplatsen.
Detta görs genom att använda <kbd>AddLanguage</kbd>.
Här följer en lista över de språk som används nu - men var beredd på att
lägga in fler senare:
</p>

<pre>
  AddLanguage en .en
<:
foreach $l (keys %langs) { push @codes, $langs{$l}; }
foreach $c (sort @codes) { print "  AddLanguage $c .$c\n" if (($c ne "en") && ($c ne "zh")); }
:>  \
  AddLanguage pt-br .pt
  AddLanguage nb .nb
  AddLanguage zh-CN .zh-cn
  AddLanguage zh-HK .zh-hk
  AddLanguage zh-TW .zh-tw
</pre>

<p>På grund av ett fel i Apache kan fel språk sändas ut från servern under
vissa omständigheter, varför det är det en bra idé att lägga in alla språk i
LanguagePriority-inställningen, enligt vad som följer:
</p>

<pre>
<:
print "LanguagePriority en fr es ";
foreach $c (sort @codes) { print "$c " if (($c ne "en") && ($c ne "fr") && ($c ne "es") && ($c ne "zh")); }
print "pt-br nb zh-CN zh-HK zh-TW\n";
:>\
</pre>

<p>För att undvika att filer som sänds via innehållsförhandling sänds med
fel teckenuppsättning, se till att
<code>AddDefaultCharSet</code>-inställningen antingen är utkommenterad,
eller satt till <q><code>Off</code></q>.
</p>

<p>
För att hantera indexfiler i kataloger korrekt måste du, om du använder
Apache 1, antagligen
modifiera <code>DirectoryIndex</code>-posten i
<code>/etc/apache/srm.conf</code>.
Detta fungerar dock inte i Apache 2.
Följande bör räcka för Apache 1:
</p>

<pre>
DirectoryIndex index index.html
</pre>

<p>
För att sända korrekt Content-Type-huvud för favicon.ico måste Apache
instrueras att använda typen image/x-icon, så här:
</p>

<pre>
AddType image/x-icon .ico
</pre>

<p>
För att sända korrekt Content-Type-huvud för RSS-kanaler måste Apache
instrueras att använda typen application/rss+xml, så här:
</p>

<pre>
AddType application/rss+xml .rdf
</pre>

<p>För att sända korrekt Content-Type-huvud för spanska
översättningar av HTML-, PDF- och klartextfiler, måste Apache
instrueras att använda rätt typer, så här:</p>

<pre>
&lt;Files *.html.es>
  ForceType text/html
&lt;/Files>

&lt;Files *.pdf.es>
  ForceType application/pdf
&lt;/Files>

&lt;Files *.txt.es>
  ForceType text/plain
&lt;/Files>
</pre>

<p>
För att undvika problem med innehållsförhandling i katalogen
<a href="../events/">/events</a>, måste kalenderfiler tilldelas en lägre
prioritet än text/html-innehåll:
</p>

<pre>
AddType text/calendar;qs=0.9 .ics
</pre>

<h4>Omdirigeringar</h4>

<p>Eftersom vissa delar av webbplatsen börjar bli för stora för att speglas
av de flesta av platserna har vi delat av dem från huvudwebbplatsen.
Trots att de flesta länkar bör ha korrigerats så att de använder de nya
platserna ser vi gärna att du lägger till en omdirigering till de nya
adresserna, så att inga länkar slutar fungera.
Detta kan göras i <kbd>/etc/apache/srm.conf</kbd> så här:
</p>

<pre>
Redirect /Lists-Archives http://lists.debian.org/
Redirect /search http://search.debian.org
Redirect /Packages http://packages.debian.org
Redirect /lintian http://lintian.debian.org
</pre>

<h4>Virtuella värdar</h4>

<p>Debians webbplats, när den hämtas genom<a
href="$(HOME)">www.debian.org</a> och under flera andra namn, använder en
GeoDNS-installation för att sprida belastningarna och välja en spegel närmare
den plats där användaren befinner sig.</p>

<p>Som en konsekvens av detta måste Apache göra Debians webbplats tillgänglig
genom flera virtuella värdar, så här:</p>

<pre>
ServerAlias www.debian.org www.debian.com debian.org www.*.debian.org
</pre>
