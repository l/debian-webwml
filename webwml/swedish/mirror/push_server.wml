#use wml::debian::template title="Sätta upp en &quot;push&quot;-server"
#use wml::debian::translation-check translation="1.5"

<p><small>(För mer information om vad en "push"-server är, läs
<a href="push_mirroring">"push"-speglings-förklaringen</a>.)</small>

<p>
Att sätta upp en "push"-server är rätt enkelt:
<ul>
  <li>installera <kbd>rsync</kbd> 2.1.1 eller senare.
  <li>skapa <kbd>rsyncd.conf</kbd> och lägg in något i stil med detta:
<pre>
uid = nobody
gid = nogroup
max connections = 25
syslog facility = daemon
socket options = SO_KEEPALIVE

[ftp]
  path = /org/ftp.debian.org/ftp
  comment = Debians ftp-arkiv (~20 Gbyte)
  auth users = auktoriserat_konto1,auktoriserat_konto2,auktoriserat_kontoN
  read only = true
  secrets file = /etc/rsyncd/debian.secrets
[web.debian.org]
  path = /org/www.debian.org/debian.org
  comment = Debians webbplats (~400 MB)
  auth users = auktoriserat_konto1,auktoriserat_konto2,auktoriserat_kontoN
  read only = true
  secrets file = /etc/rsyncd/debian.secrets
</pre>

  <li>För varje plats som hämtar från dig med "push" lägger du in en rad i
      <kbd>/etc/rsyncd/debian.secrets</kbd>:

<pre>
konto1:ett_lösenord
konto2:annat_lösenord
</pre>

  <li>Du vill antagligen starta rsyncprocessen från inetd. För att göra detta,
  lägg till

<pre>
rsync           873/tcp
</pre>

  i <kbd>/etc/services</kbd> (om det inte redan står där),
  och följande i <kbd>/etc/inetd.conf</kbd>:

<pre>
rsync      stream      tcp         nowait      root /usr/bin/rsync rsyncd --daemon
</pre>

   (Kom ihåg att sända en HUP-signal till inetd för att tala om för det
    att läsa om sin inställningsfil efter att du ändrat den.)

  <li>skapa en ny ssh-nyckel för kontot som du använder för att spegla Debian.
    Se till att du inte skriver över din riktiga ssh-nyckel genom att
    använda flaggan -f,
    <kbd>ssh-keygen -f ~/.ssh/&lt;filnamn&gt;</kbd>.
</ul>

<p>För varje plats du kommer att "push"-spegla måste du lägga in ett
användarnamn och lösenrod för i <kbd>/etc/rsyncd/debian.secrets</kbd> och
sedan lägga in detta användarnamn till åtkomstlistan i
<kbd>/etc/rsyncd.conf</kbd>. 

<p>
För att förenkla det hela kan du vilja använda det kontonamn du använder för
att "push":a spegeln nedströms.
Du har nu gett spegeln nedströmst spegelåtkomstbehörighet till arkivet på
din maskin.
Användarnamnet och lösenordet sänds till servern nedströms.

<p>Du måste fortfarande ställa in skriptet så att det kontaktar speglingar
nedströms.
Skapa filerna <kbd>runmirrors</kbd>, med innehållet:

<protect>
<pre>
#!/bin/sh

HOME=/home/archvsync
LOGNAME="archvsync"
USER="archvsync"
MAIL=
PATH="/bin:/usr/bin"

cd $HOME

./signal någon.annan.plats archvsync
./signal och.ytterligare.en kontopåandrasidan
</pre>
</protect>

<p>och filen <kbd>signal</kbd>, med innehållet:

<protect>
<pre>
#!/bin/sh

# Detta skript anropas för att signalera fjärrvärden att det är dags att
# spegla arkivet. Detta görs på det säkraste sätt jag kan komma på, en
# ssh-utlösare. Den andra sidan har en post för denna nyckel som tillåter
# den att köra ett enda kommando - ftpsync.

echo Signalerar $1
ssh  -o"BatchMode yes" -q -o"user $2" "$1" sleep 1
</pre>
</protect>

<p>
För varje plats du skickar till måste du skapa en rad
<code>./signal &lt;plats&gt; &lt;användarnamn&gt;</code>
i <kbd>runmirrors</kbd>.

<p>Lägg slutligen till en rad i slutet av <kbd>ftpsync</kbd> som anropar
<kbd>runmirrors</kbd>.
På det sättet kommer du att börja skicka data till de som finns nedströms
från dig räknat så fort du speglat färdigt din uppströmsplats.
