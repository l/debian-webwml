<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.7">
 <TITLE>Linux/Alpha Frequently Asked Questions: What State Is Linux/Alpha In? </TITLE>
 <LINK HREF="FAQ-2.html" REL=next>

 <LINK HREF="FAQ.html#toc1" REL=contents>
</HEAD>
<BODY>
<A HREF="FAQ-2.html">Next</A>
Previous
<A HREF="FAQ.html#toc1">Contents</A>
<HR>
<H2><A NAME="What State Is Linux/Alpha In"></A> <A NAME="s1">1. What State Is Linux/Alpha In? </A></H2>

<P> Linux/Alpha is for real: pretty much everything is up and running:
there is XFree86, LaTeX, ghostview, Mosaic, Emacs, gcc, C++, NFS,
automounter, all sorts of shells, perl, python, Java, Tcl/Tk, scheme,
apache HTTP server, and pretty much anything else that's freely
available.  X11 works well on several video cards (see below).  Thanks
to Dave Taylor and Linus Torvalds, there is now even a 
<A HREF="ftp://ftp.digital.com/pub/DEC/Linux-Alpha/X11">Quake binary</A> for Linux/Alpha!
Since April 1997, it is now also possible to run many Linux/x86
binaries through the em86 emulator. (See section 
<A HREF="FAQ-16.html#em86">em86</A>
)
The list of applications supported by em86 includes gems
such as applix, netscape, and acrobat.  The emulator has been made
available free of charge by Jim Paradis of Digital Semiconductor.
<P>Linux/Alpha presently runs on most of the Alpha boxes that come with
the PCI or EISA bus.  This excludes the old TURBOchannel based DEC
3000 series of workstations.
<P>
<P>
<H2><A NAME="ss1.1">1.1 Supported Drivers</A>
</H2>

<P><B>Drivers that are known to work</B> (let us known if there is something new):
<UL>
<LI> X11:  Almost all XFree86 drivers work on Linux/Alpha.  Perhaps the
biggest missing feature is packed 24-bit support.  32bpp/depth 24
works fine, though. <BR>
The SVGA server on Alpha supports only a subset of the cards supported
on Intel: Matrox and S3Virge are supported, but a number of older chipsets 
are not.<BR>
SuSE is actively involved with the developement of XFree. If you have a
card that isn't supported yet, you may find a driver at their 
<A HREF="http://www.suse.com/">website</A>. <BR>

There are some development X servers available from Digital's FTP
<A HREF="ftp://ftp.digital.com/pub/DEC/Linux-Alpha/X11">site</A>;
you might check there if XFree86 doesn't work on your system. <BR>

Commercial X-servers are available from MetroLink and XiGraphics.
(See the section on commercial software.) You may need these if you have
a very new graphics card.
</LI>
<LI> keyboard</LI>
<LI> console (TGA, EGA+ or VGA+ compatible cards)</LI>
<LI> selection (console mouse support)</LI>
<LI> serial</LI>
<LI> line-printer (centronics port)</LI>
<LI> floppy</LI>
<LI> SCSI: disks, CD-ROMs, and tapes seem to work fine.  Host adapters that
are known to work:
<UL>
<LI>NCR/Symbios 53c810, 825, 875 (use the ncr53c8xx driver)</LI>
<LI>aha1740 (on Jensen, at least)</LI>
<LI>BusLogic (all cards ISA or PCI cards should work fine except
for the Flashpoint; EISA cards may be flaky in older EISA systems).</LI>
<LI>Qlogic ISP1020</LI>
<LI>support for Adaptec cards has been problematic in the past,
but is improving rapidly.</LI>
</UL>

</LI>
<LI> ftape (QIC-80 tape drives): you'll need the
<A HREF="ftp://ftp.azstarnet.com/pub/linux/axp/sys">BFD-based insmod</A> utility.</LI>
<LI> IDE driver: disks and CD-ROMs (ATAPI) are known to work.</LI>
<LI> Networking:
<UL>
<LI>Ethernet drivers: de4x5, de500, depca, ewrk3, ne2000.
The following drivers are supposed to be working as well:
<UL>
<LI>Western Digital (aka SMC Elite) wd80x3</LI>
<LI>SMC Ultra</LI>
<LI>SMC EtherEZ</LI>
<LI>3Com 3c503, 3c503/16, 3c509</LI>
<LI>Cabletron e2100</LI>
<LI>Hewlett Packard PC Lan  (model 27245, uses hp.c) </LI>
<LI>Hewlett Packard PC Lan+ (model 27247 or 27252A, uses hp-plus.c) </LI>
<LI>Ansel AC3200 EISA card.</LI>
<LI>AMD PCnetPCI (79C970 and 79C970A) based Ethernet cards
(LANCE32 driver).</LI>
</UL>

If you experience problems with one of these, you might want to drop
a note to
<A HREF="mailto:gpg109@rsphy1.anu.edu.au">Paul Gortmaker</A>.
</LI>
<LI>Other drivers: ppp, ibmtr (IBM token ring driver).
</LI>
<LI>ISDN: ICN 2B and ICN 4B cards (if you have problems with them,
contact 
<A HREF="mailto:tsbogend@bigbug.franken.de">Thomas        Bogendoerfer</A>).
</LI>
</UL>

</LI>
<LI> Cameras/Scanners: QuickCam (both grayscale and color
versions).  HP ScanJet reportedly work.  Mustek flat
scanners are supported, too (you may want to subscribe to the
sane-devel mailing list in this case; send a mail containing
"subscribe" to 
<A HREF="mailto:sane-devel-request@listserv.azstarnet.com">sane-devel-request@listserv.azstarnet.com</A>).
</LI>
<LI> Sound cards: SoundBlaster compatible cards seem to work well.
The Microsoft Sound System compatible card built into the
<A HREF="http://www.annex.co.uk/systems/udb.html">UDB</A> is
supported, too.
</LI>
<LI> Joystick: The joystick interface on a
SoundBlaster16 (which is just a regular PC joystick port) is
known to work with joystick-0.7.3 (as a module).  There were a
few minor patches that had to be applied.  If you want it, send
mail to 
<A HREF="mailto:David.Mosberger@acm.org">David Mosberger</A>.  The "koules" game is known
to work with the joystick.</LI>
</UL>
<P>
<H2><A NAME="ss1.2">1.2 Known Bugs And Workarounds</A>
</H2>

<P>This section lists known bugs in Linux/Alpha and discusses how they
can be avoided or worked around.  As things are under constant
development, this section is rather volatile.  Just because it isn't
listed here doesn't mean the problem isn't known already.  On the
other hand, if you run a recent distribution, it's likely that most of
the problems have been addressed already.  In any case, before sending
mail off to 
<A HREF="mailto:axp-list@redhat.com">axp-list</A>, be
sure to check this section first.  If you discover a new
problem/workaround, we would appreciate if you could send us a report
(preferably in linuxdoc SGML format).
<P>
<DL>
<P>
<DT><B>Kernel hangs or panics when trying to mount root file system:</B><DD><P>The Linux
kernel currently has <CODE>/dev/sda2</CODE> hardcoded as its default root
file system.  Thus, if your root file system is on any other
disk or partition, you will have to specify the boot
option <CODE>root=/dev/</CODE><I>root-partition</I>.
For example, if the root file system is on <CODE>/dev/hda1</CODE>,
you'd specify <CODE>root=/dev/hda1</CODE>.
<P>
<DT><B>ELF <CODE>gdb</CODE> behaves odd w.r.t. shared functions.</B><DD><P>When
using <CODE>gdb</CODE> on a dynamically linked binary, it is best
to force eager resolution of dynamic symbols.  To do this,
simply issue the command <CODE>set env
LD_BIND_NOW=1</CODE> from within <CODE>gdb</CODE>.  Otherwise,
you may see unexpected behavior when trying to step into
or over a shared function.  The source of this problem is known,
but nobody has had time yet to fix the problem.
<P>
<DT><B>Kernel reports 2.88MB floppy drive:</B><DD><P>On the Alphas, the kernel
<EM>always</EM> reports floppy drives as having 2.88MB capacity
even if a smaller capacity drive is installed.  This is nothing
to worry about: normally, the floppy driver automatically
detects and selects the correct capacity so everything will work
fine.  The only exception to this rule is when formatting a
new floppy disk.  To do this, you'll need to select the device
name with the correct capacity.  For example, if the system
has a 1.4MB drive, format <CODE>/dev/fd0H1440</CODE> instead of
<CODE>/dev/fd0</CODE>.
<P>
<DT><B>Unaligned accesses:</B><DD><P>The Alpha, like all real RISC CPUs, requires that memory
accesses are <EM>naturally aligned</EM>.  For example, reading
a 4 byte integer from memory requires that the address of the
integer be a multiple of 4.  Similarly, 8 byte integers need
to start at an address that is a multiple of 8.  If the CPU
attempts to access a word that is not properly aligned,
the CPU will trap into the kernel and issue a warning message.
The kernel will then go ahead and emulate the unaligned access
so that the user-level process executes as if nothing had
happened (except for a substantial slow-down due to the
fault).
<P>Typically, an unaligned fault message looks like this:
<BLOCKQUOTE><CODE>
<PRE>
X(26738): unaligned trap at 000000012004b6f0: 00000001401b20ca 28 1
        
</PRE>
</CODE></BLOCKQUOTE>

What this means is that the process executing command <CODE>X</CODE>
(the X11 server) with process id 26738 caused an
unaligned fault accessing address 0x1401b20ca.  This access
was performed by the instruction located at address
0x12004b6f0.  The other numbers are less important, but if
you check the kernel sources, you'll find that they tell you
more info on what kind of instruction caused the fault (e.g.,
a load vs. a store).
<P>You do not need to be overly alarmed when seeing such a message.
The program causing the faults will work <EM>correctly</EM>.
Eventually, all unaligned accesses will be fixed, but
in the meantime, just ignore these messages (if you're a programmer,
please take a minute and fix the source of the unaligned access
instead...).
<P>
<DT><B>Linker issues <CODE>warning: using multiple gp values</CODE> message:</B><DD><P>This is a warning message that
is often issued by the linker when building a large program.
Unless you're into low-level hacking, you don't want to know what
it means. The good news is: you can safely ignore this message and
this warning will be optional in the future.
<P>
<DT><B>IDE driver causes time to run slow:</B><DD><P>The default configuration of the
IDE driver disables interrupts for extended periods of time.  This
causes the kernel to loose timer interrupts and as a result, time
runs slow.  To avoid this, use the following command on all of the
IDE drives in your system:
<BLOCKQUOTE><CODE>
<PRE>
                hdparm -u 1 /dev/hd?
        
</PRE>
</CODE></BLOCKQUOTE>

This reconfigures the IDE driver to reenable interrupts as quickly
as possible.
<P>
<DT><B><CODE>minlabel</CODE>,<CODE>fdisk</CODE> fail to update kernel partition table:</B><DD><P>Do not attempt to use a system after changing the partition
table.  Even if <CODE>minlabel</CODE> and/or <CODE>fdisk</CODE> show the correct
values you <EM>will</EM> have to reboot the machine before the new
values take effect.
<P>
<DT><B><CODE>tar xvMf /dev/fd0</CODE> hangs.</B><DD><P>(This bug should not occur
on GNU libc-based systems.)  Due to a bug in the
malloc package that comes with libc-0.43, multivolume tar
archives do not work. Recompile and link with the gmalloc
standalone package, or get an updated libc.
<P>
<DT><B>Clock seems to be off by 20 years:</B><DD><P>This is not really a bug, but
many people seem to have problems with it. Here's Jay Estabrook's
Definitive Solution.
<BLOCKQUOTE><CODE>
<PRE>
ARC console and SRM console keep dates in the time-of-year (TOY) clock
in slightly different formats (actually, only the "year" field differs).

The "/sbin/clock" binary normally expects the format which SRM uses; you can,
however, tell it to expect ARC format instead, using the "-A" flag.
Thus, to read the clock when its kept in ARC format, say "clock -r -A", and
to write it, "clock -w -A". If its not written in the expected format, the
console (ARC or SRM) will prolly complain about it the next time it has a
chance... :-\

The best way to ensure you're using the correct format, is to set the date via
the console's date-setting facility; under ARC, it's a menu item some place,
under SRM it's a command (IIRC; try "help date").

Then you must ensure that the "clock" call in the RH script
/etc/rc.d/rc.sysconfig KNOWS WHAT FORMAT TO READ THE TOY IN!!!!

If you're using ARC console to boot MILO/kernel, do:

1. running RH 4.1, make sure /etc/sysconfig/clock contains:

        CLOCKMODE="ARC"

2. running RH 4.2, make sure /etc/sysconfig/clock contains (at least):

        ARC=true

Now, If you're using SRM console to directly boot a kernel, then:

1. RH 4.1, same file, set CLOCKMODE=""

2. RH 4.2, same file, set ARC=false

Refer to /etc/rc.d/rc.sysconfig for details about how the above are used to
call "clock" with the appropriate arguments.
        
</PRE>
</CODE></BLOCKQUOTE>
<P>
<DT><B>Clock gets set to a random date and time</B><DD><P>This occurs on the PC164/LX164/SX164 mainboards.
This is due to a slightly different version of the TOY clock
hardware on these boards. As seen above, your system clock gets
set from the TOY clock during bootup, using <CODE>clock</CODE>.
To test if your setup has this problem try the following command:
<BLOCKQUOTE><CODE>
<PRE>
while true; do /sbin/clock -r [-A]; done
        
</PRE>
</CODE></BLOCKQUOTE>

(use the -A option when your hardware TOY clock is in ARC format)<BR>
If you see any inconsistent results, you need to upgrade your
<CODE>/sbin/clock</CODE>. Get one of:
<BLOCKQUOTE><CODE>
<PRE>
gatekeeper.dec.com:/pub/DEC/Linux-Alpha/Kernels/clock-pc164-rh4.2
gatekeeper.dec.com:/pub/DEC/Linux-Alpha/Kernels/clock-pc164-rh50
        
</PRE>
</CODE></BLOCKQUOTE>
<P>
<DT><B>0>0>0>0>0>0></B><DD><P>Standard MILO images are configured to talk to the first serial  
port as well as the screen. When you have a modem connected it
will talk back. To resolve this, either make sure your modem is
turned off at boot time, connect it to a different port, or build
your own MILO, disabling serial port echo.
<P>
<DT><B><CODE>fdisk</CODE> doesn't recognize my disk's partitions.</B><DD><P>This may occur when
you're using BSD-style partitioning, e.g when partitioned using
Digital Unix's <CODE>disklabel</CODE> utility. Just go into <CODE>fdisk</CODE>'s BSD
mode and you will be allright.
<P>
<DT><B><CODE>vi</CODE> handles keystrokes in batches of four</B><DD><P>In fact, other apps will show the same behaviour: it really is a <CODE>ncurses</CODE>
problem. It may be related to the <CODE>termio</CODE> vs. <CODE>termios</CODE> programming error
described in the section below. A workaround is to issue <CODE>stty eof '^a'</CODE>
before starting vi.
<P>
<DT><B>X will not start on Ruffian (164UX)</B><DD><P>Starting X fails with "Failed to set IOPL for I/O".
Cause: the stock 5.1 GLIBC doesn't recognize the RUFFIAN 
system type. So, do <EM>exactly</EM> the following (as root):
<BLOCKQUOTE><CODE>
<PRE>
ln -s EB164 /etc/alpha_systype
        
</PRE>
</CODE></BLOCKQUOTE>
<P>
<DT><B><CODE>ipfwadm</CODE> fails.</B><DD><P>Redhat 5.1 and 5.2 for Alpha shipped with a buggy ipfwadm. The common
workaround is to use ipfwadm from Redhat 5.0. (Note: when you're running 
a 2.1.* or 2.2.* kernel you'll be using ipchains instead.)
<P>
<DT><B>Instable configurations with Adaptec SCSI controllers.</B><DD><P>This seems to occur with Adaptec 2940 on PC164 in particular. Improvement
has been reported after turning off the autodetection of device speed, width
and termination. Get the utility from:
<BLOCKQUOTE><CODE>
<PRE>
http://www.windowsnt.digital.com/support/drivers/drivers.asp/
        
</PRE>
</CODE></BLOCKQUOTE>

Put it on a floppy, or any FAT partition, and select "Run a program" from
the ARCBIOS menu. (Newer systems will allow you to configure SCSI controllers
by running the onboard utility through the i386 emulator in the firmware.)
<P>
<DT><B>XL266 refuses to boot after setting time.</B><DD><P>When you forget to use the -A option when setting the hardware clock on an XL266,
the ARCBIOS may see an invalid time, and refuse to boot any OS until this has
been corrected. Unfortunately, when the setting is sufficiently invalid, it will
not allow you to do so. (This is definitely a bug...) To recover you need a modified
version of linload.exe. (Thanks to Juergen Schroeder this is available from 
<A HREF="ftp://ftp.ub.uni-marburg.de/pub/unix/linux/alpha/linload_auto.exe">ftp://ftp.ub.uni-marburg.de/pub/unix/linux/alpha/linload_auto.exe</A>.)
Put it on a floppy, together with your favorite MILO, and
use the "Run a Program" option to start it. Once in MILO you can boot linux, and
set the clock again. Be sure to use -A this time...<BR>
(I believe the modification to linload.exe is that the location of MILO is
hardwired into the program.)
<P>
</DL>
<P>
<H2><A NAME="ss1.3">1.3 Porting to Alpha: the <CODE>long</CODE> and <CODE>short</CODE> of it</A>
</H2>

<P> Here is a somewhat random collection of popular ways of shooting
yourself in the foot on Unix when programming in C.  This has
practically nothing to do with Linux or Alpha, but since Linux/Alpha
is among the pioneers in 64-bit land, these errors are more likely to
show on such systems.
<P>
<DL>
<DT><B><CODE>sizeof(long)!=32</CODE></B><DD><P>Many programs assume a long is
32 bits wide.  This is non-sense.  The ANSI C standard
does not specify anything like that.  For example, on
an Alpha running a grown up operating system such as
DEC Unix or Linux, the fundamental C types have the following
sizes and alignment restrictions:
<UL>
<LI><CODE>char</CODE>: 8 bits as usual, byte alignment is fine.</LI>
<LI><CODE>short</CODE>: 16 bits as usual, 2 byte alignment required.</LI>
<LI><CODE>int</CODE>: 32 bits as usual, 4 byte alignment required.</LI>
<LI><CODE>float</CODE>: 32 bits as usual, 4 byte alignment required.</LI>
<LI><CODE>long</CODE>: 64 bits, 8 byte alignment required.</LI>
<LI><CODE>void*</CODE>: 64 bits, 8 byte alignment required.</LI>
<LI><CODE>double</CODE>: 64 bits as usual, 4 byte alignment required.</LI>
</UL>

Note that the above implies that you cannot cast a pointer
to an integer without loosing bits.  In fact, Alpha binaries
by default are purposely arranged in such a way that if you
try to do this, they'll dump core---it is much better to
learn about such program errors via a core dump than through
some subtle errors.
<P>If you need a variable with exactly <I>n</I> bits in it, you can
use the following types in Linux applications (and most other
systems that are based on GNU libc):
<UL>
<LI><CODE>int8_t</CODE>: signed integer type with 8 bits.</LI>
<LI><CODE>int16_t</CODE>: signed integer type with 16 bits.</LI>
<LI><CODE>int32_t</CODE>: signed integer type with 32 bits.</LI>
<LI><CODE>int64_t</CODE>: signed integer type with 64 bits.</LI>
<LI><CODE>u_int8_t</CODE>: unsigned integer type with 8 bits.</LI>
<LI><CODE>u_int16_t</CODE>: unsigned integer type with 16 bits.</LI>
<LI><CODE>u_int32_t</CODE>: unsigned integer type with 32 bits.</LI>
<LI><CODE>u_int64_t</CODE>: unsigned integer type with 64 bits.</LI>
</UL>

In the kernel, use the following types instead:
<UL>
<LI><CODE>__s8</CODE>: signed integer type with 8 bits.</LI>
<LI><CODE>__s16</CODE>: signed integer type with 16 bits.</LI>
<LI><CODE>__s32</CODE>: signed integer type with 32 bits.</LI>
<LI><CODE>__s64</CODE>: signed integer type with 64 bits.</LI>
<LI><CODE>__u8</CODE>: unsigned integer type with 8 bits.</LI>
<LI><CODE>__u16</CODE>: unsigned integer type with 16 bits.</LI>
<LI><CODE>__u32</CODE>: unsigned integer type with 32 bits.</LI>
<LI><CODE>__u64</CODE>: unsigned integer type with 64 bits.</LI>
</UL>

However, the availability of these types is somewhat system
dependent.  In particular, on a 32 bit machine, the 64 bit
integers are typically available only when using GNU C.  Also,
keep in mind that there are still machines out there that
have odd word sizes, such as 36 bits.  So, for the sake of
portability, these types should be used sparingly.
<P>
<DT><B>Error return value of <CODE>inet_addr</CODE>()</B><DD><P>It is a common myth
to assume that <CODE>inet_addr()</CODE> returns -1 in case of
error.  In fact, even the Linux man-page propagates this
superstitious belief.  But don't be misguided: in truth,
<CODE>inet_addr()</CODE> returns <CODE>INADDR_NONE</CODE> in case
of error.  This manifest constant is defined in
<CODE>netinet/in.h</CODE>.  An even better solution is to avoid
this function alltogether.  Reasonably modern libraries provide
the <CODE>inet_aton</CODE>() function that has an unmistakable
return value to indicate success or failure.
<P>
<DT><B><CODE>struct termio</CODE> does <EM>not</EM> equal <CODE>struct termios</CODE></B><DD><P>Many Linux programs incorrectly assume it is all right to mix
and match <CODE>struct termio</CODE> and <CODE>struct termios</CODE> and their
<CODE>ioctl()</CODE> calls.  Well, not quite.  The two interfaces are in fact
incompatible on many systems (for historic reasons, this can't be
fixed easily).  Thus, if you use <CODE>struct termio</CODE>, then be
sure to use the termio calls <EM>only</EM> (<CODE>TCGETA</CODE>, <CODE>TCSETAF</CODE>,
<CODE>TCSETAW</CODE>, and <CODE>TCSETA</CODE>).  In constrast, if you use the termios
structure, be sure to use its calls only (<CODE>TCGETS</CODE>, <CODE>TCSETSF</CODE>,
<CODE>TCSETSW</CODE>, and <CODE>TCSETS</CODE>).
<P>
<DT><B>Atomicity of sub-word loads/stores</B><DD><P>It is generally not safe to assume that reading or writing a
quantity that is smaller than the machine's word size is
atomic.  In particular, all early Alpha chips do not have
atomic instructions to read or write a byte or a short (16
bits).  Unless you're into kernel hacking where you need to
synchronize with devices and/or interrupts, you probably won't
care.  But even in user-space this can cause problems in case
your program is sharing data with another process through
shared memory, for example.
</DL>
<P>
<P>
<HR>
<A HREF="FAQ-2.html">Next</A>
Previous
<A HREF="FAQ.html#toc1">Contents</A>
</BODY>
</HTML>
