
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>Debian GNU/Linux - Security Information</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso-8859-1">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
</HEAD>

<BODY BGCOLOR="#FFFFFF">
<H1><IMG SRC="../../Pics/debian.jpg" WIDTH=114 HEIGHT=140 ALIGN="middle" ALT="Debian GNU/Linux - ">Security Information</H1>
<HR>
Debian takes security very seriously.  Most <a href="../index.html">security problems</a> brought
to our attention are corrected within 48 hours.

<P> Please send security-related bug reports to <a href="mailto:security@debian.org">security@debian.org</a><P>

<blockquote>
<b>Date: Sun, 23 Mar 1997 09:11:34 -0800 (PST)</b> <br>
<b>From: Alex Belits &lt;abelits@phobos.illtel.denver.co.us&gt;</b> <p>

[Mod: David Holland's message added to the back, linux-alert added to the
list of addresses -- alex] <p>

On Sat, 22 Mar 1997, Ben Cantrick wrote:

<em>
   It's a cute little hack, and it seems to work. But I am convinced that
 someone must have seen the need and done this before. My extended forays
 into the web via several search engines have failed to turn up anything
 relevant. So I'm curious if anyone on the list knows of (or better, has)
 freely distributable source for a "secure" tftpd. <p>
</em>

  tftpd in FreeBSD distribution uses chroot() and sets its uid to nobody.
I don't think, it does anything reasonable with groups. <p>

But... I've looked at both Linux (NetKit 0.09) and FreeBSD (2.2-ALPHA)
tftpd and found rather strange code in Linux tftpd's validate_access()
function: <p>

<pre>
        syslog(LOG_ERR, "tftpd: trying to get file: %s\n", filename);

        if (*filename != '/') {
                syslog(LOG_ERR, "tftpd: serving file from %s\n", dirs[0]);
                chdir(dirs[0]);
        } else {
                for (dirp = dirs; *dirp; dirp++)
                        if (strncmp(filename, *dirp, strlen(*dirp)) == 0)
                                break;
                if (*dirp==0 && dirp!=dirs)
                        return (EACCESS);
        }
        /*
         * prevent tricksters from getting around the directory restrictions
         */
        for (cp = filename + 1; *cp; cp++)
                if(*cp == '.' && strncmp(cp-1, "/../", 4) == 0)
                        return(EACCESS);
</pre>

...it checks _only_ for "/../" and start _always_ from the second
character in the filename (in other words, if filename is empty, it will
"analyze" the memory after it where other piece of code places mode, so at
least it won't do anything destructive). But it also assumes all not
starting from '/' filenames to be relative to some directory, and never
checks them for "../" that FreeBSD one does. So (see code above for
locations of calls to syslog()): <p>

<pre>
Mar 23 06:55:08 phobos in.tftpd[9799]: connect from phobos.illtel.denver.co.us
Mar 23 06:55:08 phobos tftpd[9800]: tftpd: trying to get file: ../etc/passwd 
Mar 23 06:55:08 phobos tftpd[9800]: tftpd: serving file from /tftpboot 
</pre>

...and obviously it was /tftpboot/../etc/passwd aka /etc/passwd <p>

  Not that it does any damage by itself, but it definitely wasn't supposed
to do that. FreeBSD tftpd disallows such things. <p>

   According to copyright notices, both tftpd are derived from some old
(1983) Berkeley code, and Linux one has some general clumsiness all over
its code (and default /tftpboot directory didn't exist until 0.09, 0.08
seems to require the list of directories, or it will just SIGSEGV
on NULL pointer). <p>

FreeBSD tftpd compiles with command line: <p>

<pre>
   gcc -O -DLOG_FTP=LOG_DAEMON -o tftpd  tftpd.c tftpsubs.c
</pre>

and works fine if -ls /tftpboot is added as options to its command line.
Otherwise it only checks file permissions without even trying to become
"nobody" and thus opens hole for non-executable directories (even if
directory is non-executable for anyone but root, files in it will be
accessible). Also it's necessary to hardlink /dev/log under chroot
directory to keep logging functional. <p>

P.S. how such umm... not obviously secure code got into tftpd in the first
place after that many revisions that definitely were done to increase
security? After all, changes between NetKit revisions _do_ make sense. <p>

<b>Return-Path: dholland@hcs.harvard.edu</b> <p>

<pre>
  [tftpd source mapped to /dev/null]
 
  Finally, it prevents ".." and "." in filename to be used to go up:
</pre>

He's right; it doesn't block leading ".." in the case where the
filename doesn't begin with "/".  <p>

Someone already caught this and the fix is going to be in the next
release; in the meantime here's a patch. <p>

It needs an intensive rewrite. Don't hold your breath... :( <p>

<a href="tftpd.patch">Here</a> is a patch.
</blockquote>

<P><SMALL>Last Modified: 10 Jan 1998.
Copyright &copy;1997 SPI; See
<A HREF="../../license.html">license terms.</A></SMALL>
<HR>
</BODY>
</HTML>


