<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
	<title>test.c</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="com">/*
 * Sample code with a few buffer overflows. (<a href="test.c">Plain file here</a>)
 */</span> 

<span class="dir">#include &lt;stdio.h&gt;
</span><span class="dir">#include &lt;stdlib.h&gt;
</span>
<span class="kwb">int</span> main<span class="sym">(</span> <span class="kwb">int</span> argc<span class="sym">,</span> <span class="kwb">char</span> <span class="sym">*</span>argv<span class="sym">[] )
{
</span>    <span class="kwb">char</span> dir<span class="sym">[</span><span class="num">1024</span><span class="sym">];
</span>    <span class="kwb">char</span> cmd<span class="sym">[</span><span class="num">1200</span><span class="sym">];
</span>    <span class="kwb">char</span> buff<span class="sym">[</span><span class="num">1024</span><span class="sym">];
</span>    <span class="kwb">FILE</span> <span class="sym">*</span>fp <span class="sym">=</span> NULL<span class="sym">;
</span>    <span class="kwb">int</span> i <span class="sym">=</span> <span class="num">0</span><span class="sym">;

</span>    <span class="kwa">if</span> <span class="sym">(</span> argc <span class="sym">==</span> <span class="num">2</span> <span class="sym">)
    {
</span>      strcpy<span class="sym">(</span> dir<span class="sym">,</span> argv<span class="sym">[</span> <span class="num">1</span> <span class="sym">] );
    }
</span>    <span class="kwa">else
</span>    <span class="sym">{
</span>      <span class="kwa">if</span> <span class="sym">(</span> getenv<span class="sym">(</span> <span class="str">&quot;HOME&quot;</span> <span class="sym">) !=</span> NULL <span class="sym">)
      {
</span>	sprintf<span class="sym">(</span> dir<span class="sym">,</span> <span class="str">&quot;%s&quot;</span><span class="sym">,</span> getenv<span class="sym">(</span> <span class="str">&quot;HOME&quot;</span> <span class="sym">) );
      }
</span>      <span class="kwa">else
</span>      <span class="sym">{
</span>	strcpy<span class="sym">(</span> dir<span class="sym">,</span> <span class="str">&quot;/&quot;</span> <span class="sym">);
      }
    }

</span>    snprintf<span class="sym">(</span>cmd<span class="sym">,</span> <span class="kwa">sizeof</span><span class="sym">(</span>cmd<span class="sym">)-</span><span class="num">1</span><span class="sym">,</span> <span class="str">&quot;%s %s&quot;</span><span class="sym">,</span> <span class="str">&quot;ls&quot;</span><span class="sym">,</span> dir <span class="sym">);
</span>    fp <span class="sym">=</span> popen<span class="sym">(</span> cmd<span class="sym">,</span> <span class="str">&quot;r&quot;</span> <span class="sym">);
</span>    <span class="kwa">if</span> <span class="sym">(</span> fp <span class="sym">==</span> NULL <span class="sym">)
    {
</span>      printf<span class="sym">(</span><span class="str">&quot;Failed to invoke: %s</span><span class="esc">\n</span><span class="str">&quot;</span><span class="sym">,</span> cmd <span class="sym">);
</span>      <span class="kwa">return</span> <span class="num">-1</span><span class="sym">;
    }

</span>    <span class="kwa">while</span><span class="sym">(</span> i <span class="sym">=</span> fread<span class="sym">(</span> buff<span class="sym">,</span> <span class="num">1</span><span class="sym">,</span> <span class="kwa">sizeof</span><span class="sym">(</span>buff<span class="sym">),</span> fp <span class="sym">) )
    {
</span>      printf<span class="sym">(</span> buff <span class="sym">);
    }

</span>    pclose<span class="sym">(</span> fp <span class="sym">);

</span>    <span class="kwa">return</span> <span class="num">0</span><span class="sym">;
}</span>
</pre>
<hr>
<p>
HTML generated by <a href="http://www.andre-simon.de/">highlight 2.2-8</a><br>
<a href="http://packages.debian.org/highlight">Debian package highlight</a>
</p>
</body>
</html>
<!--HTML generated by highlight 2.2-8, http://www.andre-simon.de/-->
