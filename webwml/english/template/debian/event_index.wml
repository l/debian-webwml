#use wml::debian::basic title="Debian GNU/Linux &mdash; Upcoming Attractions"
#use wml::debian::languages

#for translators
<define-tag past_events_label><H3>Past Events</H3><TABLE></define-tag>
<define-tag coming_events_label><H3>Coming Events</H3><TABLE></define-tag>
<define-tag unknown_place_label><H3>Unknown</H3><TABLE></define-tag>

<perl>
sub get_event_list {
	my ( $path, $number, $current_dir ) = @_;


	$str=""; $over="<past_events_label>"; $current="<coming_events_label>"; $unknown="<unknown_place_label>";

	opendir(DIR, "$current_dir/$path");
  	@files = grep { /^\d+.*.wml$/ && -f "$current_dir/$path/$_" } readdir(DIR);
  	@files = sort {$b cmp $a} @files;
  	closedir DIR;

  $count = 0;
  foreach (@files) {
     $count++;
     open(FILE, "<$path/$_") || open(FILE, "<$current_dir/$path/$_");
     if ( /(\d+.*).wml/ ) {
        $base = $1;
     }
     $title = ''; $when = ''; $where = ''; $desc = ''; $past = '';
     foreach $line (<FILE>) {
        if ($line =~ /^<define-tag pagetitle>(.*)<\/define-tag>$/) {
           $title = $1;
        }
        elsif ($line =~ /^#use wml::debian::past_event$/) {
           $past = 'yes';
        }
        elsif ($line =~ /^#use wml::debian::event$/) {
           $past = 'no';
        }
        elsif ($line =~ /^<define-tag date>(.*)<\/define-tag>$/) {
           $when = $1;
        }
        elsif ($line =~ /^<define-tag where>(.*)<\/define-tag>$/) {
           $where = $1;
        }
        elsif ($line =~ /^<define-tag desc>(.*)<\/define-tag>$/) {
           $desc = $1;
        }

		if ($title && $when && $where) {
           $str1 = "<TR><TD><TT>[$when]</TT></TD><TD><STRONG><A HREF=\"$path/$base\">$title</A></STRONG> ($where)</TD></TR>\n";
		}
		elsif ($title && $when) {
           $str1 = "<TR><TT>[$when]</TT></TD><TD><STRONG><A HREF=\"$path/$base\">$title</A></STRONG></TD></TR>\n";
		}

		if ($past && $title && $when && $where ) {
			last;
		}
     }
	 if ( $past eq "yes" )
	 {
	 	$over .= $str1;
	 }
	 elsif ( $past eq "no" )
	 {
	 	$current .= $str1;
	 }
	 else
	 {
	 	$unknown .= $str1;
	 }
     close FILE;
     if ($count eq $number) { last; }
  }
close DIR;
$str = "<H2>$path</H2>";
if ( $over eq "<past_events_label>" && $current eq "<coming_events_label>" && $unknown eq "<unknown_place_label>" )
{
	$str .= "[none]";
}
else
{
	if ( $current ne "<coming_events_label>" ) { $str .= "$current </TABLE>"; }
	if ( $over ne "<past_events_label>" ) { $str .= "$over </TABLE>"; }
	if ( $unknown ne "<unknown_place_label>" ) { $str .= "$unknown </TABLE>"; }
}
return $str;
}
</perl>
