#use wml::debian::ctime

<define-tag noitemsforthisyear whitespace=delete>
	[EN:No items for this year.:]
	[RO:Nu sÎnt articole pentru anul acesta:]
	[EO:Estas nenio por æi tiu jaro.:]
	[TR:Bu yIl iCin bilgi yok:]
	[FI:Ei otsikoita tältä vuodelta:]
	[PT:Sem itens neste ano.:]
	[HR:Za ovu godinu nema èlanaka.:]
	[FR:Pas d'éléments cette année.:]
	[NL:Geen items voor dit jaar.:]
	[DE:Kein Eintrag für dieses Jahr.:]
	[IT:Nessun articolo per quest'anno.:]
	[JA:º£Ç¯ÅÙ¤Î¹àÌÜ¤Ï¤¢¤ê¤Þ¤»¤ó¡£:]
	[PL:Brak wydarzeñ w tym roku.:]
	[ES:No hay elementos para este año.:]
	[DA:Ingen begivenheder i dette &aring;r.:]
	[NO:Ingen begivenheter dette året:]
	[ZH:¥»¦~«×¤ºÁÙ¥¼¦³¥ô¦ó·s®ø®§¡C:]
	[SV:Ingenting detta år.:]
	[KO:No items for this year.:]
	[AR:ÍÊøì ÚäÕÑ åÐÇ ÇáÚÇã:]
	[RU:îÅÔ ÎÉÞÅÇÏ ÚÁ ÜÔÏÔ ÇÏÄ.:]
</define-tag>

<define-tag proposed whitespace=delete>
	[EN:proposed:]
	[AR:proposed:]
	[DA:proposed:]
	[DE:proposed:]
	[EO:proposed:]
	[ES:proposed:]
	[FI:proposed:]
	[FR:proposed:]
	[HR:proposed:]
	[HU:proposed:]
	[IT:proposed:]
	[JA:proposed:]
	[KO:proposed:]
	[NL:voorgesteld:]
	[NO:proposed:]
	[PL:proposed:]
	[PT:proposed:]
	[RO:proposed:]
	[RU:proposed:]
	[SV:föreslagen:]
	[TR:proposed:]
	[ZH:proposed:]
</define-tag>

<define-tag discussed whitespace=delete>
	[EN:discussed:]
	[AR:discussed:]
	[DA:discussed:]
	[DE:discussed:]
	[EO:discussed:]
	[ES:discussed:]
	[FI:discussed:]
	[FR:discussed:]
	[HR:discussed:]
	[HU:discussed:]
	[IT:discussed:]
	[JA:discussed:]
	[KO:discussed:]
	[NL:besproken:]
	[NO:discussed:]
	[PL:discussed:]
	[PT:discussed:]
	[RO:discussed:]
	[RU:discussed:]
	[SV:diskuterad:]
	[TR:discussed:]
	[ZH:discussed:]
</define-tag>

<define-tag votedon whitespace=delete>
	[EN:voted on:]
	[AR:voted on:]
	[DA:voted on:]
	[DE:voted on:]
	[EO:voted on:]
	[ES:voted on:]
	[FI:voted on:]
	[FR:voted on:]
	[HR:voted on:]
	[HU:voted on:]
	[IT:voted on:]
	[JA:voted on:]
	[KO:voted on:]
	[NL:op gestemd:]
	[NO:voted on:]
	[PL:voted on:]
	[PT:voted on:]
	[RO:voted on:]
	[RU:voted on:]
	[SV:omröstad:]
	[TR:voted on:]
	[ZH:voted on:]
</define-tag>

<define-tag finished whitespace=delete>
	[EN:finished:]
	[AR:finished:]
	[DA:finished:]
	[DE:finished:]
	[EO:finished:]
	[ES:finished:]
	[FI:finished:]
	[FR:finished:]
	[HR:finished:]
	[HU:finished:]
	[IT:finished:]
	[JA:finished:]
	[KO:finished:]
	[NL:afgelopen:]
	[NO:finished:]
	[PL:finished:]
	[PT:finished:]
	[RO:finished:]
	[RU:finished:]
	[SV:avslutad:]
	[TR:finished:]
	[ZH:finished:]
</define-tag>

# DO NOT translate anything below here. If you feel something needs to be changed, write to
# debian-www first

<perl>

# grabs the date and title of the last $number news items from directory $year.
# If $number is zero then all the news items are shown.
# example usage:
# get_recent_list ('1998', '0', '$(ENGLISHDIR)/News', '', '\d+\w*')

sub get_recent_list {
	my ($year, $number, $eng_dir, $format, $match) = @_;

	if ($format =~ order) {
		$listhead = '<OL>';
		$listfoot = '</OL>';
		$elemhead = '<LI>';
		$elemfoot = '';
	}
	elsif ($format =~ bullet) {
		$listhead = '<UL>';
		$listfoot = '</UL>';
		$elemhead = '<LI>';
		$elemfoot = '';
	}
	elsif ($format =~ list) {
		$listhead = '<DL>';
		$listfoot = '</DL>';
		$elemhead = '<DT>';
		$elemfoot = '<DD>';
	}
	else {
		$listhead = '';
		$listfoot = '';
		$elemhead = '';
		$elemfoot = '';
	}

	$str=$listhead;

	opendir(DIR, "$eng_dir/$year");
	@files = grep { /^$match.wml$/ && -f "$eng_dir/$year/$_" } readdir(DIR);
	@files = sort {$b cmp $a} @files;
	closedir DIR;

#	print STDERR "files: " . join " ", @files;
#	print STDERR "year=$year number=$number eng_dir=$eng_dir format=$format match=$match";
	$count = 0;
	grab_titles($year, $number, $eng_dir, $format, $match);

	if ($count < $number && $number ne 0) {
		@tmp = split('/', $year);
		$tmp[$#tmp]--;
		# $year--;
		$year = join('/', @tmp);
		if (-d "$eng_dir/$year") {
			opendir(DIR, "$eng_dir/$year") or printf stderr "couldn't open dir $eng_dir/$year\n";
			@files = grep { /^$match.wml$/ && -f "$eng_dir/$year/$_" } readdir(DIR);
			@files = sort {$b cmp $a} @files;
			closedir DIR;
			grab_titles($year, $number, $eng_dir, $format, $match);
		}
	}
	if ($count eq 0) {
		$str .= "<noitemsforthisyear>\n";
	}
	$str .= $listfoot;
	return $str;
}

sub grab_titles {
	my ($year, $number, $eng_dir, $format, $match) = @_;
	foreach (@files) {
		$trans_title = $_;
		$trans_title =~ s/wml/title/;
		$count++;
		open(FILE, "<$year/$_") || open(FILE, "<$year/$trans_title") || open(FILE, "<$eng_dir/$year/$_") or printf stderr "ACK: can't open $year/$_\n";
		if (/($match).wml/) {
			$base = $1;
		}
		$date = ''; $title = ''; $desc = '';
		<protect pass=2>
		foreach $line (<FILE>) {
			if ($line =~ /^<define-tag pagetitle>(.*)<\/define-tag>$/) {
				$title = qq/$1/;
			}
			elsif ($line =~ /^<define-tag release_date>(.*)<\/define-tag>$/) {
				$date = qq/$1/;
			}
			elsif ($line =~ /^<define-tag report_date>(.*)<\/define-tag>$/) {
				$date = qq/$1/;
			}
			elsif ($line =~ /^<define-tag date>(.*)<\/define-tag>$/) {
				$date = qq/$1/;
			}
			elsif ($line =~ /^<define-tag description>(.*)<\/define-tag>$/) {
				$desc = qq/$1/;
			}
			elsif ($line =~ /^<define-tag status>(.*)<\/define-tag>$/) {
				$status = qq/$1/;
			}
		</protect>
			if ($title && $date && $desc) {
				$date = newsdate($date);
				$title =~ s/DSA-\d{3}-\d{1}//;
				$str1 = "$elemhead<tt>[$date]</tt> <strong><a href=\"$year/$base\">$title</a></strong> - $elemfoot$desc<br>\n";
				last;
			}
			elsif ($title && $date) {
				$date = newsdate($date);
				$title =~ s/DSA-\d{3}-\d{1}//;
				$str1 = "$elemhead<tt>[$date]</tt> <strong><a href=\"$year/$base\">$title</a></strong><br>\n";
			}
			elsif ($title && $status) {
				$str1 = "$elemhead<a href=\"$year/$base\">$title</a> &mdash; ";
				 if ( $status eq "P" ) { $str1 .= "<proposed>"; }
				 elsif ( $status eq "D" ) { $str1 .= "<discussed>"; }
				 elsif ( $status eq "V" ) { $str1 .= "<votedon>"; }
				 elsif ( $status eq "F" ) { $str1 .= "<finished>"; }
				 else { $str1 .= "other"; }
				$str1 .= "<br>\n";
			}
		}
		$str .= $str1;
		close FILE;
		if ($count eq $number) { last; }
	}
	return $str;
}

</perl>
