<perl>

# grabs the date and title of the last $number news items from directory $year.
# If $number is zero then all the news items are shown.

sub get_recent_list {
  my ($year, $number, $eng_dir) = @_;

  opendir(DIR, "$eng_dir/$year");
  @files = grep { /^\d+\w?.wml$/ && -f "$eng_dir/$year/$_" } readdir(DIR);
  @files = sort {$b cmp $a} @files;
  closedir DIR;

  $count = 0;
  foreach (@files) {
     $count++;
     open(FILE, "<$year/$_") || open(FILE, "<$eng_dir/$year/$_");
     if (/(\d+\w?).wml/) {
        $base = $1;
     }
     $date = ''; $title = ''; $desc = '';
     foreach $line (<FILE>) {
        if ($line =~ /^<define-tag pagetitle>(.*)<\/define-tag>$/) {
           $title = $1;
        }
        elsif ($line =~ /^<define-tag release_date>(.*)<\/define-tag>$/) {
           $date = $1;
        }
        elsif ($line =~ /^<define-tag report_date>(.*)<\/define-tag>$/) {
           $date = $1;
        }
        elsif ($line =~ /^<define-tag description>(.*)<\/define-tag>$/) {
           $desc = $1;
        }
        if ($title && $date) {
           $str1 = "<tt>[$date]</tt> <strong><a href=\"$year/$base\">$title</a></strong> - $desc<br>\n";
		}
        if ($title && $date && $desc) {
           last;
        }
     }
	 $str .= $str1;
     close FILE;
     if ($count eq $number) { last; }
  }
close DIR;
return $str;
}

</perl>
