<perl>

#
# emits an bunch of li (list items)
#   assumes %arches and $indirect_object_conjoiner
#
sub permute_as_list {
    my($file, $name, @exts) = @_;
    my($ext, $arch);

    foreach $arch (keys %arches) {
	print "<li> <a href=\"./$arch/$file\">";
	# language dependant part -- given a manual name and an architecture, join them
	if ( $CUR_ISO_LANG eq 'en' ) {
	    print "$name for " . $arches{$arch};
	}
	elsif ( $CUR_ISO_LANG eq 'de' ) {
	    print "$name für " . $arches{$arch};
	}
	elsif ( $CUR_ISO_LANG eq 'sv' ) {
	    print "$name för " . $arches{$arch};
	}
	print "</a>";
	if ( $#exts != -1 ) {
	    foreach $ext (@exts) {
	        print " (<a href=\"./$arch/$file.$ext\"><em>" . 
			$formats{$ext} . "</em></a>)";
	    }
	}
	print "\n";
    }
}

#
# emits an HTML table matrix:
#   | arch | format | lang1, lang2, lang3 |
#   assumes %arches and %formats
#
sub permute_as_matrix {
    my($file, @langs) = @_;
    my($ext, $arch, $lang, @cur_dir, $release);
    my $altcolor = 'white';
    my $ctr = 0;

    @cur_dir = split('/', '$(WML_SRC_DIRNAME)');
    $release = pop @cur_dir;

    foreach $arch (keys %arches) {
	$ctr++;
	my $first = 1;

	foreach $ext (keys %formats) {
	    if (!-f "$(HTMLDIR)/releases/$release/$arch/$file.en.$ext") {
	        next;
	    }
	    # alternate the row color
	    if ( $ctr % 2 ) {
		print "\n<tr>\n";
	    } else {
		print "\n<tr bgcolor=\"$altcolor\">\n";
	    }
	    # only print the arch name on the first row
	    if ( $first == 1 ) {
		print "  <td align=\"left\"><a href=\"$arch/$file\">" . $arches{$arch} . "</a></td>\n";
		$first = 0;
	    } else {
		print "  <td>&nbsp;</td>\n";
	    }
	    print "  <td align=\"left\">" . $formats{$ext} . "</td>\n";
	    # permute over languages
	    print "  <td>";
	    foreach $lang (@langs) {
	        $file_version = "./$arch/$file." . $langs{$lang} . ".$ext";
	        if (-f "$(HTMLDIR)/releases/$release/$file_version") {
	            # all languages should be defined in %trans. Add missing entries 
	            # in English if this is not the case
	            print "<a href=\"$file_version\">" . $trans{$CUR_ISO_LANG}{$lang} . "</a> \n";
	        }
	    }
	    print "  </td>";
	    print "</tr>\n";
	    
	}
    }
}

</perl>
