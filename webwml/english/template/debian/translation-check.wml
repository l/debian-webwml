#use wml::std::tags
#use wml::debian::languages

# This file is used to track when translations go out-of-date, and it is
# used by including this in the head of the translated file:
#
# #use wml::debian::translation-check translation="X.xx"
#
# where X.xx is the current CVS revision number of the file you have
# translated.
#
# There are also some additional parameters that you can use on the #use
# line:
#
#    original="language"
# where  language  is the name of the language you are translating from, if
# not english. The name must correspond to the top-level subdirectory, and
# to the name in languages.wml
#
#    mindelta="number"
# which defines the maximum difference in CVS revisions before the
# translation is considered aged. The default value is 2. For important
# pages, set it to 1, which means that every change is considered making the
# translation aged. The value for the <aged> tag is displayed.
#
#    maxdelta="number"
# which defines the maximum difference in CVS revisions before the
# translation is considered to be outdated (and the value of the <outdated>
# tag is displayed). The default value is 5. For very important pages, set
# it to be less. A value of 1 means that every change is considered making
# the translation outdated.

# This is the message that is displayed if the translation is aged.
# (min_delta <= difference < max_delta)
<define-tag translationaged whitespace=delete>
  [EN:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [EL:<P><EM>Óçìåßùóç:</EM> To áõèåíôéêü åßíáé íåşôåñï áğï áõôŞ ôç ìåôÜöñáóç.</P>:]
  [SV:<P><EM>Observera:</EM> Originalet är nyare än denna översättning.</P>:]
  [NO:<P><EM>NB:</EM> Originalen er nyere enn denne oversettelsen.</P>:]
  [DE:<P><EM>NB:</EM> Das Original ist neuer als diese Übersetzung.</P>:]
  [AR:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [DA:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [EO:<P><EM>Noto:</EM> La originala paøo estas pli nova ol tiu æi.</P>:]
  [ES:<P><EM>Nota:</EM> La página original es más nueva que esta traducción.</P>:]
  [FI:<P><EM>Huomaa:</EM> Alkuperäinen sivu on tätä suomennosta uudempi.</P>:]
  [FR:<P><EM>Note:</EM> Le document original est plus récent que cette traduction.</P>:]
  [HR:<P><EM>NB:</EM> Originalni dokument je noviji od ovog prijevoda.</P>:]
  [HU:<P><EM>Megjegyzés:</EM>Az eredeti oldalt a legutóbbi fordítás óta módosították.</P>:]
  [IT:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [JA:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [KO:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [NL:<P><EM>Noot:</EM> Het origineel is nieuwer dan deze translatie.</P>:]
  [PL:<P><EM>Uwaga: Orygina³ jest nowszy ni¿ to t³umaczenie</EM>.</P>:]
  [PT:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [RO:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [RU:<P><EM>úÁÍÅŞÁÎÉÅ:</EM> ïÒÉÇÉÎÁÌ ÜÔÏÇÏ ÄÏËÕÍÅÎÔÁ ÎÏ×ÅÅ, ŞÅÍ ĞÅÒÅ×ÏÄ.</P>:]
  [TR:<P><EM>Note:</EM> The original is newer than this translation.</P>:]
  [ZH:<P><EM>µù¡G</EM>¦¹ºô­¶ªº¤¤¤åÄ¶¥»¤£¤Î­ì­^¤å¥»·s¡C</P>:]
</define-tag>

# This is the message that is displayed if the translation is too old.
# (difference >= max_delta)
<define-tag translationoutofdate whitespace=delete>
  [EN:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [EL:<P><STRONG>Ğñïóï÷Ş! ÁõôŞ ç ìåôÜöñáóç åßíáé ğïëı ğáëéÜ, \
      ğáñáêáëş äåßôå ôï <A HREF="$link">áõèåíôéêü êåßìåíï</A>.</STRONG></P>:]
  [SV:<P><STRONG>Varning! Den här översättningen är för gammal, \
      vänligen se <A HREF="$link">originalet</A>.</STRONG></P>:]
  [NO:<P><STRONG>Advarsel! Denne oversettelsen er for gammel, \
      vennligst se <A HREF="$link">originalen</A>.</STRONG></P>:]
  [DE:<P><STRONG>Achtung! Diese Übersetzung ist zu alt, \
      bitte benutzen Sie das <A HREF="$link">Original</A>.</STRONG></P>:]
  [AR:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [DA:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [EO:<P><STRONG>Atentu! Tiu æi traduko estas tro malnova, \
      bonvolu viziti la <A HREF="$link">originalan</A>.</STRONG></P>:]
  [ES:<P><STRONG>¡Ojo! Esta traducción está muy desactualizada, \
      por favor, consulte el <A HREF="$link">documento original</A>.</STRONG></P>:]
  [FI:<P><STRONG>Varoitus! Tämä suomennos on liian vanha, katso mielummin \
      <A HREF="$link">alkuperäistä sivua</A>.</STRONG></P>:]
  [FR:<P><STRONG>Attention : cette traduction n'est plus à jour, \
      veuillez vous référer au <A HREF="$link">document original</A>.</STRONG></P>:]
  [HR:<P><STRONG>Pa¾nja! Ovaj prijevod je jako zastario, \
      molimo pogledajte <A HREF="$link">original</A>.</STRONG></P>:]
  [HU:<P><STRONG>Figyelem! A fordítás elavult, \
      olvasd az <A HREF="$link">eredetit</A>.</STRONG></P>:]
  [IT:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [JA:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [KO:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [NL:<P><STRONG>Waarschuwing! Deze vertaling is te oud. \
      Lees bij voorkeur het <A HREF="$link">origineel</A>.</STRONG></P>:]
  [PL:<P><STRONG>Uwaga! To t³umaczenie jest przestarza³e, \
      proszê zwróciæ uwagê na <A HREF="$link">orygina³</A>.</STRONG></P>:]
  [PT:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [RO:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [RU:<P><STRONG>ğÒÅÄÕĞÒÅÖÄÅÎÉÅ! üÔÏÔ ĞÅÒÅ×ÏÄ ÓÉÌØÎÏ ÕÓÔÁÒÅÌ, \
      ĞÏÖÁÌÕÊÓÔÁ ĞÏÌØÚÕÊÔÅÓØ <A HREF="$link">ÏÒÉÇÉÎÁÌÏÍ</A>.</STRONG></P>:]
  [TR:<P><STRONG>Warning! This translation is too out of date, \
      please see the <A HREF="$link">original</A>.</STRONG></P>:]
  [ZH:<P><STRONG>ª`·N¡I¦¹ºô­¶¤¤¤åÄ¶¥»¤Ó¤[¨S¦³§ó·s¤F¡A\
      ½Ğ°Ñ¾\<A HREF="$link">³Ì·s­ì­^¤å¥»</A>¡C</STRONG></P>:]
</define-tag>

# This is the message that is displayed if the referenced original file
# no longer exists.
<define-tag originalgone whitespace=delete>
  [EN:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [AR:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [DA:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [DE:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [EL:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [EO:<P><EM>Noto:</EM> La originala paøo ne plu ekzistas.</P>:]
  [ES:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [FI:<P><EM>Huomaa:</EM> Alkuperäistä sivua, josta tämä on käännetty, ei enää ole.</P>:]
  [FR:<P><EM>Note:</EM> Le document original n'existe plus.</P>:]
  [HR:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [HU:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [IT:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [JA:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [KO:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [NL:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [NO:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [PL:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [PT:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [RO:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [RU:<P><EM>úÁÍÅŞÁÎÉÅ:</EM> ïÒÉÇÉÎÁÌ ÂÏÌØÛÅ ÎÅ ÓÕİÅÓÔ×ÕÅÔ.</P>:]
  [TR:<P><EM>Note:</EM> The original no longer exists.</P>:]
  [SV:<P><EM>Observera:</EM> Originalet existerar inte längre.</P>:]
  [ZH:<P><STRONG>µù¡G</STRONG>¦¹ºô­¶ªº­ì­^¤å¥»¤w¸g¤£¦s¦b¤F¡C</P>:]
</define-tag>

# DO NOT translate anything below here. --------------------------------------

<perl>

sub check_translation {

# Input parameters:
my ($translation, $file, $original, $mindelta, $maxdelta) = @_;

my $parents, $level, $relative_dir;
my @relative_dir = ();

# This is the maximum difference between a translated
# document and the original before considering it outdated
$max_versions = $maxdelta || 5;

# This is the maximum difference between a translated
# document and the original before considering it aged
$min_versions = $mindelta || 2;

# Set this to >= 1 to get debugging output.
# Remember, if you checkin to CVS this needs to be set to 0!
$debug = 0;

# This is the language code of the original (to make a link)
$original_lang = $original ? $langs{$original} : "en";
$link = $file;
$link =~ s/\.wml$//;
$link .= ".$original_lang.html";

# This is the directory where the original source is kept
$original_dir = $original ? "$original" : "english";

# some brown paper bag code to generate path to the original CVS/Entries
@full_directory_name = split '/', $WML_SRC_DIRNAME;
$dir = pop @full_directory_name;
while ($dir) {
	# below condition is lame, it only works for webwml and cdimage trees <shrug>
	if ($dir ne "webwml" && $dir ne "cdimage") { $level++; } else { last; }
	push @relative_dir, $dir;
	$dir = pop @full_directory_name;
}
for (; $level > 0; $level--) { $parents .= "../"; }
pop @relative_dir;
@relative_dir = reverse @relative_dir;
$relative_dir = join '/', @relative_dir;

# Read the original CVS/Entries file and extract version from it
open (CVS_ENTRY,"<$parents/$original_dir/$relative_dir/CVS/Entries")
	or die "Couldn't open $parents/$original_dir/$relative_dir/CVS/Entries: $!\n";
while (<CVS_ENTRY>) {
	($version) = $_ =~ m,/\Q$file\E/([\d\.]*),;
	last if $version;
}
close CVS_ENTRY;
if ($version ne "")
{
	print ${file} . "'s original CVS revision is: $version\n"
		if ($debug >= 1);

	@version_numbers = split /\./,$version;
	$major_number = @version_numbers[0];
	$last_number = pop @version_numbers;
	die "Invalid CVS revision for $file: $version\n"
		unless ($major_number =~ /\d+/ && $last_number =~ /\d+/);

	@translation_numbers = split /\./,$translation;
	$major_translated_number = @translation_numbers[0];
	$last_translated_number = pop @translation_numbers;
	die "Invalid translation revision for $file: $translation\n"
		unless ($major_translated_number =~ /\d+/ && $last_translated_number =~ /\d+/);
}

# Here we compare the original version with the translated one and print
# a note for the user if their first or last numbers are too far apart

print "Comparing original $version to translation version $translation\n" if ($debug >= 1);

if ($version eq "")
{
	print qq(<originalgone>)
}
elsif ( $major_number != $major_translated_number ) {
	print qq(<translationoutofdate>)
}
elsif ( $last_number - $last_translated_number >= $max_versions ) {
	print qq(<translationoutofdate>)
}
elsif ( $last_number - $last_translated_number >= $min_versions ) {
	print qq(<translationaged>)
}
}
</perl>

# The call to the subroutine is done here
<: check_translation ("$(translation)","$WML_SRC_FILENAME","$(original)","$(mindelta)","$(maxdelta)") :>

# This template was originally made by Javier Fernández-Sanguino, described
# in a proposal made around last week of August 1999. Please check the
# debian-www mailing list archives and
# webwml/english/devel/website/uptodate.wml for more information on this.
