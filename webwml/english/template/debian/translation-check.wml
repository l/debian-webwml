#use wml::std::tags
#use wml::debian::languages

# This file is used to track when translations go out-of-date, and it is
# used by including this in the head of the translated file:
#
# #use wml::debian::translation-check translation="X.xx"
#
# where X.xx is the current CVS revision number of the file you have
# translated.
#
# There are also some additional parameters that you can use on the #use
# line:
#
#    original="language"
# where  language  is the name of the language you are translating from, if
# not english. The name must correspond to the top-level subdirectory, and
# to the name in languages.wml
#
#    mindelta="number"
# which defines the maximum difference in CVS revisions before the
# translation is considered aged. The default value is 1. For less important
# pages, set it to 2, which means that not every change is considered making
# the translation aged. The value for the <aged/> tag is displayed.
#
#    maxdelta="number"
# which defines the maximum difference in CVS revisions before the
# translation is considered to be outdated (and the value of the <outdated/>
# tag is displayed). The default value is 5. For very important pages, set
# it to be less. A value of 1 means that every change is considered making
# the translation outdated.

# This is the message that is displayed if the translation is aged.
# (min_delta <= difference < max_delta)
<define-tag translationaged>
  [EN:<em>Note:</em> The <a href="$link">original document</a> is newer than this translation.:]
  [AR:<em>Note:</em> The <a href="$link">original document</a> is newer than this translation.:]
  [CA:<em>Nota:</em> El <a href="$link">document original</a> és més nou que aquesta traducció.:]
  [DA:<em>Bemærk:</em> <a href="$link">Originalen</a> er nyere end denne oversættelse.:]
  [DE:<em>Bemerkung:</em> Das <a href="$link">Original</a> ist neuer als diese Übersetzung.:]
  [EL:<em>Óçìåßùóç:</em> To <a href="$link">áõèåíôéêü</a> åßíáé íåşôåñï áğï áõôŞ ôç ìåôÜöñáóç.:]
  [EO:<em>Noto:</em> La <a href="$link">originala paøo</a> estas pli nova ol tiu æi.:]
  [ES:<em>Nota:</em> La <a href="$link">página original</a> es más nueva que esta traducción.:]
  [FI:<em>Huomaa:</em> <a href="$link">Alkuperäinen</a> sivu on tätä suomennosta uudempi.:]
  [FR:<em>Note:</em> Le <a href="$link">document original</a> est plus récent que cette traduction.:]
  [HR:<em>Pa¾nja:</em> <a href="$link">Originalni dokument</a> je noviji od ovog prijevoda.:]
  [HU:<em>Megjegyzés:</em> Az <a href="$link">eredeti oldalt</a> a legutóbbi fordítás óta módosították.:]
  [ID:<em>Catatan:</em> Dokumen ini sudah kadaluwarsa, yang <a href="$link">asli</a> telah dimodifikasi.:]
  [IT:<em>Nota:</em> <a href="$link">L'originale</a> è più recente di questa traduzione.:]
  [JA:<em>Ãí°Õ:</em> ¸¶Ê¸¤Ï¤³¤ÎËİÌõ¤è¤ê¤â¿·¤·¤¯¤Ê¤Ã¤Æ¤¤¤Ş¤¹¡£:]
  [KO:<em>Note:</em> The <a href="$link">original document</a> is newer than this translation.:]
  [NL:<em>Opmerking:</em> Het <a href="$link">origineel</a> is recenter dan de vertaling.:]
  [NO:<em>NB:</em> <a href="$link">Originalen</a> er nyere enn denne oversettelsen.:]
  [PL:<em>Uwaga: <a href="$link">Orygina³</a> jest nowszy ni¿ to t³umaczenie</em>.:]
  [PT:<em>Nota:</em> O <a href="$link">original</a> é mais novo que essa tradução.:]
  [RO:<em>Notã:</em> <a href="$link">Originalul</a> este mai nou decît traducerea.:]
  [RU:<em>úÁÍÅŞÁÎÉÅ:</em> <a href="$link">ïÒÉÇÉÎÁÌ ÜÔÏÇÏ ÄÏËÕÍÅÎÔÁ</a> ÎÏ×ÅÅ, ŞÅÍ ĞÅÒÅ×ÏÄ.:]
  [SV:<em>Observera:</em> <a href="$link">Originalet</a> är nyare än denna översättning.:]
  [TR:<em>Not:</em> Bu belgenin <a href="$link">son hali</a> henüz çevrilmemiş.:]
  [ZH:<em>µù¡G</em>¦¹ºô­¶ªº¤¤¤åÄ¶¥»¤£¤Î­ì­^¤å¥»·s¡C:]
</define-tag>

# This is the message that is displayed if the translation is too old.
# (difference >= max_delta)
<define-tag translationoutofdate>
  [EN:Warning! This translation is too out of date,
      please see the <a href="$link">original</a>.:]
  [AR:Warning! This translation is too out of date,
      please see the <a href="$link">original</a>.:]
  [CA:Advertiment!:Aquesta traducció és massa antiga, si us
      plau vegeu <a href="$link">l'original</a>.:]
  [DA:Advarsel! Denne oversættelse er for gammel,
      benyt venligst <a href="$link">originalen</a>.:]
  [DE:Achtung! Diese Übersetzung ist zu alt,
      benutzen Sie bitte das <a href="$link">Original</a>.:]
  [EL:Ğñïóï÷Ş! ÁõôŞ ç ìåôÜöñáóç åßíáé ğïëı ğáëéÜ,
      ğáñáêáëş äåßôå ôï <a href="$link">áõèåíôéêü êåßìåíï</a>.:]
  [EO:Atentu! Tiu æi traduko estas tro malnova,
      bonvolu viziti la <a href="$link">originalan</a>.:]
  [ES:¡Ojo! Esta traducción está muy desactualizada,
      por favor, consulte el <a href="$link">documento original</a>.:]
  [FI:Varoitus! Tämä suomennos on liian vanha, katso mielummin
      <a href="$link">alkuperäistä sivua</a>.:]
  [FR:Attention : cette traduction n'est plus à jour,
      veuillez vous référer au <a href="$link">document original</a>.:]
  [HR:Pa¾nja! Ovaj prijevod je jako zastario,
      molimo pogledajte <a href="$link">original</a>.:]
  [HU:Figyelem! A fordítás elavult,
      olvasd az <a href="$link">eredetit</a>.:]
  [ID:Peringatan! Translasi untuk dokumen ini sudah terlalu kadaluwarsa, harap lihat dokumen <a href="$link">asli</a>.:]
  [IT:Attenzione! Questa traduzione è ormai datata,
      perciò dai un'occhiata anche alla nuova pagina <a href="$link">originale</a>.:]
  [JA:·Ù¹ğ! ¤³¤ÎËİÌõ¤Ï¸Å²á¤®¤ë¤¿¤á¡¢
      <a href="$link">¸¶Ê¸</a>¤ò¸æÍ÷¤¯¤À¤µ¤¤¡£:]
  [KO:Warning! This translation is too out of date,
      please see the <a href="$link">original</a>.:]
  [NL:Waarschuwing! Deze vertaling is te oud.
      Lees bij voorkeur het <a href="$link">origineel</a>.:]
  [NO:Merk! Denne oversettelsen er utdatert, 
      se <a href="$link">originalen</a>.:]
  [PL:Uwaga! To t³umaczenie jest przestarza³e,
      proszê zwróciæ uwagê na <a href="$link">orygina³</a>.:]
  [PT:Aviso! Essa traduçao está muito desatualizada,
      por favor veja o <a href="$link">original</a>.:]
  [RO:Avertisment! Aceastã traducere este prea neactualizatã,
      vã rugãm sã vedeşi <a href="$link">originalul</a>.:]
  [RU:ğÒÅÄÕĞÒÅÖÄÅÎÉÅ! üÔÏÔ ĞÅÒÅ×ÏÄ ÓÉÌØÎÏ ÕÓÔÁÒÅÌ,
      ĞÏÖÁÌÕÊÓÔÁ ĞÏÌØÚÕÊÔÅÓØ <a href="$link">ÏÒÉÇÉÎÁÌÏÍ</a>.:]
  [SV:Varning! Den här översättningen är för gammal,
      vänligen se <a href="$link">originalet</a>.:]
  [TR:Uyarı! Bu çeviri oldukça eski,
      lütfen belgenin <a href="$link">son hali</a>'ne bakınız.:]
  [ZH:ª`·N¡I¦¹ºô­¶¤¤¤åÄ¶¥»¤Ó¤[¨S¦³§ó·s¤F¡A\
      ½Ğ°Ñ¾\\<a href="$link">³Ì·s­ì­^¤å¥»</a>¡C:]
</define-tag>

# This is the message that is displayed if the referenced original file
# no longer exists.
<define-tag originalgone>
  [EN:<em>Note:</em> The original document of this translation no longer exists.:]
  [AR:<em>Note:</em> The original document of this translation no longer exists.:]
  [CA:<em>Nota:</em> El document original d'aquesta traducció ja no existeix.:]
  [DA:<em>Bemærk:</em> Originalen findes ikke længere.:]
  [DE:<em>Bemerkung:</em> Das Original existiert nicht mehr.:]
  [EL:<em>Note:</em> The original document of this translation no longer exists.:]
  [EO:<em>Noto:</em> La originala paøo ne plu ekzistas.:]
  [ES:<em>Nota:</em> La página original de esta traducción ya no existe.:]
  [FI:<em>Huomaa:</em> Alkuperäistä sivua, josta tämä on käännetty, ei enää ole.:]
  [FR:<em>Note:</em> Le document original n'existe plus.:]
  [HR:<em>Pa¾nja:</em> Originalni dokument za ovaj prijevod vi¹e ne postoji.:]
  [HU:<em>Megjegyzés:</em> Az eredeti oldal már nem létezik.:]
  [ID:<em>Catatan:</em> Dokumen asli untuk terjemahan ini sudah tidak ada lagi.:]
  [IT:<em>Nota:</em> La pagina originale non esiste più.:]
  [JA:<em>Note:</em> ¸¶Ê¸¤Ï¤â¤¦Â¸ºß¤·¤Ş¤»¤ó¡£:]
  [KO:<em>Note:</em> The original document of this translation no longer exists.:]
  [NL:<em>Note:</em> The original document of this translation no longer exists.:]
  [NO:<em>Merk:</em> Originalen til denne oversettelsen fins ikke lenger.:]
  [PL:<em>Note:</em> The original document of this translation no longer exists.:]
  [PT:<em>Nota:</em> O original não existe mais.:]
  [RO:<em>Notã:</em> Originalul nu mai existã.:]
  [RU:<em>úÁÍÅŞÁÎÉÅ:</em> ïÒÉÇÉÎÁÌ ÂÏÌØÛÅ ÎÅ ÓÕİÅÓÔ×ÕÅÔ.:]
  [TR:<em>Not:</em> Bu çevirinin İngilizce'si artık mevcut değil.:]
  [SV:<em>Observera:</em> Originalet existerar inte längre.:]
  [ZH:<strong>µù¡G</strong>¦¹ºô­¶ªº­ì­^¤å¥»¤w¸g¤£¦s¦b¤F¡C:]
</define-tag>

# DO NOT translate anything below here. --------------------------------------

<perl>

sub check_translation {

# Input parameters:
my ($translation, $file, $original, $mindelta, $maxdelta) = @_;

my $parents, $level, $relative_dir, $output;
my @relative_dir = ();

# This is the maximum difference between a translated
# document and the original before considering it outdated
$max_versions = $maxdelta || 5;

# This is the maximum difference between a translated
# document and the original before considering it aged
$min_versions = $mindelta || 1;

# Set this to >= 1 to get debugging output.
# Remember, if you checkin to CVS this needs to be set to 0!
$debug = 0;

# This is the language code of the original (to make a link)
$original_lang = $original ? $langs{$original} : "en";
$link = $file;
$link =~ s/\.wml$//;
$link .= ".$original_lang.html";

# This is the directory where the original source is kept
$original_dir = $original ? "$original" : "english";

# some brown paper bag code to generate path to the original CVS/Entries
@full_directory_name = split '/', $WML_SRC_DIRNAME;
$dir = pop @full_directory_name;
while ($dir) {
	# below condition is lame, it only works for webwml and cdimage trees <shrug>
	if ($dir ne "webwml" && $dir ne "cdimage") { $level++; } else { last; }
	push @relative_dir, $dir;
	$dir = pop @full_directory_name;
}
for (; $level > 0; $level--) { $parents .= "../"; }
pop @relative_dir;
@relative_dir = reverse @relative_dir;
$relative_dir = join '/', @relative_dir;

# Read the original CVS/Entries file and extract version from it
if (open (CVS_ENTRY,"<$parents/$original_dir/$relative_dir/CVS/Entries")) {
    while (<CVS_ENTRY>) {
	($version) = $_ =~ m,/\Q$file\E/([\d\.]*),;
	last if $version;
    }
    close CVS_ENTRY;
} else {
    $version = "1.1";
}
if ($version ne "")
{
	print ${file} . "'s original CVS revision is: $version\n"
		if ($debug >= 1);

	@version_numbers = split /\./,$version;
	$major_number = @version_numbers[0];
	$last_number = pop @version_numbers;
	die "Invalid CVS revision for $file: $version\n"
		unless ($major_number =~ /\d+/ && $last_number =~ /\d+/);

	@translation_numbers = split /\./,$translation;
	$major_translated_number = @translation_numbers[0];
	$last_translated_number = pop @translation_numbers;
	die "Invalid translation revision for $file: $translation\n"
		unless ($major_translated_number =~ /\d+/ && $last_translated_number =~ /\d+/);
}

# Here we compare the original version with the translated one and print
# a note for the user if their first or last numbers are too far apart

print "Comparing original $version to translation version $translation\n" if ($debug >= 1);

$output = '';
if ($version eq "") {
	$output = qq(<originalgone/>)
}
elsif ( $major_number != $major_translated_number ) {
	$output = qq(<strong><translationoutofdate/></strong>)
}
elsif ( $last_number - $last_translated_number >= $max_versions ) {
	$output = qq(<strong><translationoutofdate/></strong>)
}
elsif ( $last_number - $last_translated_number >= $min_versions ) {
	$output = qq(<translationaged/>)
}

if ($output ne "") {
	$output =~ s/^\s+//m; # removes whitespace at the beginning
	$output =~ s/\s+$//m; # removes whitespace at the end
	$output =~ s/:\]\n\[/:\]\[/sg; # removes linebreaks between slices
	$output =~ s/:\]\s+\[/:\]\[/sg; # removes whitespace between slices
	$output =~ s/\n/ /sg; # replaces linebreaks with whitespace
	print "<p>$output";
}

}
</perl>

# The call to the subroutine is done here
{#check_trans#:\
<: check_translation ("$(translation)","$WML_SRC_FILENAME","$(original)","$(mindelta)","$(maxdelta)") :>\
:#check_trans#}

# This template was originally made by Javier Fernández-Sanguino, described
# in a proposal made around last week of August 1999. Please check the
# debian-www mailing list archives and
# webwml/english/devel/website/uptodate.wml for more information on this.
