#use wml::std::tags

<perl>
my (%our_countries, %our_codes, %our_countries_in_english);

my $arg = '';
$arg = "-l $CUR_ISO_LANG" if $CUR_ISO_LANG ne 'en';

foreach (`isoquery $arg`) {
	chomp ;
        my $code = substr($_,0,2);
        $_ =~ s/.*\t//;
	$our_countries{$code} = $_;
	$our_codes{$_} = $code;
}

foreach (`isoquery`) {
        chomp ;
        my $code = substr($_,0,2);
        $_ =~ s/.*\t//;
        $our_countries_in_english{$code} = $_;
}

sub country_list {
  my $ccodepos = shift;
  $ccodepos = 'ccafter' unless (defined($ccodepos));
  foreach $c (sort keys %our_codes) {
    my $code = $our_codes{$c};
    my $label;
    if ($ccodepos eq 'ccafter') {
      $label = "$c [$code]";
    } elsif ($ccodepos eq 'ccbefore') {
      $label = "[$code] $c";
    } else {
      $label = "$code $c";
    }
    print "<option value=\"$code $our_countries_in_english{$code}\">$label</option>\n";
  }
}

# Kept in case it would still be useful, to remove if it's not used
sub country_list_old {
  my $ccodepos = shift;
  $ccodepos = 'ccafter' unless (defined($ccodepos));
  foreach $c (sort keys %our_countries) {
    my $localname = $our_countries{$c};
    my $label;
    if ($ccodepos eq 'ccafter') {
      $label = "$localname [$c]";
    } elsif ($ccodepos eq 'ccbefore') {
      $label = "[$c] $localname";
    } else {
      $label = "$c $localname";
    }
    print "<option value=\"$c $our_countries_in_english{$c}\">$label</option>\n";
  }
}


</perl>
