<perl>

# Very similar to get_recent_list except it looks for the .wml files
# inside subdirectories of the given directory.
sub get_weeklynews_list {
	my ($year, $number, $eng_dir, $match) = @_;
	
	$str="";
	
	opendir(DIR, "$eng_dir/$year");
	@files = grep { /^$match$/ && -f "$eng_dir/$year/$_/index.wml" } readdir(DIR);
	closedir DIR;
	
	$count=0;
	foreach (sort {$b <=> $a} @files) {
		$count++;
		my $num=$_;
		$_="$_/index.wml";
		$trans_title = $_;
		$trans_title =~ s/wml/title/;
		($base)=m:(.*/):;
		open(FILE,"<$year/$_") || open(FILE, "<$year/$trans_title") || open(FILE, "<$eng_dir/$year/$_");
		$title = '';
		$line=<FILE>;
		if ($line =~ /PAGENAME="(.*?)"/) {
			$title=$1;
		}
		if ($title) {
			if (length $num == 1) {
				$num="&nbsp;$num";
			}
			$str.="$num.\t<a href=\"$year/$base\">$title</a><br>\n";
		}
		close FILE;
		if ($count eq $number) { last; }
	}
	close DIR;
	return $str;
}

</perl>
