<perl>
use Time::Local;

# List of weekday names (used in modification dates)
%dow = (
	en => [ 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat' ],
	tr => [ 'Paz', 'Pzt', 'Sa', 'Çar', 'Pr$', 'Cum', 'Cts' ],
	fi => [ 'Su', 'Ma', 'Ti', 'Ke', 'To', 'Pe', 'La' ],
	pt => [ 'Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb' ],
	hr => [ 'nedjelja', 'ponedjeljak', 'utorak', 'srijeda', 'èetvrtak', 'petak', 'subota' ],
	fr => [ 'Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam' ],
	de => [ 'Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag' ],
	it => [ 'dom', 'lun', 'mar', 'mer', 'gio', 'ven', 'sab' ],
	ja => [ '(Æü)', '(·î)', '(²Ð)', '(¿å)', '(ÌÚ)', '(¶â)', '(ÅÚ)' ],
	pl => [ 'ni', 'pon', 'wt', '¶ro', 'czw', 'pt', 'so' ],
	es => [ 'Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab' ],
	da => [ 'S&oslash;n', 'Man', 'Tirs', 'Ons', 'Tors', 'Fre', 'L&oslash;r' ],
	no => [ 'Søn', 'Man', 'Tir', 'Ons', 'Tor', 'Fre', 'Lør' ],
	zh => [ '¤é', '¤@', '¤G', '¤T', '¥|', '¤­', '¤»' ],
	sv => [ 'Sön', 'Mån', 'Tis', 'Ons', 'Tor', 'Fre', 'Lör' ],
	ko => [ 'ìí', 'êÅ', 'ûý', 'â©', 'ÙÊ', 'ÐÝ', '÷Ï' ],
);

# List of month names (used in modification dates, and may be used in news 
# listings)
%moy = (
	en => [ 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
         'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec' ],
	tr => [ 'Ocak', 'Þubat', 'Mart', 'Nisan', 'MayIs', 'Haziran',
	 'Temmuz', 'AGustos', 'EylUl', 'Ekim', 'KasIm', 'AralIk' ],
	fi => [ 'tammi', 'helmi', 'maalis', 'huhti', 'touko',
	 'kesä', 'heinä', 'elo', 'syys', 'loka', 'marras', 'joulu' ],
        pt => [ 'Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
         'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez' ],
	hr => [ 'sijeènja', 'veljaèe', 'o¾ujka', 'travnja', 'svibnja', 'lipnja',
         'srpnja', 'kolovoza', 'rujna', 'listopada', 'studenog', 'prosinca' ],
	fr => [ 'Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun',
         'Jui', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc' ],
	de => [ 'Januar', 'Februar', 'M&auml;rz', 'April', 'Mai', 'Juni', 'Juli',
         'August', 'September', 'Oktober', 'November', 'Dezember' ],
	it => [ 'gen', 'feb', 'mar', 'apr', 'mag', 'giu',
         'lug', 'ago', 'set', 'ott', 'nov', 'dic' ],
	ja => [ '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12' ],
	pl => [ 'sty', 'lut', 'mar', 'kwie', 'maj', 'cze',
         'lip', 'sie', 'wrz', 'pa¼', 'lis', 'gru' ],
	es => [ 'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
         'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic' ],
	da => [ 'Jan', 'Feb', 'Mar', 'Apr', 'Maj', 'Jun',
         'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec' ],
	no => [ 'jan', 'feb', 'mar', 'apr', 'mai', 'jun',
         'jul', 'aug', 'sep', 'okt', 'nov', 'des' ],
	zh => [ '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12' ],
#	zh => [ '¤@¤ë', '¤G¤ë', '¤T¤ë', '¥|¤ë', '¤­¤ë', '¤»¤ë',
#         '¤C¤ë', '¤K¤ë', '¤E¤ë', '¤Q¤ë', '¤Q¤@¤ë', '¤Q¤G¤ë' ],
	sv => [ 'jan', 'feb', 'mar', 'apr', 'maj', 'jun',
         'jul', 'aug', 'sep', 'okt', 'nov', 'dec' ],
	ko => [ '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12' ],
);

# Date format (sprintf) for modification dates. If none is supplied, the
# standard format "Www, Mmm Dd HH:MM:SS UTC Yyyy" is used instead.
%dateform = (
	hr => '"%s, %2d. %s %s., %02d:%02d:%02d %s", $wday, $mday, $mon, 1900+$year, $hour, $min, $sec, "UTC"',
#	tr => '"%s, %2d. %s %s., %02d:%02d:%02d %s", $wday, $mday, $mon, 1900+$year, $hour, $min, $sec, "UTC"',
	fr => '"%s, %2d. %s %s., %02d:%02d:%02d %s", $wday, $mday, $mon, 1900+$year, $hour, $min, $sec, "UTC"',
	zh => '"%s ¦~ %s ¤ë %s ¤é ¬P´Á%s %02d:%02d:%02d %s", 1900+$year, $mon, $mday, $wday, $hour, $min, $sec, "UTC"',
	sv => '"%s %04d-%02d-%02d %02d.%02d.%02d %s", $wday, 1900+$year, $monnr+1, $mday, $hour, $min, $sec, "UTC"',
	no => '"%s %2d. %s %s kl. %02d.%02d.%02d %s", $wday, $mday, $mon, $year, $hour, $min, $sec, "UTC"',
	ja => '"%s Ç¯ %s ·î %s Æü %s %02d:%02d:%02d %s", 1900+$year, $mon, $mday, $wday, $hour, $min, $sec, "UTC"',
#	pl => '""',
	de => '"%s den %d. %s %s um %02d:%02d:%02d Uhr %s", $wday, $mday, $mon, 1900+$year, $hour, $min, $sec, "UTC"'
);

# Date format (sprintf) for news items. If none is supplied, the standard
# format "Dd Mmm Yyyy" is used instead.
%newsdateform = (
	sv => '"%4d-%02d-%02d", $year, $mon, $mday',
	fi => '"%02d. %02d. %04d", $mday, $mon, $year',
	hr => '"%02d. %02d. %04d", $mday, $mon, $year',
	de => '"%02d.%02d.%04d", $mday, $mon, $year',
	ja => '"%04d Ç¯ %02d ·î %02d Æü", $year, $mon, $mday',
	da => '"%02d. %02d. %04d", $mday, $mon, $year',
	no => '"%02d. %s %04d", $mday, $mon_str, $year',
	zh => '"%04d ¦~ %02d ¤ë %02d ¤é", $year, $mon, $mday',
);

sub ctime {
	my ($time, $sec, $min, $hour, $mday, $monnr, $year, $wday, $yday, $isdst, $mon);
	# The last modification time of inputfile in ISO dd-mm-yyyy hh:mm:ss format.
	if (defined $(GEN_TIME)) {
		$WML_GEN_ISOTIME =~ /(..)-(..)-(....) (..):(..):(..)/;
		$time = timelocal($6, $5, $4, $1, $2-1, $3);
	}
	else {
		$WML_SRC_ISOTIME =~ /(..)-(..)-(....) (..):(..):(..)/;
		$time = timelocal($6, $5, $4, $1, $2-1, $3);
	}
	($sec, $min, $hour, $mday, $monnr, $year, $wday, $yday, $isdst) = gmtime($time);
	$wday = $dow{$CUR_ISO_LANG}[$wday];
	$mon = $moy{$CUR_ISO_LANG}[$monnr];
	$str = defined($dateform{$CUR_ISO_LANG}) ? 
		eval("sprintf($dateform{$CUR_ISO_LANG})") :
		sprintf("%s, %s %2d %02d:%02d:%02d %s %04d",
			$wday, $mon, $mday, $hour, $min, $sec, "UTC", 1900+$year);
	return $str;
}

sub newsdate {
	my ($year, $mon, $mday) = split /-/, $_[0];
	# Make sure the date is in the YYYY-MM-DD format
	return $_[0] unless $mday;
	return $_[0] if ($year < 1900);

	$mon_str = $moy{$CUR_ISO_LANG}[$mon - 1];
	return defined($newsdateform{$CUR_ISO_LANG}) ?
	       eval("sprintf($newsdateform{$CUR_ISO_LANG})") :
	       sprintf("%02d %s %04d", $mday, $mon_str, $year);
}
</perl>
