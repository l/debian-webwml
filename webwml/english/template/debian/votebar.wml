#use wml::std::tags
#use wml::debian::languages
#use wml::debian::common_tags
#use wml::debian::openrecode

<define-tag toc-title-formatting endtag="required" whitespace="delete">
   <hrline><h3>%body</h3>
</define-tag>

<define-tag vdate whitespace=delete><toc-add-entry name="date">
  <gettext>Date</gettext></toc-add-entry>
</define-tag>
<define-tag vtimeline whitespace=delete><toc-add-entry name="timeline">
  <gettext>Time Line</gettext></toc-add-entry>
</define-tag>
<define-tag vnominations whitespace=delete><toc-add-entry name="nominations">
  <gettext>Nominations</gettext></toc-add-entry>
</define-tag>
<define-tag vdebate whitespace=delete><toc-add-entry name="debate">
  <gettext>Debate</gettext></toc-add-entry>
</define-tag>
<define-tag vplatforms whitespace=delete><toc-add-entry name="platforms">
  <gettext>Platforms</gettext></toc-add-entry>
</define-tag>
<define-tag vproposer whitespace=delete><toc-add-entry name="proposer">
  <gettext>Proposer</gettext></toc-add-entry>
</define-tag>
<define-tag vproposera whitespace=delete><toc-add-entry name="proposera">
  <gettext>Proposal A Proposer</gettext></toc-add-entry>
</define-tag>
<define-tag vproposerb whitespace=delete><toc-add-entry name="proposerb">
  <gettext>Proposal B Proposer</gettext></toc-add-entry>
</define-tag>
<define-tag vproposerc whitespace=delete><toc-add-entry name="proposerc">
  <gettext>Proposal C Proposer</gettext></toc-add-entry>
</define-tag>
<define-tag vproposerd whitespace=delete><toc-add-entry name="proposerd">
  <gettext>Proposal D Proposer</gettext></toc-add-entry>
</define-tag>
<define-tag vproposere whitespace=delete><toc-add-entry name="proposere">
  <gettext>Proposal E Proposer</gettext></toc-add-entry>
</define-tag>
<define-tag vproposerf whitespace=delete><toc-add-entry name="proposerf">
  <gettext>Proposal F Proposer</gettext></toc-add-entry>
</define-tag>
<define-tag vseconds whitespace=delete><toc-add-entry name="seconds">
  <gettext>Seconds</gettext></toc-add-entry>
</define-tag>
<define-tag vsecondsa whitespace=delete><toc-add-entry name="secondsa">
  <gettext>Proposal A Seconds</gettext></toc-add-entry>
</define-tag>
<define-tag vsecondsb whitespace=delete><toc-add-entry name="secondsb">
  <gettext>Proposal B Seconds</gettext></toc-add-entry>
</define-tag>
<define-tag vsecondsc whitespace=delete><toc-add-entry name="secondsc">
  <gettext>Proposal C Seconds</gettext></toc-add-entry>
</define-tag>
<define-tag vsecondsd whitespace=delete><toc-add-entry name="secondsd">
  <gettext>Proposal D Seconds</gettext></toc-add-entry>
</define-tag>
<define-tag vsecondse whitespace=delete><toc-add-entry name="secondse">
  <gettext>Proposal E Seconds</gettext></toc-add-entry>
</define-tag>
<define-tag vsecondsf whitespace=delete><toc-add-entry name="secondsf">
  <gettext>Proposal F Seconds</gettext></toc-add-entry>
</define-tag>
<define-tag vopposition whitespace=delete><toc-add-entry name="opposition">
  <gettext>Opposition</gettext></toc-add-entry>
</define-tag>
<define-tag vtext whitespace=delete><toc-add-entry name="text">
  <gettext>Text</gettext></toc-add-entry>
</define-tag>
<define-tag vtexta whitespace=delete><toc-add-entry name="texta">
  <gettext>Proposal A</gettext></toc-add-entry>
</define-tag>
<define-tag vtextb whitespace=delete><toc-add-entry name="textb">
  <gettext>Proposal B</gettext></toc-add-entry>
</define-tag>
<define-tag vtextc whitespace=delete><toc-add-entry name="textc">
  <gettext>Proposal C</gettext></toc-add-entry>
</define-tag>
<define-tag vtextd whitespace=delete><toc-add-entry name="textd">
  <gettext>Proposal D</gettext></toc-add-entry>
</define-tag>
<define-tag vtexte whitespace=delete><toc-add-entry name="texte">
  <gettext>Proposal E</gettext></toc-add-entry>
</define-tag>
<define-tag vtextf whitespace=delete><toc-add-entry name="textf">
  <gettext>Proposal F</gettext></toc-add-entry>
</define-tag>
<define-tag vchoices whitespace=delete><toc-add-entry name="choices">
  <gettext>Choices</gettext></toc-add-entry>
</define-tag>
<define-tag vamendmentproposer whitespace=delete><toc-add-entry name="amendmentproposer">
  <gettext>Amendment Proposer</gettext></toc-add-entry>
</define-tag>
<define-tag vamendmentseconds whitespace=delete><toc-add-entry name="amendmentseconds">
  <gettext>Amendment Seconds</gettext></toc-add-entry>
</define-tag>
<define-tag vamendmenttext whitespace=delete><toc-add-entry name="amendmenttext">
  <gettext>Amendment Text</gettext></toc-add-entry>
</define-tag>
<define-tag vamendments whitespace=delete><toc-add-entry name="amendments">
  <gettext>Amendments</gettext></toc-add-entry>
</define-tag>
<define-tag vproceedings whitespace=delete><toc-add-entry name="proceedings">
  <gettext>Proceedings</gettext></toc-add-entry>
</define-tag>
<define-tag vmajorityreq whitespace=delete><toc-add-entry name="majorityreq">
  <gettext>Majority Requirement</gettext></toc-add-entry>
</define-tag>
<define-tag vstatistics whitespace=delete><toc-add-entry name="statistics">
  <gettext>Data and Statistics</gettext></toc-add-entry>
</define-tag>
<define-tag vquorum whitespace=delete><toc-add-entry name="quorum">
  <gettext>Quorum</gettext></toc-add-entry>
</define-tag>
<define-tag vmindiscuss whitespace=delete><toc-add-entry name="mindiscuss">
  <gettext>Minimum Discussion</gettext></toc-add-entry>
</define-tag>
<define-tag vballot whitespace=delete><toc-add-entry name="ballot">
  <gettext>Ballot</gettext></toc-add-entry>
</define-tag>
<define-tag vforum whitespace=delete><toc-add-entry name="forum">
  <gettext>Forum</gettext></toc-add-entry>
</define-tag>
<define-tag voutcome whitespace=delete><toc-add-entry name="outcome">
  <gettext>Outcome</gettext></toc-add-entry>
</define-tag>

<define-tag needsponsors whitespace=delete>
  <gettext>Waiting&nbsp;for&nbsp;Sponsors</gettext>
</define-tag>
<define-tag indiscussion whitespace=delete>
  <gettext>In&nbsp;Discussion</gettext>
</define-tag>
<define-tag votingopen whitespace=delete>
  <gettext>Voting&nbsp;Open</gettext>
</define-tag>
<define-tag decided whitespace=delete>
  <gettext>Decided</gettext>
</define-tag>
<define-tag withdrawn whitespace=delete>
  <gettext>Withdrawn</gettext>
</define-tag>
<define-tag other whitespace=delete>
  <gettext>Other</gettext>
</define-tag>

<define-tag homevote whitespace=delete>
  <gettext>Home&nbsp;Vote&nbsp;Page</gettext>
</define-tag>
<define-tag howto whitespace=delete>
  <gettext>How&nbsp;To</gettext>
</define-tag>
<define-tag submit whitespace=delete>
  <gettext>Submit&nbsp;a&nbsp;Proposal</gettext>
</define-tag>
<define-tag amend whitespace=delete>
  <gettext>Amend&nbsp;a&nbsp;Proposal</gettext>
</define-tag>
<define-tag follow whitespace=delete>
  <gettext>Follow&nbsp;a&nbsp;Proposal</gettext>
</define-tag>
<define-tag read whitespace=delete>
  <gettext>Read&nbsp;a&nbsp;Result</gettext>
</define-tag>
<define-tag vote whitespace=delete>
  <gettext>Vote</gettext>
</define-tag>

<define-tag fonts_sans-serif endtag=required whitespace=delete>
  <font face="$(SANS_SERIF_FONT:-Arial,Helvetica)" %attributes>%body</font>
</define-tag>

<perl>
sub get_issues_list {

my ( $path, $number, $current_dir ) = @_;

$str=""; $proposal=""; $discussion=""; $voting=""; $finished=""; $unknown="";

opendir(DIR, "$current_dir");
@years = grep { /^\d+$/ && -d "$current_dir/$_" } readdir(DIR);
closedir (DIR);

$count = 0;
foreach $year (sort @years) {

  opendir(DIR, "$current_dir/$year");
  @files = grep { /^vote.*.wml$/ && -f "$current_dir/$year/$_" } readdir(DIR);
  @files = sort @files;
  closedir DIR;

  foreach (@files) {
    $count++;
    my $fh = openrecode("$(VOTE)/$year/$_", "$current_dir/$year/$_");
    if ( /(vote.*).wml/ ) {
      $base = $1;
    }
    $title = ''; $status = '';
<protect pass=2>
    foreach $line (<$fh>) {
      if ($line =~ /^<define-tag pagetitle>(.*)<\/define-tag>$/) {
        $title = $1;
      } elsif ($line =~ /^<define-tag status>(.*)<\/define-tag>$/) {
        $status = $1;
      }
</protect>
      
      if ( $title && $status ) {
         $str1 = "<li><a href=\"$(VOTE)/$year/$base\">$title</a></li>\n";
         last;
      } elsif ( $title ) {
         $str1 = "<li><a href=\"$(VOTE)/$year/$base\">$title</a></li>\n";
      }
    }
    if ( $status eq "P" ) {
	$proposal .= $str1;
    } elsif ( $status eq "D" ) {
	$discussion .= $str1;
    } elsif ( $status eq "V" ) {
	$voting .= $str1;
    } elsif ( $status eq "F" ) {
	$finished .= $str1;
    } elsif ( $status eq "W" ) {
	$withdrawn .= $str1;
    } else {
	$unknown .= $str1;
    }
    close $fh;
    if ($count eq $number) { last; }
  }
}
close DIR;

if ( $proposal ne "" ) { 
	$str .= '<li><needsponsors/>';
	$str .= '<ul>';
	$str .= "$proposal";
	$str .= '</ul></li>';
}
if ( $discussion ne "" ) { 
	$str .= '<li><indiscussion/>';
	$str .= '<ul>';
	$str .= "$discussion";
	$str .= '</ul></li>';
}
if ( $voting ne "" ) { 
	$str .= '<li><votingopen/>';
	$str .= '<ul>';
	$str .= "$voting";
	$str .= '</ul></li>';
}
if ( $finished ne "" ) { 
	$str .= '<li><decided/>';
	$str .= '<ul>';
	$str .= "$finished";
	$str .= '</ul></li>';
}
if ( $withdrawn ne "" ) { 
	$str .= '<li><withdrawn/>';
	$str .= '<ul>';
	$str .= "$withdrawn";
	$str .= '</ul></li>';
}
if ( $unknown ne "" ) { 
	$str .= '<li><other/>';
	$str .= '<ul>';
	$str .= "$unknown";
	$str .= '</ul></li>';
}

return $str;
}
</perl>

<div id="leftcol">
<!--UdmComment-->
	<ul class="votemenu">
	<li><home/>
	<ul>
	 <li><a href="$(HOME)/vote/"><homevote/></a></li>
	</ul
	</li>
	<li><howto/>
	<ul>
	<li><a href="$(HOME)/vote/howto_proposal"><submit/></a></li>
	<li><a href="$(HOME)/vote/howto_proposal#amend"><amend/></a></li>
	<li><a href="$(HOME)/vote/howto_follow"><follow/></a></li>
	<!-- <li><a href="howto_vote">&bull;&nbsp;<vote/></a></li>
		<li>*<a href="howto_result"><read/></a></li> -->
	</ul>
	</li>
	<:= get_issues_list("$(CUR_YEAR)", '0', "$(ENGLISHDIR)/vote") :>
	</ul>
	<!--/UdmComment-->
</div> <!-- end leftcol -->
<div id="maincol">
  {#check_trans#}

  {#mainbody#}

</div> <!-- end maincol -->

{#mainbody#:
