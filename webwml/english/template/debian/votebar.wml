#use wml::std::tags
#use wml::debian::languages
#use wml::debian::common_tags
#use wml::debian::openrecode

<define-tag needsponsors whitespace=delete>
  <gettext>Waiting&nbsp;for&nbsp;Sponsors</gettext>
</define-tag>
<define-tag indiscussion whitespace=delete>
  <gettext>In&nbsp;Discussion</gettext>
</define-tag>
<define-tag votingopen whitespace=delete>
  <gettext>Voting&nbsp;Open</gettext>
</define-tag>
<define-tag decided whitespace=delete>
  <gettext>Decided</gettext>
</define-tag>
<define-tag withdrawn whitespace=delete>
  <gettext>Withdrawn</gettext>
</define-tag>
<define-tag other whitespace=delete>
  <gettext>Other</gettext>
</define-tag>

<define-tag homevote whitespace=delete>
  <gettext>Home&nbsp;Vote&nbsp;Page</gettext>
</define-tag>
<define-tag howto whitespace=delete>
  <gettext>How&nbsp;To</gettext>
</define-tag>
<define-tag submit whitespace=delete>
  <gettext>Submit&nbsp;a&nbsp;Proposal</gettext>
</define-tag>
<define-tag amend whitespace=delete>
  <gettext>Amend&nbsp;a&nbsp;Proposal</gettext>
</define-tag>
<define-tag follow whitespace=delete>
  <gettext>Follow&nbsp;a&nbsp;Proposal</gettext>
</define-tag>
<define-tag read whitespace=delete>
  <gettext>Read&nbsp;a&nbsp;Result</gettext>
</define-tag>
<define-tag vote whitespace=delete>
  <gettext>Vote</gettext>
</define-tag>

<define-tag fonts_sans-serif endtag=required whitespace=delete>
  <font face="$(SANS_SERIF_FONT:-Arial,Helvetica)" %attributes>%body</font>
</define-tag>

<perl>
sub get_issues_list {

my ( $path, $number, $current_dir ) = @_;

$str=""; $proposal=""; $discussion=""; $voting=""; $finished=""; $unknown="";

opendir(DIR, "$current_dir");
@years = grep { /^\d+$/ && -d "$current_dir/$_" } readdir(DIR);
closedir (DIR);

$count = 0;
foreach $year (sort @years) {

  opendir(DIR, "$current_dir/$year");
  @files = grep { /^vote.*.wml$/ && -f "$current_dir/$year/$_" } readdir(DIR);
  @files = sort @files;
  closedir DIR;

  foreach (@files) {
    $count++;
    my $fh = openrecode("$year/$_", "$current_dir/$year/$_");
    if ( /(vote.*).wml/ ) {
      $base = $1;
    }
    $title = ''; $status = '';
<protect pass=2>
    foreach $line (<$fh>) {
      if ($line =~ /^<define-tag pagetitle>(.*)<\/define-tag>$/) {
        $title = $1;
      } elsif ($line =~ /^<define-tag status>(.*)<\/define-tag>$/) {
        $status = $1;
      }
</protect>
      
      if ( $title && $status ) {
         $str1 = "&#149;&nbsp;<a href=\"$(VOTE)/$year/$base\">$title</a><br />\n";
         last;
      } elsif ( $title ) {
         $str1 = "&#149;&nbsp;<a href=\"$(VOTE)/$year/$base\">$title</a><br />\n";
      }
    }
    if ( $status eq "P" ) {
	$proposal .= $str1;
    } elsif ( $status eq "D" ) {
	$discussion .= $str1;
    } elsif ( $status eq "V" ) {
	$voting .= $str1;
    } elsif ( $status eq "F" ) {
	$finished .= $str1;
    } elsif ( $status eq "W" ) {
	$withdrawn .= $str1;
    } else {
	$unknown .= $str1;
    }
    close $fh;
    if ($count eq $number) { last; }
  }
}
close DIR;

if ( $proposal ne "" ) { 
	$str .= '<p><fonts_sans-serif><b><needsponsors/></b></fonts_sans-serif><br />';
	$str .= "<small>$proposal</small></p>";
}
if ( $discussion ne "" ) { 
	$str .= '<p><fonts_sans-serif><b><indiscussion/></b></fonts_sans-serif><br />';
	$str .= "<small>$discussion</small></p>";
}
if ( $voting ne "" ) { 
	$str .= '<p><fonts_sans-serif><b><votingopen/></b></fonts_sans-serif><br />';
	$str .= "<small>$voting</small></p>";
}
if ( $finished ne "" ) { 
	$str .= '<p><fonts_sans-serif><b><decided/></b></fonts_sans-serif><br />';
	$str .= "<small>$finished</small></p>";
}
if ( $withdrawn ne "" ) { 
	$str .= '<p><fonts_sans-serif><b><withdrawn/></b></fonts_sans-serif><br />';
	$str .= "<small>$withdrawn</small></p>";
}
if ( $unknown ne "" ) { 
	$str .= '<p><fonts_sans-serif><b><other/></b></fonts_sans-serif><br />';
	$str .= "<small>$unknown</small></p>";
}

return $str;
}
</perl>

<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr>
  <td valign="top">
  <table bgcolor="#BBDDFF" border="0" cellpadding="0" cellspacing="0" width="100%">
  <tr>
	<td colspan="3" valign="top" width="100%">
	  <img src="$(PICS)/blue-upperleft.png" align="left" border="0" hspace="0" vspace="0" />
	  <img src="$(PICS)/blue-upperright.png" align="right" border="0" hspace="0" vspace="0" />
	</td>
  </tr>
  <tr>
	<td>&nbsp;</td>
	<td valign="top" width=<ifeq "$(MENUWIDTH)" "" "140" "$(MENUWIDTH)"/>>
        <!--UdmComment-->	
		<p><fonts_sans-serif><b><home/></b></fonts_sans-serif><br />
			<small>
			&#149;&nbsp;<a href="$(HOME)/vote/"><homevote/></a><br />
			</small>
		<p><fonts_sans-serif><b><howto/></b></fonts_sans-serif><br />
			<small>
			&#149;&nbsp;<a href="howto_proposal"><submit/></a><br />
			&#149;&nbsp;<a href="howto_proposal#amend"><amend/></a><br />
			&#149;&nbsp;<a href="howto_follow"><follow/></a><br />
			<!-- &nbsp;<a href="howto_vote">&#149;&nbsp;<vote/></a><br />
			&nbsp;<a href="howto_result"><read/></a><br /> -->
			</small>
		</p>
		<:= get_issues_list("$(CUR_YEAR)", '0', "$(ENGLISHDIR)/vote") :>
	<!--/UdmComment-->
	</td>
	<td>&nbsp;</td>
  </tr>
  <tr>
	<td colspan="3" valign="bottom" width="100%">
	  <img src="$(PICS)/blue-lowerleft.png" align="left" border="0" hspace="0" vspace="0" />
	  <img src="$(PICS)/blue-lowerright.png" align="right" border="0" hspace="0" vspace="0" />
	</td>
  </tr>
  </table>
  &nbsp;&nbsp;&nbsp;
  </td>

  <td valign="top">
  <br />

  {#check_trans#}

  {#mainbody#}

  </td>
</tr>
</table>

{#pre_footer#:
<!--UdmComment-->
<hrlinehidden/>
<:= languages_footer() :>
:#pre_footer#}

{#mainbody#:
