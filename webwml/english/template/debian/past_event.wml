#use wml::debian::basic title="Debian GNU/Linux &mdash; Upcoming Attractions"
#use wml::debian::languages

<perl>
#############################################################################
# grabs the date and title of the last $number news items from directory $path.
# If $number is zero then all the news items are shown.
sub get_recent_list 
{
  my ( $path, $number, $current_dir, $match ) = @_;

  opendir(DIR, "$current_dir/$path");
  @files = grep { /^$match.wml$/ && -f "$current_dir/$path/$_" } readdir(DIR);
  @files = sort {$b cmp $a} @files;
  closedir DIR;

	$str = '<TR><TD>(none)</TD></TR>';

  $count = 0;
  foreach (@files) 
  {
     $count++;
     open(FILE, "<$path/$_") || open(FILE, "<$current_dir/$path/$_");
     if ( /($match).wml/ ) 
	 {
        $base = $1;
     }
     $title = ''; $date = ''; $contact = ''; $email = ''; $desc = '';
     foreach $line (<FILE>) 
	 {
        if ($line =~ /^<define-tag pagetitle>(.*)<\/define-tag>$/) 
		{
           $title = $1;
        }
        elsif ($line =~ /^<define-tag date>(.*)<\/define-tag>$/) 
		{
           $date = $1;
        }
        elsif ($line =~ /^<define-tag contact>(.*)<\/define-tag>$/) 
		{
           $contact = $1;
        }
        elsif ($line =~ /^<define-tag email>(.*)<\/define-tag>$/) 
		{
           $email = $1;
        }
        elsif ($line =~ /^<define-tag desc>(.*)<\/define-tag>$/) 
		{
           $desc = $1;
        }
		if ($title && $date) 
		{
           $str = "<tt>[$date]</tt> <strong><a href=\"$path/$base\">$title</a></strong><br>\n";
           last;
		}
		elsif ($title && $contact && $email && $desc)
		{
           $str = "<TR><TD><A HREF=\"$path/$base\">$title</A></TD><TD><A HREF=\"mailto:$email\">$contact</A></TD><TD>$desc</TD></TR>\n";
		   last;
		}
		elsif ($title && $contact && $desc)
		{
           $str = "<TR><TD><A HREF=\"$path/$base\">$title</A></TD><TD>$contact</TD><TD>$desc</TD></TR>\n";
		}
     }
     close FILE;
     if ($count eq $number) { last; }
  }
close DIR;
return $str;
}

#############################################################################
# grabs the date and title of the last $number news items from directory $path.
# If $number is zero then all the news items are shown.
sub make_link 
{
  	my ( $url, $text, $temp ) = @_;
	
	if ( $temp eq 'yes' )
	{
		$str = "$text - $url (link may nolonger be valid)";
	}
	else
	{
		$str = "<A HREF=\"$url\">$text</A>";
	}
	return $str
</perl>

<HR>
<H2><pagetitle></H2>
	<STRONG>When:</STRONG>  <when><BR>
	<STRONG>Where:</STRONG>  <where><BR>
	<STRONG>More Info:</STRONG><A HREF="<infolink>">Web Page</A><BR>

<HR>
<intro>

<HR>
<H2>Debian Involvement</H2>
<involve>

<TABLE>
	<TR><TH>Project</TH><TH>Coordinator</TH><TH>Description</TH></TR>
	<:= get_recent_list ( '<abbr>', '0', '$(ENGLISHDIR)/events/<year>', 'project-\w+' ) :>
</TABLE>

<HR>
<H2>Latest News</H2>
<:= get_recent_list ( '<abbr>', '0', '$(ENGLISHDIR)/events/<year>', 'news-\d+\w*' ) :>

<HR>
<H2>Related Links</H2>
<<mainbody>>

<:= languages() :>
#use wml::debian::footer

..mainbody>>
