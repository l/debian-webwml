#use wml::std::tags
#use wml::debian::common_translation


<define-tag eventtitle whitespace=delete>
  <gettext>Upcoming Attractions</gettext>
</define-tag>
<define-tag notvalid whitespace=delete>
  <gettext>link may no longer be valid</gettext>
</define-tag>
<define-tag langwhen whitespace=delete>
  <gettext>When</gettext>
</define-tag>
<define-tag langwhere whitespace=delete>
  <gettext>Where</gettext>
</define-tag>
<define-tag langinfo whitespace=delete>
  <gettext>More Info</gettext>
</define-tag>
<define-tag debinvolve whitespace=delete>
  <gettext>Debian Involvement</gettext>
</define-tag>
<define-tag maincoordinator whitespace=delete>
  <gettext>Main Coordinator</gettext>
</define-tag>
<define-tag projcoordinator whitespace=delete>
  <gettext><th>Project</th><th>Coordinator</th></gettext>
</define-tag> 
<define-tag relatedlinks whitespace=delete>
  <gettext>Related Links</gettext>
</define-tag>
<define-tag latestnews whitespace=delete>
  <gettext>Latest News</gettext>
</define-tag>

# Do NOT translate anything below this point. If you feel something needs to
# be modified, write to debian-www list.

<perl>
#############################################################################
# grabs the date and title of the last $number news items from directory $path.
# If $number is zero then all the news items are shown.
sub get_event_stuff {
  my ( $path, $number, $current_dir, $match ) = @_;

  opendir(DIR, "$current_dir/$path");
  @files = grep { /^$match.wml$/ && -f "$current_dir/$path/$_" } readdir(DIR);
  @files = sort {$b cmp $a} @files;
  closedir DIR;

	$str = '<tr><td>(<none>)</td></tr>';

  $count = 0;
  foreach (@files) 
  {
     $count++;
     open(FILE, "< $path/$_") || open(FILE, "< $current_dir/$path/$_");
     if ( /($match).wml/ ) 
	 {
        $base = $1;
     }
     $title = ''; $date = ''; $contact = ''; $email = ''; $desc = '';
     $startdate = ''; $enddate = '';
     <protect pass=2>
     foreach $line (<FILE>) 
	 {
        if ($line =~ /^<define-tag pagetitle>(.*)<\/define-tag>$/) 
		{
           $title = $1;
        }
        elsif ($line =~ /^<define-tag date>(.*)<\/define-tag>$/) 
		{
           $date = $1;
        }
        elsif ($line =~ /^<define-tag startdate>(.*)<\/define-tag>$/) 
		{
           $startdate = $1;
        }
        elsif ($line =~ /^<define-tag enddate>(.*)<\/define-tag>$/) 
		{
           $enddate = $1;
        }
        elsif ($line =~ /^<define-tag contact>(.*)<\/define-tag>$/) 
		{
           $contact = $1;
        }
        elsif ($line =~ /^<define-tag email>(.*)<\/define-tag>$/) 
		{
           $email = $1;
        }
        elsif ($line =~ /^<define-tag desc>(.*)<\/define-tag>$/) 
		{
           $desc = $1;
        }
     </protect>
		if ($startdate && $enddate)
		{
			$date = &daterange($startdate, $enddate);
		}
		if ($title && $date) 
		{
           $str = "<tt>[$date]</tt> <strong><a href=\"$path/$base\">$title</a></strong><br />\n";
           last;
		}
		elsif ($title && $contact && $email && $desc)
		{
           $str = "<tr><td><a href=\"$path/$base\">$title</a></td><td><a href=\"mailto:$email\">$contact</a></td><td>$desc</td></tr>\n";
		   last;
		}
		elsif ($title && $contact && $desc)
		{
           $str = "<tr><td><a href=\"$path/$base\">$title</a></td><td>$contact</td><td>$desc</td></tr>\n";
		}
     }
     close FILE;
     if ($count eq $number) { last; }
  }
close DIR;
return $str;
}

# this particular function doesn't appear to be used anywhere (?!)
sub make_link 
{
  	my ( $url, $text, $temp ) = @_;
	
	if ( $temp eq 'yes' ) {
		$str = "$text - $url (link may no longer be valid)";
	} else {
		$str = "<a href=\"$url\">$text</a>";
	}
	return $str
}
</perl>
