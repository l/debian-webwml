#use wml::debian::template title="Setting up an FTP Mirror"

<p>Mirroring is the same for both official and unofficial sites.
Once a mirror is set up the mirror should be <a href="submit">registered with Debian</a>
in order to get included in the <a href="../misc/README.mirrors">mirror list</a>.
Submissions can be done using our <A href="submit">simple web form</a>.
Any problems or enquiries can be sent to <A href="mailto:mirrors@debian.org">mirrors@debian.org</A>.

<h3>Anonymous rsync</h3>
The recommended method of mirroring is with rsync.

<p>You can use <a href="anonftpsync">this script</a> to mirror the archive.
Follow the directions in the script to set up mirroring.
Sites in the <a href="mirrors_full">full list of mirrors</a> that use '<kbd>Type: Push-*</kbd>'
should be good to mirror from.

<h3>Push Mirror</h3>
Push mirroring is a form of mirroring using rsync that we have developed to minimize the
time it takes for changes to the archive to reach mirrors. Push mirroring uses
an ssh trigger to tell the client mirror when to update itself. This method is
quite secure as ssh is configured to run only a single command. Also, mirroring is still
'pull' so it is not possible to corrupt the contents of the archive via a forged push mirror.

<p>Some mirror administrators have shown some reluctance to using this method of
mirroring due to fears that the method may open their machine to invasion.
This is simply not true. For a more detailed description of how this works
and why it is secure see <a href="explain">this page</a>.

<p>Push mirroring takes a little more effort to set up since the maintainers of the
upstream and downstream mirror must exchange information. The benefit is that
the upstream mirror initiates the mirror process immediately after its archive has
been updated. This allows changes to the archive to propagate extremely quickly.

<p>It is best to set this up using the account of an ordinary user, not root.
The contents of the public ssh key given to you by the upstream mirror should be
placed in <kbd>~&lt;user&gt;/.ssh/authorized_keys</kbd>.

<p>The files <a href="ftpsync">ftpsync</a> and <a href="ftpsync.conf">ftpsync.conf</a>
will be needed. Edit ftpsync.conf and follow the directions in there using the information
provided to you by the upstream mirror.

<p>If you are becoming a Push-Primary, you will need the
<a href="identity.pub.master.ftp">public ssh key for the ftp archive</a>.

<p>To push mirror the non-US archive, you will need the files <a
href="ftpsync-non-US">ftpsync-non-US</a> and <a
href="ftpsync-non-US.conf">ftpsync-non-US.conf</a>.  The files have
different names so that you may use the same account to mirror both
archives.  If you are becoming a non-US Push-Primary, you will need
the <a href="identity.pub.non-US.ftp">public ssh key for the non-US
ftp archive</a>.

<h3>Anonymous FTP Using 'mirror'</h3>
<p>Anonymous FTP was the standard method of mirroring for a long time.
For this, the program 'mirror' works well on the debian archive.
As you probably guessed, 'mirror' is available as a Debian package.
If you have installed the Debian package, there is a sample script for mirroring
the ftp archive in /etc/mirror/packages/ftp.debian.org .

<h3>wget</h3>
While <kbd>wget</kbd> works well for mirroring small sites, it is not as configurable as
mirror or rsync so is not recommended for this job.

<h3>When to Mirror</h3>
If you are being push mirrored, then you don't need to worry about this.
If not, and the site you choose to mirror uses rsync, then you should take a
look in <kbd>project/trace/</kbd> in the Debian archive of the mirror site
for a file with the name of that site. The file should contain the time that
the mirror last finished. Add some time, say 1 hour, to that time and mirror
then.

<p>The easiest way to automatically have the mirror run every day is to use
cron. See <kbd>man crontab</kbd> for details.

