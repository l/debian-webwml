#use wml::debian::template title="Setting up an FTP Mirror"
#use wml::debian::toc

<p>Mirroring is the same for both unofficial and
<a href="official">official</a> sites.

<p>Once a mirror is set up the mirror should be <a href="submit">registered with Debian</a>
in order to get included in the <a href="list">mirror list</a>.
Submissions can be done using our <A href="submit">simple web form</a>.

<p>Any problems or enquiries can be sent to <A href="mailto:mirrors@debian.org">mirrors@debian.org</A>.
</p>

<toc-display/>

<toc-add-entry name="wherefrom">Where to mirror from</toc-add-entry>

<p>Many people seem to think that <code>ftp.debian.org</code> is the
canonical location of Debian packages and that it will be best for them
to mirror from that site. This is <strong>not true</strong>.
<code>ftp.debian.org</code> is merely one of several servers that get
updated from an internal Debian server.</p>

<p>Any of the servers in the <a href="list-full">full list of mirrors</a>
that have the '<kbd>Type: Push-Primary</kbd>' tag should be good to mirror
from.</p>

<p>For you, there is practically no difference between mirroring from that
server and mirroring from another <em>Push-Primary</em> mirror. On the other
hand, if many people use ftp.debian.org (and unfortunately, they do), this
wastes the donated bandwidth.</p>

<toc-add-entry name="methods">Methods of mirroring</toc-add-entry>

<p>The recommended method of mirroring is with rsync.

<p>Note: while <kbd>wget</kbd> works well for mirroring small sites, it is
not as configurable as rsync or 'mirror' so is not recommended for this job.

<h3>Anonymous rsync</h3>

<p>You can use <a href="anonftpsync">this script</a> to mirror the archive.
Follow the directions in the script to set up mirroring.

<h3>Rsync with authentication, from a push mirror</h3>

<p>Push mirroring is a form of mirroring using rsync that we have developed
to minimize the time it takes for changes to the archive to reach mirrors.
The server mirror uses an ssh trigger to tell the client mirror to update
itself.

<p>Push mirroring is necessary to keep multiple servers in synchronization
(such as servers in DNS round-robin aliases like <tt>ftp.us.debian.org</tt>),
and we commonly use it for our first and second tier mirrors. For "normal"
mirrors, this method requires a lot of effort to set up which doesn't
actually pay off compared to a well tuned cron job.</p>

<p>The method is quite secure as ssh is configured to run only a single
command. Also, mirroring is still `pull' so it is <strong>not</strong>
possible to corrupt the contents of the archive via a forged push mirror.
Some mirror administrators have shown some reluctance to using this method of
mirroring due to fears that the method may open their machine to invasion.
This is simply <strong>not</strong> true.

<p>For a more detailed description of how this works, why it is secure, and
how to set a push mirror, please see <a href="push_mirroring">the complete
explanation</a>.

<h3>Anonymous FTP Using 'mirror'</h3>

<p>Anonymous FTP was the standard method of mirroring for a long time.
For this, the program 'mirror' works well on the Debian archive.
As you probably guessed, 'mirror' is available as a Debian package.
If you have installed the Debian package, there is a sample script for mirroring
the ftp archive in /etc/mirror/packages/ftp.debian.org .

<toc-add-entry name="partial">Partial mirroring</toc-add-entry>

<p>Considering the already <a href="size">large size of Debian archive</a>,
some people prefer to mirror only parts of it they need. If you want to
exclude something, you should exclude architectures.</p>

<p>With <a href="anonftpsync">anonftpsync</a>, this can be done by editing
the EXCLUDE variable. You can also use specially written scripts, like
<a href="http://packages.debian.org/unstable/net/debmirror.html">debmirror</a>
(by Joey Hess and Joerg Wendland) or
<a href="http://people.debian.org/~absurd/absurd_debmirror/">absurd_debmirror</a>
(by Stephan Suerken). If you feel
that something should be added to these, please contact the authors (contact
information should be enclosed in the scripts themselves).

<p>We strongly advise against excluding the <tt>project/</tt>, <tt>doc/</tt>
and other subdirectories. Usually these are minor in size and yet useful to
users.</p>

<toc-add-entry name="when">When to mirror</toc-add-entry>

<p>The main archive gets updated every 24 hours.

<p>If your site is being push mirrored, then you don't need to worry about this.
If not, and the site you choose to mirror uses rsync, then you should take a
look in <kbd>project/trace/</kbd> in the Debian archive of the mirror site
for a file with the name of that site. The file should contain the time that
the mirror last finished. Add some time, say 1 hour, to that time and mirror
then.

<p>The easiest way to automatically have the mirror run every day is to use
cron. See <kbd>man crontab</kbd> for details.

<toc-add-entry name="settings">Recommended additional settings</toc-add-entry>

<p>If you are going to make the Debian mirror available through HTTP, please
add the following settings to your Apache configuration (presuming, of
course, you will use Apache) for the directory indices:

<pre>
&lt;directory /org/ftp.debian.org/ftp&gt;
   IndexOptions NameWidth=* +SuppressDescription
   DirectoryIndex .
&lt;/directory&gt;
</pre>

<p>(replace <code>/org/ftp.debian.org/ftp</code> with the name of the
directory where you keep the mirror)
