#use wml::debian::template title="Mirrors of the Debian web site"
#use wml::debian::toc
#include "$(ENGLISHDIR)/mirror/webmirrors.data"

<toc-display />

<hrline />

<toc-add-entry name="whynot">Why we don't need more web mirrors</toc-add-entry>

<p>Our web site mirrors require maintenance (a bit more than the FTP site
mirrors, even, since you need to change Apache config files every now and
then) and cost the sponsors resources. However, due to the nature of web
pages, which you don't need to download regularly and for which you don't
care much if they arrive at 2kbps or at 30kbps since they are quite small,
the question of whether having many web site mirrors is useful arises.
</p>

<p>There were times when the Internet connections over the world weren't
fast, and e.g. getting to www.debian.org from another continent was painful
and much slower than a typical modem connection. So we organized mirroring
and several web site mirrors came to existence. Ten (or eleven, if you count
Turkey) of them are in Europe.
</p>

<p>However, today we have blazing fast network links, especially in Europe,
so there is hardly any need for this many mirrors. In fact, due to the
increased speed of network links between Europe and America, it's not even
slow to access www.debian.org from Europe.
</p>

<p>That is basically why we don't need any more web site mirrors, especially
not on continents where there are already mirrors in place. Please respect
our wishes. Thank you for your cooperation.
</p>

<p>If you have any questions, send mail to
<a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.
</p>

<hrline />

<toc-add-entry name="ref">Reference for existing mirrors</toc-add-entry>

<p><strong>The information below this point is provided only for reference
to the maintainers of existing mirrors.</strong>
</p>


<h3>Mirroring process</h3>

<p>The recommended method of mirroring is with rsync. There is no anonymous
access to the web site files. You can set up authenticated access with the
maintainer of the site you wish to mirror from, please send email to
<a href="mailto:mirrors@debian.org">mirrors@debian.org</a>.
</p>

<p>The mirroring is a <q>pull</q> process, i.e. the client requests the data from
the server at their own convenience. To set this up, you can use the
<a href="websync">websync script</a> and <a href="websync.conf">its
configuration file</a>, which can be run from crontab, and which will do
everything automatically. Follow the directions in the script to make sure
everything works fine.</p>


<h4>Mirroring from a push mirror</h4>

<p>Push mirroring is a form of mirroring using rsync that we have developed
to minimize the time it takes for changes to the archive to reach mirrors.
The server mirror uses an ssh trigger to tell the client mirror to update
itself.
</p>

<p>This method is quite secure as ssh is configured to run only a single
command. Also, mirroring is still <q>pull</q> so it is <strong>not</strong>
possible to corrupt the contents of the archive via a forged push mirror.
Some mirror administrators have shown some reluctance to using this method of
mirroring due to fears that the method may open their machine to invasion.
This is simply <strong>not</strong> true.
</p>

<p>For a more detailed description of how this works, why it is secure, and
how to set a push mirror, please see <a href="push_mirroring">the complete
explanation</a>.
</p>


<h3>When to mirror</h3>

<p>The main site gets updated approximately every four hours.</p>

<p>If your site is being push mirrored, then you don't need to worry about
this. If not, you should calculate the mirroring time for your site
according to the dates on timestamp files in
<code>/mirror/timestamps/</code> directory of the web site mirror. Add some
time, say half an hour, to that time and mirror then.
</p>

<p>The easiest way to automatically have the mirror run every day is to use
cron. See <kbd>man crontab</kbd> for details.
</p>


<h3>Advertising the sponsor of the mirror</h3>

<p>If you wish, you may replace the image <code>sponsor_img.jpg</code> by an
(unobtrusive) logo of your own company or organisation, and make
<code>sponsor.html</code> a redirect to your own homepage.  By default, both of
those files are not mirrored. The defaults are named
<code>sponsor.deb.html</code> and <code>sponsor.deb.jpg</code>; although you
may use these default files, we encourage you to provide your own image.  The
suggested maximum size for your logo is 120x60px.</p>

<p>Since <a href="#cn">content negotiation</a> is being used on the web pages
to select the preferred language, you may even provide
<code>sponsor.html</code> in different languages. To do this you simply create
sponsor.&lt;lang&gt;.html for each &lt;lang&gt; you would like.
</p>

<p>Make sure you add any files you don't want overwritten to the exclude list
for mirroring.
</p>


<h3>Configuring the web server</h3>


<h4>Various Web Server Changes</h4>

<p>If your machine is running Debian, it was decided to break Debian policy
and use <code>/doc</code> in the web pages.  This means you should comment
out the <q><code>Alias /doc/ /usr/share/doc/</code></q> line from your
<code>/etc/apache/srm.conf</code> file.
</p>

<p>Note: all of our CGI scripts are run centrally on cgi.debian.org, so you
don't need to worry about them.
</p>


<h4><a name="cn">Content Negotiation</a></h4>

<p>Content Negotiation is a method which lets a browser negotiate with a
server the type of document that should be served. While there are a number
of uses for this, the most common is to negotiate what language a document
should be served in. Using this will allow Debian to serve its pages in
multiple languages in a (technically) very elegant fashion.
</p>

<p>For those who are using Apache, the change is almost trivial.
Simply add this option:
</p>

<pre>
Options +Multiviews   
</pre>

<p>to the <code>&lt;Directory&gt;</code> section for the Debian web pages in your
<kbd>/etc/apache/access.conf</kbd> file, and restart the server.
</p>

<p>Additionally, you need to make sure that the server can handle all the
languages that will be on the web site. This is done using the
<kbd>AddLanguage</kbd> tag. The following is a list of those languages
already used - expect to add more later:
</p>

<pre>
  AddLanguage en .en
<:
foreach $l (keys %langs) { push @codes, $langs{$l}; }
foreach $c (sort @codes) { print "  AddLanguage $c .$c\n" if (($c ne "en") && ($c ne "zh")); }
:>  \
  AddLanguage pt-br .pt
  AddLanguage nb .nb
  AddLanguage zh-CN .zh-cn
  AddLanguage zh-HK .zh-hk
  AddLanguage zh-TW .zh-tw
</pre>

<p>Due to a bug in apache the wrong language can be served in some
circumstances, so it is a good idea to add every language served to
the LanguagePriority option, like this:
</p>

<pre>
<:
print "LanguagePriority en fr es ";
foreach $c (sort @codes) { print "$c " if (($c ne "en") && ($c ne "fr") && ($c ne "es") && ($c ne "zh")); }
print "pt-br nb zh-CN zh-HK zh-TW\n";
:>\
</pre>

<p>In order to avoid serving content-negotiated files with wrong charset,
make sure that the <code>AddDefaultCharSet</code> setting is either
commented out or set to <q><code>Off</code></q>.
</p>

<p>If using apache 1, in order to serve directory index files correctly, you
will probably need to modify the <code>DirectoryIndex</code> entry in
<code>/etc/apache/srm.conf</code>. This won't work with apache 2 though.
The following should be sufficient for apache 1:
</p>

<pre>
DirectoryIndex index index.html
</pre>

<p>To send the correct Content-Type header for favicon.ico, Apache
should be instructed to use the image/x-icon type, like this:</p>

<pre>
AddType image/x-icon .ico
</pre>

<p>To send the correct Context-Type header for RSS feeds, Apache
should be instructed to use the application/rss+xml type, like
this:</p>

<pre>
AddType application/rss+xml .rdf
</pre>

<p>To send the correct Content-Type header for the Spanish
translations of HTML, PDF, and plain text files, Apache should be
instructed to use the correct types, like this:</p>

<pre>
&lt;Files *.html.es>
  ForceType text/html
&lt;/Files>

&lt;Files *.pdf.es>
  ForceType application/pdf
&lt;/Files>

&lt;Files *.txt.es>
  ForceType text/plain
&lt;/Files>
</pre>

<p>To avoid problems with content-negotiation with the content under
<a href="../events/">/events</a>, calendar files need to be assigned a
lower priority than text/html content:</p>

<pre>
AddType text/calendar;qs=0.9 .ics
</pre>


<h4>Redirections</h4>

<p>Because some parts of the web site were beginning to be too large to be
mirrored by most sites, we have separated them from the main site. Although
most links should be converted to use the new locations, you're welcome to
add a redirect to another site so no links are broken. This can be done in
<kbd>/etc/apache/srm.conf</kbd>. For example:
</p>

<pre>
Redirect /Lists-Archives http://lists.debian.org/
Redirect /search http://search.debian.org
Redirect /Packages http://packages.debian.org
Redirect /lintian http://lintian.debian.org
</pre>

<h4>Virtual hosts</h4>

<p>The Debian website, accessed through <a
href="$(HOME)">www.debian.org</a> and under several other names, uses a
GeoDNS setup in order to spread the load and select a mirror close to the user's
location.</p>

<p>As a consequence, Apache should make available the Debian website
through several virtual hosts, like this:</p>

<pre>ServerAlias www.debian.org www.debian.com debian.org www.*.debian.org</pre>
