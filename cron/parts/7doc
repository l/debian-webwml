#!/bin/bash -e

# This file updates the doc/ directory of the web pages

# Oh, how I wish the -doc people would maintain this. -- Jay Treacy
# There ain't no such thing as the -doc people these days :/ -- Josip Rodin

. `dirname $0`/../common.sh
webdocdir=$webdir/doc
ftpdocdir=$ftpdir/doc

cd $crondir/tmp

echo -n "Installing documents:"

test -d $webdocdir/packaging-manuals || install -d -g debwww -m 2775 $webdocdir/packaging-manuals

echo -n " debian-faq"
test -d $webdocdir/FAQ || install -d -g debwww -m 2775 $webdocdir/FAQ
tar -C $webdocdir/FAQ -xzf $ftpdocdir/FAQ/debian-faq.en.html.tar.gz

echo -n " policy-manual"
tar xzf $ftpdocdir/package-developer/policy.html.tar.gz
test -d $webdocdir/debian-policy || install -d -g debwww -m 2775 $webdocdir/debian-policy
install -p -g debwww -m 664 policy.html/* $webdocdir/debian-policy/
rm -rf policy.html

echo -n " fhs"
tar xzf $ftpdocdir/package-developer/fhs-2.1.html.tar.gz
test -d $webdocdir/packaging-manuals/fhs || install -d -g debwww -m 2775 $webdocdir/packaging-manuals/fhs
install -p -g debwww -m 664 fhs.html/* $webdocdir/packaging-manuals/fhs
rm -rf fhs.html

# echo -n " packaging-manual"
# tar xzf $ftpdocdir/package-developer/packaging.html.tar.gz
# test -d $webdocdir/packaging-manuals/packaging.html || install -d -g debwww -m 2775 $webdocdir/packaging-manuals/packaging.html
# install -p -g debwww -m 664 packaging.html/* $webdocdir/packaging-manuals/packaging.html/
# rm -rf packaging.html

echo -n " developers-reference"
tar xzf $ftpdocdir/package-developer/developers-reference.html.tar.gz
test -d $webdocdir/developers-reference || install -d -g debwww -m 2775 $webdocdir/developers-reference
install -p -g debwww -m 664 developers-reference.html/* $webdocdir/developers-reference/
rm -rf developers-reference.html

echo -n " maint-guide"
test -d $webdocdir/maint-guide || install -d -g debwww -m 2775 $webdocdir/maint-guide
for i in $ftpdocdir/package-developer/maint-guide*.html.tar.gz; do
  tar xzf $i
  lang=`echo $i | perl -pe 's,^.*/maint-guide(.*).html.tar.gz$,$1,'`
  if [ -z "$lang" ]; then
    (cd maint-guide.en.html; for file in *; do
      justfile=${file/.en.html/.html}
      install -p -g debwww -m 664 $file $webdocdir/maint-guide/
      ln -sf $file $webdocdir/maint-guide/$justfile
    done)
    rm -rf maint-guide.en.html
  elif [ "$lang" != ".pt" ]; then
    install -p -g debwww -m 664 maint-guide$lang.html/* $webdocdir/maint-guide/
    rm -rf maint-guide$lang.html
  else
    install -p -g debwww -m 664 maint-guide.pt_BR.html/* $webdocdir/maint-guide/
    rm -rf maint-guide.pt_BR.html
  fi
done

echo -n " virtual-package-names"
install -p -g debwww -m 664 $ftpdocdir/package-developer/virtual-package-names-list.txt $webdocdir/packaging-manuals

echo -n " build-essential"
bedeb=`ls -1 $ftpdir/pool/main/b/build-essential/build-essential_*.deb | tail -1`
dpkg-deb -x $bedeb be
install -p -g debwww -m 664 be/usr/share/doc/build-essential/list $webdocdir/packaging-manuals/build-essential
rm -rf be

echo -n " menu"
medeb=`ls -1 $ftpdir/pool/main/m/menu/menu_*.deb | tail -1`
dpkg-deb -x $medeb me
test -d $webdocdir/packaging-manuals/menu.html || install -d -g debwww -m 2775 $webdocdir/packaging-manuals/menu.html
install -p -g debwww -m 664 me/usr/share/doc/menu/html/* $webdocdir/packaging-manuals/menu.html/
rm -rf me

echo -n " menu-policy"
tar xzf $ftpdocdir/package-developer/menu-policy.html.tar.gz
test -d $webdocdir/packaging-manuals/menu-policy || install -d -g debwww -m 2775 $webdocdir/packaging-manuals/menu-policy
install -p -g debwww -m 664 menu-policy.html/* $webdocdir/packaging-manuals/menu-policy
rm -rf menu-policy.html

echo -n " perl-policy"
tar xzf $ftpdocdir/package-developer/perl-policy.html.tar.gz
test -d $webdocdir/packaging-manuals/perl-policy || install -d -g debwww -m 2775 $webdocdir/packaging-manuals/perl-policy
install -p -g debwww -m 664 perl-policy.html/* $webdocdir/packaging-manuals/perl-policy
rm -rf perl-policy.html

echo -n " mime-policy"
tar xzf $ftpdocdir/package-developer/mime-policy.html.tar.gz
test -d $webdocdir/packaging-manuals/mime-policy || install -d -g debwww -m 2775 $webdocdir/packaging-manuals/mime-policy
install -p -g debwww -m 664 mime-policy.html/* $webdocdir/packaging-manuals/mime-policy
rm -rf mime-policy.html

echo -n " emacsen-policy"
epdeb=`ls -1 $ftpdir/pool/main/e/emacsen-common/emacsen-common_*.deb | tail -1`
dpkg-deb -x $epdeb ep
zcat ep/usr/share/doc/emacsen-common/debian-emacs-policy.gz > ep/debian-emacs-policy
install -p -g debwww -m 664 ep/debian-emacs-policy $webdocdir/packaging-manuals/
rm -rf ep

echo -n " java-policy"
jcdeb=`ls -1 $ftpdir/pool/main/j/java-common/java-common_*.deb | tail -1`
dpkg-deb -x $jcdeb jc
test -d $webdocdir/packaging-manuals/java-policy || install -d -g debwww -m 2775 $webdocdir/packaging-manuals/java-policy
install -p -g debwww -m 664 jc/usr/share/doc/java-common/debian-java-policy/*.html $webdocdir/packaging-manuals/java-policy/
rm -rf jc

echo -n " dpkg-internals"
dddeb=`ls -1 $ftpdir/pool/main/d/dpkg/dpkg-doc_*.deb | tail -1`
dpkg-deb -x $dddeb dd
test -d $webdocdir/packaging-manuals/dpkg-internals || install -d -g debwww -m 2775 $webdocdir/packaging-manuals/dpkg-internals
install -p -g debwww -m 664 dd/usr/share/doc/dpkg/internals/* $webdocdir/packaging-manuals/dpkg-internals/
rm -rf dd

echo -n " libc6-migration"
install -p -g debwww -m 664 $ftpdocdir/package-developer/libc6-migration.txt $webdocdir/packaging-manuals/

# still not accounted for: libc5-libc6-Mini-HOWTO
# joy has sent a mail to Craig Sanders asking about that and the rest of the
# bo->hamm upgrade files to be added to people.d.o/~cas/ but there was no reply
# (this also affects things under /releases/hamm)

echo
