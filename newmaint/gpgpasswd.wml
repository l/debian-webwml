<?
  include("gpgconfig.inc");
  include("common.inc");
?>
#use wml::gpgpage title="GPG Signing Coordination - Get Password"
<?

    if ($email) {
        if (($db = open_db())) {
            $sql = "SELECT passwd FROM people WHERE email = '$email'";

            if (! ($result = pg_exec($db, $sql))) {
                echo "Problem with query", pg_ErrorMessage($db), "<BR>";
                return FALSE;
            }

            if (pg_NumRows($result) == 1) {
                $row = pg_Fetch_Array($result, 0);
                echo "<P>Password was mailed to you at $email.</P>";

                $body = "Hi, your password for the GPG Coordination Page is";
                $body .= $row["passwd"];
                $body .= "\n\nhttp://nm.debian.org/gpg.php\n";

                $headers = "From: gpg-coord@nm.debian.org";

                mail($email, "[GPG-Coord] Your password", $body, $headers);

            } else {
                echo "Cannot find that e-mail in the database.";
            }
        }
    } else {
        echo "No e-mail given.";
    }

?>

