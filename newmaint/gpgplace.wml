<?
  session_start();
  include("gpgconfig.inc");
  include("common.inc");
  include("gpgcommon.inc");

?>
#use wml::gpgpage title="GPG Signing Coordination - Your profile"
<?
  if (!session_is_registered("s_username")) {
?>
<STRONG>
You should not be here!</STRONG>
<?
   return FALSE;
 } else {
  session_register("s_username");
  }
?>

<?
    if (! ($db = open_db())) {
        echo "<P>Cannot open database.</P>";
        return FALSE;
    }

    $sql = "SELECT id FROM people WHERE email = '$s_username'";
    if (! ($result = pg_exec($db, $sql))) {
        echo "Problem with query", pg_ErrorMessage($db), "<BR>";
        return FALSE;
    }
    if (pg_NumRows($result) != 1) {
        echo "That e-mail address is wicked.";
        return FALSE;
    }
    $row = pg_Fetch_Array($result, 0);
    $who = $row["id"];


    # begin, finish

    # city, country


    # modify an entry (if $id exists), or add a new one)
    if ($id) {
        $sql = "SELECT begin, finish, city, country FROM places WHERE id = '$id'";
        if (! ($result = pg_exec($db, $sql))) {
            echo "Problem with query", pg_ErrorMessage($db), "<BR>";
            return FALSE;
        }

        if (pg_NumRows($result) != 1) {
            echo "Not enough or too many results.  That should not happen.";
            return FALSE;
        }

        $row = pg_Fetch_Array($result, 0);
        $begin = $row["begin"];
        $finish = $row["finish"];
        $city = $row["city"];
        $country = $row["country"];
    } else {
        $begin = $finish = "";
        $city = $country = "";
    }

?>

<div align="center">
<TABLE summary="">
<FORM method="post" action="gpgregister.php">


<?

function print_date($title, $name, $date) {

    $parsed_date = split("-", $date);
    $year = $parsed_date[0];
    $month = $parsed_date[1];
    $day = $parsed_date[2];

    echo "<TR><TD>$title</TD><TD><SELECT name = \"";
    echo $name;
    echo "_year\">";

    $years = array("2001", "2002", "2003", "always");
    foreach ($years as $i) {
        echo "<OPTION";
        if ($year == $i || (!year && $i == "always")) {
            echo " SELECTED";
        }
        echo ">$i\n";
    }

    echo "</SELECT></TD>";
    echo "<TD><SELECT name = \"";
    echo $name;
    echo "_month\">";

    $months = array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December");
    $counter = 1;
    foreach ($months as $i) {
        echo "<OPTION value=$counter";
        if ($month == $counter) {
            echo " SELECTED";
        }
        echo ">$i\n";
        $counter = $counter + 1;
    }

    echo "</SELECT></TD>";
    echo "<TD><SELECT name = \"";
    echo $name;
    echo "_day\">";

    for ($i = 1; $i < 32; $i++) {
        echo "<OPTION";
        if ($day == $i) {
            echo " SELECTED";
        }
        echo ">$i";
    }
    echo "</SELECT></TD>";
    echo "</TR>";
    echo "\n";
}
?>

<?

    print_date("Begin", "begin", $begin);
    print_date("End", "end", $finish);

?>


<TR><TD><B>City</B></TD><TD><INPUT name = "city" type = "text" value="<? echo $city ?>"></TD></TR>
<TR><TD><B>Country</B></TD><TD><INPUT name = "country" type = "text" value="<? echo $country ?>"></TD></TR>
</FORM>
</TD>
</TR>
</TABLE>

