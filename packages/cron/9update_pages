#! /bin/bash

. `dirname $0`/../config.sh

test -d $htmldir || mkdir -p $htmldir

for dist in ${dists}
do
  foo=\$arch_${dist//-/_}
  test -d ${htmldir}/${dist} || mkdir -p ${htmldir}/${dist}
  rm -f ${filesdir}/*dbfile
  ${scriptdir}/create_package_pages --html_root="${htmldir}/${dist}" \
      --locales=${localedir} --langs="${ddtplangs}" --quiet \
      --md5file="${filesdir}/md5sums.${dist}" --distribution=${dist} \
      --indices=${filesdir}/archive --debian_site=${ftpsite} \
      --nonus_site=${nonus_ftpsite} --security_site=${security_ftpsite} \
      --subdists="security non-US" --archs="`eval echo $foo`" \
      --parts="${parts}" --dbfile="${filesdir}/dbfile" \
      --srcdbfile="${filesdir}/srcdbfile"
done

test -d ${htmldir}/experimental || mkdir -p ${htmldir}/experimental
rm -f ${filesdir}/*dbfile
${scriptdir}/create_package_pages --html_root="${htmldir}/experimental" \
    --locales=${localedir} --quiet \
    --md5file="${filesdir}/md5sums.experimental" \
    --distribution=experimental --indices=${filesdir}/archive \
    --debian_site=${ftpsite} --nonus_site=${nonus_ftpsite} \
    --security_site=${security_ftpsite} --archs="${arch_experimental}" \
    --parts="${parts}" --dbfile="${filesdir}/dbfile" \
    --srcdbfile="${filesdir}/srcdbfile"

# Backwards compatibility
#
find ${htmldir} -name '*.en.html' |\
while read f
do
    ln=${f%.en.html}.html
    test -L ${ln} || ln -s `basename $f` $ln
done

# remove stale files
${bindir}/remove-stale ${filesdir}/md5sums.*
