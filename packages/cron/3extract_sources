#! /bin/bash

. `dirname $0`/../config.sh

flatdir=${filesdir}/flat
test -d ${flatdir} || mkdir -p ${flatdir}

cd ${archivedir}

# Main Archive
#
for dist in ${dists} experimental
do
    test -d ${flatdir}/${dist} || mkdir -p ${flatdir}/${dist}
    cd us/${dist}
    for part in ${parts}
      do
      if [ -f ${part}/source/Sources.gz ]
	  then
	  test -d ${flatdir}/${dist}/${part} || mkdir -p ${flatdir}/${dist}/${part}
	  $bindir/flatten-db \
	      --db ${part}/source/Sources.gz \
	      --output ${flatdir}/${dist}/${part}/Sources.us
      fi
    done
    cd ${archivedir}
done

# non-US
#
for dist in ${dists}
do
    test -d ${flatdir}/${dist} || mkdir -p ${flatdir}/${dist}
    cd non-US/${dist}
    for part in ${parts}
      do
      if [ -f ${part}/source/Sources.gz ]
	  then
	  test -d ${flatdir}/${dist}/${part} || mkdir -p ${flatdir}/${dist}/${part}
	  $bindir/flatten-db \
	      --db ${part}/source/Sources.gz \
	      --output ${flatdir}/${dist}/${part}/Sources.non-US
      fi
    done
    cd ${archivedir}
done
