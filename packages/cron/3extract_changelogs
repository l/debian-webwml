#!/bin/bash

. `dirname $0`/../config.sh
 
if test -z "${localdir}"; then
    echo skipping due to missing local archive
    exit 1
fi

#set -e

NOCPY_TEMPLATE=$topdir/etc/copyright_error
NOCPY_BIN_TEMPLATE=$topdir/etc/copyright_error_bin

logs=$topdir/files/logs
log=${logs}/changelogs.log

test -d $logs || mkdir -p $logs

if [ -s $log ]
then
    savelog -c 14 $log > /dev/null
fi

(
date

for part in $parts; do
	${bindir}/extract_files -v -d ${localdir}/pool/$parts/ \
		-t ${htmldir}/changelogs/pool/$parts/
done

find ${htmldir}/changelogs/ -name log -cmin +3600 \
 | while read logfile; do
 	dir=$(dirname "$logfile")
	echo deleting $dir
 	rm -r "$dir"
done

date
) > $log 2>&1
