#!/bin/bash
# Copyright 2003 Noel Köthe
# Copyright 2004 Martin Schulze <joey@debian.org>
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

. `dirname $0`/../config.sh
 
if test -z "${localdir}"; then
    echo skipping due to missing local archive
    exit 1
fi

#set -e

NOCPY_TEMPLATE=$topdir/etc/copyright_error
NOCPY_BIN_TEMPLATE=$topdir/etc/copyright_error_bin

logs=$topdir/files/logs
log=${logs}/changelogs.log

test -d $logs || mkdir -p $logs

if [ -s $log ]
then
    savelog -c 14 $log > /dev/null
fi

(
date

for part in $parts; do
	${bindir}/extract_files -v -d ${localdir}/pool/$parts/ \
		-t ${htmldir}/changelogs/$parts/
done

find ${htmldir}/changelogs/ -name log -cmin +3600 \
 | while read logfile; do
 	dir=$(dirname "$logfile")
	echo deleting $dir
 	rm -r "$dir"
done

date
) > $log 2>&1
