#! /bin/bash

. `dirname $0`/../config.sh

test -d ${archivedir} || mkdir -p ${archivedir}
cd ${archivedir}

# Main archive
#
if [ -z "${localdir}" ]
then
    for dist in $dists
    do

	foo=\$arch_${dist//-/_}
	for arch in `eval echo $foo`
	do
	    for part in main contrib non-free
	    do
		test -d us/${dist}/${part}/binary-${arch} || mkdir -p us/${dist}/${part}/binary-${arch}
		wget -q -N -O us/${dist}/${part}/binary-${arch}/Packages.gz \
		    ${ftpsite}/dists/${dist}/${part}/binary-${arch}/Packages.gz
	    done
	    wget -q -N -O us/${dist}/Contents-${arch}.gz \
		${ftpsite}/dists/${dist}/Contents-${arch}.gz
	done
    done
else
    for dist in $dists
    do
	foo=\$arch_${dist//-/_}
	for arch in `eval echo $foo`
	do
	    for part in main contrib non-free
	    do
		test -d us/${dist}/${part}/binary-${arch} || mkdir -p us/${dist}/${part}/binary-${arch}
		rsync ${localdir}/dists/${dist}/${part}/binary-${arch}/Packages.gz \
		    us/${dist}/${part}/binary-${arch}/Packages.gz
	    done
	    rsync ${localdir}/dists/${dist}/Contents-${arch}.gz \
		us/${dist}/Contents-${arch}.gz
	done
    done
fi

# Non-US archive
#
for dist in $dists
do
    foo=\$arch_${dist//-/_}
    for arch in `eval echo $foo`
    do
	for part in main contrib non-free
	do
	    test -d non-US/${dist}/${part}/binary-${arch} || mkdir -p non-US/${dist}/${part}/binary-${arch}
	    wget -q -N -O non-US/${dist}/${part}/binary-${arch}/Packages.gz \
		${nonus_ftpsite}/dists/${dist}/${part}/binary-${arch}/Packages.gz
	done
	wget -q -N -O non-US/${dist}/Contents-${arch}.gz \
	    ${nonus_ftpsite}/dists/${dist}/Contents-${arch}.gz
    done
done

# security archive
#
for dist in stable testing
do
    foo=\$arch_${dist//-/_}
    for arch in `eval echo $foo`
    do
	test -d security/${dist}/main/binary-${arch} || mkdir -p security/${dist}/main/binary-${arch}
	wget -q -N -O security/${dist}/main/binary-${arch}/Packages.gz \
	    ${security_ftpsite}/dists/${dist}/updates/main/binary-${arch}/Packages.gz
    done
done
